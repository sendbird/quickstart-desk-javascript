!function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/dist",n(n.s=13)}([function(e,t,n){(function(t,n){e.exports=function(){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),e}function a(e){return(a=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function o(e,t){return(o=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function u(e,t,n){return(u=l()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&o(i,n.prototype),i}).apply(null,arguments)}function c(e){var t="function"==typeof Map?new Map:void 0;return(c=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return u(e,arguments,a(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),o(n,e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e){return function(){var t,n=a(e);if(l()){var r=a(this).constructor;t=Reflect.construct(n,arguments,r)}else t=n.apply(this,arguments);return function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}(this,t)}}function f(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}var p=Object.prototype.toString;function g(e){return"[object Array]"===p.call(e)}function y(e){return void 0===e}function m(e){return null!==e&&"object"==typeof e}function _(e){return"[object Function]"===p.call(e)}function v(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),g(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}var E={isArray:g,isArrayBuffer:function(e){return"[object ArrayBuffer]"===p.call(e)},isBuffer:function(e){return null!==e&&!y(e)&&null!==e.constructor&&!y(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:m,isUndefined:y,isDate:function(e){return"[object Date]"===p.call(e)},isFile:function(e){return"[object File]"===p.call(e)},isBlob:function(e){return"[object Blob]"===p.call(e)},isFunction:_,isStream:function(e){return m(e)&&_(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&"undefined"!=typeof window&&"undefined"!=typeof document},forEach:v,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,i=arguments.length;r<i;r++)v(arguments[r],n);return t},deepMerge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]="object"==typeof n?e({},n):n}for(var r=0,i=arguments.length;r<i;r++)v(arguments[r],n);return t},extend:function(e,t,n){return v(t,(function(t,r){e[r]=n&&"function"==typeof t?f(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}};function C(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function b(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(E.isURLSearchParams(t))r=t.toString();else{var i=[];E.forEach(t,(function(e,t){null!=e&&(E.isArray(e)?t+="[]":e=[e],E.forEach(e,(function(e){E.isDate(e)?e=e.toISOString():E.isObject(e)&&(e=JSON.stringify(e)),i.push(C(t)+"="+C(e))})))})),r=i.join("&")}if(r){var s=e.indexOf("#");-1!==s&&(e=e.slice(0,s)),e+=(-1===e.indexOf("?")?"?":"&")+r}return e}function S(){this.handlers=[]}function A(e,t,n){return E.forEach(n,(function(n){e=n(e,t)})),e}function I(e){return!(!e||!e.__CANCEL__)}function U(e,t){E.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}function k(e,t,n,r,i){return function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}(new Error(e),t,n,r,i)}S.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},S.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},S.prototype.forEach=function(e){E.forEach(this.handlers,(function(t){null!==t&&e(t)}))};var N,R,T,O=S,w=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],M=E.isStandardBrowserEnv()?(R=/(msie|trident)/i.test(navigator.userAgent),T=document.createElement("a"),N=L(window.location.href),function(e){var t=E.isString(e)?L(e):e;return t.protocol===N.protocol&&t.host===N.host}):function(){return!0};function L(e){var t=e;return R&&(T.setAttribute("href",t),t=T.href),T.setAttribute("href",t),{href:T.href,protocol:T.protocol?T.protocol.replace(/:$/,""):"",host:T.host,search:T.search?T.search.replace(/^\?/,""):"",hash:T.hash?T.hash.replace(/^#/,""):"",hostname:T.hostname,port:T.port,pathname:"/"===T.pathname.charAt(0)?T.pathname:"/"+T.pathname}}function P(e){return new Promise((function(t,n){var r=e.data,i=e.headers;E.isFormData(r)&&delete i["Content-Type"];var s=new XMLHttpRequest;if(e.auth){var a=e.auth.username||"",o=e.auth.password||"";i.Authorization="Basic "+btoa(a+":"+o)}var l=function(e,t){return e&&!function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}(t)?function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}(e,t):t}(e.baseURL,e.url);if(s.open(e.method.toUpperCase(),b(l,e.params,e.paramsSerializer),!0),s.timeout=e.timeout,s.onreadystatechange=function(){if(s&&4===s.readyState&&(0!==s.status||s.responseURL&&0===s.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in s?function(e){var t,n,r,i={};return e&&E.forEach(e.split("\n"),(function(e){if(r=e.indexOf(":"),t=E.trim(e.substr(0,r)).toLowerCase(),n=E.trim(e.substr(r+1)),t){if(i[t]&&0<=w.indexOf(t))return;i[t]="set-cookie"===t?(i[t]?i[t]:[]).concat([n]):i[t]?i[t]+", "+n:n}})),i}(s.getAllResponseHeaders()):null,i={data:e.responseType&&"text"!==e.responseType?s.response:s.responseText,status:s.status,statusText:s.statusText,headers:r,config:e,request:s};!function(e,t,n){var r=n.config.validateStatus;!r||r(n.status)?e(n):t(k("Request failed with status code "+n.status,n.config,null,n.request,n))}(t,n,i),s=null}},s.onabort=function(){s&&(n(k("Request aborted",e,"ECONNABORTED",s)),s=null)},s.onerror=function(){n(k("Network Error",e,null,s)),s=null},s.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),n(k(t,e,"ECONNABORTED",s)),s=null},E.isStandardBrowserEnv()){var u=D,c=(e.withCredentials||M(l))&&e.xsrfCookieName?u.read(e.xsrfCookieName):void 0;c&&(i[e.xsrfHeaderName]=c)}if("setRequestHeader"in s&&E.forEach(i,(function(e,t){void 0===r&&"content-type"===t.toLowerCase()?delete i[t]:s.setRequestHeader(t,e)})),E.isUndefined(e.withCredentials)||(s.withCredentials=!!e.withCredentials),e.responseType)try{s.responseType=e.responseType}catch(a){if("json"!==e.responseType)throw a}"function"==typeof e.onDownloadProgress&&s.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&s.upload&&s.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){s&&(s.abort(),n(e),s=null)})),void 0===r&&(r=null),s.send(r)}))}var D=E.isStandardBrowserEnv()?{write:function(e,t,n,r,i,s){var a=[];a.push(e+"="+encodeURIComponent(t)),E.isNumber(n)&&a.push("expires="+new Date(n).toGMTString()),E.isString(r)&&a.push("path="+r),E.isString(i)&&a.push("domain="+i),!0===s&&a.push("secure"),document.cookie=a.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},H={"Content-Type":"application/x-www-form-urlencoded"};function F(e,t){!E.isUndefined(e)&&E.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var G,x={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(G=P),G),transformRequest:[function(e,t){return U(t,"Accept"),U(t,"Content-Type"),E.isFormData(e)||E.isArrayBuffer(e)||E.isBuffer(e)||E.isStream(e)||E.isFile(e)||E.isBlob(e)?e:E.isArrayBufferView(e)?e.buffer:E.isURLSearchParams(e)?(F(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):E.isObject(e)?(F(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return 200<=e&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};E.forEach(["delete","get","head"],(function(e){x.headers[e]={}})),E.forEach(["post","put","patch"],(function(e){x.headers[e]=E.merge(H)}));var B=x;function j(e){e.cancelToken&&e.cancelToken.throwIfRequested()}function q(e){return j(e),e.headers=e.headers||{},e.data=A(e.data,e.headers,e.transformRequest),e.headers=E.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),E.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||B.adapter)(e).then((function(t){return j(e),t.data=A(t.data,t.headers,e.transformResponse),t}),(function(t){return I(t)||(j(e),t&&t.response&&(t.response.data=A(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}function z(e,t){t=t||{};var n={},r=["url","method","params","data"],i=["headers","auth","proxy"],s=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];E.forEach(r,(function(e){void 0!==t[e]&&(n[e]=t[e])})),E.forEach(i,(function(r){E.isObject(t[r])?n[r]=E.deepMerge(e[r],t[r]):void 0!==t[r]?n[r]=t[r]:E.isObject(e[r])?n[r]=E.deepMerge(e[r]):void 0!==e[r]&&(n[r]=e[r])})),E.forEach(s,(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])}));var a=r.concat(i).concat(s),o=Object.keys(t).filter((function(e){return-1===a.indexOf(e)}));return E.forEach(o,(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])})),n}function Y(e){this.defaults=e,this.interceptors={request:new O,response:new O}}Y.prototype.request=function(e,t){"string"==typeof e?(e=t||{}).url=arguments[0]:e=e||{},(e=z(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var n=[q,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){n.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){n.push(e.fulfilled,e.rejected)}));n.length;)r=r.then(n.shift(),n.shift());return r},Y.prototype.getUri=function(e){return b((e=z(this.defaults,e)).url,e.params,e.paramsSerializer).replace(/^\?/,"")},E.forEach(["delete","get","head","options"],(function(e){Y.prototype[e]=function(t,n){return this.request(E.merge(n||{},{method:e,url:t}))}})),E.forEach(["post","put","patch"],(function(e){Y.prototype[e]=function(t,n,r){return this.request(E.merge(r||{},{method:e,url:t,data:n}))}}));var Q=Y;function K(e){this.message=e}K.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},K.prototype.__CANCEL__=!0;var V=K;function W(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new V(e),t(n.reason))}))}W.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},W.source=function(){var e;return{token:new W((function(t){e=t})),cancel:e}};var J=W;function X(e){var t=new Q(e),n=f(Q.prototype.request,t);return E.extend(n,Q.prototype,t),E.extend(n,t),n}var $=X(B);$.Axios=Q,$.create=function(e){return X(z($.defaults,e))},$.Cancel=V,$.CancelToken=J,$.isCancel=I,$.all=function(e){return Promise.all(e)},$.spread=function(e){return function(t){return e.apply(null,t)}};var Z=$,ee=$;function te(e){try{return!!e()}catch(e){return!0}}function ne(e){return ae.call(e).slice(8,-1)}function re(e){if(null==e)throw TypeError("Can't call method on "+e);return e}function ie(e){return le(re(e))}Z.default=ee;var se=Z,ae={}.toString,oe="".split,le=te((function(){return!Object("z").propertyIsEnumerable(0)}))?function(e){return"String"==ne(e)?oe.call(e,""):Object(e)}:Object,ue="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==n?n:"undefined"!=typeof self?self:{};function ce(e,t){return e(t={exports:{}},t.exports),t.exports}function de(e){return e&&e.Math==Math&&e}function he(e){return"object"==typeof e?null!==e:"function"==typeof e}function fe(e){return Le?Me.createElement(e):{}}function pe(e){if(!he(e))throw TypeError(String(e)+" is not an object");return e}function ge(e,t){if(!he(e))return e;var n,r;if(t&&"function"==typeof(n=e.toString)&&!he(r=n.call(e)))return r;if("function"==typeof(n=e.valueOf)&&!he(r=n.call(e)))return r;if(!t&&"function"==typeof(n=e.toString)&&!he(r=n.call(e)))return r;throw TypeError("Can't convert object to primitive value")}function ye(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}function me(e,t){try{Fe(Oe,e,t)}catch(n){Oe[e]=t}return t}function _e(e,t){return je.call(e,t)}function ve(e){return"Symbol("+String(void 0===e?"":e)+")_"+(++qe+ze).toString(36)}function Ee(e){return _e(Ke,e)||(Ye&&_e(Ve,e)?Ke[e]=Ve[e]:Ke[e]=We("Symbol."+e)),Ke[e]}function Ce(e){return isNaN(e=+e)?0:(0<e?Xe:Je)(e)}function be(e){return 0<e?$e(Ce(e),9007199254740991):0}function Se(e){return function(t,n,r){var i,s=ie(t),a=be(s.length),o=function(e,t){var n=Ce(e);return n<0?Ze(n+t,0):et(n,t)}(r,a);if(e&&n!=n){for(;o<a;)if((i=s[o++])!=i)return!0}else for(;o<a;o++)if((e||o in s)&&s[o]===n)return e||o||0;return!e&&-1}}function Ae(e,t){var n,r=ie(e),i=0,s=[];for(n in r)!_e(nt,n)&&_e(r,n)&&s.push(n);for(;t.length>i;)_e(r,n=t[i++])&&(~rt(s,n)||s.push(n));return s}function Ie(e){return"function"==typeof e?e:void 0}function Ue(e,t){return arguments.length<2?Ie(ot[e])||Ie(Oe[e]):ot[e]&&ot[e][t]||Oe[e]&&Oe[e][t]}function ke(e){return ut[e]||(ut[e]=ve(e))}function Ne(){}function Re(e){return"<script>"+e+"</"+dt+">"}var Te,Oe=de("object"==typeof globalThis&&globalThis)||de("object"==typeof window&&window)||de("object"==typeof self&&self)||de("object"==typeof ue&&ue)||Function("return this")(),we=!te((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),Me=Oe.document,Le=he(Me)&&he(Me.createElement),Pe=!we&&!te((function(){return 7!=Object.defineProperty(fe("div"),"a",{get:function(){return 7}}).a})),De=Object.defineProperty,He={f:we?De:function(e,t,n){if(pe(e),t=ge(t,!0),pe(n),Pe)try{return De(e,t,n)}catch(e){}if("get"in n||"set"in n)throw TypeError("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},Fe=we?function(e,t,n){return He.f(e,t,ye(1,n))}:function(e,t,n){return e[t]=n,e},Ge="__core-js_shared__",xe=Oe[Ge]||me(Ge,{}),Be=ce((function(e){(e.exports=function(e,t){return xe[e]||(xe[e]=void 0!==t?t:{})})("versions",[]).push({version:"3.6.5",mode:"global",copyright:"Â© 2020 Denis Pushkarev (zloirock.ru)"})})),je={}.hasOwnProperty,qe=0,ze=Math.random(),Ye=!!Object.getOwnPropertySymbols&&!te((function(){return!String(Symbol())})),Qe=Ye&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,Ke=Be("wks"),Ve=Oe.Symbol,We=Qe?Ve:Ve&&Ve.withoutSetter||ve,Je=Math.ceil,Xe=Math.floor,$e=Math.min,Ze=Math.max,et=Math.min,tt={includes:Se(!0),indexOf:Se(!1)},nt={},rt=tt.indexOf,it=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],st=Object.keys||function(e){return Ae(e,it)},at=we?Object.defineProperties:function(e,t){pe(e);for(var n,r=st(t),i=r.length,s=0;s<i;)He.f(e,n=r[s++],t[n]);return e},ot=Oe,lt=Ue("document","documentElement"),ut=Be("keys"),ct="prototype",dt="script",ht=ke("IE_PROTO"),ft=function(){try{Te=document.domain&&new ActiveXObject("htmlfile")}catch(e){}ft=Te?function(e){e.write(Re("")),e.close();var t=e.parentWindow.Object;return e=null,t}(Te):function(){var e,t=fe("iframe");return t.style.display="none",lt.appendChild(t),t.src=String("javascript:"),(e=t.contentWindow.document).open(),e.write(Re("document.F=Object")),e.close(),e.F}();for(var e=it.length;e--;)delete ft[ct][it[e]];return ft()};nt[ht]=!0;var pt=Object.create||function(e,t){var n;return null!==e?(Ne[ct]=pe(e),n=new Ne,Ne[ct]=null,n[ht]=e):n=ft(),void 0===t?n:at(n,t)},gt=Ee("unscopables"),yt=Array.prototype;function mt(e){yt[gt][e]=!0}null==yt[gt]&&He.f(yt,gt,{configurable:!0,value:pt(null)});var _t={},vt=Function.toString;"function"!=typeof xe.inspectSource&&(xe.inspectSource=function(e){return vt.call(e)});var Et,Ct,bt,St=xe.inspectSource,At=Oe.WeakMap,It="function"==typeof At&&/native code/.test(St(At)),Ut=Oe.WeakMap;if(It){var kt=new Ut,Nt=kt.get,Rt=kt.has,Tt=kt.set;Et=function(e,t){return Tt.call(kt,e,t),t},Ct=function(e){return Nt.call(kt,e)||{}},bt=function(e){return Rt.call(kt,e)}}else{var Ot=ke("state");nt[Ot]=!0,Et=function(e,t){return Fe(e,Ot,t),t},Ct=function(e){return _e(e,Ot)?e[Ot]:{}},bt=function(e){return _e(e,Ot)}}function wt(e,t){for(var n=Wt(t),r=He.f,i=zt.f,s=0;s<n.length;s++){var a=n[s];_e(e,a)||r(e,a,i(t,a))}}function Mt(e,t){var n=$t[Xt(e)];return n==en||n!=Zt&&("function"==typeof t?te(t):!!t)}function Lt(e,t){var n,r,i,s,a,o=e.target,l=e.global,u=e.stat;if(n=l?Oe:u?Oe[o]||me(o,{}):(Oe[o]||{}).prototype)for(r in t){if(s=t[r],i=e.noTargetGet?(a=nn(n,r))&&a.value:n[r],!tn(l?r:o+(u?".":"#")+r,e.forced)&&void 0!==i){if(typeof s==typeof i)continue;wt(s,i)}(e.sham||i&&i.sham)&&Fe(s,"sham",!0),Yt(n,r,s,e)}}function Pt(e){return Object(re(e))}var Dt,Ht,Ft,Gt={set:Et,get:Ct,has:bt,enforce:function(e){return bt(e)?Ct(e):Et(e,{})},getterFor:function(e){return function(t){var n;if(!he(t)||(n=Ct(t)).type!==e)throw TypeError("Incompatible receiver, "+e+" required");return n}}},xt={}.propertyIsEnumerable,Bt=Object.getOwnPropertyDescriptor,jt={f:Bt&&!xt.call({1:2},1)?function(e){var t=Bt(this,e);return!!t&&t.enumerable}:xt},qt=Object.getOwnPropertyDescriptor,zt={f:we?qt:function(e,t){if(e=ie(e),t=ge(t,!0),Pe)try{return qt(e,t)}catch(e){}if(_e(e,t))return ye(!jt.f.call(e,t),e[t])}},Yt=ce((function(e){var t=Gt.get,n=Gt.enforce,r=String(String).split("String");(e.exports=function(e,t,i,s){var a=!!s&&!!s.unsafe,o=!!s&&!!s.enumerable,l=!!s&&!!s.noTargetGet;"function"==typeof i&&("string"!=typeof t||_e(i,"name")||Fe(i,"name",t),n(i).source=r.join("string"==typeof t?t:"")),e!==Oe?(a?!l&&e[t]&&(o=!0):delete e[t],o?e[t]=i:Fe(e,t,i)):o?e[t]=i:me(t,i)})(Function.prototype,"toString",(function(){return"function"==typeof this&&t(this).source||St(this)}))})),Qt=it.concat("length","prototype"),Kt={f:Object.getOwnPropertyNames||function(e){return Ae(e,Qt)}},Vt={f:Object.getOwnPropertySymbols},Wt=Ue("Reflect","ownKeys")||function(e){var t=Kt.f(pe(e)),n=Vt.f;return n?t.concat(n(e)):t},Jt=/#|\.prototype\./,Xt=Mt.normalize=function(e){return String(e).replace(Jt,".").toLowerCase()},$t=Mt.data={},Zt=Mt.NATIVE="N",en=Mt.POLYFILL="P",tn=Mt,nn=zt.f,rn=!te((function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype})),sn=ke("IE_PROTO"),an=Object.prototype,on=rn?Object.getPrototypeOf:function(e){return _e(e=Pt(e),sn)?e[sn]:"function"==typeof e.constructor&&e instanceof e.constructor?e.constructor.prototype:e instanceof Object?an:null},ln=Ee("iterator"),un=!1;function cn(e,t,n){e&&!_e(e=n?e:e.prototype,yn)&&gn(e,yn,{configurable:!0,value:t})}function dn(){return this}function hn(){return this}function fn(e,t,n,r,i,s,a){function o(e){if(e===i&&g)return g;if(!En&&e in f)return f[e];switch(e){case"keys":case bn:case Sn:return function(){return new n(this,e)}}return function(){return new n(this)}}!function(e,t,n){var r=t+" Iterator";e.prototype=pt(mn,{next:ye(1,n)}),cn(e,r,!1),_t[r]=dn}(n,t,r);var l,u,c,d=t+" Iterator",h=!1,f=e.prototype,p=f[Cn]||f["@@iterator"]||i&&f[i],g=!En&&p||o(i),y="Array"==t&&f.entries||p;if(y&&(l=on(y.call(new e)),vn!==Object.prototype&&l.next&&(on(l)!==vn&&(_n?_n(l,vn):"function"!=typeof l[Cn]&&Fe(l,Cn,hn)),cn(l,d,!0))),i==bn&&p&&p.name!==bn&&(h=!0,g=function(){return p.call(this)}),f[Cn]!==g&&Fe(f,Cn,g),_t[t]=g,i)if(u={values:o(bn),keys:s?g:o("keys"),entries:o(Sn)},a)for(c in u)!En&&!h&&c in f||Yt(f,c,u[c]);else Lt({target:t,proto:!0,forced:En||h},u);return u}[].keys&&("next"in(Ft=[].keys())?(Ht=on(on(Ft)))!==Object.prototype&&(Dt=Ht):un=!0),null==Dt&&(Dt={}),_e(Dt,ln)||Fe(Dt,ln,(function(){return this}));var pn={IteratorPrototype:Dt,BUGGY_SAFARI_ITERATORS:un},gn=He.f,yn=Ee("toStringTag"),mn=pn.IteratorPrototype,_n=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set).call(n,[]),t=n instanceof Array}catch(n){}return function(n,r){return pe(n),function(e){if(!he(e)&&null!==e)throw TypeError("Can't set "+String(e)+" as a prototype")}(r),t?e.call(n,r):n.__proto__=r,n}}():void 0),vn=pn.IteratorPrototype,En=pn.BUGGY_SAFARI_ITERATORS,Cn=Ee("iterator"),bn="values",Sn="entries",An="Array Iterator",In=Gt.set,Un=Gt.getterFor(An),kn=fn(Array,"Array",(function(e,t){In(this,{type:An,target:ie(e),index:0,kind:t})}),(function(){var e=Un(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?{value:e.target=void 0,done:!0}:"keys"==n?{value:r,done:!1}:"values"==n?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}}),"values");_t.Arguments=_t.Array,mt("keys"),mt("values"),mt("entries");var Nn={};Nn[Ee("toStringTag")]="z";var Rn="[object z]"===String(Nn),Tn=Ee("toStringTag"),On="Arguments"==ne(function(){return arguments}()),wn=Rn?ne:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=function(e,t){try{return e[t]}catch(e){}}(t=Object(e),Tn))?n:On?ne(t):"Object"==(r=ne(t))&&"function"==typeof t.callee?"Arguments":r},Mn=Rn?{}.toString:function(){return"[object "+wn(this)+"]"};function Ln(e,t){return RegExp(e,t)}Rn||Yt(Object.prototype,"toString",Mn,{unsafe:!0});var Pn,Dn,Hn={UNSUPPORTED_Y:te((function(){var e=Ln("a","y");return e.lastIndex=2,null!=e.exec("abcd")})),BROKEN_CARET:te((function(){var e=Ln("^r","gy");return e.lastIndex=2,null!=e.exec("str")}))},Fn=RegExp.prototype.exec,Gn=String.prototype.replace,xn=Fn,Bn=(Pn=/a/,Dn=/b*/g,Fn.call(Pn,"a"),Fn.call(Dn,"a"),0!==Pn.lastIndex||0!==Dn.lastIndex),jn=Hn.UNSUPPORTED_Y||Hn.BROKEN_CARET,qn=void 0!==/()??/.exec("")[1];(Bn||qn||jn)&&(xn=function(e){var t,n,r,i,s=this,a=jn&&s.sticky,o=function(){var e=pe(this),t="";return e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.sticky&&(t+="y"),t}.call(s),l=s.source,u=0,c=e;return a&&(-1===(o=o.replace("y","")).indexOf("g")&&(o+="g"),c=String(e).slice(s.lastIndex),0<s.lastIndex&&(!s.multiline||s.multiline&&"\n"!==e[s.lastIndex-1])&&(l="(?: "+l+")",c=" "+c,u++),n=new RegExp("^(?:"+l+")",o)),qn&&(n=new RegExp("^"+l+"$(?!\\s)",o)),Bn&&(t=s.lastIndex),r=Fn.call(a?n:s,c),a?r?(r.input=r.input.slice(u),r[0]=r[0].slice(u),r.index=s.lastIndex,s.lastIndex+=r[0].length):s.lastIndex=0:Bn&&r&&(s.lastIndex=s.global?r.index+r[0].length:t),qn&&r&&1<r.length&&Gn.call(r[0],n,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(r[i]=void 0)})),r});var zn=xn;function Yn(e){return function(t,n){var r,i,s=String(re(t)),a=Ce(n),o=s.length;return a<0||o<=a?e?"":void 0:(r=s.charCodeAt(a))<55296||56319<r||a+1===o||(i=s.charCodeAt(a+1))<56320||57343<i?e?s.charAt(a):r:e?s.slice(a,a+2):i-56320+(r-55296<<10)+65536}}Lt({target:"RegExp",proto:!0,forced:/./.exec!==zn},{exec:zn});var Qn={codeAt:Yn(!1),charAt:Yn(!0)},Kn=Qn.charAt,Vn="String Iterator",Wn=Gt.set,Jn=Gt.getterFor(Vn);function Xn(e){if("function"!=typeof e)throw TypeError(String(e)+" is not a function");return e}function $n(e,t){var n=e.exec;if("function"==typeof n){var r=n.call(e,t);if("object"!=typeof r)throw TypeError("RegExp exec method returned something other than an Object or null");return r}if("RegExp"!==ne(e))throw TypeError("RegExp#exec called on incompatible receiver");return zn.call(e,t)}fn(String,"String",(function(e){Wn(this,{type:Vn,string:String(e),index:0})}),(function(){var e,t=Jn(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=Kn(n,r),t.index+=e.length,{value:e,done:!1})}));var Zn=Ee("species"),er=(te((function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})),"a".replace(/./,"$0"),Ee("replace")),tr=(!!/./[er]&&/./[er]("a","$0"),!te((function(){var e=/(?:)/,t=e.exec;e.exec=function(){return t.apply(this,arguments)};var n="ab".split(e);return 2!==n.length||"a"!==n[0]||"b"!==n[1]}))),nr=Ee("match"),rr=Ee("species"),ir=Qn.charAt,sr=[].push,ar=Math.min,or=4294967295,lr=!te((function(){return!RegExp(or,"y")}));function ur(e,t,n){for(var r in t)Yt(e,r,t[r],n);return e}function cr(e,t,n){if(Xn(e),void 0===t)return e;switch(n){case 0:return function(){return e.call(t)};case 1:return function(n){return e.call(t,n)};case 2:return function(n,r){return e.call(t,n,r)};case 3:return function(n,r,i){return e.call(t,n,r,i)}}return function(){return e.apply(t,arguments)}}function dr(e,t,n,r){try{return r?t(pe(n)[0],n[1]):t(n)}catch(t){var i=e.return;throw void 0!==i&&pe(i.call(e)),t}}function hr(e,t,n){if(!(e instanceof t))throw TypeError("Incorrect "+(n?n+" ":"")+"invocation");return e}!function(e,t,n,r){var i=Ee(e),s=!te((function(){var t={};return t[i]=function(){return 7},7!=""[e](t)})),a=s&&!te((function(){var e=!1,t=/a/;return(t={constructor:{}}).constructor[Zn]=function(){return t},t.flags="",t[i]=/./[i],t.exec=function(){return e=!0,null},t[i](""),!e}));if(!s||!a||!tr){var o=/./[i],l=function(e,t,n){var r;return r="c"=="abbc".split(/(b)*/)[1]||4!="test".split(/(?:)/,-1).length||2!="ab".split(/(?:ab)*/).length||4!=".".split(/(.?)(.?)/).length||1<".".split(/()()/).length||"".split(/.?/).length?function(e,n){var r=String(re(this)),i=void 0===n?or:n>>>0;if(0==i)return[];if(void 0===e)return[r];if(!function(e){var t;return he(e)&&(void 0!==(t=e[nr])?!!t:"RegExp"==ne(e))}(e))return t.call(r,e,i);for(var s,a,o,l=[],u=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(e.sticky?"y":""),c=0,d=new RegExp(e.source,u+"g");(s=zn.call(d,r))&&!(c<(a=d.lastIndex)&&(l.push(r.slice(c,s.index)),1<s.length&&s.index<r.length&&sr.apply(l,s.slice(1)),o=s[0].length,c=a,l.length>=i));)d.lastIndex===s.index&&d.lastIndex++;return c===r.length?!o&&d.test("")||l.push(""):l.push(r.slice(c)),l.length>i?l.slice(0,i):l}:"0".split(void 0,0).length?function(e,n){return void 0===e&&0===n?[]:t.call(this,e,n)}:t,[function(t,n){var i=re(this),s=null==t?void 0:t[e];return void 0!==s?s.call(t,i,n):r.call(String(i),t,n)},function(e,i){var s=n(r,e,this,i,r!==t);if(s.done)return s.value;var a=pe(e),o=String(this),l=function(e,t){var n,r=pe(e).constructor;return void 0===r||null==(n=pe(r)[rr])?t:Xn(n)}(a,RegExp),u=a.unicode,c=(a.ignoreCase?"i":"")+(a.multiline?"m":"")+(a.unicode?"u":"")+(lr?"y":"g"),d=new l(lr?a:"^(?:"+a.source+")",c),h=void 0===i?or:i>>>0;if(0==h)return[];if(0===o.length)return null===$n(d,o)?[o]:[];for(var f,p=0,g=0,y=[];g<o.length;){d.lastIndex=lr?g:0;var m,_=$n(d,lr?o:o.slice(g));if(null===_||(m=ar(be(d.lastIndex+(lr?0:g)),o.length))===p)g=(f=g)+(u?ir(o,f).length:1);else{if(y.push(o.slice(p,g)),y.length===h)return y;for(var v=1;v<=_.length-1;v++)if(y.push(_[v]),y.length===h)return y;g=p=m}}return y.push(o.slice(p)),y}]}(i,""[e],(function(e,t,n,r,i){return t.exec===zn?s&&!i?{done:!0,value:o.call(t,n,r)}:{done:!0,value:e.call(n,t,r)}:{done:!1}})),u=l[0],c=l[1];Yt(String.prototype,e,u),Yt(RegExp.prototype,i,(function(e,t){return c.call(e,this,t)}))}r&&Fe(RegExp.prototype[i],"sham",!0)}("split",0,0,!lr);var fr=!te((function(){return Object.isExtensible(Object.preventExtensions({}))})),pr=ce((function(e){function t(e){n(e,r,{value:{objectID:"O"+ ++i,weakData:{}}})}var n=He.f,r=ve("meta"),i=0,s=Object.isExtensible||function(){return!0},a=e.exports={REQUIRED:!1,fastKey:function(e,n){if(!he(e))return"symbol"==typeof e?e:("string"==typeof e?"S":"P")+e;if(!_e(e,r)){if(!s(e))return"F";if(!n)return"E";t(e)}return e[r].objectID},getWeakData:function(e,n){if(!_e(e,r)){if(!s(e))return!0;if(!n)return!1;t(e)}return e[r].weakData},onFreeze:function(e){return fr&&a.REQUIRED&&s(e)&&!_e(e,r)&&t(e),e}};nt[r]=!0})),gr=(pr.REQUIRED,pr.fastKey,pr.getWeakData,pr.onFreeze,Ee("iterator")),yr=Array.prototype,mr=Ee("iterator"),_r=ce((function(e){function t(e,t){this.stopped=e,this.result=t}(e.exports=function(e,n,r,i,s){var a,o,l,u,c,d,h,f=cr(n,r,i?2:1);if(s)a=e;else{if("function"!=typeof(o=function(e){if(null!=e)return e[mr]||e["@@iterator"]||_t[wn(e)]}(e)))throw TypeError("Target is not iterable");if(function(e){return void 0!==e&&(_t.Array===e||yr[gr]===e)}(o)){for(l=0,u=be(e.length);l<u;l++)if((c=i?f(pe(h=e[l])[0],h[1]):f(e[l]))&&c instanceof t)return c;return new t(!1)}a=o.call(e)}for(d=a.next;!(h=d.call(a)).done;)if("object"==typeof(c=dr(a,f,h.value,i))&&c&&c instanceof t)return c;return new t(!1)}).stop=function(e){return new t(!0,e)}})),vr=Ee("iterator"),Er=!1;try{var Cr=0,br={next:function(){return{done:!!Cr++}},return:function(){Er=!0}};br[vr]=function(){return this},Array.from(br,(function(){throw 2}))}catch(h){}function Sr(e,t,n){function r(e){var t=l[e];Yt(l,e,"add"==e?function(e){return t.call(this,0===e?0:e),this}:"delete"==e?function(e){return!(s&&!he(e))&&t.call(this,0===e?0:e)}:"get"==e?function(e){return s&&!he(e)?void 0:t.call(this,0===e?0:e)}:"has"==e?function(e){return!(s&&!he(e))&&t.call(this,0===e?0:e)}:function(e,n){return t.call(this,0===e?0:e,n),this})}var i=-1!==e.indexOf("Map"),s=-1!==e.indexOf("Weak"),a=i?"set":"add",o=Oe[e],l=o&&o.prototype,u=o,c={};if(tn(e,"function"!=typeof o||!(s||l.forEach&&!te((function(){(new o).entries().next()})))))u=n.getConstructor(t,e,i,a),pr.REQUIRED=!0;else if(tn(e,!0)){var d=new u,h=d[a](s?{}:-0,1)!=d,f=te((function(){d.has(1)})),p=function(e,t){if(!Er)return!1;var n=!1;try{var r={};r[vr]=function(){return{next:function(){return{done:n=!0}}}},function(e){new o(e)}(r)}catch(e){}return n}(),g=!s&&te((function(){for(var e=new o,t=5;t--;)e[a](t,t);return!e.has(-0)}));p||(((u=t((function(t,n){hr(t,u,e);var r=function(e,t,n){var r,i;return _n&&"function"==typeof(r=t.constructor)&&r!==n&&he(i=r.prototype)&&i!==n.prototype&&_n(e,i),e}(new o,t,u);return null!=n&&_r(n,r[a],r,i),r}))).prototype=l).constructor=u),(f||g)&&(r("delete"),r("has"),i&&r("get")),(g||h)&&r(a),s&&l.clear&&delete l.clear}return c[e]=u,Lt({global:!0,forced:u!=o},c),cn(u,e),s||n.setStrong(u,e,i),u}function Ar(e,t){var n;return Nr(e)&&("function"!=typeof(n=e.constructor)||n!==Array&&!Nr(n.prototype)?he(n)&&null===(n=n[Rr])&&(n=void 0):n=void 0),new(void 0===n?Array:n)(0===t?0:t)}function Ir(e){var t=1==e,n=2==e,r=3==e,i=4==e,s=6==e,a=5==e||s;return function(o,l,u,c){for(var d,h,f=Pt(o),p=le(f),g=cr(l,u,3),y=be(p.length),m=0,_=c||Ar,v=t?_(o,y):n?_(o,0):void 0;m<y;m++)if((a||m in p)&&(h=g(d=p[m],m,f),e))if(t)v[m]=h;else if(h)switch(e){case 3:return!0;case 5:return d;case 6:return m;case 2:Tr.call(v,d)}else if(i)return!1;return s?-1:r||i?i:v}}function Ur(e){return e.frozen||(e.frozen=new Fr)}function kr(e,t){return Pr(e.entries,(function(e){return e[0]===t}))}var Nr=Array.isArray||function(e){return"Array"==ne(e)},Rr=Ee("species"),Tr=[].push,Or={forEach:Ir(0),map:Ir(1),filter:Ir(2),some:Ir(3),every:Ir(4),find:Ir(5),findIndex:Ir(6)},wr=pr.getWeakData,Mr=Gt.set,Lr=Gt.getterFor,Pr=Or.find,Dr=Or.findIndex,Hr=0,Fr=function(){this.entries=[]};Fr.prototype={get:function(e){var t=kr(this,e);if(t)return t[1]},has:function(e){return!!kr(this,e)},set:function(e,t){var n=kr(this,e);n?n[1]=t:this.entries.push([e,t])},delete:function(e){var t=Dr(this.entries,(function(t){return t[0]===e}));return~t&&this.entries.splice(t,1),!!~t}};var Gr={getConstructor:function(e,t,n,r){function i(e,t,n){var r=a(e),i=wr(pe(t),!0);return!0===i?Ur(r).set(t,n):i[r.id]=n,e}var s=e((function(e,i){hr(e,s,t),Mr(e,{type:t,id:Hr++,frozen:void 0}),null!=i&&_r(i,e[r],e,n)})),a=Lr(t);return ur(s.prototype,{delete:function(e){var t=a(this);if(!he(e))return!1;var n=wr(e);return!0===n?Ur(t).delete(e):n&&_e(n,t.id)&&delete n[t.id]},has:function(e){var t=a(this);if(!he(e))return!1;var n=wr(e);return!0===n?Ur(t).has(e):n&&_e(n,t.id)}}),ur(s.prototype,n?{get:function(e){var t=a(this);if(he(e)){var n=wr(e);return!0===n?Ur(t).get(e):n?n[t.id]:void 0}},set:function(e,t){return i(this,e,t)}}:{add:function(e){return i(this,e,!0)}}),s}},xr=(ce((function(e){function t(e){return function(t){return e(this,arguments.length?t:void 0)}}var n,r=Gt.enforce,i=!Oe.ActiveXObject&&"ActiveXObject"in Oe,s=Object.isExtensible,a=e.exports=Sr("WeakMap",t,Gr);if(It&&i){n=Gr.getConstructor(t,"WeakMap",!0),pr.REQUIRED=!0;var o=a.prototype,l=o.delete,u=o.has,c=o.get,d=o.set;ur(o,{delete:function(e){if(!he(e)||s(e))return l.call(this,e);var t=r(this);return t.frozen||(t.frozen=new n),l.call(this,e)||t.frozen.delete(e)},has:function(e){if(!he(e)||s(e))return u.call(this,e);var t=r(this);return t.frozen||(t.frozen=new n),u.call(this,e)||t.frozen.has(e)},get:function(e){if(!he(e)||s(e))return c.call(this,e);var t=r(this);return t.frozen||(t.frozen=new n),u.call(this,e)?c.call(this,e):t.frozen.get(e)},set:function(e,t){if(he(e)&&!s(e)){var i=r(this);i.frozen||(i.frozen=new n),u.call(this,e)?d.call(this,e,t):i.frozen.set(e,t)}else d.call(this,e,t);return this}})}})),{CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0}),Br=Ee("iterator"),jr=Ee("toStringTag"),qr=kn.values;for(var zr in xr){var Yr=Oe[zr],Qr=Yr&&Yr.prototype;if(Qr){if(Qr[Br]!==qr)try{Fe(Qr,Br,qr)}catch(h){Qr[Br]=qr}if(Qr[jr]||Fe(Qr,jr,zr),xr[zr])for(var Kr in kn)if(Qr[Kr]!==kn[Kr])try{Fe(Qr,Kr,kn[Kr])}catch(h){Qr[Kr]=kn[Kr]}}}var Vr=function(){function e(){r(this,e)}return s(e,null,[{key:"write",value:function(){var e;$r.isDebugMode&&(e=console).log.apply(e,arguments)}},{key:"error",value:function(){var e;$r.isDebugMode&&(e=console).error.apply(e,arguments)}}]),e}(),Wr=new WeakMap,Jr=null,Xr=null,$r=function(){function e(){r(this,e)}return s(e,null,[{key:"setDebugMode",value:function(){Wr.set(this,!0)}},{key:"unsetDebugMode",value:function(){Wr.set(this,!1)}},{key:"getParamsFromCallback",value:function(e,t){return{result:e,err:t,reversed:!1}}},{key:"callback",value:function(t,n,r){if(r){var i=e.getParamsFromCallback(t,n);i.err&&Vr.error(i.err),i.reversed?r(i.err,i.result):r(i.result,i.err)}}},{key:"isSendBirdSdkCompatible",value:function(e){var t="3.0.55".split("."),n=e.split(".");if(t.length!==n.length)return!1;for(var r in t)if(parseInt(t[r])>parseInt(n[r]))return!1;return!0}},{key:"sendBird",get:function(){return Jr},set:function(e){Jr=e}},{key:"isDebugMode",get:function(){return Wr.get(this)}},{key:"apiHost",get:function(){if(!Xr){var e=Jr.getInstance();Xr="https://desk-api-".concat(e.getApplicationId(),".sendbird.com/sapi")}return Xr},set:function(e){Xr=e}},{key:"sdkVersion",get:function(){return"1.0.14"}},{key:"minSendBirdVersion",get:function(){return"3.0.55"}}]),e}(),Zr=He.f,ei=Function.prototype,ti=ei.toString,ni=/^\s*function ([^ (]*)/;function ri(e,t,n){var r=ge(t);r in e?He.f(e,r,ye(0,n)):e[r]=n}!we||"name"in ei||Zr(ei,"name",{configurable:!0,get:function(){try{return ti.call(this).match(ni)[1]}catch(e){return""}}});var ii,si,ai={ERROR_SENDBIRD_SDK_MISSING:{code:100,message:"SendBird SDK is missing."},ERROR_SENDBIRD_SDK_VERSION_NOT_SUPPORTED:{code:101,message:"This SendBird SDK version is not supported."},ERROR_SENDBIRD_DESK_INIT_MISSING:{code:102,message:"SendBird Desk SDK is not initialized. It should be done before authentication."},ERROR_SENDBIRD_SDK_MESSAGE_LIST_FAILED:{code:200,message:"Cannot load messages in SDK client."},ERROR_INVALID_PARAMETER:{code:403,message:"Invalid parameter."},ERROR_DATA_NOT_FOUND:{code:404,message:"Data not found."},ERROR_REQUEST_TIMEOUT:{code:409,message:"Request timed-out."},ERROR_REQUEST:{code:500,message:"Request failed."},ERROR_REQUEST_CANCELED:{code:501,message:"Request canceled."}},oi=function(){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&o(e,t)}(t,c(Error));var e=h(t);function t(n,i){var s;return r(this,t),s=e.call(this,n),"function"==typeof Error.captureStackTrace?Error.captureStackTrace(d(s),s.constructor):s.stack=new Error(n).stack,s.name="SendBirdDeskError",s.message=n,s.code=i,s}return s(t,null,[{key:"create",value:function(e){return e?new t(e.message,e.code):new Error("SendBirdDeskError type missing.")}},{key:"throw",value:function(e){if(e)throw new t(e.message,e.code)}},{key:"Type",get:function(){return ai}}]),t}(),li=new ot.WeakMap,ui=function(){function e(){r(this,e)}return s(e,null,[{key:"connect",value:function(e,t,n){var r=this;"function"==typeof t&&(n=t,t="");var i=$r.sendBird;if(i){var s=i.getInstance(),a="".concat($r.apiHost,"/customers/auth/"),o={sendbirdAccessToken:t||"","content-type":"application/json"},l={sendbirdAppId:s.getApplicationId(),sendbirdId:e};se.create({headers:o}).post(a,l).then((function(e){li.set(r,{deskToken:e.data.token}),Vr.write("[REQ] connection established"),$r.callback(e.data,null,n)})).catch((function(e){$r.callback(null,e,n)}))}else $r.callback(null,oi.create(oi.Type.ERROR_SENDBIRD_SDK_MISSING),n)}},{key:"header",get:function(){return{sendbirdDeskToken:li.get(this).deskToken,"content-type":"application/json","user-agent":"desk-js@".concat("1.0.14")}}},{key:"getParam",get:function(){var e=$r.sendBird;if(e){var t=e.getInstance();return"sendbirdAppId=".concat(t.getApplicationId())}return""}},{key:"postParam",get:function(){var e=$r.sendBird;return e?{sendbirdAppId:e.getInstance().getApplicationId()}:{}}}]),e}(),ci=function(){function e(t){r(this,e),this.fetchFromJSON(t)}return s(e,[{key:"fetchFromJSON",value:function(e){this.userId=e?e.user:0,this.name=e?e.displayName:"",this.profileUrl=e?e.photoThumbnailUrl:""}}]),e}(),di=Ue("navigator","userAgent")||"",hi=Oe.process,fi=hi&&hi.versions,pi=fi&&fi.v8;function gi(e){return 51<=mi||!te((function(){var t=[];return(t.constructor={})[_i]=function(){return{foo:1}},1!==t[e](Boolean).foo}))}function yi(e){if(!he(e))return!1;var t=e[vi];return void 0!==t?!!t:Nr(e)}pi?si=(ii=pi.split("."))[0]+ii[1]:di&&(!(ii=di.match(/Edge\/(\d+)/))||74<=ii[1])&&(ii=di.match(/Chrome\/(\d+)/))&&(si=ii[1]);var mi=si&&+si,_i=Ee("species"),vi=Ee("isConcatSpreadable"),Ei=9007199254740991,Ci="Maximum allowed index exceeded",bi=51<=mi||!te((function(){var e=[];return e[vi]=!1,e.concat()[0]!==e})),Si=gi("concat");function Ai(e,t){var n=[][e];return!!n&&te((function(){n.call(null,t||function(){throw 1},1)}))}function Ii(e){throw e}function Ui(e,t){if(_e(Ni,e))return Ni[e];var n=[][e],r=!!_e(t=t||{},"ACCESSORS")&&t.ACCESSORS,i=_e(t,0)?t[0]:Ii,s=_e(t,1)?t[1]:void 0;return Ni[e]=!!n&&!te((function(){if(r&&!we)return!0;var e={length:-1};r?ki(e,1,{enumerable:!0,get:Ii}):e[1]=1,n.call(e,i,s)}))}Lt({target:"Array",proto:!0,forced:!bi||!Si},{concat:function(e){var t,n,r,i,s,a=Pt(this),o=Ar(a,0),l=0;for(t=-1,r=arguments.length;t<r;t++)if(yi(s=-1===t?a:arguments[t])){if(i=be(s.length),Ei<l+i)throw TypeError(Ci);for(n=0;n<i;n++,l++)n in s&&ri(o,l,s[n])}else{if(Ei<=l)throw TypeError(Ci);ri(o,l++,s)}return o.length=l,o}});var ki=Object.defineProperty,Ni={},Ri=Or.forEach,Ti=Ai("forEach"),Oi=Ui("forEach"),wi=Ti&&Oi?[].forEach:function(e,t){return Ri(this,e,1<arguments.length?t:void 0)};Lt({target:"Array",proto:!0,forced:[].forEach!=wi},{forEach:wi});var Mi=tt.indexOf,Li=[].indexOf,Pi=!!Li&&1/[1].indexOf(1,-0)<0,Di=Ai("indexOf"),Hi=Ui("indexOf",{ACCESSORS:!0,1:0});Lt({target:"Array",proto:!0,forced:Pi||!Di||!Hi},{indexOf:function(e,t){return Pi?Li.apply(this,arguments)||0:Mi(this,e,1<arguments.length?t:void 0)}});var Fi=[].join,Gi=le!=Object,xi=Ai("join",",");Lt({target:"Array",proto:!0,forced:Gi||!xi},{join:function(e){return Fi.call(ie(this),void 0===e?",":e)}});var Bi=Or.map,ji=gi("map"),qi=Ui("map");Lt({target:"Array",proto:!0,forced:!ji||!qi},{map:function(e,t){return Bi(this,e,1<arguments.length?t:void 0)}});var zi=Or.some,Yi=Ai("some"),Qi=Ui("some");function Ki(e,t){var n=$r.sendBird;if(n){var r=n.getInstance().GroupChannel.createMyGroupChannelListQuery();r.customTypesFilter=[Xi],r.channelUrlsFilter=e,r.includeEmpty=!0,r.next(t)}else $r.callback(null,oi.create(oi.Type.ERROR_SENDBIRD_SDK_MISSING),t)}function Vi(t,n){var r=Zi.Status.OPEN;Zi.isStatus(t.status)&&(r=t.status);var i=r!==Zi.Status.CLOSED?"status=ASSIGNED&status=UNASSIGNED":"status=CLOSED",s="".concat($r.apiHost,"/tickets/")+"?".concat(ui.getParam,"&limit=").concat(t.limit||Zi.defaultLimit,"&offset=").concat(t.offset||0)+"&".concat(i,"&order=").concat(t.order||"-updated_at");t.channelUrl&&(s+="&channelUrl=".concat(t.channelUrl)),t.customFieldFilter&&"object"===e(t.customFieldFilter)&&(s+="&customFields="+encodeURIComponent(Object.keys(t.customFieldFilter).map((function(e){return"".concat(e,":").concat(encodeURIComponent(t.customFieldFilter[e]))})).join(","))),se.create({headers:ui.header}).get(s).then((function(e){if(e&&e.data){var t=[],i=[];for(var s in e.data.results){var a=new Zi(e.data.results[s]);$i[a.channelUrl]=a,i.push(a.channelUrl),t.push(a)}Ki(i,(function(e,i){var s=$r.getParamsFromCallback(e,i),a=s.result;s.err||t.forEach((function(e){for(var t in a){var n=a[t];if(e.channelUrl===n.url){e.channel=n;break}}})),Vr.write("[REQ] ".concat(r," ticket list:"),t),$r.callback(t,s.err,n)}))}else $r.callback([],null,n)})).catch((function(e){return $r.callback(null,e,n)}))}Lt({target:"Array",proto:!0,forced:!Yi||!Qi},{some:function(e,t){return zi(this,e,1<arguments.length?t:void 0)}}),Lt({target:"Object",stat:!0,forced:te((function(){st(1)}))},{keys:function(e){return st(Pt(e))}});var Wi=function(){function e(){r(this,e)}return s(e,null,[{key:"CustomType",get:function(){return{RICH_MESSAGE:"SENDBIRD_DESK_RICH_MESSAGE",ADMIN_MESSAGE:"SENDBIRD_DESK_ADMIN_MESSAGE_CUSTOM_TYPE"}}},{key:"DataType",get:function(){return{TICKET_INQUIRE_CLOSURE:"SENDBIRD_DESK_INQUIRE_TICKET_CLOSURE",TICKET_ASSIGN:"TICKET_ASSIGN",TICKET_TRANSFER:"TICKET_TRANSFER",TICKET_CLOSE:"TICKET_CLOSE",TICKET_FEEDBACK:"SENDBIRD_DESK_CUSTOMER_SATISFACTION",URL_PREVIEW:"SENDBIRD_DESK_URL_PREVIEW"}}},{key:"ClosureState",get:function(){return{WAITING:"WAITING",CONFIRMED:"CONFIRMED",DECLINED:"DECLINED"}}},{key:"FeedbackState",get:function(){return{WAITING:"WAITING",CONFIRMED:"CONFIRMED"}}},{key:"UrlRegExp",get:function(){return/(?:(?:https?|ftp):\/\/)?(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?/gi}}]),e}(),Ji=function(){function e(t){r(this,e),this.fetchFromJSON(t)}return s(e,[{key:"fetchFromJSON",value:function(e){this.channelUrl=e?e.channel_url:"",this.name=e?e.name:""}}]),e}(),Xi="SENDBIRD_DESK_CHANNEL_CUSTOM_TYPE",$i={},Zi=function(){function t(e){r(this,t),this.fetchFromJSON(e)}return s(t,[{key:"fetchFromJSON",value:function(e){if(this.id=e?e.id:0,this.title=e?e.channelName:"",this.status=e?e.status:"",this.info=e&&e.info?JSON.parse(e.info):null,this.priority=e?e.priority:t.Priority.MEDIUM,this.agent=e&&e.recentAssignment&&e.recentAssignment.agent?new ci(e.recentAssignment.agent):null,this.customer=e?e.customer:null,this.customFields={},this.relatedChannels=[],this.channel=this.channel,this.channelUrl=e?e.channelUrl:null,this.updatedAt=e?new Date(e.updatedAt).getTime():(new Date).getTime(),e&&e.customFields)for(var n=e.customFields,r=0;r<n.length;r++){var i=n[r].key,s=n[r].value;this.customFields[i]=s}if(e&&e.relatedChannels)try{var a=JSON.parse(e.relatedChannels);Array.isArray(a)&&(this.relatedChannels=a.map((function(e){return new Ji(e)})))}catch(e){}}},{key:"refresh",value:function(e){var t=this,n="".concat($r.apiHost,"/tickets/").concat(this.id,"/?").concat(ui.getParam);se.create({headers:ui.header}).get(n).then((function(n){t.fetchFromJSON(n.data),Ki([t.channelUrl],(function(n,r){var i=$r.getParamsFromCallback(n,r).result;0<i.length&&(t.channel=i[0]),$i[t.channelUrl]=t,Vr.write("[REQ] ticket refresh:",t),$r.callback(t,null,e)}))})).catch((function(t){return $r.callback(null,t,e)}))}},{key:"reopen",value:function(e){var t=this,n="".concat($r.apiHost,"/tickets/").concat(this.id,"/reopen"),r=ui.postParam;se.create({headers:ui.header}).patch(n,r).then((function(n){n.data.channelUrl?(t.fetchFromJSON(n),Ki([t.channelUrl],(function(n,r){var i=$r.getParamsFromCallback(n,r).result;0<i.length&&(t.channel=i[0]),$i[t.channelUrl]=t,Vr.write("[REQ] ticket reopen:",t),$r.callback(t,null,e)}))):$r.callback(t,null,e)})).catch((function(t){return $r.callback(null,t,e)}))}},{key:"setPriority",value:function(e,n){var r=this;if(Object.keys(t.Priority).map((function(e){return t.Priority[e]})).indexOf(e)<0)$r.callback(null,oi.create(oi.Type.ERROR_INVALID_PARAMETER),n);else{var i="".concat($r.apiHost,"/tickets/").concat(this.id,"/"),s=ui.postParam;s.priority=e,se.create({headers:ui.header}).patch(i,s).then((function(e){r.fetchFromJSON(e.data),$r.callback(r,null,n)})).catch((function(e){$r.callback(null,e,n)}))}}},{key:"setRelatedChannelUrls",value:function(e,t){var n=this;if(Array.isArray(e)&&!e.some((function(e){return"string"!=typeof e}))){var r="".concat($r.apiHost,"/tickets/").concat(this.id,"/"),i=ui.postParam;i.relatedChannelUrls=e.join(","),se.create({headers:ui.header}).patch(r,i).then((function(e){n.fetchFromJSON(e.data),$r.callback(n,null,t)})).catch((function(e){$r.callback(null,e,t)}))}else $r.callback(null,oi.create(oi.Type.ERROR_INVALID_PARAMETER),t)}},{key:"setCustomFields",value:function(t,n){var r=this;if("object"!==e(t)||null===t||Array.isArray(t))$r.callback(null,oi.create(oi.Type.ERROR_INVALID_PARAMETER),n);else{var i={};for(var s in t)i[s]="string"==typeof t[s]?t[s]:JSON.stringify(t[s]);var a="".concat($r.apiHost,"/tickets/").concat(this.id,"/custom_fields/"),o=ui.postParam;o.customFields=JSON.stringify(i),se.create({headers:ui.header}).patch(a,o).then((function(e){r.fetchFromJSON(e.data),$r.callback(r,null,n)})).catch((function(e){$r.callback(null,e,n)}))}}}],[{key:"isStatus",value:function(e){for(var n in t.Status)if(t.Status[n]===e)return!0;return!1}},{key:"isPriority",value:function(e){for(var n in t.Priority)if(t.Priority[n]===e)return!0;return!1}},{key:"isDeskCustomType",value:function(e){return e===Xi}},{key:"clearCache",value:function(e){e?(delete $i[e],Vr.write("[SYS] cached ticket for ".concat(e," cleared"))):($i={},Vr.write("[SYS] all cached ticket cleared"))}},{key:"create",value:function(n,r,i,s,a,o,l){var u=$r.sendBird;if(u){if("function"==typeof i&&(l=i,o=a=s=i=null),"function"==typeof s&&(l=s,o=a=s=null),"function"==typeof a&&(l=a,o=a=null),"function"==typeof o&&(l=o,o=null),"string"!=typeof n||"string"!=typeof r||i&&"string"!=typeof i||s&&"object"!==e(s)||a&&!t.isPriority(a)||o&&(!Array.isArray(o)||o.some((function(e){return"string"!=typeof e})))||Array.isArray(s))return void $r.callback(null,oi.create(oi.Type.ERROR_INVALID_PARAMETER),l);var c=u.getInstance(),d="".concat($r.apiHost,"/tickets/"),h=ui.postParam;if(h.channelName=n,h.channelType="SENDBIRD_JAVASCRIPT",i&&(h.groupKey=i),s){var f={};for(var p in s)f[p]="string"==typeof s[p]?s[p]:JSON.stringify(s[p]);h.customFields=JSON.stringify(f)}a&&(h.priority=a),o&&(h.relatedChannelUrls=o.join(",")),h.info=JSON.stringify({ticket:{subject:n,requester:{name:r,email:c.getCurrentUserId()}}}),se.create({headers:ui.header}).post(d,h).then((function(e){var n=new t(e.data);Ki([n.channelUrl],(function(e,t){var r=$r.getParamsFromCallback(e,t).result;0<r.length&&(n.channel=r[0]),$i[n.channelUrl]=n,Vr.write("[REQ] ticket create:",n),$r.callback(n,null,l)}))})).catch((function(e){return $r.callback(null,e,l)}))}else $r.callback(null,oi.create(oi.Type.ERROR_SENDBIRD_SDK_MISSING),l)}},{key:"getOpenCount",value:function(e){var t="".concat($r.apiHost,"/tickets/count/?").concat(ui.getParam);se.create({headers:ui.header}).get(t).then((function(t){return $r.callback(t.data,null,e)})).catch((function(t){return $r.callback(null,t,e)}))}},{key:"getByChannelUrl",value:function(e,n){if($i[e])$r.callback($i[e],null,n);else{var r="".concat($r.apiHost,"/tickets/?").concat(ui.getParam,"&limit=10&channelUrl=").concat(e);se.create({headers:ui.header}).get(r).then((function(r){var i=null;r&&r.data&&0<r.data.results.length&&(i=new t(r.data.results[0])),i?Ki([e],(function(t,r){var s=$r.getParamsFromCallback(t,r).result;0<s.length&&(i.channel=s[0]),$i[e]=i,Vr.write("[REQ] get ticket for channel ".concat(e,":"),i),$r.callback(i,null,n)})):$r.callback(null,oi.Type.ERROR_DATA_NOT_FOUND,n)})).catch((function(e){return $r.callback(null,e,n)}))}}},{key:"getOpenedList",value:function(e,t,n){"function"==typeof t&&(n=t,t=null),Vi({offset:e,customFieldFilter:t,status:this.Status.OPEN},n)}},{key:"getClosedList",value:function(e,t,n){"function"==typeof t&&(n=t,t=null),Vi({offset:e,customFieldFilter:t,status:this.Status.CLOSED},n)}},{key:"getUrlPreview",value:function(e,t){var n="".concat($r.apiHost,"/tickets/url_preview/"),r=ui.postParam;r.url=e,se.create({headers:ui.header}).post(n,r).then((function(e){return $r.callback(e.data,null,t)})).catch((function(e){return $r.callback(null,e,t)}))}},{key:"confirmEndOfChat",value:function(e,n,r){"string"==typeof n&&-1<["yes","no"].indexOf(n)?t.getByChannelUrl(e.channelUrl,(function(t,i){var s=$r.getParamsFromCallback(t,i).result,a="".concat($r.apiHost,"/tickets/").concat(s.id,"/edit_message/"),o=ui.postParam;o.messageId=e.messageId,o.messageData=JSON.stringify({type:Wi.DataType.TICKET_INQUIRE_CLOSURE,body:{state:"yes"===n?Wi.ClosureState.CONFIRMED:Wi.ClosureState.DECLINED,ticketId:s.id}}),se.create({headers:ui.header}).patch(a,o).then((function(e){Vr.write("[REQ] confirmed end of chat:",s),$r.callback(e.data,null,r)})).catch((function(e){return $r.callback(null,e,r)}))})):$r.callback(null,oi.create(oi.Type.ERROR_INVALID_PARAMETER))}},{key:"submitFeedback",value:function(e,n,r,i){var s=2<arguments.length&&void 0!==r?r:"",a=3<arguments.length?i:void 0;e&&0<e.messageId&&e.channelUrl&&"number"==typeof n&&1<=n&&n<=5&&"string"==typeof s?t.getByChannelUrl(e.channelUrl,(function(t,r){var i=$r.getParamsFromCallback(t,r).result,o="".concat($r.apiHost,"/tickets/").concat(i.id,"/edit_message/"),l=ui.postParam;l.messageId=e.messageId,l.messageData=JSON.stringify({type:Wi.DataType.TICKET_FEEDBACK,body:{state:Wi.FeedbackState.CONFIRMED,customerSatisfactionScore:n,customerSatisfactionComment:s,ticketId:i.id}}),se.create({headers:ui.header}).patch(o,l).then((function(e){Vr.write("[REQ] customer feedback:",i),$r.callback(e.data,null,a)})).catch((function(e){return $r.callback(null,e,a)}))})):$r.callback(null,oi.create(oi.Type.ERROR_INVALID_PARAMETER))}},{key:"Status",get:function(){return{INITIALIZED:"INITIALIZED",PROACTIVE:"PROACTIVE",UNASSIGNED:"UNASSIGNED",ASSIGNED:"ASSIGNED",OPEN:"OPEN",CLOSED:"CLOSED"}}},{key:"Priority",get:function(){return{URGENT:"URGENT",HIGH:"HIGH",MEDIUM:"MEDIUM",LOW:"LOW"}}},{key:"defaultLimit",get:function(){return 10}}]),t}(),es=!1;return function(){function t(){r(this,t)}return s(t,null,[{key:"init",value:function(e){try{e||(window&&window.SendBird&&(e=window.SendBird),n&&n.SendBird&&(e=n.SendBird)),e&&e.version?($r.sendBird=e,$r.isSendBirdSdkCompatible(e.version)?es=!0:oi.throw(oi.Type.ERROR_SENDBIRD_SDK_VERSION_NOT_SUPPORTED)):oi.throw(oi.Type.ERROR_SENDBIRD_SDK_MISSING)}catch(e){oi.throw(oi.Type.ERROR_SENDBIRD_SDK_MISSING)}}},{key:"authenticate",value:function(e,t,n){es?ui.connect(e,t,n):oi.throw(oi.Type.ERROR_SENDBIRD_DESK_INIT_MISSING)}},{key:"isDeskChannel",value:function(e){return Zi.isDeskCustomType(e.customType)}},{key:"setApiHost",value:function(e){$r.apiHost=e}},{key:"setDebugMode",value:function(){$r.setDebugMode()}},{key:"setCustomerCustomFields",value:function(t,n){if("object"!==e(t)||null===t||Array.isArray(t))$r.callback(null,oi.create(oi.Type.ERROR_INVALID_PARAMETER),n);else{var r={};for(var i in t)r[i]="string"==typeof t[i]?t[i]:JSON.stringify(t[i]);var s="".concat($r.apiHost,"/customers/custom_fields/"),a=ui.postParam;a.customFields=JSON.stringify(r),se.create({headers:ui.header}).patch(s,a).then((function(e){var t={};for(var r in e.data.customFields){var i=e.data.customFields[r];t[i.key]=i.value}$r.callback(t,null,n)})).catch((function(e){$r.callback(null,e,n)}))}}},{key:"version",get:function(){return $r.sdkVersion}},{key:"Error",get:function(){return oi}},{key:"Agent",get:function(){return ci}},{key:"Ticket",get:function(){return Zi}},{key:"Message",get:function(){return Wi}},{key:"RelatedChannel",get:function(){return Ji}},{key:"UrlRegExp",get:function(){return Wi.UrlRegExp}}]),t}()}()}).call(this,n(3),n(4))},function(e,t,n){"use strict";var r=n(5),i=Object.prototype.toString;function s(e){return"[object Array]"===i.call(e)}function a(e){return void 0===e}function o(e){return null!==e&&"object"==typeof e}function l(e){return"[object Function]"===i.call(e)}function u(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.call(null,e[i],i,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===i.call(e)},isBuffer:function(e){return null!==e&&!a(e)&&null!==e.constructor&&!a(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:o,isUndefined:a,isDate:function(e){return"[object Date]"===i.call(e)},isFile:function(e){return"[object File]"===i.call(e)},isBlob:function(e){return"[object Blob]"===i.call(e)},isFunction:l,isStream:function(e){return o(e)&&l(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:u,merge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]=n}for(var r=0,i=arguments.length;r<i;r++)u(arguments[r],n);return t},deepMerge:function e(){var t={};function n(n,r){"object"==typeof t[r]&&"object"==typeof n?t[r]=e(t[r],n):t[r]="object"==typeof n?e({},n):n}for(var r=0,i=arguments.length;r<i;r++)u(arguments[r],n);return t},extend:function(e,t,n){return u(t,(function(t,i){e[i]=n&&"function"==typeof t?r(t,n):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,n){(function(t,r){e.exports=function(e,n,i){"use strict";function s(e){return(s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function l(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function u(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?u(Object(n),!0).forEach((function(t){var r,i,s;r=e,s=n[i=t],i in r?Object.defineProperty(r,i,{value:s,enumerable:!0,configurable:!0,writable:!0}):r[i]=s})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function p(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function g(e,t,n){return(g=p()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&f(i,n.prototype),i}).apply(null,arguments)}function y(e){var t="function"==typeof Map?new Map:void 0;return(y=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return g(e,arguments,h(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),f(n,e)})(e)}function m(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _(e){var t=p();return function(){var n,r=h(e);if(t){var i=h(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?m(e):t}(this,n)}}function v(e,t,n){return(v="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=h(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function E(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e)){var n=[],r=!0,i=!1,s=void 0;try{for(var a,o=e[Symbol.iterator]();!(r=(a=o.next()).done)&&(n.push(a.value),!t||n.length!==t);r=!0);}catch(e){i=!0,s=e}finally{try{r||null==o.return||o.return()}finally{if(i)throw s}}return n}}(e,t)||b(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function C(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||b(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var A=function(){function e(){a(this,e)}return l(e,null,[{key:"OS_VERSION",get:function(){return"undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.replace(/,/g,"."):"noAgent"}},{key:"SDK_VERSION",get:function(){return"3.0.127"}},{key:"SDK_MAJOR_VERSION",get:function(){return e.SDK_VERSION.split(".")[0]}},{key:"COMMAND_ACK_TIMEOUT",get:function(){return 1e4}},{key:"DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL",get:function(){return 100}},{key:"INTERNAL_CALL",get:function(){return"ic"}}]),e}(),I={},U=new WeakMap,k=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this,e),U.set(this,"object"===s(t)&&t?t:{})}return l(e,[{key:"get",value:function(e){return U.get(this)[e]}},{key:"set",value:function(e,t){U.get(this)[e]=t}},{key:"remove",value:function(e){var t=U.get(this);t.hasOwnProperty(e)&&delete t[e]}},{key:"container",get:function(){return U.get(this)}}],[{key:"create",value:function(t,n){return I[t]=new e(n),I[t]}},{key:"get",value:function(e){return e=e||bt.getInstance()._iid,I[e]}}]),e}(),N=function(){d(t,y(Error));var e=_(t);function t(n,r){var i;return a(this,t),(i=e.call(this,r)).name="SendBirdException",i.code=r||0,i.message=n,i}return l(t,null,[{key:"INVALID_INITIALIZATION",get:function(){return 800100}},{key:"CONNECTION_REQUIRED",get:function(){return 800101}},{key:"CONNECTION_CANCELED",get:function(){return 800102}},{key:"INVALID_PARAMETER",get:function(){return 800110}},{key:"NETWORK_ERROR",get:function(){return 800120}},{key:"NETWORK_ROUTING_ERROR",get:function(){return 800121}},{key:"MALFORMED_DATA",get:function(){return 800130}},{key:"MALFORMED_ERROR_DATA",get:function(){return 800140}},{key:"WRONG_CHANNEL_TYPE",get:function(){return 800150}},{key:"MARK_AS_READ_RATE_LIMIT_EXCEEDED",get:function(){return 800160}},{key:"QUERY_IN_PROGRESS",get:function(){return 800170}},{key:"ACK_TIMEOUT",get:function(){return 800180}},{key:"LOGIN_TIMEOUT",get:function(){return 800190}},{key:"WEBSOCKET_CONNECTION_CLOSED",get:function(){return 800200}},{key:"WEBSOCKET_CONNECTION_FAILED",get:function(){return 800210}},{key:"REQUEST_FAILED",get:function(){return 800220}},{key:"FILE_UPLOAD_CANCEL_FAILED",get:function(){return 800230}},{key:"REQUEST_CANCELED",get:function(){return 800240}},{key:"REQUEST_DUPLICATED",get:function(){return 800250}}]),t}(),R=function(){function e(){a(this,e),this.sessionKey=null,this.eKey=null}return l(e,[{key:"hasSession",value:function(){return!!this.sessionKey}}]),e}(),T={DEBUG:"debug",PRODUCTION:"production"},O=T.PRODUCTION,w=function(){function e(){a(this,e)}return l(e,null,[{key:"log",value:function(){var e;(e=console).log.apply(e,arguments)}},{key:"debug",value:function(){O===e.Mode.DEBUG&&e.log.apply(e,arguments)}},{key:"Mode",get:function(){return T}},{key:"mode",get:function(){return O},set:function(t){-1<Object.keys(e.Mode).map((function(t){return e.Mode[t]})).indexOf(t)&&(O=t)}}]),e}(),M={},L=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};for(var r in a(this,e),this._iid=t,n){var i=n[r];"function"==typeof i&&(this[r]=this.getClonedClass(i))}M[t]=this}return l(e,[{key:"getClonedClass",value:function(e){var t=this._iid;return function(){d(r,e);var n=_(r);function r(){return a(this,r),n.apply(this,arguments)}return l(r,[{key:"_iid",get:function(){return t}}],[{key:"_iid",get:function(){return t}},{key:"_name",get:function(){return e.name}}]),r}()}}],[{key:"get",value:function(e){return e?M[e]:{}}}]),e}(),P=function(){function e(t){a(this,e),this.sb=t,this.pingTimer=null,this.pingTimeoutTimer=null}return l(e,[{key:"ping",value:function(){var e=this,t=L.get(this.sb._iid).Command.bPing(),n=k.get(this.sb._iid).container,r=n.wsAdapter,i=n.pongTimeout;r.ws.send(t),w.debug("PING"),this.pingTimeoutTimer=setTimeout((function(){w.debug("PING timeout"),e.stop(),r.ws.handler&&r.ws.handler.onError()}),i)}},{key:"pong",value:function(){clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null}},{key:"start",value:function(){var e=this,t=k.get(this.sb._iid).container.pingInterval;this.stop(),this.ping(),this.pingTimer=setInterval((function(){e.ping()}),t)}},{key:"stop",value:function(){clearInterval(this.pingTimer),this.pingTimer=null,clearTimeout(this.pingTimeoutTimer),this.pingTimeoutTimer=null}}]),e}(),D=[N.CONNECTION_REQUIRED,N.NETWORK_ERROR,N.ACK_TIMEOUT,N.WEBSOCKET_CONNECTION_CLOSED,N.WEBSOCKET_CONNECTION_FAILED,N.FILE_UPLOAD_CANCEL_FAILED,N.REQUEST_CANCELED,500901,500910,900200],H=function(){function e(){a(this,e)}return l(e,null,[{key:"deepEqual",value:function(e,t){if(e===t)return!0;var n=c({},e),r=c({},t);return!(n.messageId&&r.messageId&&n.messageId!==r.messageId||n.reqId&&r.reqId&&n.reqId!==r.reqId||(n.hasOwnProperty("messageId")&&delete n.messageId,n.hasOwnProperty("reqId")&&delete n.reqId,r.hasOwnProperty("messageId")&&delete r.messageId,r.hasOwnProperty("reqId")&&delete r.reqId,JSON.stringify(n)!==JSON.stringify(r)))}},{key:"isResendableError",value:function(e){return 0<e&&0<=D.indexOf(e)}},{key:"isFile",value:function(e){var n="object"===s(e)&&null!==e&&"string"==typeof e.name&&"string"==typeof e.uri&&"string"==typeof e.type;if(!n)if("undefined"==typeof window&&void 0!==t){if(void 0!==r)return e instanceof r}else{if("undefined"!=typeof Blob)return e instanceof Blob;if("undefined"!=typeof File)return e instanceof File}return n}}]),e}(),F=function(){function e(t){if(a(this,e),this.fields={},t)for(var n in t)this.fields[n]={value:t[n]},H.isFile(t[n])&&(this.fields[n].filename=t[n].name);this.internal=!1,this.upload={reqId:null,deleteRequest:null,progressHandler:null}}return l(e,[{key:"add",value:function(e,t,n){var r=2<arguments.length&&void 0!==n?n:null;this.fields[e]={value:t,filename:r}}},{key:"remove",value:function(e){this.fields.hasOwnProperty(e)&&delete this.fields[e]}},{key:"yield",value:function(){var e=!1;for(var t in this.fields)if(H.isFile(this.fields[t].value)){e=!0;break}if(e){var r=new n;for(var i in this.fields){var s=this.fields[i];if(H.isFile(s.value)){var a=s.value;a.filename||a.name?r.append(i,s.value,a.filename||a.name):a.data?r.append(i,s.value,s.data.name):r.append(i,s.value,"unnamed")}else r.append(i,s.value)}return r}var o={};for(var l in this.fields)o[l]=this.fields[l].value;return o}}]),e}(),G=200,x=400,B=function(){function t(e){a(this,t),this.sb=e,this.cls=L.get(this.sb._iid)}return l(t,[{key:"checkRouting",value:function(e){if(this.sb.customApiHost&&this.sb.customWsHost)"function"==typeof e&&e(null,{apiHost:this.sb.customApiHost,wsHost:this.sb.customWsHost});else{var t=this.sb.getApplicationId();e(null,{apiHost:"https://api-".concat(t,".sendbird.com"),wsHost:"wss://ws-".concat(t,".sendbird.com")})}}},{key:"_buildUrl",value:function(e){var t=e.apiHost,n=e.url,r=e.params;return r&&r.internal?"".concat(t,"/v").concat(A.SDK_MAJOR_VERSION,"/sdk").concat(n):"".concat(t,"/v").concat(A.SDK_MAJOR_VERSION).concat(n)}},{key:"_createHeader",value:function(e){var t=0<arguments.length&&void 0!==e?e:{},r=t instanceof n&&"function"==typeof t.getHeaders?t.getHeaders():{},i=k.get(this.sb._iid).container,s=i.appId,a=i.auth,o=i.extensions,l=i.getUserAgentWithExtensions;return r.SendBird="JS,".concat(A.OS_VERSION,",").concat(A.SDK_VERSION,",").concat(s),r["SB-User-Agent"]=encodeURIComponent(l(o)),a.sessionKey&&(r["Session-Key"]=a.sessionKey),r["Request-Sent-Timestamp"]=(new Date).getTime().toString(),r}},{key:"_createQuery",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:{};try{var r=[];for(var i in n){var a=n[i];if(null!=a){var o="";o="object"===s(a)?Array.isArray(a)?a.map((function(e){return encodeURIComponent(e)})).join(","):encodeURIComponent(JSON.stringify(a)):encodeURIComponent(a),r.push("".concat(i,"=").concat(o))}}return 0<r.length?"".concat(e,"?").concat(r.join("&")):e}catch(t){return w.debug("createWithEncodedGetParams is failed. - ",t),e}}},{key:"_parseError",value:function(e){if(e.isAbort||e.aborted)return new N("Request has been canceled.",N.REQUEST_CANCELED);try{var t=JSON.parse(e.responseText),n=t?t.message:"Request failed.",r=t?t.code:N.REQUEST_FAILED;return new N(n,r)}catch(e){return e instanceof N?e:new N("Request failed.",N.REQUEST_FAILED)}}},{key:"get",value:function(t,n,r){var i=this;this.checkRouting((function(s,a){if(s)r(new N("Request failed.",N.REQUEST_FAILED),null);else{var o=i._buildUrl({apiHost:a.apiHost,url:t,params:n}),l=n?n.yield():{},u=i._createHeader(l);e.get(i._createQuery(o,l),{headers:u}).then((function(e){var t=e.status,n=e.data,s=e.request;if(G<=t&&t<x)r(null,n);else{var a=i._parseError(s);w.debug(a),r(a,null)}})).catch((function(e){w.debug(e),r(e,null)}))}}))}},{key:"dummyCall",value:function(t){var n=this;this.checkRouting((function(r,i){if(r)t(new N("Request failed.",N.REQUEST_FAILED),null);else{var s=i.apiHost,a=n._createHeader();e.get(n._createQuery(s),{headers:a}).then((function(e){var r=e.status,i=e.data,s=e.request;if(G<=r&&r<x)t(null,i);else{var a=n._parseError(s);w.debug(a),t(a,null)}})).catch((function(e){w.debug(e),t(e,null)}))}}))}},{key:"post",value:function(t,r,i){var s=this;this.checkRouting((function(a,o){if(a)i(new N("Request failed.",N.REQUEST_FAILED),null);else{var l=s._buildUrl({apiHost:o.apiHost,url:t,params:r}),u=r?r.yield():{},c=s._createHeader(u),d=null;if(u instanceof n){var h=e.CancelToken.source();d=h.token;var f=s.cls.FileMessageQueue,p=r.upload.reqId;p&&(f.uploadRequest[p]=h)}e.post(l,"function"==typeof u.getBuffer?u.getBuffer():u,{headers:c,cancelToken:d,onUploadProgress:function(e){r.upload.progressHandler&&r.upload.progressHandler(e,r.upload.reqId)}}).then((function(e){var t=e.status,n=e.data,a=e.request;if(G<=t&&t<x)"function"==typeof r.upload.deleteRequest&&r.upload.deleteRequest(),i(null,n);else{"function"==typeof r.upload.deleteRequest&&r.upload.deleteRequest();var o=s._parseError(a);w.debug(o),i(o,null)}})).catch((function(e){"function"==typeof r.upload.deleteRequest&&r.upload.deleteRequest(),w.debug(e),i(e,null)}))}}))}},{key:"put",value:function(t,n,r){var i=this;this.checkRouting((function(s,a){if(s)r(new N("Request failed.",N.REQUEST_FAILED),null);else{var o=i._buildUrl({apiHost:a.apiHost,url:t,params:n}),l=n?n.yield():{},u=i._createHeader(l);e.put(o,l,{headers:u}).then((function(e){var t=e.status,n=e.data,s=e.request;if(G<=t&&t<x)r(null,n);else{var a=i._parseError(s);w.debug(a),r(a,null)}})).catch((function(e){w.debug(e),r(e,null)}))}}))}},{key:"delete",value:function(t,n,r){var i=this;this.checkRouting((function(s,a){if(s)r(new N("Request failed.",N.REQUEST_FAILED),null);else{var o=i._buildUrl({apiHost:a.apiHost,url:t,params:n}),l=n?n.yield():{},u=i._createHeader(l);e.delete(i._createQuery(o,l),{headers:u}).then((function(e){var t=e.status,n=e.data,s=e.request;if(G<=t&&t<x)r(null,n);else{var a=i._parseError(s);w.debug(a),r(a,null)}})).catch((function(e){w.debug(e),r(e,null)}))}}))}},{key:"updateCurrentUserInfo",value:function(e,n){var r=this,i=e.nickname,s=e.profileUrl,a=e.profileImage,o=e.preferredLanguages;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=t.Path.USERS_USERID.replace("%s",encodeURIComponent(l.userId)),c=new F;i&&c.add("nickname",i),s&&c.add("profile_url",s),a&&c.add("profile_file",a,a.name),o&&c.add("preferred_languages",o),r.put(u,c,n)}}))}},{key:"getMyGroupChannelChangeLogs",value:function(e,n){var r=this,i=e.ts,s=e.token,a=e.customTypes,o=e.includeEmpty,l=e.includeFrozen;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=t.Path.USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS.replace("%s",encodeURIComponent(u.userId)),d=new F({show_read_receipt:!0,show_delivery_receipt:!0,show_member:!0});s&&d.add("token",s),i&&d.add("change_ts",i),a&&0<a.length&&d.add("custom_types",a),"boolean"==typeof o&&d.add("show_empty",o),"boolean"==typeof l&&d.add("show_frozen",l),r.get(c,d,n)}}))}},{key:"getChannelInvitationPreference",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(i.userId));r.get(s,null,n)}}))}},{key:"getGroupChannelCount",value:function(e,n){var r=this,i=e.memberStateFilter;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=r.cls.GroupChannel,o=t.Path.USERS_USERID_GROUP_CHANNEL_COUNT.replace("%s",encodeURIComponent(s.userId)),l="";switch(i){case a.MemberStateFilter.JOINED:l="joined";break;case a.MemberStateFilter.INVITED:l="invited";break;case a.MemberStateFilter.INVITED_BY_FRIEND:l="invited_by_friend";break;case a.MemberStateFilter.INVITED_BY_NON_FRIEND:l="invited_by_non_friend";break;default:l="all"}var u=new F({state:l});r.get(o,u,n)}}))}},{key:"getUnreadItemCount",value:function(e,n){var r=this,i=e.keys;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_UNREAD_ITEM_COUNT.replace("%s",encodeURIComponent(s.userId)),o=new F({item_keys:i});r.get(a,o,n)}}))}},{key:"getTotalUnreadMessageCount",value:function(e,n){var r=this,i=e.customTypesFilter,s=e.superChannelFilter;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.USERS_USERID_UNREAD_MESSAGE_COUNT.replace("%s",encodeURIComponent(a.userId)),l=new F({super_mode:s});null!==i&&0<i.length&&l.add("custom_types",i),r.get(o,l,n)}}))}},{key:"getTotalUnreadChannelCount",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_UNREAD_CHANNEL_COUNT.replace("%s",encodeURIComponent(i.userId));r.get(s,null,n)}}))}},{key:"searchMessages",value:function(e,n){var r=this,i=e.keyword,s=e.limit,a=e.reverse,o=e.exactMatch,l=e.channelUrl,u=e.channelCustomType,c=e.messageTimestampFrom,d=e.messageTimestampTo,h=e.order,f=e.nextToken;this.sb.ConnectionManager.ready((function(e,p){if(e)n(e,null);else{var g=t.Path.SEARCH_MESSAGE,y=new F({limit:s,reverse:a,query:i,custom_type:u});c&&y.add("message_ts_from",c),d&&y.add("message_ts_to",d),l&&y.add("channel_url",l),h&&y.add("sort_field",h),"boolean"==typeof o&&y.add("exact_match",o),null!==f&&0<f.length&&y.add("after",f),r.get(g,y,n)}}))}},{key:"markAsReadAll",value:function(e,n){var r=this,i=e.channelUrls;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_MARKASREADALL.replace("%s",encodeURIComponent(s.userId)),o=new F;i&&o.add("channel_urls",i),r.put(a,o,n)}}))}},{key:"markAsDelivered",value:function(e,n){var r=this,i=e.channelUrl,s=e.userId;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASDELIVERED.replace("%s",encodeURIComponent(i)),l=new F;s&&l.add("user_id",s),r.put(o,l,n)}}))}},{key:"setChannelInvitationPreference",value:function(e,n){var r=this,i=e.isAutoAccept;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE.replace("%s",encodeURIComponent(s.userId)),o=new F({auto_accept:i});r.put(a,o,n)}}))}},{key:"blockUser",value:function(e,n){var r=this,i=e.blockedUserId;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(s.userId)),o=new F({target_id:i});r.post(a,o,n)}}))}},{key:"unblockUser",value:function(e,n){var r=this,i=e.unblockedUserId;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_BLOCK_TARGETID.replace("%s",encodeURIComponent(s.userId)).replace("%s",encodeURIComponent(i));r.delete(a,null,n)}}))}},{key:"getPushTriggerOption",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(i.userId));r.get(s,null,n)}}))}},{key:"setPushTriggerOption",value:function(e,n){var r=this,i=e.pushTriggerOption;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(s.userId)),o=new F({push_trigger_option:i});r.put(a,o,n)}}))}},{key:"getPushTokens",value:function(e,n){var r=this,i=e.ts,s=e.token,a=e.type;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=t.Path.USERS_USERID_PUSH_DEVICE_TOKENS.replace("%s",encodeURIComponent(o.userId)).replace("%s",encodeURIComponent(a)),u=new F;s&&u.add("token",s),i&&u.add("created_ts",i),r.get(l,u,n)}}))}},{key:"getPushTemplate",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(i.userId));r.get(s,null,n)}}))}},{key:"setPushTemplate",value:function(e,n){var r=this,i=e.templateName;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_PUSH_TEMPLATE.replace("%s",encodeURIComponent(s.userId)),o=new F({name:i});r.put(a,o,n)}}))}},{key:"getDoNotDisturb",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(i.userId));r.get(s,null,n)}}))}},{key:"setDoNotDisturb",value:function(e,n){var r=this,i=e.doNotDisturbOn,s=e.startHour,a=e.startMin,o=e.endHour,l=e.endMin,u=e.timezone;this.sb.ConnectionManager.ready((function(e,c){if(e)n(e,null);else{var d=t.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(c.userId)),h=new F({do_not_disturb:i,start_hour:s,start_min:a,end_hour:o,end_min:l,timezone:u});r.put(d,h,n)}}))}},{key:"getSnoozePeriod",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(i.userId));r.get(s,null,n)}}))}},{key:"setSnoozePeriod",value:function(e,n){var r=this,i=e.snoozeOn,s=e.startTs,a=e.endTs;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=t.Path.USERS_USERID_PUSHPREFERENCE.replace("%s",encodeURIComponent(o.userId)),u=new F({snooze_enabled:i,snooze_start_ts:s,snooze_end_ts:a});r.put(l,u,n)}}))}},{key:"registerGCMPushToken",value:function(e,n){var r=this,i=e.token;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(s.userId)),o=new F({gcm_reg_token:i,always_push:!0});r.post(a,o,n)}}))}},{key:"unregisterGCMPushToken",value:function(e,n){var r=this,i=e.token;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_PUSH_GCM_TOKEN.replace("%s",encodeURIComponent(s.userId)).replace("%s",encodeURIComponent(i));r.delete(a,null,n)}}))}},{key:"unregisterAllGCMPushTokens",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_PUSH_GCM.replace("%s",encodeURIComponent(i.userId));r.delete(s,null,n)}}))}},{key:"registerAPNSPushToken",value:function(e,n){var r=this,i=e.token;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(s.userId)),o=new F({apns_device_token:i,always_push:!0});r.post(a,o,n)}}))}},{key:"unregisterAPNSPushToken",value:function(e,n){var r=this,i=e.token;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_PUSH_APNS_TOKEN.replace("%s",encodeURIComponent(s.userId)).replace("%s",encodeURIComponent(i));r.delete(a,null,n)}}))}},{key:"unregisterAllAPNSPushTokens",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_PUSH_APNS.replace("%s",encodeURIComponent(i.userId));r.delete(s,null,n)}}))}},{key:"unregisterAllPushTokens",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_PUSH.replace("%s",encodeURIComponent(i.userId));r.delete(s,null,n)}}))}},{key:"loadFriendList",value:function(e,n){var r=this,i=e.token,s=e.limit;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.FRIENDS.replace("%s",encodeURIComponent(a.userId)),l=new F({limit:s,token:i});r.get(o,l,n)}}))}},{key:"getFriendChangeLogsByToken",value:function(e,n){var r=this,i=e.token;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.FRIENDS_CHANGE_LOGS.replace("%s",encodeURIComponent(s.userId)),o=new F;i&&o.add("token",i),r.get(a,o,n)}}))}},{key:"addFriends",value:function(e,n){var r=this,i=e.userIds;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.FRIENDS.replace("%s",encodeURIComponent(s.userId)),o=new F({user_ids:i});r.post(a,o,n)}}))}},{key:"deleteFriends",value:function(e,n){var r=this,i=e.userIds;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.FRIENDS.replace("%s",encodeURIComponent(s.userId)),o=new F({user_ids:i});r.delete(a,o,n)}}))}},{key:"uploadFriendDiscoveries",value:function(e,n){var r=this,i=e.discoveries;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(s.userId)),o=[];i.forEach((function(e){o.push({friend_discovery_key:e.friendDiscoveryKey,friend_name:"string"==typeof e.friendName||e.friendName?e.friendName:null})}));var l=new F({friend_discoveries:o});r.put(a,l,n)}}))}},{key:"deleteFriendDiscoveries",value:function(e,n){var r=this,i=e.discoveryKeys;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.FRIENDS_DISCOVERIES.replace("%s",encodeURIComponent(s.userId)),o=new F({friend_discovery_keys:i});r.delete(a,o,n)}}))}},{key:"loadUserList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.userIdsFilter,o=e.metaDataKeyFilter,l=e.metaDataValuesFilter;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=t.Path.USERS,d=new F({token:i,limit:s});a&&0<a.length&&d.add("user_ids",a),o&&l&&0<l.length&&(d.add("metadatakey",o),d.add("metadatavalues_in",l)),r.get(c,d,n)}}))}},{key:"loadBlockedUserList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.userIdsFilter;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=t.Path.USERS_USERID_BLOCK.replace("%s",encodeURIComponent(o.userId)),u=new F({token:i,limit:s});a&&0<a.length&&u.add("user_ids",a),r.get(l,u,n)}}))}},{key:"createUserMetaData",value:function(e,n){var r=this,i=e.metaData;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(s.userId)),o=new F({metadata:i});r.post(a,o,n)}}))}},{key:"updateUserMetaData",value:function(e,n){var r=this,i=e.metaData,s=e.upsert;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(a.userId)),l=new F({metadata:i,upsert:s});r.put(o,l,n)}}))}},{key:"deleteUserMetaData",value:function(e,n){var r=this,i=e.metaDataKey;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_METADATA_KEY.replace("%s",encodeURIComponent(s.userId)).replace("%s",encodeURIComponent(i));r.delete(a,null,n)}}))}},{key:"deleteAllUserMetaData",value:function(e,n){var r=this;this.sb.ConnectionManager.ready((function(e,i){if(e)n(e,null);else{var s=t.Path.USERS_USERID_METADATA.replace("%s",encodeURIComponent(i.userId));r.delete(s,null,n)}}))}},{key:"getMessageChangeLogs",value:function(e,n){var r=this,i=e.channelUrl,s=e.ts,a=e.timestamp,o=e.token,l=e.isOpenChannel,u=e.includeMetaArray,c=e.includeReaction,d=e.includeReplies,h=e.includeParentMessageText,f=e.includeThreadInfo;this.sb.ConnectionManager.ready((function(e,p){if(e)n(e,null);else{var g=l?t.Path.OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS.replace("%s",encodeURIComponent(i)),y=new F;o&&y.add("token",o),s&&y.add("change_ts",s),a&&y.add("change_ts",a),"boolean"==typeof u&&y.add("with_sorted_meta_array",u),"boolean"==typeof c&&y.add("include_reactions",c),"boolean"==typeof d&&y.add("include_replies",d),"boolean"==typeof h&&y.add("include_parent_text_message",h),"boolean"==typeof f&&y.add("include_thread_info",f),r.get(g,y,n)}}))}},{key:"getMyMutedInfo",value:function(e,n){var r=this,i=e.channelUrl,s=e.userId,a=e.isGroupChannel;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=a?t.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(s)):t.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(s));r.get(l,null,n)}}))}},{key:"loadBannedUserList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.channelUrl,o=e.isOpenChannel;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=o?t.Path.OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(a)):t.Path.GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(a)),c=new F({token:i,limit:s});r.get(u,c,n)}}))}},{key:"loadMutedUserList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.channelUrl,o=e.isOpenChannel;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=o?t.Path.OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(a)):t.Path.GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(a)),c=new F({token:i,limit:s});r.get(u,c,n)}}))}},{key:"getMessageList",value:function(e,n){var r=this,i=e.channel,s=e.token,a=e.tokenType,o=e.isInclusive,l=e.prevResultSize,u=void 0===l?0:l,c=e.nextResultSize,d=void 0===c?0:c,h=e.shouldReverse,f=e.messageType,p=e.customType,g=e.senderUserIds,y=e.includeMetaArray,m=e.includeReaction,_=e.includeThreadInfo,v=e.includeReplies,E=e.includeParentMessageText,C=e.rootMessageId,b=e.parentMessageId;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var c=i.isOpenChannel()?t.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",i.url):t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",i.url),S=new F({is_sdk:String(!0),prev_limit:String(u),next_limit:String(d),include:String(o),reverse:String(h)});"timestamp"===a?S.add("message_ts",s):"messageId"===a&&S.add("message_id",String(s)),f&&S.add("message_type",String(f)),p&&S.add("custom_type",String(p)),Array.isArray(g)&&0<g.length&&S.add("sender_ids",g),"boolean"==typeof y&&S.add("with_sorted_meta_array",y),"boolean"==typeof m&&S.add("include_reactions",m),"boolean"==typeof _&&S.add("include_thread_info",_),"boolean"==typeof v&&S.add("include_replies",v),"boolean"==typeof E&&S.add("include_parent_message_text",E),C&&S.add("root_message_id",C),b&&S.add("parent_message_id",b),r.get(c,S,n)}}))}},{key:"translateUserMessage",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.messageId,o=e.translationTargetLanguages;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=s?t.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION.replace("%s",encodeURIComponent(i)).replace("%s",a):t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION.replace("%s",encodeURIComponent(i)).replace("%s",a),c=new F({target_langs:o});r.post(u,c,n)}}))}},{key:"getMessage",value:function(e,n){var r=this,i=e.channel,s=e.messageId;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=i.isOpenChannel()?t.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(i.url)).replace("%s",encodeURIComponent(s)):t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(i.url)).replace("%s",encodeURIComponent(s));r.get(o,null,n)}}))}},{key:"deleteMessage",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.messageId;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(a)):t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(a));r.delete(l,null,n)}}))}},{key:"muteUser",value:function(e,n){var r=this,i=e.channelUrl,s=e.userId,a=e.description,o=e.seconds,l=e.isGroupChannel;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=l?t.Path.GROUPCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(i)):t.Path.OPENCHANNELS_CHANNELURL_MUTE.replace("%s",encodeURIComponent(i)),d=new F({user_id:s});o&&(0<o||-1!==o)&&d.add("seconds",o),a&&d.add("description",a),r.post(c,d,n)}}))}},{key:"unmuteUser",value:function(e,n){var r=this,i=e.channelUrl,s=e.userId,a=e.isGroupChannel;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=a?t.Path.GROUPCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(s)):t.Path.OPENCHANNELS_CHANNELURL_MUTE_USERID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(s));r.delete(l,null,n)}}))}},{key:"banUser",value:function(e,n){var r=this,i=e.channelUrl,s=e.userId,a=e.description,o=e.seconds,l=e.isGroupChannel;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=l?t.Path.GROUPCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(i)):t.Path.OPENCHANNELS_CHANNELURL_BAN.replace("%s",encodeURIComponent(i)),d=new F({user_id:s});a&&d.add("description",a),d.add("seconds",String(o)),r.post(c,d,n)}}))}},{key:"unbanUser",value:function(e,n){var r=this,i=e.channelUrl,s=e.userId,a=e.isGroupChannel;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=a?t.Path.GROUPCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(s)):t.Path.OPENCHANNELS_CHANNELURL_BAN_USERID.replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(s));r.delete(l,null,n)}}))}},{key:"getMetaCounters",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.keys;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i)),u=new F({keys:a});r.get(l,u,n)}}))}},{key:"createMetaCounters",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.metaCounter;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i)),u=new F({metacounter:a});r.post(l,u,n)}}))}},{key:"updateMetaCounters",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.metaCounter,o=e.upsert,l=e.mode;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=s?t.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i)),d=new F({metacounter:a,upsert:o,mode:l});r.put(c,d,n)}}))}},{key:"deleteMetaCounter",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.key;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.OPENCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(i)).replace("%s",a):t.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY.replace("%s",encodeURIComponent(i)).replace("%s",a);r.delete(l,null,n)}}))}},{key:"deleteAllMetaCounters",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=s?t.Path.OPENCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METACOUNTER.replace("%s",encodeURIComponent(i));r.delete(o,null,n)}}))}},{key:"getMetaData",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.keys;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i)),u=new F({keys:a});r.get(l,u,n)}}))}},{key:"createMetaData",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.metaData;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i)),u=new F({metadata:a});r.post(l,u,n)}}))}},{key:"updateMetaData",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.metaData,o=e.upsert;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=s?t.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i)),c=new F({metadata:a,upsert:o});r.put(u,c,n)}}))}},{key:"deleteMetaData",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.key;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.OPENCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(i)).replace("%s",a):t.Path.GROUPCHANNELS_CHANNELURL_METADATA_KEY.replace("%s",encodeURIComponent(i)).replace("%s",a);r.delete(l,null,n)}}))}},{key:"deleteAllMetaData",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=s?t.Path.OPENCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_METADATA.replace("%s",encodeURIComponent(i));r.delete(o,null,n)}}))}},{key:"loadOperatorList",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.token,o=e.limit;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=s?t.Path.OPENCHANNELS_OPERATORS.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_OPERATORS.replace("%s",encodeURIComponent(i)),c=new F({token:a,limit:o});r.get(u,c,n)}}))}},{key:"getOpenChannel",value:function(e,n){var r=this,i=e.channelUrl,s=e.internalCall;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(i)),l=new F({});l.internal=s===A.INTERNAL_CALL,r.get(o,l,n)}}))}},{key:"loadOpenChannelList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.nameKeyword,o=e.urlKeyword,l=e.customTypes,u=e.includeFrozen;this.sb.ConnectionManager.ready((function(e,c){if(e)n(e,null);else{var d=t.Path.OPENCHANNELS,h=new F({token:i,limit:s});a&&h.add("name_contains",a),o&&h.add("url_contains",o),l&&0<l.length&&h.add("custom_types",l),"boolean"==typeof u&&h.add("show_frozen",u),r.get(d,h,n)}}))}},{key:"loadParticipantList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.channelUrl;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=t.Path.OPENCHANNELS_CHANNELURL_PARTICIPANTS.replace("%s",encodeURIComponent(a)),u=new F({token:i,limit:s});r.get(l,u,n)}}))}},{key:"createOpenChannel",value:function(e,n){var r=this,i=e.name,s=e.coverUrlOrImage,a=e.data,o=e.operatorUserIds,l=e.customType;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=t.Path.OPENCHANNELS,d=new F;"string"==typeof s&&d.add("cover_url",s),H.isFile(s)&&d.add("cover_file",s),null!==i&&"string"==typeof i&&d.add("name",i),a&&d.add("data",a),o&&(Array.isArray(o)?d.add("operators",o):d.add("operators",[o])),l&&d.add("custom_type",l),r.post(c,d,n)}}))}},{key:"updateOpenChannel",value:function(e,n){var r=this,i=e.channelUrl,s=e.name,a=e.coverUrlOrImage,o=e.data,l=e.operatorUserIds,u=e.customType;this.sb.ConnectionManager.ready((function(e,c){if(e)n(e,null);else{var d=t.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(i)),h=new F;"string"==typeof a&&h.add("cover_url",a),H.isFile(a)&&h.add("cover_file",a,a.name),null!==s&&"string"==typeof s&&h.add("name",s),null!==o&&"string"==typeof o&&h.add("data",o),null!==l&&(Array.isArray(l)?h.add("operator_ids",l):h.add("operator_ids",[l])),null!==u&&"string"==typeof u&&h.add("custom_type",u),r.put(d,h,n)}}))}},{key:"deleteOpenChannel",value:function(e,n){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.OPENCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(i));r.delete(a,null,n)}}))}},{key:"getGroupChannel",value:function(e,n){var r=this,i=e.channelUrl,s=e.showMember,a=e.internalCall;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=t.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(i)),u=new F({show_member:s,show_read_receipt:!0,show_delivery_receipt:!0});u.internal=a===A.INTERNAL_CALL,r.get(l,u,n)}}))}},{key:"loadGroupChannelList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.includeEmpty,o=e.order,l=e.userIdsFilter,u=e.nicknameContainsFilter,c=e.channelNameContainsFilter,d=e.channelUrlsFilter,h=e.customTypesFilter,f=e.customTypeStartsWithFilter,p=e.memberStateFilter,g=e.superChannelFilter,y=e.publicChannelFilter,m=e.unreadChannelFilter,_=e.metadataOrderKeyFilter,v=e.hiddenChannelFilter,E=e.searchFilter,C=e.includeFrozen;this.sb.ConnectionManager.ready((function(e,b){if(e)n(e,null);else{var S=t.Path.MYGROUPCHANNELS.replace("%s",encodeURIComponent(b.userId)),A=new F({token:i,limit:s,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:String(a),member_state_filter:p});h&&0<h.length&&A.add("custom_types",h),u&&A.add("members_nickname_contains",u),c&&A.add("name_contains",c),E.hasOwnProperty("search_query")&&E.hasOwnProperty("search_fields")&&(A.add("search_query",E.search_query),A.add("search_fields",E.search_fields)),l.userIds&&0<l.userIds.length&&(l.includeMode?(A.add("members_include_in",l.userIds),A.add("query_type",l.queryType.toUpperCase())):A.add("members_exactly_in",l.userIds)),d&&0<d.length&&A.add("channel_urls",d),A.add("super_mode",g),A.add("public_mode",y),A.add("unread_filter",m),_&&A.add("metadata_order_key",_),f&&A.add("custom_type_startswith",f),v&&A.add("hidden_mode",v),"boolean"==typeof C&&A.add("show_frozen",C),r.get(S,A,n)}}))}},{key:"loadPublicGroupChannelList",value:function(e,n){var r=this,i=e.token,s=e.limit,a=e.includeEmpty,o=e.order,l=e.channelNameContainsFilter,u=e.channelUrlsFilter,c=e.customTypesFilter,d=e.customTypeStartsWithFilter,h=e.superChannelFilter,f=e.membershipFilter,p=e.metadataOrderKeyFilter,g=e.includeFrozen;this.sb.ConnectionManager.ready((function(e,y){if(e)n(e,null);else{var m=r.cls.GroupChannel,_=t.Path.GROUPCHANNELS,v=new F({token:i,limit:s,order:o,show_member:!0,show_read_receipt:!0,show_delivery_receipt:!0,show_empty:String(a),public_mode:m.PublicChannelFilter.PUBLIC,public_membership_mode:f});c&&0<c.length&&v.add("custom_types",c),l&&v.add("name_contains",l),u&&0<u.length&&v.add("channel_urls",u),v.add("super_mode",h),p&&v.add("metadata_order_key",p),d&&v.add("custom_type_startswith",d),"boolean"==typeof g&&v.add("show_frozen",g),r.get(_,v,n)}}))}},{key:"createGroupChannel",value:function(e,n){var r=this,i=e.isDistinct,s=e.isSuper,a=e.isBroadcast,o=e.isPublic,l=e.channelUrl,u=e.isDiscoverable,c=e.isStrict,d=e.name,h=e.data,f=e.customType,p=e.coverUrl,g=e.coverImage,y=e.accessCode,m=e.isEphemeral,_=e._invitedUserIds,v=void 0===_?[]:_,E=e.operatorUserIds,b=e.messageSurvivalSeconds;this.sb.ConnectionManager.ready((function(e,_){if(e)n(e,null);else{var S=t.Path.GROUPCHANNELS,A=new F({user_ids:[_.userId].concat(C(v)).filter((function(e,t,n){return t===n.indexOf(e)}))});null!==p&&"string"==typeof p&&A.add("cover_url",p),H.isFile(g)&&A.add("cover_file",g,g.name),null!==l&&A.add("channel_url",l),null!==i&&A.add("is_distinct",i),null!==s&&A.add("is_super",s),null!==a&&A.add("is_broadcast",a),null!==o&&A.add("is_public",o),null!==u&&A.add("is_discoverable",u),null!==c&&A.add("strict",c),null!==m&&A.add("is_ephemeral",m),y&&A.add("access_code",y),null!==d&&"string"==typeof d&&A.add("name",d),h&&A.add("data",h),f&&A.add("custom_type",f),Array.isArray(E)&&0<E.length&&A.add("operator_ids",E),null!==b&&-1<b&&A.add("message_survival_seconds",b),r.post(S,A,n)}}))}},{key:"updateGroupChannel",value:function(e,n){var r=this,i=e.isDistinct,s=e.isPublic,a=e.channelUrl,o=e.isDiscoverable,l=e.name,u=e.data,c=e.customType,d=e.coverUrl,h=e.coverImage,f=e.accessCode,p=e.operatorUserIds,g=e.messageSurvivalSeconds;this.sb.ConnectionManager.ready((function(e,y){if(e)n(e,null);else{var m=t.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(a)),_=new F;null!==i&&_.add("is_distinct",i),null!==s&&_.add("is_public",s),null!==o&&_.add("is_discoverable",o),null!==f&&_.add("access_code",f),null!==d&&"string"==typeof d&&_.add("cover_url",d),H.isFile(h)&&_.add("cover_file",h,h.name),null!==l&&"string"==typeof l&&_.add("name",l),null!==u&&"string"==typeof u&&_.add("data",u),null!==c&&"string"==typeof c&&_.add("custom_type",c),null!==p&&(Array.isArray(p)?_.add("operator_ids",p):p&&_.add("operator_ids",[p])),null!==g&&-1<g&&_.add("message_survival_seconds",g),r.put(m,_,n)}}))}},{key:"inviteToGroupChannel",value:function(e,n){var r=this,i=e.channelUrl,s=e.userIds;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.GROUPCHANNELS_CHANNELURL_INVITE.replace("%s",encodeURIComponent(i)),l=new F({user_ids:s});r.post(o,l,n)}}))}},{key:"acceptInvitation",value:function(e,n){var r=this,i=e.channelUrl,s=e.accessCode;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION.replace("%s",encodeURIComponent(i)),l=new F({user_id:a.userId});s&&l.add("access_code",s),r.put(o,l,n)}}))}},{key:"declineInvitation",value:function(e,n){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION.replace("%s",encodeURIComponent(i)),o=new F({user_id:s.userId});r.put(a,o,n)}}))}},{key:"joinGroupChannel",value:function(e,n){var r=this,i=e.channelUrl,s=e.accessCode;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.GROUPCHANNELS_CHANNELURL_JOIN.replace("%s",encodeURIComponent(i)),l=new F({user_id:a.userId});s&&l.add("access_code",s),r.put(o,l,n)}}))}},{key:"leaveGroupChannel",value:function(e,n){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.GROUPCHANNELS_CHANNELURL_LEAVE.replace("%s",encodeURIComponent(i)),o=new F({user_id:s.userId});r.put(a,o,n)}}))}},{key:"hideGroupChannel",value:function(e,n){var r=this,i=e.channelUrl,s=e.hidePreviousMessages,a=e.allowAutoUnhide;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=t.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(i)),u=new F({user_id:o.userId,hide_previous_messages:s,allow_auto_unhide:a});r.put(l,u,n)}}))}},{key:"unhideGroupChannel",value:function(e,n){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.GROUPCHANNELS_CHANNELURL_HIDE.replace("%s",encodeURIComponent(i));r.delete(a,null,n)}}))}},{key:"freeze",value:function(e,n){var r=this,i=e.channelUrl,s=e.isGroupChannel,a=e.freezing;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=s?t.Path.GROUPCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(i)):t.Path.OPENCHANNELS_CHANNELURL_FREEZE.replace("%s",encodeURIComponent(i)),u=new F({freeze:a});r.put(l,u,n)}}))}},{key:"deleteGroupChannel",value:function(e,n){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.GROUPCHANNELS_CHANNELURL.replace("%s",encodeURIComponent(i));r.delete(a,null,n)}}))}},{key:"loadMemberList",value:function(e,n){var r=this,i=e.channelUrl,s=e.token,a=e.limit,o=e.mutedMemberFilter,l=e.order,u=e.memberStateFilter,c=e.nicknameStartsWithFilter;this.sb.ConnectionManager.ready((function(e,d){if(e)n(e,null);else{var h=t.Path.GROUPCHANNELS_MEMBERS.replace("%s",encodeURIComponent(i)),f=new F({token:s,limit:a,order:l.toLowerCase(),muted_member_filter:o.toLowerCase(),member_state_filter:u,show_read_receipt:!0,show_delivery_receipt:!0});c&&f.add("nickname_startswith",c),r.get(h,f,n)}}))}},{key:"report",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.reportCategory,o=e.reportingUserId,l=e.reportDescription;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=t.Path.REPORT_CHANNELS.replace("%s",encodeURIComponent(s?"open_channels":"group_channels")).replace("%s",encodeURIComponent(i)),d=new F({report_category:a});null!=o&&d.add("reporting_user_id",o),null!=l&&d.add("report_description",l),r.post(c,d,n)}}))}},{key:"reportUser",value:function(e,n){var r=this,i=e.offendingUserId,s=e.channelUrl,a=e.isOpenChannel,o=e.reportCategory,l=e.reportingUserId,u=e.reportDescription;this.sb.ConnectionManager.ready((function(e,c){if(e)n(e,null);else{var d=t.Path.REPORT_USERS.replace("%s",encodeURIComponent(i)),h=new F({channel_url:s,channel_type:a?"open_channels":"group_channels",report_category:o});null!=l&&h.add("reporting_user_id",l),null!=u&&h.add("report_description",u),r.post(d,h,n)}}))}},{key:"reportMessage",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.messageId,o=e.reportCategory,l=e.reportingUserId,u=e.reportDescription,c=e.offendingUserId;this.sb.ConnectionManager.ready((function(e,d){if(e)n(e,null);else{var h=t.Path.REPORT_MESSAGES.replace("%s",encodeURIComponent(s?"open_channels":"group_channels")).replace("%s",encodeURIComponent(i)).replace("%s",encodeURIComponent(a)),f=new F({report_category:o,offending_user_id:c});null!=l&&f.add("reporting_user_id",l),null!=u&&f.add("report_description",u),r.post(h,f,n)}}))}},{key:"sendUserMessage",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.message,o=e.data,l=e.customType,u=e.translationTargetLanguages,c=e.metaArrays,d=e.mentionType,h=e.mentionedUserIds,f=e.pushNotificationDeliveryOption,p=e.rootMessageId,g=e.parentMessageId;this.sb.ConnectionManager.ready((function(e,y){if(e)n(e,null);else{var m=r.cls.FileMessageParams,_=s?t.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(i)),v=new F({message_type:"MESG",user_id:y.userId,message:a,mention_type:d,mentioned_user_ids:[]});null!=o&&v.add("data",o),null!=l&&v.add("custom_type",l),u&&v.add("translation_target_langs",u),c&&0<c.length&&v.add("sorted_metaarray",c.map((function(e){return e.encode()}))),d===r.cls.BaseMessageParams.MentionType.CHANNEL?v.add("mentioned_user_ids",[]):Array.isArray(h)&&0<h.length&&v.add("mentioned_user_ids",h),f&&f!==m.PushNotificationDeliveryOption.DEFAULT&&v.add("push_option",f),p&&v.add("root_message_id",p),g&&v.add("parent_message_id",g),r.post(_,v,n)}}))}},{key:"sendFileMessage",value:function(e,n){var r=this,i=e.channelUrl,s=e.isOpenChannel,a=e.fileUrl,o=e.fileName,l=e.fileSize,u=e.fileType,c=e.data,d=e.customType,h=e.thumbnailSizes,f=e.requireAuth,p=e.metaArrays,g=e.mentionType,y=e.mentionedUserIds,m=e.pushNotificationDeliveryOption,_=e.rootMessageId,v=e.parentMessageId;this.sb.ConnectionManager.ready((function(e,E){if(e)n(e,null);else{var C=r.cls.FileMessageParams,b=s?t.Path.OPENCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(i)):t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES.replace("%s",encodeURIComponent(i)),S=new F({message_type:"FILE",user_id:E.userId,url:a,mention_type:g,mentioned_user_ids:[]});null!=o&&S.add("file_name",o),null!=l&&S.add("file_size",l),null!=u&&S.add("file_type",u),null!=c&&S.add("custom_field",c),null!=d&&S.add("custom_type",d),h&&S.add("thumbnails",h),f&&S.add("require_auth",f),p&&0<p.length&&S.add("sorted_metaarray",p.map((function(e){return e.encode()}))),g===r.cls.BaseMessageParams.MentionType.CHANNEL?S.add("mentioned_user_ids",[]):Array.isArray(y)&&0<y.length&&S.add("mentioned_user_ids",y),m&&m!==C.PushNotificationDeliveryOption.DEFAULT&&S.add("push_option",m),_&&S.add("root_message_id",_),v&&S.add("parent_message_id",v),r.post(b,S,n)}}))}},{key:"uploadFile",value:function(e,n){var r=this,i=e.file,s=e.thumbnailSizes,a=e.channelUrl,o=e.progressHandler,l=e.reqId;this.sb.ConnectionManager.ready((function(e,u){if(e)n(e,null);else{var c=t.Path.STORAGE_FILE,d=new F;if(d.add("file",i,i.name),a&&"string"==typeof a&&d.add("channel_url",a),s)for(var h=0;h<s.length;h++)d.add("thumbnail"+(h+1),s[h].maxWidth+","+s[h].maxHeight);d.upload.reqId=l,d.upload.deleteRequest=function(){var e=r.cls.FileMessageQueue;e.uploadRequest[l]&&delete e.uploadRequest[l]},d.upload.progressHandler=function(e){o&&"function"==typeof o&&o(e,l)},r.post(c,d,n)}}))}},{key:"registerScheduledUserMessage",value:function(e,n){var r=this,i=e.groupChannelParams,s=e.channelUrl,a=e.isOpenChannel;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=a?t.Path.OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES.replace("%s",encodeURIComponent(s)):t.Path.GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES.replace("%s",encodeURIComponent(s)),u=new F({scheduled_dt:i._getScheduleString(),user_id:o.userId,message:i.message,data:i.data});i.customType&&u.add("custom_type",i.customType),i.metaArrayKeys&&0<Object.keys(i.metaArrayKeys).length&&u.add("metaarray",i.metaArrayKeys),i.mentionType&&u.add("mention_type",i._mentionType),i._mentionType===r.cls.BaseMessageParams.MentionType.CHANNEL?u.add("mentioned_user_ids",[]):Array.isArray(i._mentionedUserIds)&&0<i._mentionedUserIds.length&&u.add("mentioned_user_ids",i._mentionedUserIds),i.translationTargetLanguages&&0<i.translationTargetLanguages.length&&u.add("translation_target_langs",i.translationTargetLanguages),i.pushNotificationDeliveryOption&&i.pushNotificationDeliveryOption!==r.cls.BaseMessageParams.PushNotificationDeliveryOption.DEFAULT&&u.add("push_option",i.pushNotificationDeliveryOption),r.post(l,u,n)}}))}},{key:"getMyPushTriggerOption",value:function(e,n){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(s.userId)).replace("%s",encodeURIComponent(i));r.get(a,null,n)}}))}},{key:"setMyPushTriggerOption",value:function(e,n){var r=this,i=e.channelUrl,s=e.pushTriggerOption,a=e.enable;this.sb.ConnectionManager.ready((function(e,o){if(e)n(e,null);else{var l=t.Path.USERS_USERID_PUSHPREFERENCE_CHANNELURL.replace("%s",encodeURIComponent(o.userId)).replace("%s",encodeURIComponent(i)),u=new F;s&&u.add("push_trigger_option",s),"boolean"==typeof a&&u.add("enable",a),r.put(l,u,n)}}))}},{key:"setMyCountPreference",value:function(e,n){var r=this,i=e.channelUrl,s=e.countPreference;this.sb.ConnectionManager.ready((function(e,a){if(e)n(e,null);else{var o=t.Path.USERS_COUNT_PREFERENCE.replace("%s",encodeURIComponent(a.userId)).replace("%s",encodeURIComponent(i)),l=new F({count_preference:s});r.put(o,l,n)}}))}},{key:"resetMyHistory",value:function(e,n){var r=this,i=e.channelUrl;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.GROUPCHANNELS_RESET_USER_HISTORY.replace("%s",encodeURIComponent(i));r.put(a,null,n)}}))}},{key:"addReaction",value:function(e,n){var r=this,i=e.isGroupChannel,s=e.channelUrl,a=e.messageId,o=e.key;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=i?t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(a)):t.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(a)),c=new F({reaction:o});r.post(u,c,n)}}))}},{key:"deleteReaction",value:function(e,n){var r=this,i=e.isGroupChannel,s=e.channelUrl,a=e.messageId,o=e.key;this.sb.ConnectionManager.ready((function(e,l){if(e)n(e,null);else{var u=i?t.Path.GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(a)):t.Path.OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION.replace("%s",encodeURIComponent(s)).replace("%s",encodeURIComponent(a)),c=new F({reaction:o});r.delete(u,c,n)}}))}},{key:"getAllEmoji",value:function(e){var n=this;this.sb.ConnectionManager.ready((function(r,i){r?e(r,null):n.get(t.Path.EMOJI_CATEGORIES,null,e)}))}},{key:"getEmojiCategory",value:function(e,n){var r=this,i=e.categoryId;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.EMOJI_CATEGORIES_CATEGORYID.replace("%s",i);r.get(a,null,n)}}))}},{key:"getEmoji",value:function(e,n){var r=this,i=e.emojiKey;this.sb.ConnectionManager.ready((function(e,s){if(e)n(e,null);else{var a=t.Path.EMOJIS_EMOJIKEY.replace("%s",i);r.get(a,null,n)}}))}}],[{key:"Path",get:function(){return{USERS:"/users",USERS_USERID:"/users/%s",USERS_USERID_LOGIN:"/users/%s/login",USERS_USERID_METADATA:"/users/%s/metadata",USERS_USERID_METADATA_KEY:"/users/%s/metadata/%s",USERS_USERID_MARKASREADALL:"/users/%s/mark_as_read_all",USERS_USERID_MY_GROUP_CHANNEL_CHANGELOGS:"/users/%s/my_group_channels/changelogs",USERS_USERID_UNREAD_ITEM_COUNT:"/users/%s/unread_item_count",USERS_USERID_UNREAD_MESSAGE_COUNT:"/users/%s/unread_message_count",USERS_USERID_UNREAD_CHANNEL_COUNT:"/users/%s/unread_channel_count",USERS_USERID_PUSH_GCM_TOKEN:"/users/%s/push/gcm/%s",USERS_USERID_PUSH_GCM:"/users/%s/push/gcm",USERS_USERID_PUSH_DEVICE_TOKENS:"/users/%s/push/%s/device_tokens",USERS_USERID_PUSHPREFERENCE_CHANNELURL:"/users/%s/push_preference/%s",USERS_USERID_PUSHPREFERENCE:"/users/%s/push_preference/",USERS_USERID_PUSH_TEMPLATE:"/users/%s/push/template",USERS_USERID_BLOCK:"/users/%s/block",USERS_USERID_BLOCK_TARGETID:"/users/%s/block/%s",USERS_USERID_PUSH_APNS_TOKEN:"/users/%s/push/apns/%s",USERS_USERID_PUSH_APNS:"/users/%s/push/apns",USERS_USERID_PUSH:"/users/%s/push",USERS_USERID_GROUP_CHANNEL_INVITATION_PREFERENCE:"/users/%s/channel_invitation_preference",USERS_USERID_GROUP_CHANNEL_COUNT:"/users/%s/group_channel_count",USERS_COUNT_PREFERENCE:"/users/%s/count_preference/%s",OPENCHANNELS:"/open_channels",OPENCHANNELS_CHANNELURL:"/open_channels/%s",OPENCHANNELS_CHANNELURL_MESSAGES:"/open_channels/%s/messages",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/open_channels/%s/messages/%s",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/open_channels/%s/messages/%s/translation",OPENCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/open_channels/%s/messages/changelogs",OPENCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/open_channels/%s/scheduled_messages",OPENCHANNELS_CHANNELURL_PARTICIPANTS:"/open_channels/%s/participants",OPENCHANNELS_CHANNELURL_METADATA:"/open_channels/%s/metadata",OPENCHANNELS_CHANNELURL_METADATA_KEY:"/open_channels/%s/metadata/%s",OPENCHANNELS_CHANNELURL_METACOUNTER:"/open_channels/%s/metacounter",OPENCHANNELS_CHANNELURL_METACOUNTER_KEY:"/open_channels/%s/metacounter/%s",OPENCHANNELS_CHANNELURL_BAN:"/open_channels/%s/ban",OPENCHANNELS_CHANNELURL_BAN_USERID:"/open_channels/%s/ban/%s",OPENCHANNELS_CHANNELURL_MUTE:"/open_channels/%s/mute",OPENCHANNELS_CHANNELURL_MUTE_USERID:"/open_channels/%s/mute/%s",OPENCHANNELS_CHANNELURL_FREEZE:"/open_channels/%s/freeze",OPENCHANNELS_OPERATORS:"/open_channels/%s/operators",OPENCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:"/open_channels/%s/messages/%s/reactions",GROUPCHANNELS:"/group_channels",MYGROUPCHANNELS:"/users/%s/my_group_channels",GROUPCHANNELS_CHANNELURL:"/group_channels/%s",GROUPCHANNELS_CHANNELURL_INVITE:"/group_channels/%s/invite",GROUPCHANNELS_CHANNELURL_ACCEPT_INVITATION:"/group_channels/%s/accept",GROUPCHANNELS_CHANNELURL_DECLINE_INVITATION:"/group_channels/%s/decline",GROUPCHANNELS_CHANNELURL_HIDE:"/group_channels/%s/hide",GROUPCHANNELS_CHANNELURL_LEAVE:"/group_channels/%s/leave",GROUPCHANNELS_CHANNELURL_JOIN:"/group_channels/%s/join",GROUPCHANNELS_CHANNELURL_MESSAGES:"/group_channels/%s/messages",GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASREAD:"/group_channels/%s/messages/mark_as_read",GROUPCHANNELS_CHANNELURL_MESSAGES_MARKASDELIVERED:"/group_channels/%s/messages/mark_as_delivered",GROUPCHANNELS_CHANNELURL_MESSAGES_TOTALCOUNT:"/group_channels/%s/messages/total_count",GROUPCHANNELS_CHANNELURL_MESSAGES_UNREADCOUNT:"/group_channels/%s/messages/unread_count",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID:"/group_channels/%s/messages/%s",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_TRANSLATION:"/group_channels/%s/messages/%s/translation",GROUPCHANNELS_CHANNELURL_MESSAGES_CHANGELOGS:"/group_channels/%s/messages/changelogs",GROUPCHANNELS_CHANNELURL_SCHEDULED_MESSAGES:"/group_channels/%s/scheduled_messages",GROUPCHANNELS_CHANNELURL_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_METADATA:"/group_channels/%s/metadata",GROUPCHANNELS_CHANNELURL_METADATA_KEY:"/group_channels/%s/metadata/%s",GROUPCHANNELS_CHANNELURL_METACOUNTER:"/group_channels/%s/metacounter",GROUPCHANNELS_CHANNELURL_METACOUNTER_KEY:"/group_channels/%s/metacounter/%s",GROUPCHANNELS_RESET_USER_HISTORY:"/group_channels/%s/reset_user_history",GROUPCHANNELS_OPERATORS:"/group_channels/%s/operators",GROUPCHANNELS_MEMBERS:"/group_channels/%s/members",GROUPCHANNELS_CHANNELURL_BAN:"/group_channels/%s/ban",GROUPCHANNELS_CHANNELURL_BAN_USERID:"/group_channels/%s/ban/%s",GROUPCHANNELS_CHANNELURL_MUTE:"/group_channels/%s/mute",GROUPCHANNELS_CHANNELURL_MUTE_USERID:"/group_channels/%s/mute/%s",GROUPCHANNELS_CHANNELURL_FREEZE:"/group_channels/%s/freeze",GROUPCHANNELS_CHANNELURL_MESSAGES_MESSAGEID_REACTION:"/group_channels/%s/messages/%s/reactions",STORAGE_FILE:"/storage/file",STORAGE_PROFILE:"/storage/profile_image",FRIENDS:"/users/%s/friends",FRIENDS_CHANGE_LOGS:"/users/%s/friends/changelogs",FRIENDS_DISCOVERIES:"/users/%s/friend_discoveries",SEARCH_MESSAGE:"/search/messages",REPORT_USERS:"/report/users/%s",REPORT_CHANNELS:"/report/%s/%s",REPORT_MESSAGES:"/report/%s/%s/messages/%s",EMOJIS_EMOJIKEY:"/emojis/%s",EMOJI_CATEGORIES:"/emoji_categories",EMOJI_CATEGORIES_CATEGORYID:"/emoji_categories/%s"}}}]),t}(),j=function(){function e(t,n){a(this,e),this.sb=t,this.ws=null,this.wsHost=null,this.WebSocket=null,this.handler=n||new e.ConnectionHandler,this.explicitDisconnect=!1,this.lastActiveMillis=0;try{this.WebSocket="undefined"==typeof WebSocket?i:WebSocket}catch(t){this.WebSocket=WebSocket}}return l(e,[{key:"connect",value:function(e,t,n){var r=this;w.debug("WSClient connect called");var i=k.get(this.sb._iid).container,s=i.pinger,a=i.auth,o=i.extensions,l=i.getUserAgentWithExtensions;this.wsHost=n;try{var u="/?p=JS&pv="+encodeURIComponent(A.OS_VERSION)+"&sv="+encodeURIComponent(A.SDK_VERSION)+"&ai="+encodeURIComponent(this.sb.getApplicationId());if(a.sessionKey?u+="&key="+encodeURIComponent(a.sessionKey):u+="&user_id="+encodeURIComponent(e)+"&access_token="+encodeURIComponent(t),u+="&active=1",u+="&SB-User-Agent="+encodeURIComponent(l(o)),u+="&Request-Sent-Timestamp="+(new Date).getTime().toString(),u+="&include_extra_data="+encodeURIComponent(["premium_feature_list","file_upload_size_limit","emoji_hash"].join(",")),this.ws=new this.WebSocket(this.wsHost+u),!this.ws)return this.sb.isReconnectingOnError=!0,void this.handler.onError("ws does not exist.")}catch(e){return this.sb.isReconnectingOnError=!0,void this.handler.onError(e)}try{this.sb.getDebugMode()&&"undefined"!=typeof window&&(window.ws=this.ws)}catch(e){w.debug("window object does not exist.")}var c=!1;this.ws.onopen=function(e){w.debug("WSClient onopen called"),r.handler.onOpen(e)},this.ws.onmessage=function(e){r.active();var t=e.data.split("\n");for(var n in t){var i=t[n];if(i&&"string"==typeof i){try{if("PONG"===i.substring(0,4)){s.pong();continue}}catch(e){w.debug("ws.onmessage-command check error: ",e)}r.handler.onMessage(i)}}},this.ws.onerror=function(e){w.debug("WSClient ws.onerror called: ",e),s&&s.stop(),c=!0,r.sb.isReconnectingOnError=!0,r.handler.onError(e)},this.ws.onclose=function(e){w.debug("WSClient ws.onclose called - e, explicitDisconnect: ",e,r.explicitDisconnect),s&&s.stop(),r.explicitDisconnect?r.handler.onClose(e):c||r.handler.onError(e),r.explicitDisconnect=!1}}},{key:"disconnect",value:function(e,t){w.debug("WSClient disconnect called [explicit]: ",e);var n=k.get(this.sb._iid).container.pinger;n&&n.stop(),this.explicitDisconnect=!0===e,this.ws&&(this.ws.onopen=function(){},this.ws.onmessage=function(){},this.ws.onclose=function(){t&&t()},this.ws.onerror=function(){},this.ws.close(),this.ws=null),this.explicitDisconnect?this.handler.onClose():this.handler.onError(),this.explicitDisconnect=!1}},{key:"send",value:function(e,t){1!==this.ws.readyState?t&&t(new N("Connection is not valid. Please reconnect.",N.WEBSOCKET_CONNECTION_CLOSED),null):(this.ws.send(e.encode()),t&&t(null,null))}},{key:"active",value:function(){this.lastActiveMillis=(new Date).getTime()}},{key:"getConnectionState",value:function(){try{return 1===this.ws.readyState?this.sb.ConnectionState.OPEN:0===this.ws.readyState?this.sb.ConnectionState.CONNECTING:this.sb.ConnectionState.CLOSED}catch(e){return this.sb.ConnectionState.CLOSED}}}]),e}();j.ConnectionHandler=function e(){a(this,e),this.onReady=function(){},this.onOpen=function(){},this.onClose=function(){},this.onMessage=function(){},this.onError=function(){}},Number.MAX_SAFE_INTEGER||Object.defineProperty(Number,"MAX_SAFE_INTEGER",{value:Math.pow(2,53)-1});var q=function(){function e(t){a(this,e),this.sb=t,this.cls=L.get(this.sb._iid),this.ws=new j(this.sb),this.reconnectParams={interval:3,retryCount:3,multiplier:2,maxInterval:24},this.reconnectCount=0,this.reconnectDelay=0}return l(e,[{key:"connect",value:function(e,t){var n=this,r=k.get(this.sb._iid).container,i=r.auth,s=r.apiClient,a=r.commandHandler,o=this.cls.GroupChannel,l=new j.ConnectionHandler;this.ws=new j(this.sb,l),l.onMessage=function(e){a.onRawCommandReceived(e)},this.sb.loginHandler=function(e,t){if(n.sb.connecting=!1,e)n.disconnect({clearSession:!0,err:e},null);else{clearInterval(n.sb.globalTimer);var r=function(){if(o.cachedChannels)for(var e in o.cachedChannels){var t=o.cachedChannels[e];if(t.invalidateTypingStatus())for(var r in n.sb.channelHandlers)n.sb.channelHandlers[r].onTypingStatusUpdated(t)}};r(),n.sb.globalTimer=setInterval((function(){return r()}),1e3),n.flushConnectionCallbacks(null,t),n.sb.connecting=!1,n.sb.reconnecting=!1,n.sb.ConnectionManager.processAllReadyHandler(null)}},l.onOpen=function(){n.sb.loginTimer=setTimeout((function(){n.sb.loginTimer=null,n.sb.onLoginTimerCancel=null,n.flushConnectionCallbacks(new N("Connection timeout.",N.LOGIN_TIMEOUT),null),n.sb.disconnect(null)}),A.COMMAND_ACK_TIMEOUT),n.sb.onLoginTimerCancel=function(){n.flushConnectionCallbacks(new N("Connection has been canceled.",N.REQUEST_FAILED),null)},n.sb.connecting=!1},l.onError=function(t){w.debug("WebSocketClient.ConnectionHandler.onError",t),i.sessionKey?(n.sb.isReconnectingOnError=!0,n.sb.ConnectionManager.errorAllReadyHandler(),n.reconnect(e,!0)):n.flushConnectionCallbacks(new N("Websocket connection failed.",N.WEBSOCKET_CONNECTION_FAILED),null),n.sb.connecting=!1},l.onClose=function(){w.debug("WebSocketClient.ConnectionHandler.onClose"),n.sb.connecting=!1},s.checkRouting((function(r,i){if(r)return n.sb.connecting=!1,void n.flushConnectionCallbacks(new N("Connection routing failed.",N.REQUEST_FAILED),null);s.dummyCall((function(e){e&&w.log("API dummy call failed",e)})),n.ws.connect(e,t,i.wsHost)}))}},{key:"reconnect",value:function(e,t){var n=this,r=!(1<arguments.length&&void 0!==t)||t,i=k.get(this.sb._iid).container,s=i.auth,a=i.apiClient,o=i.commandHandler,l=this.cls.OpenChannel;if(this.sb.reconnecting=!0,this.sb.reconnectTimer)w.debug("still reconnecting");else{if(this.reconnectCount+=1,this.reconnectCount<=1){if(r)for(var u in this.sb.connectionHandlers)this.sb.connectionHandlers[u].onReconnectStarted();this.reconnectDelay=0}else this.reconnectDelay=Math.min(1e3*this.reconnectParams.interval*Math.pow(this.reconnectParams.multiplier,this.reconnectCount-2),0<this.reconnectParams.maxInterval?1e3*this.reconnectParams.maxInterval:Number.MAX_SAFE_INTEGER);if(!e||!s.sessionKey||0<this.reconnectParams.retryCount&&this.reconnectCount>this.reconnectParams.retryCount){for(var c in this.disconnect({clearSession:!1,err:new N("Websocket connection failed.",N.WEBSOCKET_CONNECTION_FAILED)},null),this.reconnectCount=0,this.sb.connectionHandlers)this.sb.connectionHandlers[c].onReconnectFailed();return this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1,void this.sb.ConnectionManager.errorAllReadyHandler()}this.sb.onReconnectTimerCancel=function(){n.reconnectCount=0},this.sb.reconnectTimer=setTimeout((function(){n.sb.reconnectTimer=null,n.sb.onReconnectTimerCancel=null,n.ws&&n.ws.disconnect(!0);var t=new j.ConnectionHandler;n.ws=new j(n.sb,t),n.sb.loginHandler=function(){for(var e in n.reconnectCount=0,n.sb.connecting=!1,n.sb.reconnecting=!1,n.sb.isReconnectingOnError=!1,n.sb.connectionHandlers)n.sb.connectionHandlers[e].onReconnectSucceeded();if(n.sb.ConnectionManager.processAllReadyHandler(null),n.sb.isReconnectingOnError)for(var t in n.sb.ConnectionManager.networkHandlers)n.sb.ConnectionManager.networkHandlers[t].onReconnected();Object.keys(l.enteredChannels).forEach((function(e){l.enteredChannels[e].enter((function(t,r){if(t){var i=n.cls.FileMessageQueue;delete l.enteredChannels[e],i.delete(e)}}))}))},t.onOpen=function(){w.debug("reconnect onOpen"),n.sb.loginTimer=setTimeout((function(){w.debug("reconnect loginTimer timeout"),n.sb.loginTimer=null,n.reconnect(e,!0)}),A.COMMAND_ACK_TIMEOUT),n.sb.onLoginTimerCancel=null,n.sb.reconnecting=!1},t.onMessage=function(e){o.onRawCommandReceived(e)},t.onError=function(t){w.debug("reconnect onError",t),n.sb.isReconnectingOnError=!0,n.sb.ConnectionManager.errorAllReadyHandler(),n.reconnect(e,!0)},t.onClose=function(){w.debug("reconnect onClose"),n.sb.reconnecting=!1},a.checkRouting((function(t,r){t?n.reconnect(e,!0):(n.sb.getCurrentApiHost()!==r.apiHost&&a.get("/",null,(function(){})),n.ws.connect(e,null,r.wsHost))}))}),this.reconnectDelay)}}},{key:"disconnect",value:function(e,t){var n=k.get(this.sb._iid),r=n.container.ackStateMap,i=this.cls,s=i.GroupChannel,a=i.OpenChannel,o=e.clearSession,l=e.err;if(this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.onLoginTimerCancel&&(this.sb.onLoginTimerCancel(),this.sb.onLoginTimerCancel=null),this.sb.loginTimer=null),this.sb.reconnectTimer&&(clearTimeout(this.sb.reconnectTimer),this.sb.onReconnectTimerCancel&&(this.sb.onReconnectTimerCancel(),this.sb.onReconnectTimerCancel=null),this.sb.reconnectTimer=null),this.ws&&(this.reconnectCount=0,this.ws.disconnect(!0),this.ws=null),o){for(var u in a.clearEnteredChannels(),a.clearCache(),s.clearCache(),this.sb.globalTimer&&(clearInterval(this.sb.globalTimer),this.sb.globalTimer=null),r)clearTimeout(r[u].timer);this.sb.currentUser=null,n.set("ackStateMap",{}),n.set("subscribedUnreadMessageCount",{all:0,custom_types:{},ts:0}),n.set("auth",new R)}l&&(this.flushConnectionCallbacks(l,null),this.sb.connecting=!1,this.sb.reconnecting=!1,this.sb.isReconnectingOnError=!1),t&&t(null,null)}},{key:"flushConnectionCallbacks",value:function(e,t){var n=this.sb.connectionCallbacks;this.sb.connectionCallbacks=[],n.forEach((function(n){return n(e,t)}))}}]),e}(),z=function(){function e(t){var n=t.type,r=t.nullable,i=void 0!==r&&r,s=t.optional,o=void 0!==s&&s,l=t.optionalIf,u=void 0===l?null:l,c=t.ignoreIf,d=void 0===c?null:c,h=t.defaultValue,f=void 0===h?null:h,p=t.constraint,g=void 0===p?null:p;a(this,e),this.type=n,this.nullable=i,this.optional=o,this.optionalIf=u,this.ignoreIf=d,this.defaultValue=f,this.constraint=g}return l(e,[{key:"isMatchingType",value:function(e){function t(t,n){return"string"==typeof n?s(t)===n||"array"===n&&Array.isArray(t)||"file"===n&&H.isFile(t)||"null"===n&&null===t||"date"===n&&t instanceof Date:"function"==typeof n?t instanceof n:"object"===s(n)&&-1<Object.keys(n).map((function(e){return n[e]})).indexOf(e)}return t(e,this.type)||Array.isArray(this.type)&&this.type.some((function(n){return t(e,n)}))||this.nullable&&null===e}}],[{key:"parse",value:function(t,n){for(t=e.toArray(t);void 0===t[t.length-1];)t.pop();var r=!1,i=null;"callback"===n[n.length-1].type&&("function"==typeof t[t.length-1]&&(i=t.pop()),n.pop(),r=!0);var s=[],a=null,o=0;for(var l in n){var u=n[l];"function"==typeof u.ignoreIf&&u.ignoreIf(t)?s.push(u.hasOwnProperty("defaultValue")?u.defaultValue:null):u.isMatchingType(t[o])?(u.nullable&&null===t[o]||!u.constraint||u.constraint(t[o])||(a=e.error),s.push(t[o]),o++):u.optional||"function"==typeof u.optionalIf&&u.optionalIf(t)?s.push(u.hasOwnProperty("defaultValue")?u.defaultValue:null):(a=e.error,s.push(t[o]),o++)}return r&&i&&s.push(i),t.length!==o&&(a=e.error),[a].concat(s)}},{key:"toArray",value:function(e){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}},{key:"error",get:function(){return new N("Invalid parameter.",N.INVALID_PARAMETER)}}]),e}(),Y=function(){function e(t){a(this,e),this.sb=t,this.authCount=0,this.readyHandlers=[],this.networkHandlers={},this.authenticateTimer=1e4,this.authInfoRequester=null}return l(e,[{key:"addReadyHandler",value:function(e){e&&"function"==typeof e&&this.readyHandlers.push(e)}},{key:"ready",value:function(e,t){var n=!(1<arguments.length&&void 0!==t)||t,r=k.get(this.sb._iid).container,i=r.auth,s=r.isInBackground;n&&i.hasSession()?e&&(this.sb.currentUser?e(null,this.sb.currentUser):(this.addReadyHandler(e),this.errorAllReadyHandler()),this.sb.getConnectionState()!==this.sb.ConnectionState.CLOSED||s||this.sb.reconnect()):(this.addReadyHandler(e),this.sb.isReconnectingOnError?this.errorAllReadyHandler():this.sb.getConnectionState()===this.sb.ConnectionState.OPEN?this.processAllReadyHandler(null):this.sb.getConnectionState()===this.sb.ConnectionState.CONNECTING||this.errorAllReadyHandler())}},{key:"processAllReadyHandler",value:function(e){if(0<this.readyHandlers.length){var t=this.sb.currentUser,n=this.readyHandlers;this.readyHandlers=[],n.forEach((function(n){n&&"function"==typeof n&&n(e,t)}))}}},{key:"errorAllReadyHandler",value:function(){this.processAllReadyHandler(new N("Connection should be made first.",N.CONNECTION_REQUIRED))}},{key:"NetworkHandler",value:function(){this.onReconnected=function(){}}},{key:"addNetworkHandler",value:function(e,t){this.networkHandlers[e]=t}},{key:"removeNetworkHandler",value:function(e){delete this.networkHandlers[e]}},{key:"removeAllNetworkHandler",value:function(){this.networkHandlers={}}},{key:"authenticate",value:function(e){var t=this;if(this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnecting)this.sb.connecting=!1,e(null,this.sb.currentUser);else if(this.authInfoRequester&&"function"==typeof this.authInfoRequester){this.sb.connecting=!0,this.authCount++;var n=setTimeout((function(){n=null,t.authCount--,0===t.authCount&&0===t.sb.connectionCallbacks.length&&(t.sb.connecting=!1),t.errorAllReadyHandler(),e(new N("Connection should be made first.",N.CONNECTION_REQUIRED),null)}),this.authenticateTimer);this.authInfoRequester((function(r){if(n){clearTimeout(n),n=null,t.authCount--;var i=function(n,r){t.sb.connecting=!1,e(n,null)};r&&r.hasOwnProperty("userId")?r.accessToken?r.apiHost&&r.wsHost?t.sb.connect(r.userId,r.accessToken,r.apiHost,r.wsHost,i):t.sb.connect(r.userId,r.accessToken,i):r.apiHost&&r.wsHost?t.sb.connect(r.userId,r.apiHost,r.wsHost,i):t.sb.connect(r.userId,i):e(z.error,null)}}))}else e(z.error,null)}}]),e}(),Q=function(){function e(t){a(this,e),this.sb=t}return l(e,[{key:"onlineWorker",value:function(){try{if("undefined"!=typeof navigator&&navigator.onLine){var e=k.get(this.sb._iid).container.auth;this.sb.reconnecting||this.sb.connecting||!e.sessionKey||this.sb.getConnectionState()===this.sb.ConnectionState.OPEN||this.sb.reconnect()}}catch(e){w.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"offlineWorker",value:function(){try{if("undefined"!=typeof navigator&&!navigator.onLine){var e=k.get(this.sb._iid).container,t=e.auth,n=e.pinger;this.sb.reconnecting||this.sb.connecting||!t.sessionKey||(n&&n.stop(),this.sb.reconnect())}}catch(e){w.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"start",value:function(){try{"undefined"!=typeof window&&window.addEventListener&&"ononline"in window&&"onoffline"in window&&"undefined"!=typeof navigator&&"boolean"==typeof navigator.onLine&&(window.addEventListener("online",this.onlineWorker),window.addEventListener("offline",this.offlineWorker))}catch(e){w.debug("There is no window.addEventListener.ononline or navigator.onLine")}}},{key:"stop",value:function(){try{window.removeEventListener("online",this.onlineWorker,!1),window.removeEventListener("offline",this.offlineWorker,!1)}catch(e){w.debug("There is no window.addEventListener.ononline or navigator.onLine")}}}]),e}(),K=(new Date).getTime(),V=function(){function e(t,n){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;switch(a(this,e),this.command=t,this.requestId=r,arguments.length){case 1:if(!t||t.length<=4)this.command="NOOP",this.payload="{}";else if(this.decode(t),this.isRequestIdCommand){var i=this.getJsonElement();i&&(this.requestId=i.req_id||"")}break;case 2:case 3:!this.requestId&&this.isRequestIdCommand&&(this.requestId=e.generateRequestId()),n.req_id=this.requestId||"",this.payload=JSON.stringify(n)}}return l(e,[{key:"encode",value:function(){return this.command+this.payload+"\n"}},{key:"decode",value:function(e){e=e.trim(),this.command=e.substring(0,4),this.payload=e.substring(4)}},{key:"getJsonElement",value:function(){return JSON.parse(this.payload)}},{key:"isRequestIdCommand",get:function(){return this.isAckRequired||"EROR"===this.command}},{key:"isAckRequired",get:function(){return"MESG"===this.command||"FILE"===this.command||"ENTR"===this.command||"EXIT"===this.command||"READ"===this.command||"MEDI"===this.command||"FEDI"===this.command}}],[{key:"bPing",value:function(){return new this("PING",{id:(new Date).getTime(),active:1})}},{key:"bMessage",value:function(e){var t=e.channelUrl,n=e.message,r=e.data,i=e.customType,s=e.metaArrays,a=e.mentionType,o=e.mentionedUserIds,l=e.translationTargetLanguages,u=e.pushNotificationDeliveryOption,c=e.requestId,d=void 0===c?null:c,h=e.silent,f=void 0!==h&&h,p=e.rootMessageId,g=void 0===p?null:p,y=e.parentMessageId,m=void 0===y?null:y,_=L.get(this._iid),v=_.UserMessageParams,E=_.BaseMessageParams,C={};return C.channel_url=t,C.message=n,C.data=r,s&&0<s.length&&(C.metaarray=s.map((function(e){return e.encode()}))),a&&(C.mention_type=a),C.mentioned_user_ids=[],a===E.MentionType.CHANNEL?C.mentioned_user_ids=[]:Array.isArray(o)&&0<o.length&&(C.mentioned_user_ids=o),i&&(C.custom_type=i),l&&0<l.length&&(C.target_langs=l),u&&u!==v.PushNotificationDeliveryOption.DEFAULT&&(C.push_option=u),f&&(C.silent=f),g&&(C.root_message_id=g),m&&(C.parent_message_id=m),new this("MESG",C,d)}},{key:"bFile",value:function(e){var t=e.channelUrl,n=e.url,r=e.name,i=e.type,s=e.size,a=e.data,o=e.customType,l=e.thumbnailSizes,u=e.requireAuth,c=e.metaArrays,d=e.mentionType,h=e.mentionedUserIds,f=e.pushNotificationDeliveryOption,p=e.requestId,g=void 0===p?null:p,y=e.silent,m=void 0!==y&&y,_=e.rootMessageId,v=void 0===_?null:_,E=e.parentMessageId,C=void 0===E?null:E,b=L.get(this._iid),S=b.BaseMessageParams,A=b.FileMessageParams,I={};return I.channel_url=t,I.url=n,I.name=r||"",I.type=i||"",I.size=s||0,I.custom=a,o&&(I.custom_type=o),l&&(I.thumbnails=l),u&&(I.require_auth=u),c&&0<c.length&&(I.metaarray=c.map((function(e){return e.encode()}))),d&&(I.mention_type=d),I.mentioned_user_ids=[],d===S.MentionType.CHANNEL?I.mentioned_user_ids=[]:Array.isArray(h)&&0<h.length&&(I.mentioned_user_ids=h),f&&f!==A.PushNotificationDeliveryOption.DEFAULT&&(I.push_option=f),m&&(I.silent=m),v&&(I.root_message_id=v),C&&(I.parent_message_id=C),new this("FILE",I,g)}},{key:"bUpdateUserMessage",value:function(e){var t=e.channelUrl,n=e.messageId,r=e.message,i=void 0===r?null:r,s=e.data,a=void 0===s?null:s,o=e.customType,l=void 0===o?null:o,u=e.mentionType,c=void 0===u?null:u,d=e.mentionedUserIds,h=void 0===d?null:d,f=e.metaArrayParams,p=void 0===f?null:f,g=L.get(this._iid).BaseMessageParams,y={};return y.channel_url=t,y.msg_id=n,null!=i&&void 0!==i&&(y.message=i),null!=a&&void 0!==a&&(y.data=a),null!=l&&void 0!==l&&(y.custom_type=l),c&&(y.mention_type=c),c===g.MentionType.CHANNEL?y.mentioned_user_ids=[]:Array.isArray(h)&&0<h.length&&(y.mentioned_user_ids=h),p&&(y.metaarray=p),new this("MEDI",y)}},{key:"bUpdateFileMessage",value:function(e){var t=e.channelUrl,n=e.messageId,r=e.data,i=void 0===r?null:r,s=e.customType,a=void 0===s?null:s,o=e.mentionType,l=void 0===o?null:o,u=e.mentionedUserIds,c=void 0===u?null:u,d=e.metaArrayParams,h=void 0===d?null:d,f=L.get(this._iid).BaseMessageParams,p={};return p.channel_url=t,p.msg_id=n,null!=i&&void 0!==i&&(p.data=i),null!=a&&void 0!==a&&(p.custom_type=a),l&&(p.mention_type=l),l===f.MentionType.CHANNEL?p.mentioned_user_ids=[]:Array.isArray(c)&&0<c.length&&(p.mentioned_user_ids=c),h&&(p.metaarray=h),new this("FEDI",p)}},{key:"bRead",value:function(e){var t=e.channelUrl,n={};return n.channel_url=t,new this("READ",n)}},{key:"bMessageAck",value:function(e){var t=e.channelUrl,n=e.messageId,r={};return r.channel_url=t,r.msg_id=n,new this("MACK",r)}},{key:"bTypeStart",value:function(e){var t=e.channelUrl,n=e.time,r={};return r.channel_url=t,r.time=n,new this("TPST",r)}},{key:"bTypeEnd",value:function(e){var t=e.channelUrl,n=e.time,r={};return r.channel_url=t,r.time=n,new this("TPEN",r)}},{key:"bEnter",value:function(e){var t=e.channelUrl,n={};return n.channel_url=t,new this("ENTR",n)}},{key:"bExit",value:function(e){var t=e.channelUrl,n={};return n.channel_url=t,new this("EXIT",n)}},{key:"generateRequestId",value:function(){return String(++K)}}]),e}(),W=new WeakMap,J=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};a(this,e);var n=[];if(t.hasOwnProperty("premium_feature_list"))try{var r=JSON.parse(t.premium_feature_list);n.push.apply(n,C(r))}catch(t){}W.set(this,{emojiHash:t.hasOwnProperty("emoji_hash")?t.emoji_hash:"",uploadSizeLimit:t.hasOwnProperty("file_upload_size_limit")?1048576*t.file_upload_size_limit:Number.MAX_VALUE,useReaction:t.hasOwnProperty("use_reaction")&&t.use_reaction,premiumFeatureList:n})}return l(e,[{key:"emojiHash",get:function(){return W.get(this).emojiHash}},{key:"uploadSizeLimit",get:function(){return W.get(this).uploadSizeLimit}},{key:"premiumFeatureList",get:function(){return W.get(this).premiumFeatureList}},{key:"isUsingReaction",get:function(){return W.get(this).useReaction}}]),e}(),X=function(){function e(){a(this,e),this.messageId=null,this.userId=null,this.key=null,this.operation="",this.updatedAt=null}return l(e,null,[{key:"createFromJson",value:function(e){var t=e.msg_id,n=e.user_id,r=e.operation,i=e.reaction,s=e.updated_at;if(("string"==typeof t||"number"==typeof t)&&t&&"string"==typeof n&&"string"==typeof r&&0<=["add","delete"].indexOf(r.toLowerCase())&&"string"==typeof i&&i&&"number"==typeof s){var a=new this;return a.messageId=parseInt(t),a.userId=n,a.key=i,a.operation=r.toLowerCase(),a.updatedAt=s,a}return null}}]),e}(),$=function(){function e(){a(this,e)}return l(e,null,[{key:"serialize",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:null,r=JSON.parse(JSON.stringify(e));return n&&n(r),function e(t){return Object.keys(t).forEach((function(n){t[n]&&"object"===s(t[n])&&e(t[n])})),Object.freeze(t)}(r)}},{key:"deserialize",value:function(e,t){var n=1<arguments.length&&void 0!==t?t:null,r=JSON.parse(JSON.stringify(e));return n&&n(r),r}}]),e}();function Z(e,t,n){return void 0===n?new Promise((function(e,n){t((function(t,r){return t?n(t):e(r)}))})):t((function(t,r){n&&(k.get(e).container.isErrorFirstInCallback?n(t,r):n(r,t))}))}"undefined"==typeof Promise&&(Promise=function(){function e(t){var n=this;if(a(this,e),this.state=0,this._value=null,this._reason=null,"function"!=typeof t)throw"Promise resolver ".concat(t," is not a function");t((function(e){0===n.state&&(n.state=1,n._value=e)}),(function(e){0===n.state&&(n.state=2,n._reason=e)}))}return l(e,[{key:"then",value:function(t,n){var r=this,i=this;switch(this.state){case 0:setTimeout((function(){return r.then(t,n)}),100);break;case 1:t&&"function"==typeof t&&(i=t(this._value));break;case 2:n&&"function"==typeof n&&(i=n(this._reason))}return i instanceof e?i:this}},{key:"catch",value:function(t){var n=this,r=this;switch(this.state){case 0:setTimeout((function(){return n.catch(t)}),100);break;case 1:break;case 2:r=t(this._reason)}return r instanceof e?r:this}},{key:"finally",value:function(t){var n=this,r=this;switch(this.state){case 0:setTimeout((function(){return n.finally(t)}),100);break;case 1:case 2:r=t()}return r instanceof e?r:this}},{key:"length",get:function(){return 1}}],[{key:"all",value:function(t){return new e((function(n,r){if(Array.isArray(t)||"string"==typeof t)if(0<t.length){var i=[];for(var a in t)t[a]instanceof e?i.push(t[a]):i.push(e.resolve(t[a]));var o=new Array(i.length).fill(null),l=i.length,u=function(e,t,i){t?r(t):(l--,o[e]=i,l<=0&&n(o))};i.forEach((function(e,t){e.then((function(e){u(t,null,e)})).catch((function(e){u(t,e,null)}))}))}else n([]);else r(new Error("Uncaught (in promise) TypeError: ".concat(s(t)," ").concat(t," is not iterable")))}))}},{key:"resolve",value:function(t){return new e((function(e){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}}]),e}());var ee={TIMESTAMP:"timestamp",MESSAGE_ID:"messageId"},te=new WeakMap,ne=function(){function e(t){a(this,e),this.messageId=0,this.messageType=e.MESSAGE_TYPE_BASE,this.channelUrl="",this.data=null,this.customType=null,this.silent=!1,this.createdAt=0,this.updatedAt=0,this.channelType=null,this.metaArrays=[],this.reactions=[],this.mentionType=null,this.mentionedUsers=[],te.set(this,0),this.parentMessageId=0,this.parentMessageText=null,this.threadInfo=null,t&&this.__update(t)}return l(e,[{key:"serialize",value:function(){return $.serialize(this,(function(e){e.hasOwnProperty("_sender")&&(e.sender=e._sender,delete e._sender)}))}},{key:"isIdentical",value:function(e){return!("object"!==s(e)||!e.hasOwnProperty("messageId"))&&(0!==this.messageId&&0!==e.messageId?this.messageId===e.messageId:this.reqId===e.reqId)}},{key:"isEqual",value:function(e){return H.deepEqual(this,e)}},{key:"isOpenChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isUserMessage",value:function(){return this.messageType===e.MESSAGE_TYPE_USER}},{key:"isAdminMessage",value:function(){return this.messageType===e.MESSAGE_TYPE_ADMIN}},{key:"isFileMessage",value:function(){return this.messageType===e.MESSAGE_TYPE_FILE}},{key:"__update",value:function(e){var t=this,n=L.get(this._iid),r=n.User,i=n.BaseChannel,s=n.BaseMessageParams,a=n.Reaction,o=n.MessageMetaArray,l=n.ThreadInfo;e.hasOwnProperty("msg_id")&&(this.messageId=parseInt(e.msg_id)),e.hasOwnProperty("message_id")&&(this.messageId=parseInt(e.message_id)),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?String(e.custom_type):"",this.silent=!!e.hasOwnProperty("silent")&&e.silent,this.createdAt=e.hasOwnProperty("ts")?parseInt(e.ts):0,e.hasOwnProperty("created_at")&&(this.createdAt=parseInt(e.created_at)),this.updatedAt=e.hasOwnProperty("updated_at")?parseInt(e.updated_at):0,this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):i.CHANNEL_TYPE_GROUP;var u=e.hasOwnProperty("metaarray")?e.metaarray:{},c=e.hasOwnProperty("metaarray_key_order")?e.metaarray_key_order:Object.keys(u).sort((function(e,t){return e.localeCompare(t)}));this.metaArrays=[];for(var d=0;d<c.length;d++){var h=c[d];this.metaArrays.push(new o(h,u[h]||[]))}if(e.hasOwnProperty("sorted_metaarray")){var f=e.sorted_metaarray;Array.isArray(f)&&(this.metaArrays=f.map((function(e){return new o(e.key,e.value)})))}if(this.reactions=[],e.hasOwnProperty("reactions")&&Array.isArray(e.reactions))for(var p in e.reactions){var g=a.createFromJson(e.reactions[p]);g&&this.reactions.push(g)}this.mentionType=e.hasOwnProperty("mention_type")?e.mention_type:s.MentionType.USERS,this.mentionedUsers=[],e.hasOwnProperty("mentioned_users")&&e.mentioned_users.forEach((function(e){var n=new r(e);t.mentionedUsers.push(n)})),e.hasOwnProperty("root_message_id")&&te.set(this,parseInt(e.root_message_id)),e.hasOwnProperty("parent_message_id")&&(this.parentMessageId=parseInt(e.parent_message_id)),e.hasOwnProperty("parent_message_text")&&(this.parentMessageText=e.parent_message_text),this.threadInfo=new l(e.thread_info)}},{key:"getMetaArraysByKeys",value:function(e){return Array.isArray(e)?this.metaArrays.filter((function(t){return-1<e.indexOf(t.key)})):[]}},{key:"getMetaArrayByKeys",value:function(e){var t={};return this.getMetaArraysByKeys(e).forEach((function(e){t[e.key]=e.value})),t}},{key:"applyReactionEvent",value:function(e){var t,n=this,r=L.get(this._iid).Reaction,i=E(z.parse(arguments,[new z({type:X,constraint:function(e){return parseInt(e.messageId)===parseInt(n.messageId)}})]),2);if(t=i[0],e=i[1],!t){var s=!1;for(var a in this.reactions)if(this.reactions[a].key===e.key){this.reactions[a]._applyEvent(e),this.reactions[a].isEmpty&&this.reactions.splice(a,1),s=!0;break}s||"add"!==e.operation||this.reactions.push(new r(e.key,[e.userId],e.updatedAt))}}},{key:"_getThreadedMessageList",value:function(e,t,n,r){var i,s=this,a=L.get(this._iid).ThreadedMessageListParams,o=E(z.parse(arguments,[new z({type:"number"}),new z({type:"string",constraint:function(e){return Object.values(ee).includes(e)}}),new z({type:a,constraint:function(e){return e._validate()}}),new z({type:"callback"})]),5);return i=o[0],e=o[1],t=o[2],n=o[3],r=o[4],Z(this._iid,(function(r){if(i)r(i,null);else{var a=L.get(s._iid),o=a.GroupChannel,l=a.OpenChannel;s.isGroupChannel()?o.getChannel(s.channelUrl,A.INTERNAL_CALL,(function(i,a){if(SendBird.getInstance(s._iid).getErrorFirstCallback()){var o=[i,a];a=o[0],i=o[1]}a?r(a,null):k.get(s._iid).container.apiClient.getMessageList(c(c({channel:i,token:e,tokenType:t},n),{},{shouldReverse:n.reverse,rootMessageId:s.messageId,includeReplies:!0,includeThreadInfo:!0}),(function(e,t){if(e)r(e,null);else{var n=L.get(s._iid).BaseChannel,i=t.messages.map((function(e){return n.buildMessage(e,s)})).filter((function(e){return null!==e})),a=i.filter((function(e){return e.messageId===s.messageId}))[0],o=i.filter((function(e){return e.parentMessageId===s.messageId}));r(null,{parentMessage:a,threadedReplies:o})}}))})):s.isOpenChannel()&&l.getChannel(s.channelUrl,A.INTERNAL_CALL,(function(i,a){if(SendBird.getInstance(s._iid).getErrorFirstCallback()){var o=[i,a];a=o[0],i=o[1]}a?r(a,null):k.get(s._iid).container.apiClient.getMessageList(c(c({channel:i,token:e,tokenType:t},n),{},{shouldReverse:n.reverse,rootMessageId:s.messageId,includeReplies:!0,includeThreadInfo:!0}),(function(e,t){if(e)r(e,null);else{var n=L.get(s._iid).BaseChannel,i=t.messages.map((function(e){return n.buildMessage(e,s)})).filter((function(e){return null!==e})),a=i.filter((function(e){return e.messageId===s.messageId}))[0],o=i.filter((function(e){return e.parentMessageId===s.messageId}));r(null,{parentMessage:a,threadedReplies:o})}}))}))}}),r)}},{key:"getThreadedMessagesByTimestamp",value:function(e,t,n){return this._getThreadedMessageList(e,ee.TIMESTAMP,t,n)}},{key:"applyThreadInfoUpdateEvent",value:function(e){var t,n=L.get(this._iid),r=n.ThreadInfo,i=n.ThreadInfoUpdateEvent,s=te.get(this),a=E(z.parse(arguments,[new z({type:i,constraint:function(e){return parseInt(e.targetMessageId)===parseInt(s)}})]),2);if(t=a[0],e=a[1],t)return!1;var o=e.threadInfo;return this.threadInfo=new r(o),!0}},{key:"metaArray",get:function(){var e={};return this.metaArrays.forEach((function(t){e[t.key]=t.value})),e},set:function(e){if("object"===s(e)&&e){var t=L.get(this._iid).MessageMetaArray,n=[];for(var r in e)n.push(new t(r,e[r]));this.metaArrays=n}}}],[{key:"getMessage",value:function(e,t){var n,r=this,i=L.get(this._iid),s=i.BaseChannel,a=i.MessageRetrievalParams,o=E(z.parse(arguments,[new z({type:a,constraint:function(e){return e._validate()}}),new z({type:"callback"})]),3);return n=o[0],e=o[1],t=o[2],Z(this._iid,(function(t){if(n)t(n,null);else{var i=L.get(r._iid),a=i.GroupChannel,o=i.OpenChannel;switch(e.channelType){case s.CHANNEL_TYPE_GROUP:a.getChannel(e.channelUrl,A.INTERNAL_CALL,(function(n,i){if(SendBird.getInstance(r._iid).getErrorFirstCallback()){var a=[n,i];i=a[0],n=a[1]}i?t(i,null):k.get(r._iid).container.apiClient.getMessage(c({channel:n},e),(function(e,r){if(e)t(e,null);else{var i=s.buildMessage(r,n);t(null,i)}}))}));break;case s.CHANNEL_TYPE_OPEN:o.getChannel(e.channelUrl,A.INTERNAL_CALL,(function(n,i){if(SendBird.getInstance(r._iid).getErrorFirstCallback()){var a=[n,i];i=a[0],n=a[1]}i?t(i,null):k.get(r._iid).container.apiClient.getMessage(c({channel:n},e),(function(e,r){if(e)t(e,null);else{var i=s.buildMessage(r,n);t(null,i)}}))}))}}}),t)}},{key:"MESSAGE_TYPE_BASE",get:function(){return"base"}},{key:"MESSAGE_TYPE_ADMIN",get:function(){return"admin"}},{key:"MESSAGE_TYPE_USER",get:function(){return"user"}},{key:"MESSAGE_TYPE_FILE",get:function(){return"file"}},{key:"SendingStatus",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",CANCELED:"canceled",SUCCEEDED:"succeeded"}}}]),e}(),re=function(){function e(t){a(this,e),this.nickname="",this.profileUrl="",this.userId="",this.connectionStatus="",this.lastSeenAt=null,this.metaData={},this.isActive=!0,this.friendDiscoveryKey=null,this.friendName=null,this._preferredLanguages=null,t&&this.__update(t)}return l(e,[{key:"__update",value:function(t){t.hasOwnProperty("guest_id")&&(this.userId=String(t.guest_id)),t.hasOwnProperty("user_id")&&(this.userId=String(t.user_id)),t.hasOwnProperty("name")&&(this.nickname=String(t.name)),t.hasOwnProperty("nickname")&&(this.nickname=String(t.nickname)),t.hasOwnProperty("image")&&(this.profileUrl=String(t.image)),t.hasOwnProperty("profile_url")&&(this.profileUrl=String(t.profile_url)),t.hasOwnProperty("is_online")?t.is_online===e.NON_AVAILABLE?this.connectionStatus=e.NON_AVAILABLE:this.connectionStatus=t.is_online?e.ONLINE:e.OFFLINE:this.connectionStatus=e.NON_AVAILABLE,t.hasOwnProperty("last_seen_at")?this.lastSeenAt=parseInt(t.last_seen_at):this.lastSeenAt=0,t.hasOwnProperty("metadata")?this.metaData=t.metadata:this.metaData={},t.hasOwnProperty("is_active")?this.isActive=void 0===t.is_active||t.is_active:this.isActive=!0,t.hasOwnProperty("friend_discovery_key")?this.friendDiscoveryKey=t.friend_discovery_key:this.friendDiscoveryKey=null,t.hasOwnProperty("friend_name")?this.friendName=t.friend_name:this.friendName=null,t.hasOwnProperty("preferred_languages")?this._preferredLanguages=t.preferred_languages||null:this._preferredLanguages=null}},{key:"_updateMetaData",value:function(e,t){var n=1<arguments.length&&void 0!==t&&t,r=L.get(this._iid).GroupChannel;for(var i in e)n?delete this.metaData[i]:this.metaData[i]=e[i];for(var s in r.cachedChannels)if(r.cachedChannels.hasOwnProperty(s)){var a=r.cachedChannels[s];a.memberMap.hasOwnProperty(this.userId)&&(a.memberMap[this.userId].metaData=this.metaData)}}},{key:"serialize",value:function(){return $.serialize(this,(function(e){e.hasOwnProperty("_preferredLanguages")&&(e.preferredLanguages=e._preferredLanguages,delete e._preferredLanguages)}))}},{key:"getOriginalProfileUrl",value:function(){var e="";if((-1<(e=(e=-1<this.profileUrl.indexOf("://")?this.profileUrl.split("/")[2]:this.profileUrl.split("/")[0]).split("?")[0]).indexOf("sendbird.com")||-1<e.indexOf("intoz.com")||-1<e.indexOf("file-local"))&&-1<this.profileUrl.indexOf(e+"/profile_images/")){var t=this.profileUrl.replace("profile_images/","");return t===this.profileUrl?"":t}return""}},{key:"createMetaData",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return 0<Object.keys(e).length&&!Array.isArray(e)}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.createUserMetaData({metaData:e},(function(e,n){e||r._updateMetaData(n),t(e,n)}))}),t)}},{key:"updateMetaData",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return!Array.isArray(e)&&0<Object.keys(e).length&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return"string"==typeof e}))}}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.updateUserMetaData({metaData:e,upsert:t},(function(e,t){e||i._updateMetaData(t),n(e,t)}))}),n)}},{key:"deleteMetaData",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){if(n)t(n,null);else{var i={};i[e]="",k.get(r._iid).container.apiClient.deleteUserMetaData({metaDataKey:e},(function(e,n){e||r._updateMetaData(i,!0),t(e,n)}))}}),t)}},{key:"deleteAllMetaData",value:function(e){var t=this;return Z(this._iid,(function(e){var n=t.metaData;k.get(t._iid).container.apiClient.deleteAllUserMetaData({},(function(r,i){r||t._updateMetaData(n,!0),e(r,i)}))}),e)}},{key:"preferredLanguages",get:function(){return this._preferredLanguages}}],[{key:"objectify",value:function(e){var t=e.userId,n=void 0===t?null:t,r=e.nickname,i=void 0===r?"":r,s=e.profileUrl,a=void 0===s?"":s,o=e.connectionStatus,l=void 0===o?"":o,u=e.lastSeenAt,c=void 0===u?0:u,d=e.metaData,h=void 0===d?{}:d,f=e.isActive,p=void 0===f||f,g=e.friendDiscoveryKey,y=void 0===g?null:g,m=e.friendName,_=void 0===m?null:m,v=e.preferredLanguages;return{user_id:n,nickname:i,profile_url:a,is_online:l,last_seen_at:c,metadata:h,is_active:p,friend_discovery_key:y,friend_name:_,preferred_languages:void 0===v?null:v}}},{key:"build",value:function(e,t,n,r,i,s,a,o,l,u){return this.objectify({userId:e,nickname:t,profileUrl:n,connectionStatus:r,lastSeenAt:i,metaData:s,isActive:a,friendDiscoveryKey:o,friendName:l,preferredLanguages:u})}},{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid).User,n=$.deserialize(e);return new t(t.objectify(n))}},{key:"NON_AVAILABLE",get:function(){return"nonavailable"}},{key:"ONLINE",get:function(){return"online"}},{key:"OFFLINE",get:function(){return"offline"}}]),e}(),ie={TIMESTAMP:"timestamp",MESSAGE_ID:"messageId"},se=function(){function e(t){a(this,e),this.url="",this.channelType=e.CHANNEL_TYPE_BASE,this.name="",this.coverUrl="",this.createdAt=0,this.data=null,this.customType=null,this.isFrozen=!1,this.isEphemeral=!1,t&&(this.__update(t),t.__wk&&(this.__wk=t.__wk))}return l(e,[{key:"__update",value:function(e){this.url=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.name=e.hasOwnProperty("name")?String(e.name):"",this.coverUrl=e.hasOwnProperty("cover_url")?String(e.cover_url):"",this.createdAt=e.hasOwnProperty("created_at")?1e3*e.created_at:0,this.data=e.hasOwnProperty("data")?String(e.data):"",this.customType=e.hasOwnProperty("custom_type")?e.custom_type:"",this.isFrozen=!!e.hasOwnProperty("freeze")&&e.freeze,this.isEphemeral=!!e.hasOwnProperty("is_ephemeral")&&e.is_ephemeral}},{key:"isGroupChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this.channelType===e.CHANNEL_TYPE_OPEN}},{key:"createOperatorListQuery",value:function(){return new(L.get(this._iid).OperatorListQuery)(this)}},{key:"createMessageListQuery",value:function(){return new(L.get(this._iid).MessageListQuery)(this)}},{key:"createPreviousMessageListQuery",value:function(){return new(L.get(this._iid).PreviousMessageListQuery)(this)}},{key:"serialize",value:function(){return $.serialize(this,(function(e){if(null!==e.lastMessage&&"object"===s(e.lastMessage)){var t=e.lastMessage;t.hasOwnProperty("_sender")&&(t.sender=t._sender,delete t._sender,e.lastMessage=t)}e.hasOwnProperty("_messageOffsetTimestamp")&&(e.messageOffsetTimestamp=e._messageOffsetTimestamp,delete e._messageOffsetTimestamp)}))}},{key:"getMessageChangeLogsByTimestamp",value:function(e,t,n,r){var i,s=this,a=E(z.parse(arguments,[new z({type:"number",constraint:function(e){return 0<=e}}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),5);return i=a[0],e=a[1],t=a[2],n=a[3],r=a[4],Z(this._iid,(function(r){i?r(i,null):k.get(s._iid).container.apiClient.getMessageChangeLogs({channelUrl:s.url,ts:e,token:null,isOpenChannel:s.isOpenChannel(),includeMetaArray:t,includeReaction:n},(function(e,t){var n=null;if(!e){var i=L.get(s._iid).BaseChannel;n={updatedMessages:t.updated.map((function(e){return i.buildMessage(e,s)})),deletedMessageIds:t.deleted.map((function(e){return e.message_id})),hasMore:t.has_more,token:t.next}}r(e,n)}))}),r)}},{key:"getMessageChangeLogsByToken",value:function(e,t,n,r){var i,s=this,a=E(z.parse(arguments,[new z({type:"string",nullable:!0}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),5);return i=a[0],e=a[1],t=a[2],n=a[3],r=a[4],Z(this._iid,(function(r){i?r(i,null):k.get(s._iid).container.apiClient.getMessageChangeLogs({channelUrl:s.url,ts:null,token:e,isOpenChannel:s.isOpenChannel(),includeMetaArray:t,includeReaction:n},(function(e,t){var n=null;if(!e){var i=L.get(s._iid).BaseChannel;n={updatedMessages:t.updated.map((function(e){return i.buildMessage(e,s)})),deletedMessageIds:t.deleted.map((function(e){return e.message_id})),hasMore:t.has_more,token:t.next}}r(e,n)}))}),r)}},{key:"getMessageChangeLogsSinceToken",value:function(e,t,n){var r,i=this,s=L.get(this._iid),a=s.BaseChannel,o=s.MessageChangeLogsParams,l=E(z.parse(arguments,[new z({type:"string",nullable:!0}),new z({type:o}),new z({type:"callback"})]),4);return r=l[0],e=l[1],t=l[2],n=l[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.getMessageChangeLogs(c({channelUrl:i.url,ts:null,token:e,isOpenChannel:i.isOpenChannel()},t),(function(e,t){var r=null;e||(r={updatedMessages:t.updated.map((function(e){return a.buildMessage(e,i)})),deletedMessageIds:t.deleted.map((function(e){return e.message_id})),hasMore:t.has_more,token:t.next}),n(e,r)}))}),n)}},{key:"getMessageChangeLogsSinceTimestamp",value:function(e,t,n){var r,i=this,s=L.get(this._iid),a=s.BaseChannel,o=s.MessageChangeLogsParams,l=E(z.parse(arguments,[new z({type:"number",constraint:function(e){return 0<=e}}),new z({type:o}),new z({type:"callback"})]),4);return r=l[0],e=l[1],t=l[2],n=l[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.getMessageChangeLogs(c({channelUrl:i.url,timestamp:e,token:null,isOpenChannel:i.isOpenChannel()},t),(function(e,t){var r=null;e||(r={updatedMessages:t.updated.map((function(e){return a.buildMessage(e,i)})),deletedMessageIds:t.deleted.map((function(e){return e.message_id})),hasMore:t.has_more,token:t.next}),n(e,r)}))}),n)}},{key:"getMyMutedInfo",value:function(e){var t=this;return Z(this._iid,(function(e){var n=bt.getInstance(t._iid);k.get(t._iid).container.apiClient.getMyMutedInfo({channelUrl:t.url,userId:n.currentUser?n.currentUser.userId:null,isGroupChannel:t.isGroupChannel()},(function(t,n){var r=null;t||(r={isMuted:n.is_muted,startAt:n.start_at,endAt:n.end_at,remainingDuration:n.remaining_duration,description:n.description}),e(t,r)}))}),e)}},{key:"_parseMessageListParams",value:function(e){for(var t=new(L.get(this._iid).MessageListParams),n=null,r=!1,i=0,s=0,a=!1,o="",l="",u=null,c=!1,d=!1,h=null,f=arguments.length,p=new Array(1<f?f-1:0),g=1;g<f;g++)p[g-1]=arguments[g];switch(e){case"prev":var y=E(z.parse(p,[new z({type:"number"}),new z({type:"boolean"}),new z({type:"number"}),new z({type:"boolean"}),new z({type:"string"}),new z({type:"string"}),new z({type:"array",optional:!0}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),11);n=y[0],y[1],r=y[2],i=y[3],a=y[4],o=y[5],l=y[6],u=y[7],c=y[8],d=y[9],h=y[10];break;case"next":var m=E(z.parse(p,[new z({type:"number"}),new z({type:"boolean"}),new z({type:"number"}),new z({type:"boolean"}),new z({type:"string"}),new z({type:"string"}),new z({type:"array",optional:!0}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),11);n=m[0],m[1],r=m[2],s=m[3],a=m[4],o=m[5],l=m[6],u=m[7],c=m[8],d=m[9],h=m[10];break;case"prevnext":var _=E(z.parse(p,[new z({type:"number"}),new z({type:"number"}),new z({type:"number"}),new z({type:"boolean"}),new z({type:"string"}),new z({type:"string"}),new z({type:"array",optional:!0}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),11);n=_[0],_[1],i=_[2],s=_[3],a=_[4],o=_[5],l=_[6],u=_[7],c=_[8],d=_[9],h=_[10],r=!0}return n?[null,h]:(t.isInclusive=r,t.prevResultSize=i,t.nextResultSize=s,t.reverse=a,t.messageType=o,t.customType=l,t.senderUserIds=u,t.includeMetaArray=c,t.includeReaction=d,[t,h])}},{key:"_getMessageList",value:function(e,t,n,r){var i,s=this,a=L.get(this._iid).MessageListParams,o=E(z.parse(arguments,[new z({type:"number"}),new z({type:"string",constraint:function(e){return Object.values(ie).includes(e)}}),new z({type:a,constraint:function(e){return e._validate()}}),new z({type:"callback"})]),5);return i=o[0],e=o[1],t=o[2],n=o[3],r=o[4],Z(this._iid,(function(r){i?r(i,null):k.get(s._iid).container.apiClient.getMessageList(c(c({channel:s,token:e,tokenType:t},n),{},{shouldReverse:n.reverse}),(function(e,t){if(e)r(e,null);else{var n=L.get(s._iid).BaseChannel,i=t.messages.map((function(e){return n.buildMessage(e,s)})).filter((function(e){return null!==e}));r(null,i)}}))}),r)}},{key:"getPreviousMessagesByTimestamp",value:function(e){var t=E(this._parseMessageListParams.apply(this,["prev"].concat(C(z.toArray(arguments)))),2),n=t[0],r=t[1];return this._getMessageList(e,ie.TIMESTAMP,n,r)}},{key:"getNextMessagesByTimestamp",value:function(e){var t=E(this._parseMessageListParams.apply(this,["next"].concat(C(z.toArray(arguments)))),2),n=t[0],r=t[1];return this._getMessageList(e,ie.TIMESTAMP,n,r)}},{key:"getPreviousAndNextMessagesByTimestamp",value:function(e){var t=E(this._parseMessageListParams.apply(this,["prevnext"].concat(C(z.toArray(arguments)))),2),n=t[0],r=t[1];return this._getMessageList(e,ie.TIMESTAMP,n,r)}},{key:"getPreviousMessagesByID",value:function(e){var t=E(this._parseMessageListParams.apply(this,["prev"].concat(C(z.toArray(arguments)))),2),n=t[0],r=t[1];return this._getMessageList(e,ie.MESSAGE_ID,n,r)}},{key:"getNextMessagesByID",value:function(e){var t=E(this._parseMessageListParams.apply(this,["next"].concat(C(z.toArray(arguments)))),2),n=t[0],r=t[1];return this._getMessageList(e,ie.MESSAGE_ID,n,r)}},{key:"getPreviousAndNextMessagesByID",value:function(e){var t=E(this._parseMessageListParams.apply(this,["prevnext"].concat(C(z.toArray(arguments)))),2),n=t[0],r=t[1];return this._getMessageList(e,ie.MESSAGE_ID,n,r)}},{key:"getMessagesByTimestamp",value:function(e,t,n){return this._getMessageList(e,ie.TIMESTAMP,t,n)}},{key:"getMessagesByMessageId",value:function(e,t,n){return this._getMessageList(e,ie.MESSAGE_ID,t,n)}},{key:"_sendUserMessage",value:function(e){var t=this,n=e.message,r=e.data,i=e.customType,s=e.metaArrays,a=e.mentionType,o=e.mentionedUserIds,l=e.translationTargetLanguages,u=e.pushNotificationDeliveryOption,c=e.reqId,d=e.rootMessageId,h=e.parentMessageId,f=e.silent,p=void 0!==f&&f,g=e.callback,y=L.get(this._iid),m=y.Command,_=y.UserMessage;c=c||m.generateRequestId();var v=bt.getInstance(this._iid),E=_.objectify({messageId:0,reqId:c,user:v.currentUser||{},channel:this,message:n,data:r,customType:i,metaArrays:s,mentionType:a,rootMessageId:d,parentMessageId:h,mentionedUserIds:o,translations:l,silent:p,createdAt:(new Date).getTime()}),C=new _(E);if(C.requestState=v.MessageRequestState.PENDING,C.sendingStatus=v.MessageSendingStatus.PENDING,C.requestedMentionUserIds=o,!v.currentUser){var b=new N("Connection should be made first.",N.CONNECTION_REQUIRED),S=new _(E);return S.requestState=v.MessageRequestState.FAILED,S.sendingStatus=v.MessageSendingStatus.FAILED,S.requestedMentionUserIds=o,S.errorCode=b.code,g(b,S),C}var A=m.bMessage({channelUrl:this.url,message:n,data:r,customType:i,metaArrays:s,mentionType:a,mentionedUserIds:o,requestId:c,rootMessageId:d,parentMessageId:h,silent:p,translationTargetLanguages:l,pushNotificationDeliveryOption:u});return C.reqId=A.requestId,this.isGroupChannel()&&v.getConnectionState()!==v.ConnectionState.OPEN&&v.currentUser&&!v.connecting&&!v.reconnecting&&"string"==typeof i&&0===i.indexOf("SB_VIDEOCHAT")?k.get(v._iid).container.apiClient.sendUserMessage({channelUrl:this.url,isOpenChannel:this.isOpenChannel(),message:n,data:r,customType:i,translationTargetLanguages:l,metaArrays:s,mentionType:a,mentionedUserIds:o,pushNotificationDeliveryOption:u,rootMessageId:d,parentMessageId:h},(function(e,t){var n=null;e?((n=new _(E)).requestState=v.MessageRequestState.FAILED,n.sendingStatus=v.MessageSendingStatus.FAILED,e.code===N.REQUEST_CANCELED&&(n.sendingStatus=v.MessageSendingStatus.CANCELED),n.requestedMentionUserIds=o,n.errorCode=e.code):((n=new _(t)).requestState=v.MessageRequestState.SUCCEEDED,n.sendingStatus=v.MessageSendingStatus.SUCCEEDED),g(e,n)})):v.sendCommand(A,(function(e,n){if(v.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n){var i=new _(E);i.reqId=A.requestId,i.requestState=v.MessageRequestState.FAILED,i.sendingStatus=v.MessageSendingStatus.FAILED,n.code===N.REQUEST_CANCELED&&(i.sendingStatus=v.MessageSendingStatus.CANCELED),i.requestedMentionUserIds=o,i.errorCode=n.code,g(new N(n.message,n.code),i)}else{var s=new _(e.getJsonElement()),a=v.currentUser;if(a&&s._sender&&a.userId===s._sender.userId&&(a.nickname!==s._sender.nickname&&(a.nickname=s._sender.nickname),a.profileUrl!==s._sender.profileUrl&&(a.profileUrl=s._sender.profileUrl),H.deepEqual(a.metaData,s._sender.metaData)||(a.metaData=s._sender.metaData)),t.isGroupChannel()){for(var l in t.lastMessage=s,v.channelHandlers)v.channelHandlers[l].onChannelChanged(t);s.requestState=v.MessageRequestState.SUCCEEDED,s.sendingStatus=v.MessageSendingStatus.SUCCEEDED,g(null,s)}else s.requestState=v.MessageRequestState.SUCCEEDED,s.sendingStatus=v.MessageSendingStatus.SUCCEEDED,g(null,s)}})),C}},{key:"sendUserMessage",value:function(){var e=z.toArray(arguments),t=e.pop(),n=null,r=null,i=L.get(this._iid).UserMessageParams;if("function"==typeof t)if(e[0]instanceof i)null===(r=e[0]).data&&(r.data=""),null===r.customType&&(r.customType="");else if("string"==typeof e[0])switch((r=new i).message=e[0],e.length){case 1:break;case 2:r.data=e[1]||"";break;case 3:r.data=e[1]||"",r.customType=e[2]||"";break;case 4:r.data=e[1]||"",r.customType=e[2]||"",r.translationTargetLanguages=Array.isArray(e[3])?e[3]:[e[3]];break;default:n=z.error}else n=z.error;else n=z.error;var s=k.get(this._iid).container.isErrorFirstInCallback;return!n&&r._validate()&&r.message?this._sendUserMessage(c(c({},r),{},{metaArrays:r.metaArrays,mentionType:r.mentionType,mentionedUserIds:r._mentionedUserIds,rootMessageId:r.rootMessageId,parentMessageId:r.parentMessageId,translationTargetLanguages:r._translationTargetLanguages,callback:function(e,n){s?t(e,n):t(n,e)}})):(s?t(z.error,null):t(null,z.error),null)}},{key:"resendUserMessage",value:function(e,t){var n=this,r=L.get(this._iid),i=r.UserMessage,s=r.UserMessageParams,a=null,o=E(z.parse(arguments,[new z({type:i,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===n.url&&"string"==typeof e.message&&"string"==typeof e.data&&"string"==typeof e.customType&&Array.isArray(e.translations)}}),new z({type:"callback"})]),3);return a=o[0],e=o[1],t=o[2],Z(this._iid,(function(t){if(a)a.message+=" Please check if the failed message is resend-able with `message.isResendable().`",t(a,null);else{var r=s.PushNotificationDeliveryOption.DEFAULT;n._sendUserMessage(c(c({},e),{},{mentionedUserIds:e.requestedMentionUserIds,translationTargetLanguages:e.translations,pushNotificationDeliveryOption:r,reqId:e.reqId,callback:t}))}}),t)}},{key:"updateUserMessage",value:function(e,t,n,r,i){var s=this,a=L.get(this._iid),o=a.Command,l=a.UserMessage,u=a.UserMessageParams,d=arguments,h=null,f=null;if("number"==typeof e)switch(d.length){case 3:var p=E(z.parse(d,[new z({type:"number"}),new z({type:u}),new z({type:"callback"})]),4);h=p[0],e=p[1],f=p[2],i=p[3];break;case 5:f=new u;var g=E(z.parse(d,[new z({type:"number"}),new z({type:"string",nullable:!0}),new z({type:"string",nullable:!0}),new z({type:"string",nullable:!0}),new z({type:"callback"})]),6);h=g[0],e=g[1],t=g[2],n=g[3],r=g[4],i=g[5],f.message=t,f.data=n,f.customType=r}return Z(this._iid,(function(t){if(!h&&f&&f._validate()){var n=o.bUpdateUserMessage(c(c({channelUrl:s.url,messageId:e},f),{},{mentionType:f._mentionType,mentionedUserIds:f._mentionedUserIds})),r=bt.getInstance(s._iid);r.sendCommand(n,(function(e,n){if(r.getErrorFirstCallback()){var i=[e,n];n=i[0],e=i[1]}var s=null;n||(s=new l(e.getJsonElement())),t(n,s)}))}else t(z.error,null)}),i)}},{key:"translateUserMessage",value:function(e,t,n){var r,i=this,s=bt.getInstance(this._iid),a=L.get(this._iid).UserMessage,o=E(z.parse(arguments,[new z({type:a,constraint:function(e){return e.channelUrl===i.url&&e.sendingStatus===s.MessageSendingStatus.SUCCEEDED}}),new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),4);return r=o[0],e=o[1],t=o[2],n=o[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.translateUserMessage({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),messageId:e.messageId,translationTargetLanguages:t},(function(e,t){var r=null;e||(r=new a(t)),n(e,r)}))}),n)}},{key:"_parseFileMessageArguments",value:function(e){var t=L.get(this._iid),n=t.BaseMessageParams,r=t.FileMessageParams,i={error:null,file:null,name:null,type:null,size:null,data:"",customType:"",thumbnailSizes:[],metaArrays:[],mentionType:n.MentionType.USERS,mentionedUserIds:[],pushNotificationDeliveryOption:r.PushNotificationDeliveryOption.DEFAULT,rootMessageId:null,parentMessageId:null,progressHandler:null,silent:!1,callback:null};if("function"==typeof e[e.length-1]&&(i.callback=e.pop()),"function"==typeof e[e.length-1]&&(i.progressHandler=e.pop()),e[0]instanceof r)i.file=e[0].file||e[0].fileUrl,i.name=e[0].fileName,i.type=e[0].mimeType,i.size=e[0].fileSize,i.data=e[0].data,i.customType=e[0].customType,i.thumbnailSizes=e[0].thumbnailSizes,i.metaArrays=e[0].metaArrays,i.mentionType=e[0]._mentionType,i.mentionedUserIds=e[0]._mentionedUserIds,i.pushNotificationDeliveryOption=e[0].pushNotificationDeliveryOption?e[0].pushNotificationDeliveryOption:r.PushNotificationDeliveryOption.DEFAULT,i.rootMessageId=e[0].rootMessageId,i.parentMessageId=e[0].parentMessageId,i.silent=e[0].silent,e[0]._validate()||(i.error=z.error);else if(H.isFile(e[0])||"string"==typeof e[0]){switch(i.file=e[0],e.length){case 1:break;case 2:i.data=e[1];break;case 3:i.data=e[1],i.customType=e[2];break;case 4:i.data=e[1],i.customType=e[2],i.thumbnailSizes=e[3];break;case 5:i.name=e[1],i.type=e[2],i.size=e[3],i.data=e[4];break;case 6:i.name=e[1],i.type=e[2],i.size=e[3],i.data=e[4],i.customType=e[5];break;case 7:i.name=e[1],i.type=e[2],i.size=e[3],i.data=e[4],i.customType=e[5],i.thumbnailSizes=e[6]}var s=E(z.parse([i.file,i.name,i.type,i.size,i.data,i.customType,i.thumbnailSizes],[new z({type:["file","string"]}),new z({type:"string",nullable:!0}),new z({type:"string",nullable:!0}),new z({type:"number",nullable:!0,constraint:function(e){return 0<=e}}),new z({type:"string",nullable:!0}),new z({type:"string",nullable:!0}),new z({type:"array"})]),8);i.error=s[0],i.file=s[1],i.name=s[2],i.type=s[3],i.size=s[4],i.data=s[5],i.customType=s[6],i.thumbnailSizes=s[7]}else i.error=z.error;return H.isFile(i.file)&&(i.name=i.name||i.file.name,i.type=i.type||i.file.type,i.size=i.size||i.file.size),i}},{key:"_createTempFileMessage",value:function(e){try{var t=bt.getInstance(this._iid),n=L.get(this._iid),r=n.Command,i=n.FileMessage;return new i(i.objectify(c(c({},e),{},{messageId:0,reqId:r.generateRequestId(),user:t.currentUser||{},channel:this,url:"string"==typeof e.file?e.file:"",thumbnails:e.thumbnailSizes.map((function(e){return{url:"",width:e.maxWidth,height:e.maxHeight,real_width:0,real_height:0}})),sendingStatus:t.MessageSendingStatus.PENDING,createdAt:(new Date).getTime()})))}catch(e){return null}}},{key:"sendFileMessage",value:function(){var e=this._parseFileMessageArguments(z.toArray(arguments)),t=null,n=L.get(this._iid).Command.generateRequestId();e.error||((t=this._createTempFileMessage(e)).requestedMentionUserIds=e.mentionedUserIds,n=t.reqId);var r=bt.getInstance(this._iid);r&&r.currentUser||(e.error=new N("Connection should be made first.",N.CONNECTION_REQUIRED));var i=L.get(this._iid).FileMessageQueue;return i.create(this).addJob(new i.Job({fileInfo:e,pendingMessage:t,requestId:n,error:e.error,response:null})),t}},{key:"sendFileMessages",value:function(e,t){var n=this,r=1<arguments.length&&void 0!==t?t:{},i=r.progress?r.progress:function(){},s=r.sent?r.sent:function(){},a=r.complete?r.complete:function(){};if(Array.isArray(e)&&0<e.length&&e.length<=20){var o=[];return e.forEach((function(t,r){o.push(n.sendFileMessage(t,i,(function(t,n){s(t,n),r===e.length-1&&a(null)})))})),o}return a(z.error),null}},{key:"resendFileMessage",value:function(e,t,n){var r=this,i=L.get(this._iid),s=i.FileMessage,a=i.FileMessageParams,o=null,l=E(z.parse(arguments,[new z({type:s,constraint:function(e){return 0===e.messageId&&e.isResendable()&&e.reqId&&e.channelUrl===r.url&&"string"==typeof e.data&&"string"==typeof e.customType&&Array.isArray(e.thumbnails)}}),new z({type:"file",optionalIf:function(e){return!!e[0].url},defaultValue:null}),new z({type:"callback"})]),4);return o=l[0],e=l[1],t=l[2],n=l[3],Z(this._iid,(function(n){if(o)o.message+=" Please check if the failed message is resend-able with `message.isResendable().`",n(o,null);else{var i=new a;e.url?i.fileUrl=e.url:i.file=t,i.fileName=e.name,i.fileSize=e.size,i.mimeType=e.type,i.data=e.data,i.customType=e.customType,i.mentionType=e.mentionType,i.mentionedUserIds=e.requestedMentionUserIds,i.metaArrays=e.metaArrays,i.thumbnailSizes=e.thumbnails.map((function(e){return{maxWidth:e.width,maxHeight:e.height}})),r.sendFileMessage(i,n)}}),n)}},{key:"updateFileMessage",value:function(e,t,n,r){var i=this,s=L.get(this._iid),a=s.Command,o=s.FileMessage,l=s.FileMessageParams,u=arguments,d=null,h=null;if("number"==typeof e)switch(u.length){case 3:var f=E(z.parse(u,[new z({type:"number"}),new z({type:l}),new z({type:"callback"})]),4);d=f[0],e=f[1],h=f[2],r=f[3],h&&(h._isUpdate=!0);break;case 4:h=new l;var p=E(z.parse(u,[new z({type:"number"}),new z({type:"string",nullable:!0}),new z({type:"string",nullable:!0}),new z({type:"callback"})]),5);d=p[0],e=p[1],t=p[2],n=p[3],r=p[4],h.data=t,h.customType=n,h._isUpdate=!0}return Z(this._iid,(function(t){if(!d&&h&&h._validate()){var n=a.bUpdateFileMessage(c(c({channelUrl:i.url,messageId:e},h),{},{mentionType:h._mentionType,mentionedUserIds:h._mentionedUserIds})),r=bt.getInstance(i._iid);r.sendCommand(n,(function(e,n){if(r.getErrorFirstCallback()){var i=[e,n];n=i[0],e=i[1]}var s=null;n||(s=new o(e.getJsonElement())),t(n,s)}))}else t(z.error,null)}),r)}},{key:"cancelUploadingFileMessage",value:function(e,t){var n,r=E(z.parse(arguments,[new z({type:["number","string"]}),new z({type:"callback"})]),3);n=r[0],e=r[1],t=r[2];var i=k.get(this._iid).container.isErrorFirstInCallback;return n?(i?t(n,null):t(null,n),!1):L.get(this._iid).FileMessageQueue.create(this).cancelUploadItemByRequestId(e,(function(e,n){return i?t(e,n):t(n,e)}))}},{key:"addReaction",value:function(e,t,n){var r,i=this,s=bt.getInstance(this._iid),a=L.get(this._iid).ReactionEvent,o=E(z.parse(arguments,[new z({type:ne}),new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"callback"})]),4);return r=o[0],e=o[1],t=o[2],n=o[3],Z(this._iid,(function(n){r?n(r,null):e.sendingStatus===s.MessageSendingStatus.SUCCEEDED?k.get(i._iid).container.apiClient.addReaction({isGroupChannel:e.isGroupChannel(),channelUrl:e.channelUrl,messageId:e.messageId,key:t},(function(t,r){var i=null;t||(i=a.createFromJson(c(c({},r),{},{msg_id:e.messageId}))),n(t,i)})):n(new N("Cannot add reaction to a non-succeeded message.",N.REQUEST_FAILED),null)}),n)}},{key:"deleteReaction",value:function(e,t,n){var r,i=this,s=bt.getInstance(this._iid),a=L.get(this._iid).ReactionEvent,o=E(z.parse(arguments,[new z({type:ne}),new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"callback"})]),4);return r=o[0],e=o[1],t=o[2],n=o[3],Z(this._iid,(function(n){r?n(r,null):e.sendingStatus===s.MessageSendingStatus.SUCCEEDED?k.get(i._iid).container.apiClient.deleteReaction({isGroupChannel:e.isGroupChannel(),channelUrl:e.channelUrl,messageId:e.messageId,key:t},(function(t,r){var i=null;t||(i=a.createFromJson(c(c({},r),{},{msg_id:e.messageId}))),n(t,i)})):n(new N("Cannot remove reaction to a non-succeeded message.",N.REQUEST_FAILED),null)}),n)}},{key:"deleteMessage",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return!Array.isArray(e)&&null!==e&&e.hasOwnProperty("messageId")}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.deleteMessage({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),messageId:e.messageId},(function(e,n){return t(e,null)}))}),t)}},{key:"getMetaCounters",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return Object.keys(e).map((function(t){return e[t]})).every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.getMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),keys:e},(function(e,n){return t(e,n)}))}),t)}},{key:"getAllMetaCounters",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getMetaCounters({channelUrl:t.url,isOpenChannel:t.isOpenChannel(),keys:[]},(function(t,n){return e(t,n)}))}),e)}},{key:"createMetaCounters",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return"number"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.createMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e},(function(e,n){return t(e,n)}))}),t)}},{key:"updateMetaCounters",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return"number"==typeof e}))}}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.updateMetaCounters({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaCounter:e,upsert:t,mode:"set"},(function(e,t){return n(e,t)}))}),n)}},{key:"increaseMetaCounters",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return"number"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.updateMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e,upsert:!1,mode:"increase"},(function(e,n){return t(e,n)}))}),t)}},{key:"decreaseMetaCounters",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return"number"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.updateMetaCounters({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaCounter:e,upsert:!1,mode:"decrease"},(function(e,n){var r=null;if(!e)for(var i in r={},n)r[i]=n[i];t(e,r)}))}),t)}},{key:"deleteMetaCounter",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.deleteMetaCounter({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),key:e},(function(e,n){return t(e,n)}))}),t)}},{key:"deleteAllMetaCounters",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.deleteAllMetaCounters({channelUrl:t.url,isOpenChannel:t.isOpenChannel()},(function(t,n){return e(t,n)}))}),e)}},{key:"getMetaData",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return Object.keys(e).map((function(t){return e[t]})).every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.getMetaData({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),keys:e},(function(e,n){return t(e,n)}))}),t)}},{key:"getAllMetaData",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getMetaData({channelUrl:t.url,isOpenChannel:t.isOpenChannel(),keys:[]},(function(t,n){return e(t,n)}))}),e)}},{key:"createMetaData",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.createMetaData({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),metaData:e},(function(e,n){return t(e,n)}))}),t)}},{key:"updateMetaData",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&!Array.isArray(e)&&0<Object.keys(e).length&&Object.keys(e).map((function(t){return e[t]})).every((function(e){return"string"==typeof e}))}}),new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.updateMetaData({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),metaData:e,upsert:t},(function(e,t){return n(e,t)}))}),n)}},{key:"deleteMetaData",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.deleteMetaData({channelUrl:r.url,isOpenChannel:r.isOpenChannel(),key:e},(function(e,n){return t(e,n)}))}),t)}},{key:"deleteAllMetaData",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.deleteAllMetaData({channelUrl:t.url,isOpenChannel:t.isOpenChannel()},(function(t,n){return e(t,n)}))}),e)}},{key:"_updateMessageMetaArray",value:function(e,t,n,r){var i=this;return Z(this._iid,(function(r){var s=L.get(i._iid),a=s.Command,o=s.UserMessage,l=s.FileMessage,u=s.AdminMessage,c=null;if(t.isUserMessage()?c=a.bUpdateUserMessage({channelUrl:e,messageId:t.messageId,metaArrayParams:n}):t.isFileMessage()&&(c=a.bUpdateFileMessage({channelUrl:e,messageId:t.messageId,metaArrayParams:n})),c){var d=bt.getInstance(i._iid);d.sendCommand(c,(function(e,n){if(d.getErrorFirstCallback()){var i=[e,n];n=i[0],e=i[1]}var s=null;n||(t.isUserMessage()?s=new o(e.getJsonElement()):t.isFileMessage()?s=new l(e.getJsonElement()):t.isAdminMessage()&&(s=new u(e.getJsonElement()))),r(n,s)}))}else r(z.error,null)}),r)}},{key:"createMessageMetaArrayKeys",value:function(e,t,n){var r,i=L.get(this._iid).MessageMetaArray,s=E(z.parse(arguments,[new z({type:ne}),new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e&&""!==e}))}}),new z({type:"callback"})]),4);if(r=s[0],e=s[1],t=s[2],n=s[3],r)return Z(this._iid,(function(e){e(r,null)}),n);var a=[];if(Array.isArray(t))for(var o=0;o<t.length;o++){var l=t[o];a.push(new i(l,[]))}return this._updateMessageMetaArray(this.url,e,{array:a.map((function(e){return e.encode()})),mode:"add",upsert:!0},n)}},{key:"deleteMessageMetaArrayKeys",value:function(e,t,n){var r,i=L.get(this._iid).MessageMetaArray,s=E(z.parse(arguments,[new z({type:ne}),new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e&&""!==e}))}}),new z({type:"callback"})]),4);if(r=s[0],e=s[1],t=s[2],n=s[3],r)return Z(this._iid,(function(e){e(r,null)}),n);var a=[];if(Array.isArray(t))for(var o=0;o<t.length;o++){var l=t[o];a.push(new i(l,[]))}return this._updateMessageMetaArray(this.url,e,{array:a.map((function(e){return e.encode()})),mode:"remove",upsert:!0},n)}},{key:"addMessageMetaArrayValues",value:function(e,t,n){var r,i=L.get(this._iid).MessageMetaArray,s=E(z.parse(arguments,[new z({type:ne}),new z({type:"object",constraint:function(e){return e&&(Array.isArray(e)&&0<e.length&&e.every((function(e){return e instanceof i}))||0<Object.keys(e).length&&Object.keys(e).every((function(t){return Array.isArray(e[t])&&0<e[t].length&&e[t].every((function(e){return"string"==typeof e&&0<e.length}))})))}}),new z({type:"callback"})]),4);if(r=s[0],e=s[1],t=s[2],n=s[3],r)return Z(this._iid,(function(e){e(r,null)}),n);var a=Array.isArray(t)?t.map((function(e){return e.encode()})):Object.keys(t).map((function(e){return{key:e,value:t[e]}}));return this._updateMessageMetaArray(this.url,e,{array:a,mode:"add",upsert:!0},n)}},{key:"removeMessageMetaArrayValues",value:function(e,t,n){var r,i=L.get(this._iid).MessageMetaArray,s=E(z.parse(arguments,[new z({type:ne}),new z({type:"object",constraint:function(e){return e&&(Array.isArray(e)&&0<e.length&&e.every((function(e){return e instanceof i}))||0<Object.keys(e).length&&Object.keys(e).every((function(t){return Array.isArray(e[t])&&0<e[t].length&&e[t].every((function(e){return"string"==typeof e&&0<e.length}))})))}}),new z({type:"callback"})]),4);if(r=s[0],e=s[1],t=s[2],n=s[3],r)return Z(this._iid,(function(e){e(r,null)}),n);var a=Array.isArray(t)?t.map((function(e){return e.encode()})):Object.keys(t).map((function(e){return{key:e,value:t[e]}}));return this._updateMessageMetaArray(this.url,e,{array:a,mode:"remove",upsert:!0},n)}},{key:"report",value:function(e,t,n){var r,i=this,s=L.get(this._iid).BaseChannel,a=E(z.parse(arguments,[new z({type:s.ReportCategory}),new z({type:"string"}),new z({type:"callback"})]),4);return r=a[0],e=a[1],t=a[2],n=a[3],Z(this._iid,(function(n){if(r)n(r,null);else{var s=bt.getInstance(i._iid);k.get(i._iid).container.apiClient.report({channelUrl:i.url,isOpenChannel:i.isOpenChannel(),reportCategory:e,reportingUserId:s.currentUser?s.currentUser.userId:null,reportDescription:t},(function(e,t){n(e,null)}))}}),n)}},{key:"reportUser",value:function(e,t,n,r){var i,s=this,a=L.get(this._iid).BaseChannel,o=E(z.parse(arguments,[new z({type:re}),new z({type:a.ReportCategory}),new z({type:"string"}),new z({type:"callback"})]),5);return i=o[0],e=o[1],t=o[2],n=o[3],r=o[4],Z(this._iid,(function(r){if(i)r(i,null);else{var a=bt.getInstance(s._iid);k.get(s._iid).container.apiClient.reportUser({channelUrl:s.url,isOpenChannel:s.isOpenChannel(),reportCategory:t,offendingUserId:e.userId,reportingUserId:a.currentUser?a.currentUser.userId:null,reportDescription:n},(function(e,t){r(e,null)}))}}),r)}},{key:"reportMessage",value:function(e,t,n,r){var i,s=this,a=L.get(this._iid).BaseChannel,o=E(z.parse(arguments,[new z({type:ne}),new z({type:a.ReportCategory}),new z({type:"string"}),new z({type:"callback"})]),5);return i=o[0],e=o[1],t=o[2],n=o[3],r=o[4],Z(this._iid,(function(r){if(i)r(i,null);else{var a=bt.getInstance(s._iid);k.get(s._iid).container.apiClient.reportMessage({messageId:e.messageId,channelUrl:s.url,isOpenChannel:s.isOpenChannel(),reportCategory:t,offendingUserId:e.sender.userId,reportingUserId:a.currentUser?a.currentUser.userId:null,reportDescription:n},(function(e,t){r(e,null)}))}}),r)}}],[{key:"buildMessage",value:function(e){var t=L.get(this._iid),n=t.UserMessage,r=t.FileMessage,i=t.AdminMessage;if(e)switch(e.type){case"MESG":return new n(e);case"FILE":var s=e.file;return new r(c(c({},e),{},{url:String(s.url),name:String(s.name),type:String(s.type),size:parseInt(s.size)}));case"BRDM":case"ADMM":return new i(e)}return null}},{key:"CHANNEL_TYPE_OPEN",get:function(){return"open"}},{key:"CHANNEL_TYPE_GROUP",get:function(){return"group"}},{key:"CHANNEL_TYPE_BASE",get:function(){return"base"}},{key:"MessageTypeFilter",get:function(){return{ALL:"",USER:"MESG",FILE:"FILE",ADMIN:"ADMM"}}},{key:"ReportCategory",get:function(){return{SPAM:"spam",HARASSING:"harassing",SUSPICIOUS:"suspicious",INAPPROPRIATE:"inappropriate"}}}]),e}(),ae=function(){function e(t){a(this,e),t&&(this.category=t.hasOwnProperty("cat")?parseInt(t.cat):0,this.data=t.hasOwnProperty("data")?t.data:null,this.channelUrl=t.hasOwnProperty("channel_url")?String(t.channel_url):"",this.channelType=t.hasOwnProperty("channel_type")?String(t.channel_type):se.CHANNEL_TYPE_GROUP)}return l(e,[{key:"isGroupChannel",value:function(){return this.channelType===se.CHANNEL_TYPE_GROUP}},{key:"isOpenChannel",value:function(){return this.channelType===se.CHANNEL_TYPE_OPEN}}]),e}();function oe(e){a(this,oe),e&&(this.category=e.hasOwnProperty("cat")?parseInt(e.cat):0)}ae.CATEGORY_NONE=0,ae.CATEGORY_CHANNEL_ENTER=10102,ae.CATEGORY_CHANNEL_EXIT=10103,ae.CATEGORY_USER_CHANNEL_MUTE=10201,ae.CATEGORY_USER_CHANNEL_UNMUTE=10200,ae.CATEGORY_USER_CHANNEL_BAN=10601,ae.CATEGORY_USER_CHANNEL_UNBAN=10600,ae.CATEGORY_CHANNEL_FREEZE=10701,ae.CATEGORY_CHANNEL_UNFREEZE=10700,ae.CATEGORY_TYPING_START=10900,ae.CATEGORY_TYPING_END=10901,ae.CATEGORY_CHANNEL_JOIN=1e4,ae.CATEGORY_CHANNEL_LEAVE=10001,ae.CATEGORY_CHANNEL_OPERATOR_UPDATE=10002,ae.CATEGORY_CHANNEL_INVITE=10020,ae.CATEGORY_CHANNEL_DECLINE_INVITE=10022,ae.CATEGORY_CHANNEL_PROP_CHANGED=11e3,ae.CATEGORY_CHANNEL_DELETED=12e3,ae.CATEGORY_CHANNEL_META_DATA_CHANGED=11100,ae.CATEGORY_CHANNEL_META_COUNTERS_CHANGED=11200,ae.CATEGORY_CHANNEL_HIDE=13e3,ae.CATEGORY_CHANNEL_UNHIDE=13001,oe.CATEGORY_USER_BLOCK=20001,oe.CATEGORY_USER_UNBLOCK=2e4,oe.CATEGORY_FRIEND_DISCOVERED=20900;var le=function(){function e(t){a(this,e),this.sb=t,this.cls=L.get(this.sb._iid)}return l(e,[{key:"onRawCommandReceived",value:function(e){var t=this,n=this.cls,r=n.Command,i=n.User,a=n.Member,o=n.BaseChannel,l=n.GroupChannel,u=n.OpenChannel,c=n.UserMessage,d=n.FileMessage,h=n.AdminMessage,f=n.BaseMessageParams,p=n.ReactionEvent,g=n.ReadStatus,y=n.ThreadInfoUpdateEvent,m=k.get(this.sb._iid),_=m.container,v=_.pinger,E=_.auth,C=_.subscribedUnreadMessageCount,b=_.ackStateMap,S=new r(e),I=S.getJsonElement();if(I.hasOwnProperty("unread_cnt")&&"object"===s(I.unread_cnt)){var U=!1,R=I.unread_cnt.ts;if("number"==typeof R&&R>C.ts){if(C.all!==I.unread_cnt.all&&(U=!0),C.all=0<=I.unread_cnt.all?I.unread_cnt.all:0,I.unread_cnt.custom_types)for(var T in I.unread_cnt.custom_types)C.custom_types[T]!==I.unread_cnt.custom_types[T]&&(U=!0),C.custom_types[T]=I.unread_cnt.custom_types[T];U=U&&0<C.ts,C.ts=R}if(U)for(var O in this.sb.userEventHandlers)this.sb.userEventHandlers[O].onTotalUnreadMessageCountUpdated(C.all,C.custom_types)}var M=S.requestId;if(M){var L=b[M];if(L){clearTimeout(L.timer);var P=L.handler;P&&("EROR"===S.command?P(new N(I.message,I.code),null):P(null,S)),b.hasOwnProperty(M)&&delete b[M]}}else switch(v&&"LOGI"!==S.command&&v.start(),S.command){case"LOGI":this.sb.loginTimer&&(clearTimeout(this.sb.loginTimer),this.sb.loginTimer=null,this.sb.onLoginTimerCancel=null,I.hasOwnProperty("error")?(this.sb.isSessionOpened=!1,this.sb.loginHandler(new N(I.message,I.code),null)):(this.sb.isSessionOpened=!0,I.hasOwnProperty("key")&&(E.sessionKey=I.key),I.hasOwnProperty("ekey")&&(E.eKey=I.ekey),I.hasOwnProperty("user_id")&&(this.sb.currentUser=new i(I)),"number"==typeof I.ping_interval&&0<I.ping_interval&&m.set("pingInterval",1e3*I.ping_interval),"number"==typeof I.pong_timeout&&0<I.pong_timeout&&m.set("pongTimeout",1e3*I.pong_timeout),"number"==typeof I.login_ts&&m.set("connectedAt",1e3*I.login_ts),"number"==typeof I.max_unread_cnt_on_super_group?m.set("maxUnreadCountOfSuperGroupChannel",I.max_unread_cnt_on_super_group):m.set("maxUnreadCountOfSuperGroupChannel",A.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL),v&&v.start(),I.hasOwnProperty("file_upload_size_limit")&&I.hasOwnProperty("premium_feature_list")&&I.hasOwnProperty("emoji_hash")&&m.set("appInfo",new J(I)),this.sb.loginHandler(null,this.sb.currentUser)),this.sb.connecting=!1,this.sb.reconnecting=!1);break;case"MESG":case"FILE":case"BRDM":case"ADMM":var D=null;if("MESG"===S.command?D=new c(I):"FILE"===S.command?D=new d(I):"BRDM"!==S.command&&"ADMM"!==S.command||(D=new h(I)),D){var F=this.sb.currentUser?this.sb.currentUser.userId:null,G=D.silent,x=!!I.force_update_last_message,B=D._sender&&D._sender.userId===F;if(D.isGroupChannel()){var j=r.bMessageAck({channelUrl:D.channelUrl,messageId:D.messageId});this.sb.sendCommand(j);var q=l.cachedChannels.hasOwnProperty(D.channelUrl);l.getChannel(D.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n){if(e.isHidden=!1,e.hiddenState=l.HiddenState.UNHIDDEN,l.cachedChannels[e.url]=e,D._sender&&e.memberMap.hasOwnProperty(D._sender.userId)){var i=e.memberMap[D._sender.userId];i.nickname!==D._sender.nickname&&(i.nickname=D._sender.nickname),i.profileUrl!==D._sender.profileUrl&&(i.profileUrl=D._sender.profileUrl),H.deepEqual(i.metaData,D._sender.metaData)||(i.metaData=D._sender.metaData),i.isBlockedByMe!==D._sender.isBlockedByMe&&(i.isBlockedByMe=D._sender.isBlockedByMe)}var s=t.sb.currentUser;s&&B&&(s.nickname!==D._sender.nickname&&(s.nickname=D._sender.nickname),s.profileUrl!==D._sender.profileUrl&&(s.profileUrl=D._sender.profileUrl),H.deepEqual(s.metaData,D._sender.metaData)||(s.metaData=D._sender.metaData));var a=!1;if(D.mentionType===f.MentionType.CHANNEL)B||(a=!0);else if(D.mentionType===f.MentionType.USERS)for(var o=0;o<D.mentionedUsers.length;o++)if(!B&&D.mentionedUsers[o].userId===F){a=!0;break}if(G&&!B||(e.isEphemeral||q)&&((!e.lastMessage||e.lastMessage.createdAt<D.createdAt)&&(e.lastMessage=D),B||e._setGroupChannelUnreadCount(e.unreadMessageCount+1,e.unreadMentionCount+(a?1:0))),x&&(!e.lastMessage||e.lastMessage.createdAt<D.createdAt)&&(e.lastMessage=D),!G||B)for(var u in t.sb.channelHandlers)t.sb.channelHandlers[u].onChannelChanged(e);for(var c in t.sb.channelHandlers){var d=t.sb.channelHandlers[c];d.onMessageReceived(e,D),a&&d.onMentionReceived(e,D)}}}))}else D.isOpenChannel()&&u.getChannel(D.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n){var i=!1;if(D.mentionType===f.MentionType.CHANNEL)i=!0;else if(D.mentionType===f.MentionType.USERS)for(var s=0;s<D.mentionedUsers.length;s++)if(D.mentionedUsers[s].userId===F){i=!0;break}for(var a in t.sb.channelHandlers){var o=t.sb.channelHandlers[a];u.enteredChannels[e.url]&&o.onMessageReceived(e,D),i&&o.onMentionReceived(e,D)}}}))}break;case"MEDI":case"FEDI":case"AEDI":var z=null;if("MEDI"===S.command?z=new c(I):"FEDI"===S.command?z=new d(I):"AEDI"===S.command&&(z=new h(I)),z){var Y=this.sb.currentUser?this.sb.currentUser.userId:null,Q=z.silent,K=z.sender&&z.sender.userId===Y;if(z.isGroupChannel()){var V=l.cachedChannels.hasOwnProperty(z.channelUrl);l.getChannel(z.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n){var i=e.cachedReadReceiptStatus[Y],s=i&&i>=z.createAt,a=t.sb.currentUser;a&&K&&(a.nickname!==z._sender.nickname&&(a.nickname=z._sender.nickname),a.profileUrl!==z._sender.profileUrl&&(a.profileUrl=z._sender.profileUrl),H.deepEqual(a.metaData,z._sender.metaData)||(a.metaData=z._sender.metaData));var o=!1,l=!1;if(!K&&!s&&I&&I.hasOwnProperty("old_values")){var u=I.old_values.mention_type||z.mentionType,c=I.old_values.mentioned_user_ids||z.mentionedUsers.map((function(e){return e.userId}));if(u===f.MentionType.USERS&&z.mentionType===f.MentionType.USERS){for(var d=!1,h=!1,p=0;p<c.length;p++)if(c[p]===Y){d=!0;break}for(var g=0;g<z.mentionedUsers.length;g++)if(z.mentionedUsers[g].userId===Y){h=!0;break}!d&&h&&(l=!0,!Q&&V&&(e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1),o=!0))}else if(u===f.MentionType.USERS&&z.mentionType===f.MentionType.CHANNEL){for(var y=!1,m=0;m<c.length;m++)if(c[m]===Y){y=!0;break}y||(l=!0,!Q&&V&&(e._setGroupChannelUnreadCount(e.unreadMessageCount,e.unreadMentionCount+1),o=!0))}}if(e.lastMessage?e.lastMessage.createdAt<z.createdAt?(e.lastMessage=z,o=!0):e.lastMessage.createdAt===z.createdAt&&e.lastMessage.messageId===z.messageId&&(V?e.lastMessage.updatedAt<z.updatedAt&&(e.lastMessage=z,o=!0):o=!0):(e.lastMessage=z,o=!0),(!Q||K)&&o)for(var _ in t.sb.channelHandlers)t.sb.channelHandlers[_].onChannelChanged(e);for(var v in t.sb.channelHandlers){var E=t.sb.channelHandlers[v];E.onMessageUpdated(e,z),l&&E.onMentionReceived(e,z)}}}))}else z.isOpenChannel()&&u.getChannel(z.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n)for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onMessageUpdated(e,z)}))}break;case"DELM":var W=String(I.channel_type),X=String(I.channel_url),$=String(I.msg_id);switch(W){case o.CHANNEL_TYPE_GROUP:l.getChannel(X,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command);else for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onMessageDeleted(e,$)}));break;case o.CHANNEL_TYPE_OPEN:u.getChannel(X,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command);else for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onMessageDeleted(e,$)}))}break;case"READ":var Z=new g(I),ee=l.cachedChannels.hasOwnProperty(Z.channelUrl);l.getChannel(Z.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n&&(ee&&e.updateReadReceipt(Z.reader.userId,Z.timestamp),t.sb.currentUser))if(Z.reader.userId===t.sb.currentUser.userId){if(ee){if(0<e.unreadMessageCount||0<e.unreadMentionCount)for(var i in e._setGroupChannelUnreadCount(0,0),t.sb.channelHandlers)t.sb.channelHandlers[i].onChannelChanged(e)}else if(0===e.unreadMessageCount||0===e.unreadMentionCount)for(var s in t.sb.channelHandlers)t.sb.channelHandlers[s].onChannelChanged(e)}else for(var a in t.sb.channelHandlers)t.sb.channelHandlers[a].onReadReceiptUpdated(e)}));break;case"MRCT":var te=String(I.channel_type),ne=String(I.channel_url),re=p.createFromJson(I);switch(te){case o.CHANNEL_TYPE_GROUP:l.getChannel(ne,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command);else for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onReactionUpdated(e,re)}));break;case o.CHANNEL_TYPE_OPEN:u.getChannel(ne,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command);else for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onReactionUpdated(e,re)}))}break;case"DLVR":var ie=String(I.channel_url),se=I.hasOwnProperty("updated")?I.updated:null,le=l.cachedChannels.hasOwnProperty(ie);l.getChannel(ie,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n){var i=!1;for(var s in se)t.sb.currentUser&&s===t.sb.currentUser.userId&&(i=!0),le&&e.updateDeliveryReceipt(s,parseInt(se[s]));if(l.cachedChannels[e.url]=e,!i||1!==Object.keys(se).length)for(var a in t.sb.channelHandlers)t.sb.channelHandlers[a].onDeliveryReceiptUpdated(e)}}));break;case"MTHD":var ue=String(I.channel_url),ce=String(I.channel_type),de=y.createFromJson(I);switch(ce){case o.CHANNEL_TYPE_GROUP:l.getChannel(ue,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n)for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onThreadInfoUpdated(e,de)}));break;case o.CHANNEL_TYPE_OPEN:u.getChannel(ue,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(!n)for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onThreadInfoUpdated(e,de)}))}break;case"SYEV":var he=new ae(I);switch(he.category){case ae.CATEGORY_CHANNEL_JOIN:case ae.CATEGORY_CHANNEL_LEAVE:l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=he.data.hasOwnProperty("member_count")?he.data.member_count:null,o=he.data.hasOwnProperty("joined_member_count")?he.data.joined_member_count:null;if(he.category===ae.CATEGORY_CHANNEL_JOIN)(he.data.hasOwnProperty("users")?he.data.users:[he.data]).forEach((function(n){e.isSuper||e.isBroadcast?e.setLatestMemberCount(s,o,I.ts):(n.state=a.JOINED,e.addMember(new a(n)),e.updateJoinedMemberCount());var r=new i(n);for(var u in t.sb.currentUser&&r.userId===t.sb.currentUser.userId&&(e.myMemberState="joined",l.cachedChannels[e.url]=e),t.sb.channelHandlers)t.sb.channelHandlers[u].onUserJoined(e,r)}));else{var u=new i(he.data);for(var c in t.sb.currentUser&&u.userId===t.sb.currentUser.userId?(e.isPublic||l.removeCachedChannel(he.channelUrl),e.myMemberState="none",e.invitedAt=0,e._setGroupChannelUnreadCount(0,0)):l.cachedChannels[e.url]=e,e.isSuper||e.isBroadcast?e.setLatestMemberCount(s,o,I.ts):(e.removeMember(u),e.updateJoinedMemberCount()),t.sb.channelHandlers)t.sb.channelHandlers[c].onUserLeft(e,u)}}}));break;case ae.CATEGORY_CHANNEL_OPERATOR_UPDATE:he.isGroupChannel()?l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=he.data.operators.map((function(e){return new i(e)})),a=s.map((function(e){return e.userId}));for(var o in e.members)e.members[o].role=0<=a.indexOf(e.members[o].userId)?l.Role.OPERATOR:l.Role.NONE;for(var u in e.myRole=t.sb.currentUser&&0<=a.indexOf(t.sb.currentUser.userId)?l.Role.OPERATOR:l.Role.NONE,t.sb.channelHandlers)t.sb.channelHandlers[u].onOperatorUpdated(e,s)}})):he.isOpenChannel()&&u.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else for(var s in e.operators=he.data.operators.map((function(e){return new i(e)})),t.sb.channelHandlers)t.sb.channelHandlers[s].onOperatorUpdated(e,e.operators)}));break;case ae.CATEGORY_CHANNEL_INVITE:l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=null;he.data&&he.data.inviter&&0<Object.keys(he.data.inviter).length&&(s=new i(he.data.inviter));for(var o=[],u=0;u<he.data.invitees.length;u++){var c=new i(he.data.invitees[u]);o.push(c),he.data.invitees[u].state=a.INVITED;var d=new a(he.data.invitees[u]);if(e.isSuper||e.isBroadcast){var h=he.data.hasOwnProperty("member_count")?he.data.member_count:null,f=he.data.hasOwnProperty("joined_member_count")?he.data.joined_member_count:null;e.setLatestMemberCount(h,f,I.ts)}else e.addMember(d);t.sb.currentUser&&d.userId===t.sb.currentUser.userId&&(e.isHidden=!1,"joined"!==e.myMemberState&&(e.myMemberState="invited"),e.invitedAt=I.ts,l.cachedChannels[e.url]=e)}for(var p in t.sb.channelHandlers)t.sb.channelHandlers[p].onUserReceivedInvitation(e,s,o)}}));break;case ae.CATEGORY_CHANNEL_DECLINE_INVITE:l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=null;he.data&&he.data.inviter&&0<Object.keys(he.data.inviter).length&&(s=new i(he.data.inviter));var a=new i(he.data.invitee);if(t.sb.currentUser&&a.userId===t.sb.currentUser.userId&&(e.invitedAt=0,e.myMemberState="none",e.isPublic||l.removeCachedChannel(he.channelUrl)),e.isSuper||e.isBroadcast){var o=he.data.hasOwnProperty("member_count")?he.data.member_count:null,u=he.data.hasOwnProperty("joined_member_count")?he.data.joined_member_count:null;e.setLatestMemberCount(o,u,I.ts)}else e.removeMember(a);for(var c in t.sb.currentUser&&a.userId!==t.sb.currentUser.userId&&(l.cachedChannels[e.url]=e),t.sb.channelHandlers)t.sb.channelHandlers[c].onUserDeclinedInvitation(e,s,a)}}));break;case ae.CATEGORY_TYPING_START:case ae.CATEGORY_TYPING_END:l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=new i(he.data);for(var a in he.category===ae.CATEGORY_TYPING_START?e.updateTypingStatus(s,!0):e.updateTypingStatus(s,!1),t.sb.channelHandlers)t.sb.channelHandlers[a].onTypingStatusUpdated(e)}}));break;case ae.CATEGORY_CHANNEL_ENTER:case ae.CATEGORY_CHANNEL_EXIT:u.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{he.data.hasOwnProperty("participant_count")&&(e.participantCount=he.data.participant_count);var s=new i(he.data);if(he.category===ae.CATEGORY_CHANNEL_ENTER)for(var a in t.sb.channelHandlers)t.sb.channelHandlers[a].onUserEntered(e,s);else for(var o in t.sb.channelHandlers)t.sb.channelHandlers[o].onUserExited(e,s)}}));break;case ae.CATEGORY_USER_CHANNEL_MUTE:case ae.CATEGORY_USER_CHANNEL_UNMUTE:he.isOpenChannel()?u.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=new i(he.data);if(he.category===ae.CATEGORY_USER_CHANNEL_MUTE)for(var a in t.sb.channelHandlers)t.sb.channelHandlers[a].onUserMuted(e,s);else for(var o in t.sb.channelHandlers)t.sb.channelHandlers[o].onUserUnmuted(e,s)}})):l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=new i(he.data);if(t.sb.currentUser&&s.userId===t.sb.currentUser.userId&&(e.myMutedState=he.category===ae.CATEGORY_USER_CHANNEL_MUTE?"muted":"unmuted"),he.category===ae.CATEGORY_USER_CHANNEL_MUTE)for(var a in t.sb.channelHandlers)t.sb.channelHandlers[a].onUserMuted(e,s);else for(var o in t.sb.channelHandlers)t.sb.channelHandlers[o].onUserUnmuted(e,s)}}));break;case ae.CATEGORY_USER_CHANNEL_BAN:case ae.CATEGORY_USER_CHANNEL_UNBAN:he.isOpenChannel()?u.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=new i(he.data);if(he.category===ae.CATEGORY_USER_CHANNEL_BAN)for(var a in t.sb.currentUser&&s.userId===t.sb.currentUser.userId&&(delete u.enteredChannels[he.channelUrl],t.cls.FileMessageQueue.delete(he.channelUrl)),t.sb.channelHandlers)t.sb.channelHandlers[a].onUserBanned(e,s);else for(var o in t.sb.channelHandlers)t.sb.channelHandlers[o].onUserUnbanned(e,s)}})):l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var s=new i(he.data);if(he.category===ae.CATEGORY_USER_CHANNEL_BAN){if(t.sb.currentUser&&s.userId===t.sb.currentUser.userId&&(e.isPublic||l.removeCachedChannel(he.channelUrl),e.myMemberState="none",e.invitedAt=0,e._setGroupChannelUnreadCount(0,0)),e.isSuper||e.isBroadcast){var a=he.data.hasOwnProperty("member_count")?he.data.member_count:null,o=he.data.hasOwnProperty("joined_member_count")?he.data.joined_member_count:null;e.setLatestMemberCount(a,o,I.ts)}else e.removeMember(s),e.updateJoinedMemberCount();for(var u in t.sb.channelHandlers)t.sb.channelHandlers[u].onUserBanned(e,s)}else for(var c in t.sb.channelHandlers)t.sb.channelHandlers[c].onUserUnbanned(e,s)}}));break;case ae.CATEGORY_CHANNEL_FREEZE:case ae.CATEGORY_CHANNEL_UNFREEZE:he.isOpenChannel()?u.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else if(e.isFrozen=he.data.freeze,u.cachedChannels[e.url]=e,he.category===ae.CATEGORY_CHANNEL_FREEZE)for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onChannelFrozen(e);else for(var s in t.sb.channelHandlers)t.sb.channelHandlers[s].onChannelUnfrozen(e)})):l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else if(e.isFrozen=he.data.freeze,l.cachedChannels[e.url]=e,he.category===ae.CATEGORY_CHANNEL_FREEZE)for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onChannelFrozen(e);else for(var s in t.sb.channelHandlers)t.sb.channelHandlers[s].onChannelUnfrozen(e)}));break;case ae.CATEGORY_CHANNEL_DELETED:for(var fe in he.isGroupChannel()?l.removeCachedChannel(he.channelUrl):u.removeCachedChannel(he.channelUrl),this.sb.channelHandlers)this.sb.channelHandlers[fe].onChannelDeleted(he.channelUrl,he.isGroupChannel()?"group":"open");break;case ae.CATEGORY_CHANNEL_PROP_CHANGED:he.isOpenChannel()?u.getChannelWithoutCache(he.channelUrl,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else for(var i in t.sb.channelHandlers)t.sb.channelHandlers[i].onChannelChanged(e)})):l.getChannelWithoutCache(he.channelUrl,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else{var i=e.unreadMessageCount,s=e.unreadMentionCount;for(var a in e.myCountPreference!==l.CountPreference.ALL&&(e.myCountPreference===l.CountPreference.UNREAD_MESSAGE_COUNT_ONLY?s=0:e.myCountPreference===l.CountPreference.UNREAD_MENTION_COUNT_ONLY?i=0:s=i=0),e._setGroupChannelUnreadCount(i,s),t.sb.channelHandlers)t.sb.channelHandlers[a].onChannelChanged(e)}}));break;case ae.CATEGORY_CHANNEL_META_DATA_CHANGED:case ae.CATEGORY_CHANNEL_META_COUNTERS_CHANGED:var pe=he.data.hasOwnProperty("created"),ge=he.data.hasOwnProperty("updated"),ye=he.data.hasOwnProperty("deleted");he.isOpenChannel()?u.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else for(var i in t.sb.channelHandlers){var s=t.sb.channelHandlers[i];he.category===ae.CATEGORY_CHANNEL_META_DATA_CHANGED?(pe&&s.onMetaDataCreated(e,he.data.created),ge&&s.onMetaDataUpdated(e,he.data.updated),ye&&s.onMetaDataDeleted(e,he.data.deleted)):(pe&&s.onMetaCountersCreated(e,he.data.created),ge&&s.onMetaCountersUpdated(e,he.data.updated),ye&&s.onMetaCountersDeleted(e,he.data.deleted))}})):l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else for(var i in t.sb.channelHandlers){var s=t.sb.channelHandlers[i];he.category===ae.CATEGORY_CHANNEL_META_DATA_CHANGED?(pe&&s.onMetaDataCreated(e,he.data.created),ge&&s.onMetaDataUpdated(e,he.data.updated),ye&&s.onMetaDataDeleted(e,he.data.deleted)):(pe&&s.onMetaCountersCreated(e,he.data.created),ge&&s.onMetaCountersUpdated(e,he.data.updated),ye&&s.onMetaCountersDeleted(e,he.data.deleted))}}));break;case ae.CATEGORY_CHANNEL_HIDE:case ae.CATEGORY_CHANNEL_UNHIDE:l.getChannel(he.channelUrl,A.INTERNAL_CALL,(function(e,n){if(t.sb.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n)w.debug("Discard command",S.command,he.category);else if(he.category===ae.CATEGORY_CHANNEL_HIDE)for(var i in e.isHidden=!0,he.data&&(he.data.hasOwnProperty("allow_auto_unhide")&&(e.hiddenState=he.data.allow_auto_unhide?l.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:l.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE),he.data.hasOwnProperty("hide_previous_messages")&&he.data.hide_previous_messages&&e._setGroupChannelUnreadCount(0,0)),I.hasOwnProperty("ts_message_offset")&&(e._messageOffsetTimestamp=I.ts_message_offset),l.cachedChannels[e.url]=e,t.sb.channelHandlers)t.sb.channelHandlers[i].onChannelHidden(e);else for(var s in e.isHidden=!1,e.hiddenState=l.HiddenState.UNHIDDEN,l.cachedChannels[e.url]=e,t.sb.channelHandlers)t.sb.channelHandlers[s].onChannelChanged(e)}))}break;case"USEV":var me=new ae(I);switch(me.category){case oe.CATEGORY_USER_BLOCK:case oe.CATEGORY_USER_UNBLOCK:var _e=me.data.blocker.user_id,ve=me.data.blockee.user_id;Object.keys(l.cachedChannels).forEach((function(e){var n=l.cachedChannels[e];try{t.sb.currentUser&&(t.sb.currentUser.userId===_e?n.memberMap[ve].isBlockedByMe=me.category===oe.CATEGORY_USER_BLOCK:t.sb.currentUser.userId===ve&&(n.memberMap[_e].isBlockingMe=me.category===oe.CATEGORY_USER_BLOCK))}catch(e){}}));break;case oe.CATEGORY_FRIEND_DISCOVERED:var Ee=me.data.friend_discoveries.map((function(e){return new i(e)}));for(var Ce in this.sb.userEventHandlers)this.sb.userEventHandlers[Ce].onFriendsDiscovered(Ee)}break;case"LEAV":case"JOIN":case"PONG":case"MTIO":case"TPST":case"TPEN":break;default:w.debug("Discard command",S.command)}}}]),e}(),ue={},ce={},de=function(){function e(t){a(this,e),this.channel=t,this.uploadQueue=[],this.messageQueue=[],this.latestTimestampToSendMessage=0,L.get(this._iid).FileMessageQueue.queueMap[t.url]=this}return l(e,[{key:"_handleMessageQueueUpdated",value:function(e){var t=this;switch(w.debug("fileMessageQueue message queue updated: ",this.messageQueue),e){case"add":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue();break;case"update":case"remove":if(0<this.messageQueue.length){var n=L.get(this._iid).FileMessageQueue,r=this.messageQueue[0];if(r)if(r.state===n.State.UPLOADED){if(r&&r.state===n.State.UPLOADED){for(r.state=n.State.SENDING,0===this.latestTimestampToSendMessage&&(this.latestTimestampToSendMessage=(new Date).getTime()-200);(new Date).getTime()-this.latestTimestampToSendMessage<200;);this.latestTimestampToSendMessage=(new Date).getTime(),this._sendUploadedMessage(r,(function(e,i){r.state=n.State.SENT,r.error=e||null,r.response=i||null,t._handleMessageQueueUpdated("update")}))}}else r.state===n.State.SENT&&this._finalizeMessage()}}}},{key:"_handleUploadQueueUpdated",value:function(e,t){var n=this;switch(w.debug("fileMessageQueue upload queue updated: ",this.uploadQueue),e){case"add":var r=L.get(this._iid).FileMessageQueue;t.state=r.State.UPLOADING,t.error?(-1<this.messageQueue.map((function(e){return e.requestId})).indexOf(t.requestId)&&(t.state=r.State.SENT,this._handleMessageQueueUpdated("update")),this._finalizeUpload(t.requestId)):this._uploadFile(t,(function(e){t.error&&t.state===r.State.SENT||(t.state=r.State.UPLOADED),t.fileInfo=e,n._handleMessageQueueUpdated("update"),n._finalizeUpload(t.requestId)}));break;case"update":break;case"remove":this.uploadQueue.length<6&&this._moveFirstPendingMessageToUploadQueue()}}},{key:"_moveFirstPendingMessageToUploadQueue",value:function(){var e=L.get(this._iid).FileMessageQueue,t=this.messageQueue.filter((function(t){return t.state===e.State.PENDING}));if(0<t.length){var n=t[0];this.uploadQueue.push(n),this._handleUploadQueueUpdated("add",n)}}},{key:"_sendUploadedMessage",value:function(e,t){var n=L.get(this._iid),r=n.Command,i=n.FileMessage,s=e.fileInfo,a=r.bFile(c(c({},s),{},{requestId:e.requestId,channelUrl:this.channel.url,url:s.file,metaArrays:s.metaArrays})),o=bt.getInstance(this._iid),l=k.get(this._iid);o.getConnectionState()!==o.ConnectionState.OPEN&&o.currentUser&&!o.connecting?l.container.apiClient.sendFileMessage(c(c({channelUrl:this.channel.url,isOpenChannel:this.channel.isOpenChannel()},s),{},{fileUrl:s.file,fileName:s.name,fileSize:s.size,fileType:s.type,metaArrays:s.metaArrays}),(function(e,n){var r=new i(e?a.getJsonElement():n);e&&(r.requestedMentionUserIds=s.mentionedUserIds),t(e,r)})):o.sendCommand(a,(function(e,n){if(o.getErrorFirstCallback()){var r=[e,n];n=r[0],e=r[1]}if(n){var l=new i(a.getJsonElement());l.requestedMentionUserIds=s.mentionedUserIds,t(n,l)}else{var u=new i(e.getJsonElement());t(null,u)}}))}},{key:"_uploadFile",value:function(e,t){var n=e.fileInfo,r=e.pendingMessage;if("string"!=typeof n.file&&n.file){var i=L.get(this._iid).FileMessageQueue;k.get(this._iid).container.apiClient.uploadFile(c(c({},n),{},{fileType:n.type,channelUrl:this.channel.url,reqId:r?r.reqId:null}),(function(r,a){if(r)e.state=i.State.SENT,e.error=r,e.response=null,t(n);else{var o="object"===s(a)?a:JSON.parse(a);n.file=o.url,n.thumbnailSizes=o.hasOwnProperty("thumbnails")?o.thumbnails:[],n.requireAuth=!!o.hasOwnProperty("require_auth")&&o.require_auth,t(n)}}))}else n.thumbnailSizes=[],n.requireAuth=!1,t(n)}},{key:"_finalizeUpload",value:function(e){var t=this.uploadQueue.map((function(e){return e.requestId})).indexOf(e);if(-1<t){var n=this.uploadQueue.splice(t,1);0<n.length&&this._handleUploadQueueUpdated("remove",n[0])}}},{key:"_finalizeMessage",value:function(){var e=this,t=k.get(this._iid).container.isErrorFirstInCallback,n=bt.getInstance(this._iid),r=L.get(this._iid),i=r.GroupChannel,s=(r.BaseMessage,r.FileMessageQueue),a=this.messageQueue[0];if(a&&a.state===s.State.SENT){a.state=s.State.DONE;var o=a.response,l=a.error,u=a.fileInfo.callback;if(o&&!l){var c=n.currentUser;if(c&&o._sender&&c.userId===o._sender.userId&&(c.nickname!==o._sender.nickname&&(c.nickname=o._sender.nickname),c.profileUrl!==o._sender.profileUrl&&(c.profileUrl=o._sender.profileUrl)),this.channel.isGroupChannel())return void i.getChannel(this.channel.url,A.INTERNAL_CALL,(function(r,i){if(n.getErrorFirstCallback()){var s=[r,i];i=s[0],r=s[1]}if(i)t?u(null,o):u(o,null),e.messageQueue.shift(),e._handleMessageQueueUpdated("remove");else{for(var a in r.lastMessage=o,n.channelHandlers)n.channelHandlers[a].onChannelChanged(r);t?u(i,o):u(o,i),e.messageQueue.shift(),e._handleMessageQueueUpdated("remove")}}))}l&&(o=a.pendingMessage)&&(l.code!==N.INVALID_PARAMETER?(o.requestState=n.MessageRequestState.FAILED,o.sendingStatus=n.MessageSendingStatus.FAILED,l.code!==N.FILE_UPLOAD_CANCEL_FAILED&&l.code!==N.REQUEST_CANCELED||(o.sendingStatus=n.MessageSendingStatus.CANCELED),o.requestedMentionUserIds=a.fileInfo.mentionedUserIds,o.errorCode=l.code):o=null),t?u(l,o):u(o,l),this.messageQueue.shift(),this._handleMessageQueueUpdated("remove")}}},{key:"addJob",value:function(e){this.messageQueue.push(e),this._handleMessageQueueUpdated("add")}},{key:"cancelUploadItemByRequestId",value:function(e,t){this._finalizeUpload(e);var n=this.messageQueue.map((function(e){return e.requestId})).indexOf(e);if(-1<n){var r=L.get(this._iid).FileMessageQueue,i=this.messageQueue[n];!i||i.state!==r.State.UPLOADING&&i.state!==r.State.PENDING||(i.state=r.State.SENT,i.response=null,i.error=new N("Uploading has been completed or canceled.",N.FILE_UPLOAD_CANCEL_FAILED),this._handleMessageQueueUpdated("update"));var s=r.uploadRequest[e];if(s)return s.cancel("Upload has been canceled."),t(null,!0),!0;t(new N("Uploading has been completed or canceled.",N.FILE_UPLOAD_CANCEL_FAILED),!1)}else t(new N("Uploading has been completed or canceled.",N.FILE_UPLOAD_CANCEL_FAILED),!1);return!1}}],[{key:"getByChannelUrl",value:function(e){return L.get(this._iid).FileMessageQueue.queueMap[e]}},{key:"create",value:function(e){var t=L.get(this._iid).FileMessageQueue;return t.queueMap.hasOwnProperty(e.url)||(t.queueMap[e.url]=new t(e)),t.queueMap[e.url]}},{key:"delete",value:function(e){var t=L.get(this._iid).FileMessageQueue;t.queueMap.hasOwnProperty(e)&&delete t.queueMap[e]}},{key:"clear",value:function(){ce[this._iid]={}}},{key:"State",get:function(){return{PENDING:"pending",UPLOADING:"uploading",UPLOADED:"uploaded",SENDING:"sending",SENT:"sent",DONE:"done"}}},{key:"queueMap",get:function(){return ce[this._iid]||(ce[this._iid]={}),ce[this._iid]}},{key:"uploadRequest",get:function(){return ue[this._iid]||(ue[this._iid]={}),ue[this._iid]}}]),e}();function he(){a(this,he),this.channelCustomTypesFilter=[],this.superChannelFilter=Se.SuperChannelFilter.ALL}function fe(){a(this,fe),this.onReconnectStarted=function(){},this.onReconnectSucceeded=function(){},this.onReconnectFailed=function(){}}function pe(){a(this,pe),this.onFriendsDiscovered=function(e){},this.onTotalUnreadMessageCountUpdated=function(e,t){}}function ge(){a(this,ge),this.onMessageReceived=function(e,t){},this.onMessageUpdated=function(e,t){},this.onMessageDeleted=function(e,t){},this.onReadReceiptUpdated=function(e){},this.onReactionUpdated=function(e,t){},this.onDeliveryReceiptUpdated=function(e){},this.onTypingStatusUpdated=function(e){},this.onUserJoined=function(e,t){},this.onUserLeft=function(e,t){},this.onOperatorUpdated=function(e,t){},this.onUserEntered=function(e,t){},this.onUserExited=function(e,t){},this.onUserMuted=function(e,t){},this.onUserUnmuted=function(e,t){},this.onUserBanned=function(e,t){},this.onUserUnbanned=function(e,t){},this.onChannelFrozen=function(e){},this.onChannelUnfrozen=function(e){},this.onChannelChanged=function(e){},this.onChannelDeleted=function(e,t){},this.onUserReceivedInvitation=function(e,t,n){},this.onUserDeclinedInvitation=function(e,t,n){},this.onMetaDataCreated=function(e,t){},this.onMetaDataUpdated=function(e,t){},this.onMetaDataDeleted=function(e,t){},this.onMetaCountersCreated=function(e,t){},this.onMetaCountersUpdated=function(e,t){},this.onMetaCountersDeleted=function(e,t){},this.onChannelHidden=function(e){},this.onMentionReceived=function(e,t){},this.onThreadInfoUpdated=function(e,t){}}function ye(e){if(a(this,ye),e){var t=L.get(this._iid),n=t.User,r=t.BaseChannel;this.reader=new n(e.user),this.timestamp=parseInt(e.ts),this.channelUrl=e.hasOwnProperty("channel_url")?String(e.channel_url):"",this.channelType=e.hasOwnProperty("channel_type")?String(e.channel_type):r.CHANNEL_TYPE_GROUP}}de.Job=function e(t){var n=t.fileInfo,r=t.requestId,i=t.pendingMessage,s=t.state,o=t.error,l=void 0===o?null:o,u=t.response,c=void 0===u?null:u;a(this,e),this.fileInfo=n,this.requestId=r,this.pendingMessage=i,this.state=s||de.State.PENDING,this.error=l,this.response=c};var me=function(){function e(){a(this,e)}return l(e,null,[{key:"create",value:function(){return"".concat(parseInt(1e5*Math.random()),"-").concat((new Date).getTime())}}]),e}(),_e={},ve={},Ee=new WeakMap,Ce=new WeakMap,be=new WeakMap,Se=function(){d(t,se);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this,n)).channelType=se.CHANNEL_TYPE_GROUP,r.isDistinct=!1,r.isSuper=!1,r.isBroadcast=!1,r.isPublic=!1,r.unreadMessageCount=0,r.inviter=null,r.members=[],r.memberMap={},r.lastMessage=null,r.memberCount=0,r.joinedMemberCount=0,r.cachedReadReceiptStatus={},r.cachedDeliveryReceiptStatus=null,r.myPushTriggerOption=t.PushTriggerOption.DEFAULT,r.isPushEnabled,r.isHidden=!1,r.hiddenState=t.HiddenState.UNHIDDEN,r.isDiscoverable=!0,r.myLastRead=0,r.messageSurvivalSeconds=-1,r._messageOffsetTimestamp=0,r._cachedLastDeliveredReceipt={sentAt:0,timeout:null},Ee.set(m(r),{}),Ce.set(m(r),{start:0,end:0}),be.set(m(r),0),n&&r._update(n),r}return l(t,[{key:"_setGroupChannelUnreadCount",value:function(e,t){try{if("number"==typeof e&&0<=e)if("all"===this.myCountPreference||"unread_message_count_only"===this.myCountPreference)if(this.isSuper||this.isBroadcast){var n=k.get(this._iid).container.maxUnreadCountOfSuperGroupChannel;this.unreadMessageCount=n<=e?n:e}else this.unreadMessageCount=e;else this.unreadMessageCount=0;"number"==typeof t&&0<=t&&("all"===this.myCountPreference||"unread_mention_count_only"===this.myCountPreference?this.unreadMentionCount=t:this.unreadMentionCount=0)}catch(e){}}},{key:"_update",value:function(e){var t=L.get(this._iid),n=t.BaseChannel,r=t.GroupChannel,i=t.User,a=t.Member;if(this.isAccessCodeRequired=!!e.is_access_code_required&&e.is_access_code_required,this.isDistinct=!!e.is_distinct&&e.is_distinct,this.isPushEnabled=!!e.is_push_enabled&&e.is_push_enabled,this.isHidden=!!e.hasOwnProperty("is_hidden")&&e.is_hidden,this.myPushTriggerOption=e.push_trigger_option?e.push_trigger_option:r.PushTriggerOption.DEFAULT,this.myCountPreference=e.hasOwnProperty("count_preference")?e.count_preference:r.CountPreference.ALL,this.unreadMessageCount=0,this.unreadMentionCount=0,this._setGroupChannelUnreadCount(parseInt(e.unread_message_count),parseInt(e.unread_mention_count)),e.hasOwnProperty("read_receipt"))for(var o in this.cachedReadReceiptStatus={},e.read_receipt){var l=e.read_receipt[o];this.updateReadReceipt(o,parseInt(l))}if(e.hasOwnProperty("delivery_receipt")&&"object"===s(e.delivery_receipt)&&null!==e.delivery_receipt)for(var u in this.cachedDeliveryReceiptStatus||(this.cachedDeliveryReceiptStatus={}),e.delivery_receipt){var c=e.delivery_receipt[u];this.updateDeliveryReceipt(u,parseInt(c))}if(e.hasOwnProperty("user_last_read")&&"number"==typeof e.user_last_read?this.myLastRead=e.user_last_read:this.myLastRead=0,e.hasOwnProperty("members")){this.members=[],this.memberMap={};for(var d=0;d<e.members.length;d++){var h=new a(e.members[d]);this.members.push(h),this.memberMap[h.userId]=h}}this.myMemberState=e.member_state||"none",this.myRole=e.my_role||r.Role.NONE,e.hasOwnProperty("is_muted")?"string"==typeof e.is_muted?this.myMutedState=e.is_muted:"boolean"==typeof e.is_muted?this.myMutedState=e.is_muted?"muted":"unmuted":this.myMutedState="unmuted":this.myMutedState="unmuted",e.hasOwnProperty("member_count")&&(this.memberCount=parseInt(e.member_count)),e.hasOwnProperty("joined_member_count")&&(this.joinedMemberCount=parseInt(e.joined_member_count)),e.hasOwnProperty("last_message")&&"object"===s(e.last_message)&&e.last_message?e.last_message instanceof ne?this.lastMessage=e.last_message:this.lastMessage=n.buildMessage(e.last_message,this):this.lastMessage=null,e.hasOwnProperty("inviter")&&null!==e.inviter&&"object"===s(e.inviter)&&0<Object.keys(e.inviter).length?this.inviter=new i(e.inviter):this.inviter=null,this.invitedAt=e.invited_at||0,e.hasOwnProperty("is_super")&&"boolean"==typeof e.is_super?this.isSuper=e.is_super:this.isSuper=!1,e.hasOwnProperty("is_broadcast")&&"boolean"==typeof e.is_broadcast?this.isBroadcast=e.is_broadcast:this.isBroadcast=!1,e.hasOwnProperty("is_public")&&"boolean"==typeof e.is_public?this.isPublic=e.is_public:this.isPublic=!1,e.hasOwnProperty("hidden_state")?this.hiddenState=e.hidden_state:this.hiddenState=r.HiddenState.UNHIDDEN,e.hasOwnProperty("is_discoverable")&&"boolean"==typeof e.is_discoverable?this.isDiscoverable=e.is_discoverable:this.isDiscoverable=this.isPublic,e.hasOwnProperty("ts_message_offset")&&(this._messageOffsetTimestamp=e.ts_message_offset),e.hasOwnProperty("message_survival_seconds")&&"number"==typeof e.message_survival_seconds&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"addMember",value:function(e){if(!this.isSuper&&!this.isBroadcast){var t=L.get(this._iid).Member,n=this.removeMember(e);n&&n.state===t.JOINED&&(e.state=t.JOINED),this.memberMap[e.userId]=e,this.members.push(e),this.memberCount++,this.updateReadReceipt(e.userId,0),this.updateDeliveryReceipt(e.userId,0)}}},{key:"removeMember",value:function(e){var t=null;if(!this.isSuper&&!this.isBroadcast&&this.memberMap.hasOwnProperty(e.userId)){delete this.memberMap[e.userId];for(var n=0;n<this.members.length;n++){var r=this.members[n];if(r.userId===e.userId){t=r,this.members.splice(n,1);break}}this.memberCount--}return t}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"isIdentical",value:function(e){return e&&this.url===e.url}},{key:"isEqual",value:function(e){return H.deepEqual(this,e)}},{key:"createMemberListQuery",value:function(){return new(L.get(this._iid).MemberListQuery)(this.url)}},{key:"createBannedUserListQuery",value:function(){return new(L.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:this.isOpenChannel()})}},{key:"refresh",value:function(e){return L.get(this._iid).GroupChannel.getChannelWithoutCache(this.url,e)}},{key:"updateChannel",value:function(){var e=this,t=z.toArray(arguments),n=void 0;"function"==typeof t[t.length-1]&&(n=t.pop());var r=L.get(this._iid),i=r.GroupChannel,s=r.GroupChannelParams;if(t[0]instanceof s&&1===t.length)return Z(this._iid,(function(n){var r=t[0];r.channelUrl=e.url,r._validate()?k.get(e._iid).container.apiClient.updateGroupChannel(c(c({},r),{},{operatorUserIds:r.operatorUserIds}),(function(e,t){var r=null;e||(r=i.upsert(t)),n(e,r)})):n(z.error,null)}),n);if(3===t.length){var a=new s;return a.channelUrl=this.url,a.name=t[0],"string"==typeof t[1]?a.coverUrl=t[1]:a.coverImage=t[1],a.data=t[2],this.updateChannel(a,n)}if(4===t.length){var o=new s;return o.channelUrl=this.url,o.isDistinct=t[0],o.name=t[1],"string"==typeof t[1]?o.coverUrl=t[2]:o.coverImage=t[2],o.data=t[3],this.updateChannel(o,n)}if(5!==t.length)return Z(this._iid,(function(e){return e(z.error,null)}),n);var l=new s;return l.channelUrl=this.url,l.isDistinct=t[0],l.name=t[1],"string"==typeof t[2]?l.coverUrl=t[2]:l.coverImage=t[2],l.data=t[3],l.customType=t[4],this.updateChannel(l,n)}},{key:"invite",value:function(e,t){var n,r=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return 0<e.length&&e.every((function(e){return!!e.userId&&"string"==typeof e.userId}))}}),new z({type:"callback"})]),3);return n=r[0],e=r[1],t=r[2],n?Z(this._iid,(function(e){return e(z.error,null)}),t):this.inviteWithUserIds(e.map((function(e){return e.userId})),t)}},{key:"inviteWithUserIds",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.inviteToGroupChannel({channelUrl:r.url,userIds:e},(function(e,n){var i=null;e||(i=L.get(r._iid).GroupChannel.upsert(n)),t(e,i)}))}),t)}},{key:"acceptInvitation",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",optional:!0,defaultValue:null}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.acceptInvitation({channelUrl:r.url,accessCode:e},(function(e,n){var i=null;e||((i=L.get(r._iid).GroupChannel.upsert(n)).myMemberState="joined"),t(e,i)}))}),t)}},{key:"declineInvitation",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.declineInvitation({channelUrl:t.url},(function(n,r){var i=null;if(!n){var s=L.get(t._iid).GroupChannel;(i=s.upsert(r)).myMemberState="none",t.isPublic||s.removeCachedChannel(t.url)}e(n,i)}))}),e)}},{key:"join",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",optional:!0,defaultValue:null}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.joinGroupChannel({channelUrl:r.url,accessCode:e},(function(e,n){var i=null;e||((i=L.get(r._iid).GroupChannel.upsert(n)).myMemberState="joined"),t(e,i)}))}),t)}},{key:"leave",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.leaveGroupChannel({channelUrl:t.url},(function(t,n){return e(t,null)}))}),e)}},{key:"muteUser",value:function(e,t,n,r){return this.muteUserWithUserId(e?e.userId:null,t,n,r)}},{key:"muteUserWithUserId",value:function(e,t,n,r){var i,s=this,a=E(z.parse(arguments,[new z({type:"string"}),new z({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new z({type:"string",optional:!0,defaultValue:""}),new z({type:"callback"})]),5);return i=a[0],e=a[1],t=a[2],n=a[3],r=a[4],Z(this._iid,(function(r){i?r(i,null):k.get(s._iid).container.apiClient.muteUser({channelUrl:s.url,userId:e,description:n,seconds:t,isGroupChannel:!0},(function(e,t){r(e,null)}))}),r)}},{key:"unmuteUser",value:function(e,t){return this.unmuteUserWithUserId(e?e.userId:null,t)}},{key:"unmuteUserWithUserId",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.unmuteUser({channelUrl:r.url,userId:e,isGroupChannel:!0},(function(e,n){t(e,null)}))}),t)}},{key:"banUser",value:function(e,t,n,r){return this.banUserWithUserId(e?e.userId:null,t,n,r)}},{key:"banUserWithUserId",value:function(e,t,n,r){var i,s=this,a=E(z.parse(arguments,[new z({type:"string"}),new z({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new z({type:"string"}),new z({type:"callback"})]),5);return i=a[0],e=a[1],t=a[2],n=a[3],r=a[4],Z(this._iid,(function(r){i?r(i,null):k.get(s._iid).container.apiClient.banUser({channelUrl:s.url,userId:e,description:n,seconds:t,isGroupChannel:!0},(function(e,t){r(e,null)}))}),r)}},{key:"unbanUser",value:function(e,t){return this.unbanUserWithUserId(e?e.userId:null,t)}},{key:"unbanUserWithUserId",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.unbanUser({channelUrl:r.url,userId:e,isGroupChannel:!0},(function(e,n){t(e,null)}))}),t)}},{key:"updateJoinedMemberCount",value:function(){if(!this.isSuper&&!this.isBroadcast){var e=L.get(this._iid).Member;this.joinedMemberCount=this.members.filter((function(t){return t.state===e.JOINED})).length}}},{key:"setLatestMemberCount",value:function(e,t,n){"number"==typeof e&&"number"==typeof t&&"number"==typeof n&&n>=be.get(this)&&(be.set(this,n),this.memberCount=e,this.joinedMemberCount=t)}},{key:"hide",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"boolean",optional:!0,defaultValue:!1}),new z({type:"boolean",optional:!0,defaultValue:!0}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.hideGroupChannel({channelUrl:i.url,hidePreviousMessages:e,allowAutoUnhide:t},(function(r,s){if(!r){var a=L.get(i._iid).GroupChannel;i.isHidden=!0,i.hiddenState=t?a.HiddenState.HIDDEN_ALLOW_AUTO_UNHIDE:a.HiddenState.HIDDEN_PREVENT_AUTO_UNHIDE,e&&i._setGroupChannelUnreadCount(0,0),s.hasOwnProperty("ts_message_offset")&&(i._messageOffsetTimestamp=s.ts_message_offset),a.cachedChannels[i.url]=i}n(r,s)}))}),n)}},{key:"unhide",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.unhideGroupChannel({channelUrl:t.url},(function(n,r){if(!n){var i=L.get(t._iid).GroupChannel;t.isHidden=!1,t.hiddenState=i.HiddenState.UNHIDDEN,i.cachedChannels[t.url]=t}e(n,r)}))}),e)}},{key:"freeze",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.freeze({channelUrl:t.url,isGroupChannel:!0,freezing:!0},(function(n,r){n||L.get(t._iid).GroupChannel.upsert(r),e(n,null)}))}),e)}},{key:"unfreeze",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.freeze({channelUrl:t.url,isGroupChannel:!0,freezing:!1},(function(n,r){n||L.get(t._iid).GroupChannel.upsert(r),e(n,null)}))}),e)}},{key:"delete",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.deleteGroupChannel({channelUrl:t.url},(function(n,r){n||L.get(t._iid).GroupChannel.removeCachedChannel(t.url),e(n,r)}))}),e)}},{key:"markAsRead",value:function(){var e=this,t=L.get(this._iid).Command,n=bt.getInstance(this._iid),r=t.bRead({channelUrl:this.url});n.sendCommand(r,(function(t,r){if(n.getErrorFirstCallback()){var i=[t,r];r=i[0],t=i[1]}if(!r&&n.currentUser&&(e.updateReadReceipt(n.currentUser.userId,t.getJsonElement().ts),0<e.unreadMessageCount||0<e.unreadMentionCount))for(var s in e._setGroupChannelUnreadCount(0,0),n.channelHandlers)n.channelHandlers[s].onChannelChanged(e)}))}},{key:"getUnreadMemberCount",value:function(e){var t=bt.getInstance(this._iid);if(e instanceof ne&&!e.isAdminMessage()&&t.currentUser&&!this.isSuper&&!this.isBroadcast){for(var n=0,r=e.createdAt,i=this.members,s=0;s<i.length;s++){var a=i[s];t.currentUser.userId===a.userId||e.sender&&e.sender.userId===a.userId||(this.cachedReadReceiptStatus[a.userId]||0)<r&&n++}return n}return 0}},{key:"getReadReceipt",value:function(e){return this.getUnreadMemberCount(e)}},{key:"markAsDelivered",value:function(){function e(){var e=bt.getInstance(t._iid),n=e.currentUser?e.currentUser.userId:null;k.get(t._iid).container.apiClient.markAsDelivered({channelUrl:t.url,userId:n},(function(e,r){if(e)w.debug(e);else{var i=r.hasOwnProperty("ts")?r.ts:0;t.updateDeliveryReceipt(n,i)}}))}var t=this,n=this._cachedLastDeliveredReceipt;n&&Date.now()-n.sentAt<1e3?(n.timeout&&clearTimeout(n.timeout),n.timeout=setTimeout((function(){n.sentAt=Date.now(),e()}),n.sentAt+1e3-Date.now())):(n.sentAt=Date.now(),e())}},{key:"getUndeliveredMemberCount",value:function(e){var t=bt.getInstance(this._iid);if(this.cachedDeliveryReceiptStatus&&e instanceof ne&&!e.isAdminMessage()&&t.currentUser&&!this.isSuper&&!this.isBroadcast){var n,r=e.createdAt,i=0,s=function(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=b(e))){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==n.return||n.return()}finally{if(o)throw s}}}}(this.members);try{for(s.s();!(n=s.n()).done;){var a=n.value;t.currentUser.userId===a.userId||e.sender&&e.sender.userId===a.userId||this.cachedDeliveryReceiptStatus[a.userId]<r&&i++}}catch(e){s.e(e)}finally{s.f()}return i}return 0}},{key:"getDeliveryReceipt",value:function(e){return this.getUndeliveredMemberCount(e)}},{key:"getReadMembers",value:function(e,t){var n=1<arguments.length&&void 0!==t&&t,r=bt.getInstance(this._iid);if(r.currentUser&&!this.isSuper&&!this.isBroadcast&&e instanceof ne&&!e.isAdminMessage()){for(var i=[],s=0;s<this.members.length;s++){var a=this.members[s];(n||a.userId!==r.currentUser.userId&&a.userId!==e.sender.userId)&&(this.cachedReadReceiptStatus[a.userId]||0)>=e.createdAt&&i.push(a)}return i}return[]}},{key:"getUnreadMembers",value:function(e,t){var n=1<arguments.length&&void 0!==t&&t,r=bt.getInstance(this._iid);if(r.currentUser&&!this.isSuper&&!this.isBroadcast&&e instanceof ne&&!e.isAdminMessage()){for(var i=[],s=0;s<this.members.length;s++){var a=this.members[s];(n||a.userId!==r.currentUser.userId&&a.userId!==e.sender.userId)&&(this.cachedReadReceiptStatus[a.userId]||0)<e.createdAt&&i.push(a)}return i}return[]}},{key:"getReadStatus",value:function(e){var t=this,n=0<arguments.length&&void 0!==e&&e,r=bt.getInstance(this._iid);if(!r.currentUser||this.isSuper||this.isBroadcast)return{};function i(e){if(!n&&e===r.currentUser.userId)return"continue";var i=t.cachedReadReceiptStatus[e],a=t.members.filter((function(t){return t.userId===e}));s[e]={user:0<a.length?a[0]:null,last_seen_at:parseInt(i)}}var s={};for(var a in this.cachedReadReceiptStatus)i(a);return s}},{key:"updateReadReceipt",value:function(e,t){var n=this.cachedReadReceiptStatus[e];if(!n||n<t){this.cachedReadReceiptStatus[e]=t;var r=bt.getInstance(this._iid);r.currentUser&&e===r.currentUser.userId&&(this.myLastRead=t)}}},{key:"updateDeliveryReceipt",value:function(e,t){if(this.cachedDeliveryReceiptStatus)if(this.cachedDeliveryReceiptStatus.hasOwnProperty(e)){var n=this.cachedDeliveryReceiptStatus[e];(!n||n<t)&&(this.cachedDeliveryReceiptStatus[e]=t)}else this.cachedDeliveryReceiptStatus[e]=t}},{key:"startTyping",value:function(){var e=bt.getInstance(this._iid),t=(new Date).getTime(),n=e.Options.typingIndicatorThrottle;("number"!=typeof n||n<1e3||9e3<n)&&(n=1e3);var r=Ce.get(this);if(t-r.start>=n){r.end=0,r.start=t;var i=L.get(this._iid).Command.bTypeStart({channelUrl:this.url,time:r.start});e.sendCommand(i,null)}}},{key:"endTyping",value:function(){var e=bt.getInstance(this._iid),t=(new Date).getTime(),n=e.Options.typingIndicatorThrottle;("number"!=typeof n||n<1e3||9e3<n)&&(n=1e3);var r=Ce.get(this);if(t-r.end>=n){r.start=0,r.end=t;var i=L.get(this._iid).Command.bTypeEnd({channelUrl:this.url,time:r.end});e.sendCommand(i,null)}}},{key:"invalidateTypingStatus",value:function(){var e=Ee.get(this),t=(new Date).getTime(),n=!1;for(var r in e)1e4<=t-e[r]&&(delete e[r],n=!0);return n}},{key:"getTypingMembers",value:function(){var e=Ee.get(this),t=[];for(var n in e){var r=this.memberMap[n];r&&t.push(r)}return t}},{key:"updateTypingStatus",value:function(e,t){var n=Ee.get(this);t?n[e.userId]=(new Date).getTime():delete n[e.userId]}},{key:"isTyping",value:function(){var e=Ee.get(this);return 0!==Object.keys(e).length}},{key:"registerScheduledUserMessage",value:function(e,t){var n,r=this,i=L.get(this._iid),s=i.ScheduledUserMessage,a=i.ScheduledUserMessageParams,o=E(z.parse(arguments,[new z({type:a,constraint:function(e){return"string"==typeof e.message&&"string"==typeof e._getScheduleString()}}),new z({type:"callback"})]),3);return n=o[0],e=o[1],t=o[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.registerScheduledUserMessage({groupChannelParams:e,channelUrl:r.url,isOpenChannel:!1},(function(e,n){var i=null;if(!e){i=new s(n);var a=bt.getInstance(r._iid).currentUser;a&&i._sender&&a.userId===i._sender.userId&&(a.nickname=i._sender.nickname,a.profileUrl=i._sender.profileUrl,a.metaData=i._sender.metaData)}t(e,i)}))}),t)}},{key:"getPushPreference",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getMyPushTriggerOption({channelUrl:t.url},(function(n,r){var i=null;if(!n){try{i=r.enable}catch(n){i=!1}t.isPushEnabled=i}e&&e(n,i)}))}),e)}},{key:"setPushPreference",value:function(e,t){var n=this;return Z(this._iid,(function(t){var r=L.get(n._iid).GroupChannel;k.get(n._iid).container.apiClient.setMyPushTriggerOption({channelUrl:n.url,enable:e},(function(e,i){e||(n.isPushEnabled=i.enable,n.isPushEnabled||(n.myPushTriggerOption=r.PushTriggerOption.OFF)),t(e,i)}))}),t)}},{key:"getMyPushTriggerOption",value:function(e){var n=this;return Z(this._iid,(function(e){k.get(n._iid).container.apiClient.getMyPushTriggerOption({channelUrl:n.url},(function(r,i){var s=null;if(!r){try{s=i.push_trigger_option||t.PushTriggerOption.DEFAULT}catch(r){w.debug(r)}n.myPushTriggerOption=s}e(r,s)}))}),e)}},{key:"setMyPushTriggerOption",value:function(e,t){var n,r=this,i=L.get(this._iid).GroupChannel,s=E(z.parse(arguments,[new z({type:i.PushTriggerOption}),new z({type:"callback"})]),3);return n=s[0],e=s[1],t=s[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.setMyPushTriggerOption({channelUrl:r.url,pushTriggerOption:e},(function(e,n){var i=null;if(!e){try{i=n.push_trigger_option}catch(e){w.debug(e)}r.myPushTriggerOption=i}t(e,i)}))}),t)}},{key:"setMyCountPreference",value:function(e,t){var n,r=this,i=L.get(this._iid).GroupChannel,s=E(z.parse(arguments,[new z({type:i.CountPreference}),new z({type:"callback"})]),3);return n=s[0],e=s[1],t=s[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.setMyCountPreference({channelUrl:r.url,countPreference:e},(function(e,n){var s=null;e||(s=r.myCountPreference=n.count_preference,r._setGroupChannelUnreadCount(r.unreadMessageCount,r.unreadMentionCount),i.cachedChannels[r.url]=r),t(e,s)}))}),t)}},{key:"resetMyHistory",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.resetMyHistory({channelUrl:t.url},(function(n,r){if(!n&&r.hasOwnProperty("ts_message_offset")){var i=L.get(t._iid).GroupChannel;t._messageOffsetTimestamp=r.ts_message_offset,i.cachedChannels[t.url]=t}e(n,r)}))}),e)}},{key:"messageOffsetTimestamp",get:function(){return this._messageOffsetTimestamp}}],[{key:"buildFromSerializedData",value:function(e){var t,n=L.get(this._iid),r=n.User,i=n.Member,a=n.GroupChannel,o=n.BaseMessage,l=n.UserMessage,u=n.FileMessage,d=n.AdminMessage,h=$.deserialize(e);return new a({channel_url:h.url,name:h.name,cover_url:h.coverUrl,data:h.data,custom_type:h.customType,invited_at:h.invitedAt,created_at:h.createdAt/1e3,is_access_code_required:h.isAccessCodeRequired,is_distinct:h.isDistinct,is_super:h.isSuper,is_broadcast:h.isBroadcast,is_public:h.isPublic,is_discoverable:h.isDiscoverable,freeze:h.isFrozen,is_ephemeral:h.isEphemeral,unread_message_count:h.unreadMessageCount,unread_mention_count:h.unreadMentionCount,is_push_enabled:h.isPushEnabled,push_trigger_option:h.myPushTriggerOption,count_preference:h.myCountPreference,is_hidden:h.isHidden,hidden_state:h.hiddenState,member_count:h.memberCount,joined_member_count:h.joinedMemberCount,member_state:h.myMemberState,my_role:h.myRole,is_muted:h.myMutedState,user_last_read:h.myLastRead,ts_message_offset:h.messageOffsetTimestamp,message_survival_seconds:h.messageSurvivalSeconds,read_receipt:h.cachedReadReceiptStatus,delivery_receipt:h.cachedDeliveryReceiptStatus,members:h.members.map((function(e){return i.objectify(c({user:e},e))})),last_message:(t=h.lastMessage,null!=t&&"object"===s(t)?t.messageType===o.MESSAGE_TYPE_USER?new l(l.objectify(c(c({},t),{},{channel:{url:t.channelUrl,channelType:t.channelType},user:t.sender,mentionedUsers:t.mentionedUsers}))):t.messageType===o.MESSAGE_TYPE_FILE?new u(u.objectify(c(c({},t),{},{channel:{url:t.channelUrl,channelType:t.channelType},user:t.sender,mentionedUsers:t.mentionedUsers}))):new d(d.objectify(c(c({},t),{},{channel:{url:t.channelUrl,channelType:t.channelType},mentionedUsers:t.mentionedUsers}))):null),inviter:null!==h.inviter&&void 0!==h.inviter&&"object"===s(h.inviter)?r.objectify(h.inviter):null})}},{key:"upsert",value:function(e){var t=L.get(this._iid).GroupChannel,n=new t(e);if(t.cachedChannels.hasOwnProperty(n.url)){if(n.isEphemeral){var r=t.cachedChannels[n.url];e.last_message=r.lastMessage,e.unread_message_count=r.unreadMessageCount}t.cachedChannels[n.url].update(e)}else t.cachedChannels[n.url]=n;return t.cachedChannels[n.url]}},{key:"removeCachedChannel",value:function(e){var t=L.get(this._iid),n=t.GroupChannel,r=t.FileMessageQueue;n.cachedChannels[e]&&delete n.cachedChannels[e],r.delete(e)}},{key:"clearCache",value:function(){_e[this._iid]={},L.get(this._iid).FileMessageQueue.clear()}},{key:"getChannel",value:function(e,t){var n,r,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"string",optional:!0,nullable:!0,defaultValue:null}),new z({type:"callback"})]),4);if(n=i[0],e=i[1],r=i[2],t=i[3],n)return Z(this._iid,(function(e){e(n,null)}),t);var s=L.get(this._iid).GroupChannel;return s.cachedChannels[e]?Z(this._iid,(function(t){t(null,s.cachedChannels[e])}),t):s.getChannelWithoutCache(e,r,t)}},{key:"getChannelWithoutCache",value:function(e,t){var n,r,i=this,s=E(z.parse(arguments,[new z({type:"string"}),new z({type:"string",optional:!0,nullable:!0,defaultValue:null}),new z({type:"callback"})]),4);return n=s[0],e=s[1],r=s[2],t=s[3],Z(this._iid,(function(t){n?t(n,null):k.get(i._iid).container.apiClient.getGroupChannel({channelUrl:e,internalCall:r,showMember:!0},(function(e,n){var r=null;e||(r=i.upsert(n)),t(e,r)}))}),t)}},{key:"createDistinctChannelIfNotExist",value:function(e,t){var n,r=this,i=L.get(this._iid).GroupChannelParams,s=E(z.parse(arguments,[new z({type:i,constraint:function(e){return e._validate()}}),new z({type:"callback"})]),3);return n=s[0],e=s[1],t=s[2],Z(this._iid,(function(t){n?t(n,null):(e.isPublic||(e.accessCode=null),k.get(r._iid).container.apiClient.createGroupChannel(c(c({},e),{},{isDistinct:!0}),(function(e,n){var i=null;if(!e){var s=L.get(r._iid).GroupChannel;i={channel:new s(n),isCreated:n.is_created},s.cachedChannels[i.channel.url]=i.channel}t(e,i)})))}),t)}},{key:"createChannel",value:function(){var e=this,t=z.toArray(arguments),n=void 0;"function"==typeof t[t.length-1]&&(n=t.pop());var r=L.get(this._iid),i=r.GroupChannel,s=r.GroupChannelParams;if(t[0]instanceof s&&1===t.length)return Z(this._iid,(function(n){var r=t[0];r.isPublic||(r.accessCode=null),r._validate()?k.get(e._iid).container.apiClient.createGroupChannel(r,(function(e,t){var r=null;e||(r=new i(t),i.cachedChannels[r.url]=r),n(e,r)})):n(z.error,null)}),n);if(Array.isArray(t[0])){var a=new s;switch(t.length){case 1:a.addUsers(t[0]);break;case 2:a.addUsers(t[0]),a.isDistinct=t[1];break;case 3:a.addUsers(t[0]),a.isDistinct=t[1],a.customType=t[2];break;case 5:a.addUsers(t[0]),a.isDistinct=t[1],a.name=t[2],"string"==typeof t[3]?a.coverUrl=t[3]:a.coverImage=t[3],a.data=t[4];break;case 6:a.addUsers(t[0]),a.isDistinct=t[1],a.name=t[2],"string"==typeof t[3]?a.coverUrl=t[3]:a.coverImage=t[3],a.data=t[4],a.customType=t[5];break;default:return Z(this._iid,(function(e){return e(z.error,null)}),n)}return n?i.createChannel(a,n):i.createChannel(a)}return Z(this._iid,(function(e){return e(z.error,null)}),n)}},{key:"createChannelWithUserIds",value:function(){var e=z.toArray(arguments),t=void 0;"function"==typeof e[e.length-1]&&(t=e.pop());var n=L.get(this._iid),r=n.GroupChannel,i=new n.GroupChannelParams;switch(e.length){case 1:i.addUserIds(e[0]);break;case 2:i.addUserIds(e[0]),i.isDistinct=e[1];break;case 3:i.addUserIds(e[0]),i.isDistinct=e[1],i.customType=e[2];break;case 5:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4];break;case 6:i.addUserIds(e[0]),i.isDistinct=e[1],i.name=e[2],"string"==typeof e[3]?i.coverUrl=e[3]:i.coverImage=e[3],i.data=e[4],i.customType=e[5];break;default:return Z(this._iid,(function(e){return e(z.error,null)}),t)}return r.createChannel(i,t)}},{key:"createMyGroupChannelListQuery",value:function(){return new(L.get(this._iid).GroupChannelListQuery)}},{key:"createPublicGroupChannelListQuery",value:function(){return new(L.get(this._iid).PublicGroupChannelListQuery)}},{key:"getChannelCount",value:function(e,t){return bt.getInstance(this._iid).getGroupChannelCount(e,t)}},{key:"getUnreadItemCount",value:function(e,t){return bt.getInstance(this._iid).getUnreadItemCount(e,t)}},{key:"getTotalUnreadMessageCount",value:function(){var e=z.toArray(arguments),t="function"==typeof e[e.length-1]?e.pop():null,n=bt.getInstance(this._iid);return n.getTotalUnreadMessageCount.apply(n,C(e).concat([t]))}},{key:"getTotalUnreadChannelCount",value:function(e){return bt.getInstance(this._iid).getTotalUnreadChannelCount(e)}},{key:"MemberStateFilter",get:function(){return{ALL:"all",JOINED:"joined_only",INVITED:"invited_only",INVITED_BY_FRIEND:"invited_by_friend",INVITED_BY_NON_FRIEND:"invited_by_non_friend"}}},{key:"PushTriggerOption",get:function(){return{DEFAULT:"default",ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}},{key:"CountPreference",get:function(){return{ALL:"all",UNREAD_MESSAGE_COUNT_ONLY:"unread_message_count_only",UNREAD_MENTION_COUNT_ONLY:"unread_mention_count_only",OFF:"off"}}},{key:"HiddenState",get:function(){return{UNHIDDEN:"unhidden",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"PublicChannelFilter",get:function(){return{ALL:"all",PUBLIC:"public",PRIVATE:"private"}}},{key:"SuperChannelFilter",get:function(){return{ALL:"all",SUPER:"super",NON_SUPER:"nonsuper"}}},{key:"UnreadChannelFilter",get:function(){return{ALL:"all",UNREAD_MESSAGE:"unread_message"}}},{key:"HiddenChannelFilter",get:function(){return{UNHIDDEN:"unhidden_only",HIDDEN:"hidden_only",HIDDEN_ALLOW_AUTO_UNHIDE:"hidden_allow_auto_unhide",HIDDEN_PREVENT_AUTO_UNHIDE:"hidden_prevent_auto_unhide"}}},{key:"Role",get:function(){return{OPERATOR:"operator",NONE:"none"}}},{key:"UnreadItemKey",get:function(){return{GROUP_CHANNEL_UNREAD_MENTION_COUNT:"group_channel_unread_mention_count",NONSUPER_UNREAD_MENTION_COUNT:"non_super_group_channel_unread_mention_count",SUPER_UNREAD_MENTION_COUNT:"super_group_channel_unread_mention_count",GROUP_CHANNEL_UNREAD_MESSAGE_COUNT:"group_channel_unread_message_count",NONSUPER_UNREAD_MESSAGE_COUNT:"non_super_group_channel_unread_message_count",SUPER_UNREAD_MESSAGE_COUNT:"super_group_channel_unread_message_count",GROUP_CHANNEL_INVITATION_COUNT:"group_channel_invitation_count",NONSUPER_INVITATION_COUNT:"non_super_group_channel_invitation_count",SUPER_INVITATION_COUNT:"super_group_channel_invitation_count"}}},{key:"cachedChannels",get:function(){return _e[this._iid]||(_e[this._iid]={}),_e[this._iid]}},{key:"markAsReadAllLastSentAt",get:function(){return ve[this._iid]||0},set:function(e){ve[this._iid]=e}}]),t}(),Ae=function(){d(t,re);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this,n)).state="",r.role="",r.isBlockedByMe=!1,r.isBlockingMe=!1,n&&r._update(n),r}return l(t,[{key:"_update",value:function(e){this.state=e.state,this.role=e.role||Se.Role.NONE,e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me),e.hasOwnProperty("is_blocking_me")&&(this.isBlockingMe=e.is_blocking_me)}},{key:"parse",value:function(e){this._update(e)}}],[{key:"objectify",value:function(e){var t=L.get(this._iid).User,n=e.user,r=e.state,i=e.role,s=void 0===i?"":i,a=e.isBlockedByMe,o=void 0!==a&&a,l=e.isBlockingMe,u=void 0!==l&&l,c=t.objectify(n);return c.state=r,c.role=s,c.is_blocked_by_me=o,c.is_blocking_me=u,c}},{key:"build",value:function(e,t,n,r,i){var s=L.get(this._iid).User;return this.objectify({user:new s(e),state:t,role:n,isBlockedByMe:r,isBlockingMe:i})}},{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid).Member,n=$.deserialize(e);return new t(t.objectify(c({user:n},n)))}},{key:"JOINED",get:function(){return"joined"}},{key:"INVITED",get:function(){return"invited"}}]),t}(),Ie=function(){d(t,re);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this,n)).isBlockedByMe=!1,n&&r._update(n),r}return l(t,[{key:"parse",value:function(e){this._update(e)}},{key:"_update",value:function(e){e.hasOwnProperty("is_blocked_by_me")&&(this.isBlockedByMe=e.is_blocked_by_me)}}],[{key:"objectify",value:function(e){var t=L.get(this._iid).User,n=e.user,r=e.isBlockedByMe,i=void 0!==r&&r,s=t.objectify(n);return s.is_blocked_by_me=i,s}},{key:"build",value:function(e,t){var n=L.get(this._iid).User;return this.objectify({user:new n(e),isBlockedByMe:t})}},{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid).Sender,n=$.deserialize(e);return new t(t.objectify(c({user:n},n)))}}]),t}(),Ue=function(){function e(t){a(this,e),this.emojiHash=null,this.emojiCategories=null,t&&this._update(t)}return l(e,[{key:"_update",value:function(e){var t=L.get(this._iid).EmojiCategory;this.emojiHash=e.emoji_hash||"",this.emojiCategories=e.emoji_categories?e.emoji_categories.map((function(e){return new t(e)})):[]}}]),e}(),ke=function(){function e(t){a(this,e),this.id=null,this.name=null,this.url=null,this.emojis=null,t&&this._update(t)}return l(e,[{key:"_update",value:function(e){var t=L.get(this._iid).Emoji;this.id=e.id||0,this.name=e.name||"",this.url=e.url||"",this.emojis=e.emojis?e.emojis.map((function(e){return new t(e)})):[]}}]),e}(),Ne=function(){function e(t){a(this,e),this.key=null,this.url=null,t&&this._update(t)}return l(e,[{key:"_update",value:function(e){this.key=e.key,this.url=e.url}}]),e}(),Re={},Te={},Oe=function(){d(t,se);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this,n)).channelType=se.CHANNEL_TYPE_OPEN,r.participantCount=0,r.operators=[],n&&r._update(n),r}return l(t,[{key:"_update",value:function(e){var t=L.get(this._iid).User;e.hasOwnProperty("participant_count")&&(this.participantCount=parseInt(e.participant_count)),e.hasOwnProperty("operators")&&Array.isArray(e.operators)&&(this.operators=e.operators.map((function(e){return new t(e)})))}},{key:"parse",value:function(e){this._update(e)}},{key:"update",value:function(e){this.__update(e),this._update(e)}},{key:"createParticipantListQuery",value:function(){return new(L.get(this._iid).ParticipantListQuery)({channelUrl:this.url})}},{key:"createMutedUserListQuery",value:function(){return new(L.get(this._iid).MutedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"createBannedUserListQuery",value:function(){return new(L.get(this._iid).BannedUserListQuery)({channelUrl:this.url,isOpenChannel:!0})}},{key:"isOperator",value:function(e){return!!e&&this.isOperatorWithUserId(e.userId)}},{key:"isOperatorWithUserId",value:function(e){return-1<this.operators.map((function(e){return e.userId})).indexOf(e)}},{key:"refresh",value:function(e){return L.get(this._iid).OpenChannel.getChannelWithoutCache(this.url,e)}},{key:"enter",value:function(e){var t=this;return Z(this._iid,(function(e){var n=L.get(t._iid).Command.bEnter({channelUrl:t.url}),r=bt.getInstance(t._iid);r.sendCommand(n,(function(n,i){if(r.getErrorFirstCallback()){var s=[n,i];i=s[0],n=s[1]}i?(i=i?new N(i.message,i.code):null,e(i,null)):(L.get(t._iid).OpenChannel.enteredChannels[t.url]=t).refresh((function(){return e(null,null)}))}))}),e)}},{key:"exit",value:function(e){var t=this;return Z(this._iid,(function(e){var n=L.get(t._iid),r=n.Command,i=n.FileMessageQueue,s=r.bExit({channelUrl:t.url}),a=bt.getInstance(t._iid);a.sendCommand(s,(function(n,r){if(a.getErrorFirstCallback()){var s=[n,r];r=s[0],n=s[1]}r?(r=r?new N(r.message,r.code):null,e(r,null)):(delete L.get(t._iid).OpenChannel.enteredChannels[t.url],i.delete(t.url),e(null,null))}))}),e)}},{key:"updateChannel",value:function(e,t,n,r,i,s){var a,o=this,l=E(z.parse(arguments,[new z({type:"string",nullable:!0}),new z({type:["string","file"],nullable:!0}),new z({type:"string",nullable:!0}),new z({type:"array",nullable:!0,optional:!0,defaultValue:null,constraint:function(e){return e.map((function(e){return"string"==typeof e}))}}),new z({type:"string",nullable:!0,optional:!0}),new z({type:"callback"})]),7);return a=l[0],e=l[1],t=l[2],n=l[3],r=l[4],i=l[5],s=l[6],Z(this._iid,(function(s){a?s(a,null):k.get(o._iid).container.apiClient.updateOpenChannel({channelUrl:o.url,name:e,coverUrlOrImage:t,data:n,operatorUserIds:r,customType:i},(function(e,t){var n=null;e||(n=L.get(o._iid).OpenChannel.upsert(t)),s(e,n)}))}),s)}},{key:"updateChannelWithOperatorUserIds",value:function(){var e=z.toArray(arguments),t=void 0;switch("function"==typeof e[e.length-1]&&(t=e.pop()),e.length){case 4:case 5:return this.updateChannel.apply(this,C(e).concat([t]));default:return Z(this._iid,(function(e){return e(z.error,null)}),t)}}},{key:"muteUser",value:function(e,t,n,r){return this.muteUserWithUserId(e?e.userId:null,t,n,r)}},{key:"muteUserWithUserId",value:function(e,t,n,r){var i,s=this,a=E(z.parse(arguments,[new z({type:"string"}),new z({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new z({type:"string",optional:!0,defaultValue:""}),new z({type:"callback"})]),5);return i=a[0],e=a[1],t=a[2],n=a[3],r=a[4],Z(this._iid,(function(r){i?r(i,null):k.get(s._iid).container.apiClient.muteUser({channelUrl:s.url,userId:e,description:n,seconds:t,isGroupChannel:!1},(function(e,t){r(e,null)}))}),r)}},{key:"unmuteUser",value:function(e,t){return this.unmuteUserWithUserId(e?e.userId:null,t)}},{key:"unmuteUserWithUserId",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.unmuteUser({channelUrl:r.url,userId:e,isGroupChannel:!1},(function(e,n){t(e,null)}))}),t)}},{key:"banUser",value:function(e,t,n){return this.banUserWithUserId(e?e.userId:null,t,n)}},{key:"banUserWithUserId",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"string"}),new z({type:"number",optional:!0,defaultValue:-1,constraint:function(e){return-1<=e}}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.banUser({channelUrl:i.url,userId:e,description:null,seconds:t,isGroupChannel:!1},(function(e,t){n(e,null)}))}),n)}},{key:"unbanUser",value:function(e,t){return this.unbanUserWithUserId(e?e.userId:null,t)}},{key:"unbanUserWithUserId",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.unbanUser({channelUrl:r.url,userId:e,isGroupChannel:!1},(function(e,n){t(e,null)}))}),t)}},{key:"delete",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.deleteOpenChannel({channelUrl:t.url},(function(n,r){n||(delete L.get(t._iid).OpenChannel.cachedChannels[t.url],L.get(t._iid).FileMessageQueue.delete(t.url)),e(n,r)}))}),e)}}],[{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid),n=t.User,r=t.OpenChannel,i=$.deserialize(e);return new r({channel_url:i.url,name:i.name,cover_url:i.coverUrl,data:i.data,custom_type:i.customType,created_at:i.createdAt/1e3,freeze:i.isFrozen,is_ephemeral:i.isEphemeral,participant_count:i.participantCount,operators:i.operators.map((function(e){return n.objectify(e)}))})}},{key:"getChannel",value:function(e,t){var n,r,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"string",optional:!0,nullable:!0,defaultValue:null}),new z({type:"callback"})]),4);if(n=i[0],e=i[1],r=i[2],t=i[3],n)return Z(this._iid,(function(e){e(n,null)}),t);var s=L.get(this._iid).OpenChannel;return s.cachedChannels[e]?Z(this._iid,(function(t){t(null,s.cachedChannels[e])}),t):s.getChannelWithoutCache(e,r,t)}},{key:"getChannelWithoutCache",value:function(e,t){var n,r,i=this,s=E(z.parse(arguments,[new z({type:"string"}),new z({type:"string",optional:!0,nullable:!0,defaultValue:null}),new z({type:"callback"})]),4);return n=s[0],e=s[1],r=s[2],t=s[3],Z(this._iid,(function(t){n?t(n,null):k.get(i._iid).container.apiClient.getOpenChannel({channelUrl:e,internalCall:r},(function(e,n){var r=null;e||(r=L.get(i._iid).OpenChannel.upsert(n)),t(e,r)}))}),t)}},{key:"createChannel",value:function(e,t,n,r,i,s){var a,o=this,l=E(z.parse(arguments,[new z({type:"string",nullable:!0,ignoreIf:function(e){return 0===e.length}}),new z({type:["string","file"],nullable:!0,ignoreIf:function(e){return 0===e.length}}),new z({type:"string",nullable:!0,ignoreIf:function(e){return 0===e.length}}),new z({type:"array",nullable:!0,ignoreIf:function(e){return e.length<4},constraint:function(e){return e.map((function(e){return"string"==typeof e}))}}),new z({type:"string",nullable:!0,ignoreIf:function(e){return e.length<5}}),new z({type:"callback"})]),7);return a=l[0],e=l[1],t=l[2],n=l[3],r=l[4],i=l[5],s=l[6],Z(this._iid,(function(s){a?s(a,null):k.get(o._iid).container.apiClient.createOpenChannel({name:e,coverUrlOrImage:t,data:n,operatorUserIds:r,customType:i},(function(e,t){var n=null;e||(n=L.get(o._iid).OpenChannel.upsert(t)),s(e,n)}))}),s)}},{key:"createChannelWithOperatorUserIds",value:function(){var e=z.toArray(arguments),t=void 0;switch("function"==typeof e[e.length-1]&&(t=e.pop()),e.length){case 4:case 5:return this.createChannel.apply(this,C(e).concat([t]));default:return Z(this._iid,(function(e){return e(z.error,null)}),t)}}},{key:"upsert",value:function(e){var t=new(L.get(this._iid).OpenChannel)(e);return this.cachedChannels.hasOwnProperty(t.url)?this.cachedChannels[t.url].update(e):this.cachedChannels[t.url]=t,this.cachedChannels[t.url]}},{key:"removeCachedChannel",value:function(e){this.cachedChannels[e]&&delete this.cachedChannels[e],L.get(this._iid).FileMessageQueue.delete(e)}},{key:"clearCache",value:function(){Re[this._iid]={},L.get(this._iid).FileMessageQueue.clear()}},{key:"clearEnteredChannels",value:function(){Te[this._iid]={}}},{key:"createOpenChannelListQuery",value:function(){return new(L.get(this._iid).OpenChannelListQuery)}},{key:"cachedChannels",get:function(){return Re[this._iid]||(Re[this._iid]={}),Re[this._iid]}},{key:"enteredChannels",get:function(){return Te[this._iid]||(Te[this._iid]={}),Te[this._iid]}}]),t}(),we=function(){d(t,ne);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this,n)).messageType=ne.MESSAGE_TYPE_USER,r.message=null,r._sender=null,r.reqId="",r.translations={},r.requestState=null,r.sendingStatus=null,r.requestedMentionUserIds=[],r.errorCode=0,r.messageSurvivalSeconds=-1,n&&r._update(n),r}return l(t,[{key:"_update",value:function(e){var t=bt.getInstance(this._iid),n=L.get(this._iid).Sender;this.message=String(e.message),this._sender=new n(e.user),this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.translations=e.hasOwnProperty("translations")?e.translations:{},this.sendingStatus=0<this.messageId?t.MessageSendingStatus.SUCCEEDED:t.MessageSendingStatus.FAILED,e.hasOwnProperty("sending_status")&&(this.sendingStatus=e.sending_status),this.requestState=0<this.messageId?t.MessageRequestState.SUCCEEDED:t.MessageRequestState.FAILED,e.hasOwnProperty("sending_status")&&(this.requestState=e.sending_status,this.requestState===t.MessageSendingStatus.CANCELED&&(this.requestState=t.MessageRequestState.FAILED)),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code),this.messageSurvivalSeconds=-1,e.hasOwnProperty("message_survival_seconds")&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"isResendable",value:function(){var e=bt.getInstance(this._iid);return this.sendingStatus===e.MessageSendingStatus.FAILED&&H.isResendableError(this.errorCode)}},{key:"sender",get:function(){var e=bt.getInstance(this._iid),t=L.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var n=t.cachedChannels[this.channelUrl];if(n){var r=n.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.profileUrl!==r.profileUrl&&(this._sender.profileUrl=r.profileUrl),H.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}}],[{key:"objectify",value:function(e){var t=bt.getInstance(this._iid),n=L.get(this._iid),r=n.BaseChannel,i=n.BaseMessageParams,s=n.Sender,a=n.User,o=n.ThreadInfo,l=e.messageId,u=e.reqId,c=void 0===u?"":u,d=e.user,h=e.channel,f=e.message,p=e.data,g=void 0===p?"":p,y=e.customType,m=void 0===y?"":y,_=e.mentionType,v=void 0===_?i.MentionType.USERS:_,E=e.mentionedUsers,C=void 0===E?[]:E,b=e.mentionedUserIds,S=void 0===b?[]:b,A=e.requestedMentionUserIds,I=void 0===A?[]:A,U=e.reactions,k=void 0===U?[]:U,N=e.metaArrays,R=void 0===N?[]:N,T=e.rootMessageId,O=void 0===T?0:T,w=e.parentMessageId,M=void 0===w?0:w,P=e.parentMessageText,D=void 0===P?"":P,H=e.threadInfo,F=void 0===H?null:H,G=e.translations,x=void 0===G?{}:G,B=e.sendingStatus,j=e.errorCode,q=void 0===j?0:j,z=e.silent,Y=void 0!==z&&z,Q=e.isGlobalBlocked,K=void 0!==Q&&Q,V=e.messageSurvivalSeconds,W=void 0===V?-1:V,J=e.createdAt,X=e.updatedAt,$=void 0===X?0:X,Z={};for(var ee in Z.req_id=c,Z.msg_id=l,Z.user=s.objectify({user:d,isBlockedByMe:d.isBlockedByMe}),Z.channel_url=h.url,Z.channel_type=h.channelType===r.CHANNEL_TYPE_OPEN?r.CHANNEL_TYPE_OPEN:r.CHANNEL_TYPE_GROUP,Z.message=f,Z.data=g,Z.custom_type=m,Z.translations=x,Z.is_global_block=!!K,Z.ts=J,Z.updated_at=$,Z.mention_type=v,Z.mentioned_users=C.map((function(e){return a.objectify(e)})),Z.mentioned_user_ids=S,Z.requested_mention_user_ids=I,Z.reactions=k.map((function(e){return e.serialize()})),Z.metaarray={},R){var te=R[ee].key;Z.metaarray[te]=R[ee].value}return Z.metaarray_key_order=R.map((function(e){return e.key})),Z.root_message_id=O,Z.parent_message_id=M,Z.parent_message_text=D,F&&(Z.thread_info=o.objectify(F)),Z.sending_status=0<l?t.MessageSendingStatus.SUCCEEDED:t.MessageSendingStatus.FAILED,B&&(Z.sending_status=B),Z.silent=!!Y,Z.error_code=q,Z.message_survival_seconds=W,Z}},{key:"build",value:function(e,t,n,r,i,s,a,o,l,u,c,d,h,f,p,g,y,m,_,v,E,C,b,S){return this.objectify({messageId:t,reqId:e,user:n,channel:r,message:i,data:s,customType:a,mentionType:f,mentionedUsers:p,mentionedUserIds:v,requestedMentionUserIds:C,reactions:h,metaArrays:d,rootMessageId:g,parentMessageId:y,parentMessageText:m,threadInfo:_,translations:o,sendingStatus:E,errorCode:b,isGlobalBlocked:l,messageSurvivalSeconds:S,createdAt:u,updatedAt:c})}},{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid).UserMessage,n=$.deserialize(e);return new t(t.objectify(c(c({},n),{},{channel:{url:n.channelUrl,channelType:n.channelType},user:n.sender})))}}]),t}(),Me=function(){d(t,ne);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this,n)).messageType=ne.MESSAGE_TYPE_FILE,r.url=null,r.name="File",r.size=0,r.type=null,r.data=null,r.thumbnails=[],r._sender=null,r.reqId="",r.requireAuth=null,r.requestState=null,r.sendingStatus=null,r.requestedMentionUserIds=[],r.errorCode=0,r.messageSurvivalSeconds=-1,n&&r._update(n),r}return l(t,[{key:"_update",value:function(e){var t=bt.getInstance(this._iid),n=k.get(this._iid).container.auth,r=L.get(this._iid).Sender;if(this._sender=new r(e.user),this.requireAuth=!!e.hasOwnProperty("require_auth")&&e.require_auth,this.url=this.requireAuth?String(e.url).split("?auth=")[0]+"?auth="+n.eKey:String(e.url).split("?auth=")[0],this.name=e.hasOwnProperty("name")?e.name:"File",this.size=parseInt(e.size)||0,this.type=String(e.type),this.data=e.hasOwnProperty("custom")?String(e.custom):"",this.reqId=e.hasOwnProperty("req_id")?String(e.req_id):"",this.thumbnails=e.hasOwnProperty("thumbnails")?e.thumbnails:[],this.requireAuth)for(var i in this.thumbnails)this.thumbnails[i].url=String(this.thumbnails[i].url).split("?auth=")[0]+"?auth="+n.eKey;this.sendingStatus=0<this.messageId?t.MessageSendingStatus.SUCCEEDED:t.MessageSendingStatus.FAILED,e.hasOwnProperty("sending_status")&&(this.sendingStatus=e.sending_status),this.requestState=0<this.messageId?t.MessageRequestState.SUCCEEDED:t.MessageRequestState.FAILED,e.hasOwnProperty("sending_status")&&(this.requestState=e.sending_status,this.requestState===t.MessageSendingStatus.CANCELED&&(this.requestState=t.MessageRequestState.FAILED)),this.requestedMentionUserIds=[],e.hasOwnProperty("requested_mention_user_ids")&&(this.requestedMentionUserIds=e.requested_mention_user_ids),this.errorCode=0,e.hasOwnProperty("error_code")&&(this.errorCode=e.error_code),this.messageSurvivalSeconds=-1,e.hasOwnProperty("message_survival_seconds")&&(this.messageSurvivalSeconds=e.message_survival_seconds)}},{key:"isResendable",value:function(){var e=bt.getInstance(this._iid);return this.sendingStatus===e.MessageSendingStatus.FAILED&&H.isResendableError(this.errorCode)}},{key:"sender",get:function(){var e=bt.getInstance(this._iid),t=L.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var n=t.cachedChannels[this.channelUrl];if(n){var r=n.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.profileUrl!==r.profileUrl&&(this._sender.profileUrl=r.profileUrl),H.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}}],[{key:"objectify",value:function(e){var t=bt.getInstance(this._iid),n=L.get(this._iid),r=n.BaseChannel,i=n.BaseMessageParams,s=n.Sender,a=n.User,o=n.ThreadInfo,l=e.messageId,u=e.reqId,c=void 0===u?"":u,d=e.user,h=void 0===d?{}:d,f=e.channel,p=e.url,g=e.name,y=e.type,m=e.size,_=void 0===m?0:m,v=e.data,E=void 0===v?"":v,C=e.customType,b=void 0===C?"":C,S=e.mentionType,A=void 0===S?i.MentionType.USERS:S,I=e.mentionedUsers,U=void 0===I?[]:I,k=e.mentionedUserIds,N=void 0===k?[]:k,R=e.requestedMentionUserIds,T=void 0===R?[]:R,O=e.reactions,w=void 0===O?[]:O,M=e.metaArrays,P=void 0===M?[]:M,D=e.rootMessageId,H=void 0===D?0:D,F=e.parentMessageId,G=void 0===F?0:F,x=e.parentMessageText,B=void 0===x?"":x,j=e.threadInfo,q=void 0===j?null:j,z=e.thumbnails,Y=void 0===z?[]:z,Q=e.requireAuth,K=void 0!==Q&&Q,V=e.sendingStatus,W=e.errorCode,J=void 0===W?0:W,X=e.silent,$=void 0!==X&&X,Z=e.isGlobalBlocked,ee=void 0!==Z&&Z,te=e.messageSurvivalSeconds,ne=void 0===te?-1:te,re=e.createdAt,ie=e.updatedAt,se=void 0===ie?0:ie,ae={};ae.req_id=c,ae.msg_id=l,ae.user=s.objectify({user:h,isBlockedByMe:h.isBlockedByMe}),ae.channel_url=f.url,ae.channel_type=f.channelType===r.CHANNEL_TYPE_OPEN?r.CHANNEL_TYPE_OPEN:r.CHANNEL_TYPE_GROUP,ae.url=p,ae.name=g,ae.type=y,ae.size=_,ae.custom=E,ae.custom_type=b,ae.thumbnails=Y,ae.require_auth=K,ae.is_global_block=!!ee,ae.ts=re,ae.updated_at=se,ae.mention_type=A,ae.mentioned_users=U.map((function(e){return a.objectify(e)})),ae.mentioned_user_ids=N,ae.requested_mention_user_ids=T,ae.reactions=w.map((function(e){return e.serialize()})),ae.metaarray={};for(var oe=0;oe<P.length;oe++){var le=P[oe].key;ae.metaarray[le]=P[oe].value}return ae.metaarray_key_order=P.map((function(e){return e.key})),ae.root_message_id=H,ae.parent_message_id=G,ae.parent_message_text=B,q&&(ae.thread_info=o.objectify(q)),ae.sending_status=0<l?t.MessageSendingStatus.SUCCEEDED:t.MessageSendingStatus.FAILED,V&&(ae.sending_status=V),ae.silent=!!$,ae.error_code=J,ae.message_survival_seconds=ne,ae}},{key:"build",value:function(e,t,n,r,i,s,a,o,l,u,c,d,h,f,p,g,y,m,_,v,E,C,b,S,A,I,U,k){return this.objectify({messageId:t,reqId:e,user:n,channel:r,url:i,name:s,type:a,size:o,data:l,customType:u,mentionType:m,mentionedUsers:_,mentionedUserIds:S,requestedMentionUserIds:I,reactions:y,metaArrays:g,rootMessageId:v,parentMessageId:E,parentMessageText:C,threadInfo:b,thumbnails:h,requireAuth:f,sendingStatus:A,errorCode:U,isGlobalBlocked:c,messageSurvivalSeconds:k,createdAt:d,updatedAt:p})}},{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid).FileMessage,n=$.deserialize(e);return new t(t.objectify(c(c({},n),{},{channel:{url:n.channelUrl,channelType:n.channelType},user:n.sender})))}}]),t}(),Le=function(){d(t,ne);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this,n)).messageType=ne.MESSAGE_TYPE_ADMIN,r.message="",r.translations={},n&&r._update(n),r}return l(t,[{key:"_update",value:function(e){this.message=String(e.message),this.translations=e.hasOwnProperty("translations")?e.translations:{}}}],[{key:"objectify",value:function(e){var t=L.get(this._iid),n=t.BaseChannel,r=t.BaseMessageParams,i=t.User,s=t.ThreadInfo,a=e.messageId,o=e.channel,l=e.message,u=e.data,c=void 0===u?"":u,d=e.customType,h=void 0===d?"":d,f=e.mentionType,p=void 0===f?r.MentionType.USERS:f,g=e.mentionedUsers,y=void 0===g?[]:g,m=e.reactions,_=void 0===m?[]:m,v=e.metaArrays,E=void 0===v?[]:v,C=e.rootMessageId,b=void 0===C?0:C,S=e.parentMessageId,A=void 0===S?0:S,I=e.parentMessageText,U=void 0===I?"":I,k=e.threadInfo,N=void 0===k?null:k,R=e.translations,T=void 0===R?{}:R,O=e.silent,w=void 0!==O&&O,M=e.createdAt,P=e.updatedAt,D=void 0===P?0:P,H={msg_id:a,channel_url:o.url,channel_type:o.channelType===n.CHANNEL_TYPE_OPEN?n.CHANNEL_TYPE_OPEN:n.CHANNEL_TYPE_GROUP,message:l,data:c,custom_type:h,silent:w,ts:M,updated_at:D};H.translations=T,H.mention_type=p,H.mentioned_users=y.map((function(e){return i.objectify(e)})),H.reactions=_.map((function(e){return e.serialize()})),H.metaarray={};for(var F=0;F<E.length;F++){var G=E[F].key;H.metaarray[G]=E[F].value}return H.metaarray_key_order=E.map((function(e){return e.key})),H.root_message_id=b,H.parent_message_id=A,H.parent_message_text=U,N&&(H.thread_info=s.objectify(N)),H}},{key:"build",value:function(e,t,n,r,i,s,a,o,l,u,c,d,h,f,p,g){return this.objectify({messageId:e,channel:t,message:n,data:r,customType:i,mentionType:c,mentionedUsers:d,reactions:u,metaArrays:l,rootMessageId:h,parentMessageId:f,parentMessageText:p,threadInfo:g,translations:s,createdAt:a,updatedAt:o})}},{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid).AdminMessage,n=$.deserialize(e);return new t(t.objectify(c(c({},n),{},{channel:{url:n.channelUrl,channelType:n.channelType}})))}}]),t}(),Pe=function(){function e(t){a(this,e);var n=L.get(this._iid),r=n.BaseMessage,i=n.BaseMessageParams;this.scheduledId=0,this.scheduledDateTimeString="",this.scheduledTimezone="",this.status=e.Status.SCHEDULED,this.createdAt=0,this.updatedAt=0,this._messageType=r.MESSAGE_TYPE_BASE,this._sender=null,this._channelType="",this.channelUrl="",this.message="",this.customType="",this.data="",this.metaArrays=[],this.mentionType=i.MentionType.USERS,this.mentionedUsers=[],this.pushNotificationDeliveryOption=i.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=[],this.errorMessage="",this.errorCode=0,t&&this._update(t)}return l(e,[{key:"_update",value:function(t){var n=this,r=L.get(this._iid),i=r.User,s=r.Sender,a=r.BaseMessageParams,o=r.MessageMetaArray;this.scheduledId=t.hasOwnProperty("scheduled_id")?parseInt(t.scheduled_id):0,this.scheduledDateTimeString=t.hasOwnProperty("scheduled_dt")?String(t.scheduled_dt):"",this.scheduledTimezone=t.hasOwnProperty("scheduled_timezone")?String(t.scheduled_timezone):"",this.status=t.hasOwnProperty("status")?String(t.status):"",this.createdAt=t.hasOwnProperty("created_at")?parseInt(t.created_at):0,this.updatedAt=t.hasOwnProperty("updated_at")?parseInt(t.updated_at):0,this.channelUrl=t.hasOwnProperty("channel_url")?String(t.channel_url):"",this._channelType=t.hasOwnProperty("channel_type")?String(t.channel_type):"",this._messageType=t.hasOwnProperty("type")?String(t.type):"",this._sender=t.hasOwnProperty("user")?new s(t.user):"",this.message=t.hasOwnProperty("message")?String(t.message):"",this.customType=t.hasOwnProperty("custom_type")?String(t.custom_type):"",this.data=t.hasOwnProperty("data")?String(t.data):"";var l=t.hasOwnProperty("metaarray")?t.metaarray:{},u=t.hasOwnProperty("metaarray_key_order")?t.metaarray_key_order:Object.keys(l).sort((function(e,t){return e.localeCompare(t)}));this.metaArrays=[];for(var c=0;c<u.length;c++){var d=u[c];this.metaArrays.push(new o(d,l[d]||[]))}this.mentionType=t.hasOwnProperty("mention_type")?t.mention_type:a.MentionType.USERS,this.mentionedUsers=[],t.hasOwnProperty("mentioned_users")&&t.mentioned_users.forEach((function(e){var t=new i(e);n.mentionedUsers.push(t)})),this.pushNotificationDeliveryOption=t.hasOwnProperty("push_option")?t.push_option:a.PushNotificationDeliveryOption.DEFAULT,this.translationTargetLanguages=t.hasOwnProperty("translation_target_langs")?t.translation_target_langs:[],this.status===e.Status.FAILED&&(t.hasOwnProperty("error")&&t.error.hasOwnProperty("message")&&(this.errorMessage=String(t.error.message)),t.hasOwnProperty("error")&&t.error.hasOwnProperty("code")&&(this.errorCode=parseInt(t.error.code)))}},{key:"isOpenChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_OPEN}},{key:"isGroupChannel",value:function(){var e=L.get(this._iid).BaseChannel;return this._channelType===e.CHANNEL_TYPE_GROUP}},{key:"sender",get:function(){var e=bt.getInstance(this._iid),t=L.get(this._iid).GroupChannel;if(e.Options.useMemberAsMessageSender&&this.isGroupChannel()){var n=t.cachedChannels[this.channelUrl];if(n){var r=n.memberMap[this._sender.userId];r&&(this._sender.nickname!==r.nickname&&(this._sender.nickname=r.nickname),this._sender.profileUrl!==r.profileUrl&&(this._sender.profileUrl=r.profileUrl),H.deepEqual(this._sender.metaData,r.metaData)||(this._sender.metaData=r.metaData))}}return this._sender},set:function(e){this._sender=e}},{key:"metaArray",get:function(){var e={};return this.metaArrays.forEach((function(t){e[t.key]=t.value})),e},set:function(e){if("object"===s(e)&&e){var t=L.get(this._iid).MessageMetaArray,n=[];for(var r in e)n.push(new t(r,e[r]));this.metaArrays=n}}}],[{key:"Status",get:function(){return{SCHEDULED:"scheduled",SENT:"sent",CANCELED:"canceled",FAILED:"failed"}}}]),e}(),De=function(){function e(t){a(this,e),this.replyCount=0,this.mostRepliedUsers=[],this.lastRepliedAt=0,this.updatedAt=0,t&&this._update(t)}return l(e,[{key:"_update",value:function(e){var t=L.get(this._iid).User;e.hasOwnProperty("reply_count")&&(this.replyCount=parseInt(e.reply_count)),e.hasOwnProperty("most_replies")&&Array.isArray(e.most_replies)&&e.most_replies.every((function(e){return"object"===s(e)}))&&(this.mostRepliedUsers=e.most_replies.map((function(e){return new t(e)}))),e.hasOwnProperty("last_replied_at")&&(this.lastRepliedAt=parseInt(e.last_replied_at)),e.hasOwnProperty("updated_at")&&(this.updatedAt=parseInt(e.updated_at))}}],[{key:"objectify",value:function(e){var t=L.get(this._iid).User,n=e.replyCount,r=e.mostRepliedUsers,i=e.lastRepliedAt,s=e.updatedAt,a={};return a.reply_count=n,Array.isArray(r)&&r.every((function(e){return e instanceof t}))&&(a.most_replies=r.map((function(e){return t.objectify(e)}))),a.last_replied_at=i,a.updated_at=s,a}},{key:"build",value:function(e,t,n,r){return this.objectify({replyCount:e,mostRepliedUsers:t,lastRepliedAt:n,updatedAt:r})}}]),e}(),He=function(){function e(){a(this,e),this.threadInfo=null,this.targetMessageId=0,this.channelUrl=null,this.channelType=null}return l(e,null,[{key:"createFromJson",value:function(e){var t=L.get(this._iid),n=t.BaseChannel,r=t.ThreadInfo,i=e.thread_info,a=e.root_message_id,o=e.channel_url,l=e.channel_type;if(!i||"object"!==s(i)||"string"!=typeof a&&"number"!=typeof a||"string"!=typeof o||"string"!=typeof l||![n.CHANNEL_TYPE_GROUP].includes(l))return null;var u=new this;return u.threadInfo=new r(i),u.targetMessageId=parseInt(a),u.channelUrl=o,u.channelType=l,u}}]),e}(),Fe=function(){function e(){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this.metaDataKeyFilter="",this.metaDataValuesFilter=[],this._token=""}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){"number"==typeof t.limit&&0<t.limit&&Array.isArray(t.userIdsFilter)&&"string"==typeof t.metaDataKeyFilter&&Array.isArray(t.metaDataValuesFilter)&&!!t.metaDataKeyFilter==0<t.metaDataValuesFilter.length?t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadUserList(c(c({},t),{},{token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.users.map((function(e){return new s(e)}))}t.isLoading=!1,e(n,i)}))):e(null,[]):e(z.error,null)}),e)}}]),e}(),Ge=function(){function e(t){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._isOpenChannel=!1,this._channelUrl=null,this._token="",t.channelUrl&&(this._channelUrl=t.channelUrl),t.isOpenChannel&&(this._isOpenChannel=t.isOpenChannel)}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){"number"==typeof t.limit&&0<t.limit?t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadBannedUserList(c(c({},t),{},{channelUrl:t._channelUrl,isOpenChannel:t._isOpenChannel,token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.banned_list.map((function(e){return new s(e.user)}))}t.isLoading=!1,e(n,i)}))):e(null,[]):e(z.error,null)}),e)}}]),e}(),xe=function(){function e(){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIdsFilter=[],this._token=""}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){"number"==typeof t.limit&&0<t.limit&&Array.isArray(t.userIdsFilter)?t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadBlockedUserList(c(c({},t),{},{token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.users.map((function(e){return new s(e)}))}t.isLoading=!1,e(n,i)}))):e(null,[]):e(z.error,null)}),e)}}]),e}(),Be=function(){function e(){a(this,e),this.isLoading=!1,this.hasMore=!0,this.limit=20,this._token=""}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){"number"==typeof t.limit&&0<t.limit?t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasMore?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadFriendList(c(c({},t),{},{token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasMore=!!a,i=r.users.map((function(e){return new s(e)}))}t.isLoading=!1,e(n,i)}))):e(null,[]):e(z.error,null)}),e)}}]),e}(),je=function(){function e(){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=e.ORDER_LATEST_LAST_MESSAGE,this._token="",this._searchFilter={},this._userIdsFilter={userIds:[],includeMode:!0,queryType:e.QueryType.AND},this._userIdsExactFilter=[],this._userIdsIncludeFilter=[],this._userIdsIncludeFilterQueryType=e.QueryType.AND,this.nicknameContainsFilter="",this.channelNameContainsFilter="",this.memberStateFilter=Se.MemberStateFilter.ALL,this.customTypesFilter=[],this.channelUrlsFilter=[],this.superChannelFilter=Se.SuperChannelFilter.ALL,this.publicChannelFilter=Se.PublicChannelFilter.ALL,this.customTypeStartsWithFilter=null,this.unreadChannelFilter=Se.UnreadChannelFilter.ALL,this.metadataOrderKeyFilter=null,this.hiddenChannelFilter=Se.HiddenChannelFilter.UNHIDDEN,this.includeFrozen=!0}return l(e,[{key:"setSearchFilter",value:function(e,t){Array.isArray(e)&&0!==e.length&&"string"==typeof t&&t&&(this._searchFilter={search_query:t,search_fields:e.join(",").toLocaleLowerCase()})}},{key:"serialize",value:function(){return $.serialize(this,(function(e){e.isLoading=!1}))}},{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){var n=L.get(t._iid),r=n.GroupChannel,i=n.GroupChannelListQuery;!("number"==typeof t.limit&&0<t.limit&&"boolean"==typeof t.includeEmpty&&"string"==typeof t.order&&-1<[i.ORDER_CHRONOLOGICAL,i.ORDER_LATEST_LAST_MESSAGE,i.CHANNEL_NAME_ALPHABETICAL,i.METADATA_VALUE_ALPHABETICAL].indexOf(t.order.toLowerCase())&&Array.isArray(t._userIdsExactFilter)&&Array.isArray(t._userIdsIncludeFilter)&&Array.isArray(t.customTypesFilter)&&Array.isArray(t.channelUrlsFilter)&&-1<Object.keys(i.QueryType).map((function(e){return i.QueryType[e]})).indexOf(t._userIdsIncludeFilterQueryType.toUpperCase())&&-1<Object.keys(r.MemberStateFilter).map((function(e){return r.MemberStateFilter[e]})).indexOf(t.memberStateFilter)&&-1<Object.keys(r.SuperChannelFilter).map((function(e){return r.SuperChannelFilter[e]})).indexOf(t.superChannelFilter)&&-1<Object.keys(r.PublicChannelFilter).map((function(e){return r.PublicChannelFilter[e]})).indexOf(t.publicChannelFilter)&&-1<Object.keys(r.UnreadChannelFilter).map((function(e){return r.UnreadChannelFilter[e]})).indexOf(t.unreadChannelFilter)&&-1<Object.keys(r.HiddenChannelFilter).map((function(e){return r.HiddenChannelFilter[e]})).indexOf(t.hiddenChannelFilter))||"string"!=typeof t.customTypeStartsWithFilter&&null!==t.customTypeStartsWithFilter||"string"!=typeof t.nicknameContainsFilter||"string"!=typeof t.channelNameContainsFilter||"string"!=typeof t.metadataOrderKeyFilter&&null!==t.metadataOrderKeyFilter||"boolean"!=typeof t.includeFrozen?e(z.error,null):t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadGroupChannelList(c(c({},t),{},{token:t._token,userIdsFilter:t._userIdsFilter,searchFilter:t._searchFilter}),(function(n,i){if(n)return t.isLoading=!1,void e(n,null);var s=[],a=String(i.next);t._token=a,t.hasNext=!!a;for(var o=i.channels,l=0;l<o.length;l++){var u=r.upsert(o[l]);s.push(u)}t.isLoading=!1,e(n,s)}))):e(null,[])}),e)}},{key:"userIdsExactFilter",get:function(){return this._userIdsExactFilter},set:function(e){Array.isArray(e)&&(this._userIdsExactFilter=e,this._userIdsIncludeFilter=[],this._userIdsFilter.userIds=this._userIdsExactFilter,this._userIdsFilter.includeMode=!1)}},{key:"userIdsIncludeFilter",get:function(){return this._userIdsIncludeFilter},set:function(e){Array.isArray(e)&&(this._userIdsIncludeFilter=e,this._userIdsExactFilter=[],this._userIdsFilter.userIds=this._userIdsIncludeFilter,this._userIdsFilter.includeMode=!0)}},{key:"userIdsIncludeFilterQueryType",get:function(){return this._userIdsIncludeFilterQueryType},set:function(t){-1<Object.keys(e.QueryType).map((function(t){return e.QueryType[t]})).indexOf(t)&&(this._userIdsIncludeFilterQueryType=t.toUpperCase(),this._userIdsFilter.queryType=this._userIdsIncludeFilterQueryType)}}],[{key:"buildFromSerializedData",value:function(e){var t=L.get(this._iid).GroupChannel,n=$.deserialize(e),r=t.createMyGroupChannelListQuery();for(var i in n)r.hasOwnProperty(i)&&(r[i]=n[i]);return r}},{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}},{key:"QueryType",get:function(){return{AND:"AND",OR:"OR"}}},{key:"SearchField",get:function(){return{MEMBER_NICKNAME:"member_nickname",CHANNEL_NAME:"channel_name"}}}]),e}(),qe=function(){function e(t){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.mutedMemberFilter=e.MutedMemberFilter.ALL,this.memberStateFilter=Se.MemberStateFilter.ALL,this.nicknameStartsWithFilter=null,this._token="",this._channelUrl=t}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){var n=L.get(t._iid),r=n.GroupChannel,i=n.Member,s=n.MemberListQuery;if("number"==typeof t.limit&&0<t.limit&&-1<Object.keys(s.MutedMemberFilter).map((function(e){return s.MutedMemberFilter[e]})).indexOf(t.mutedMemberFilter)&&-1<Object.keys(r.MemberStateFilter).map((function(e){return r.MemberStateFilter[e]})).indexOf(t.memberStateFilter)&&("string"==typeof t.nicknameStartsWithFilter||null===t.nicknameStartsWithFilter))if(t.isLoading)e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null);else if(t.hasNext){t.isLoading=!0;var a=s.Order.MEMBER_NICKNAME_ALPHABETICAL;k.get(t._iid).container.apiClient.loadMemberList(c(c({},t),{},{channelUrl:t._channelUrl,order:a,token:t._token}),(function(n,r){var s=null;if(!n){var a=String(r.next);t._token=a,t.hasNext=!!a,s=r.members.map((function(e){return new i(e)}))}t.isLoading=!1,e(n,s)}))}else e(null,[]);else e(z.error,null)}),e)}}],[{key:"MutedMemberFilter",get:function(){return{ALL:"all",MUTED:"muted",UNMUTED:"unmuted"}}},{key:"Order",get:function(){return{MEMBER_NICKNAME_ALPHABETICAL:"member_nickname_alphabetical"}}}]),e}(),ze=function(){function e(t){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",t.channelUrl&&(this._channelUrl=t.channelUrl),t.isOpenChannel&&(this._isOpenChannel=t.isOpenChannel)}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){"number"==typeof t.limit&&0<t.limit?t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadMutedUserList(c(c({},t),{},{channelUrl:t._channelUrl,isOpenChannel:t._isOpenChannel,token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.muted_list.map((function(e){return new s(e)}))}t.isLoading=!1,e(n,i)}))):e(null,[]):e(z.error,null)}),e)}}]),e}(),Ye=function(){function e(){a(this,e),this.limit=20,this.isLoading=!1,this.hasNext=!0,this.nameKeyword=null,this.urlKeyword=null,this.customTypes=[],this.includeFrozen=!0}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){!("number"==typeof t.limit&&0<t.limit&&Array.isArray(t.customTypes))||"string"!=typeof t.nameKeyword&&null!==t.nameKeyword||"string"!=typeof t.urlKeyword&&null!==t.urlKeyword||"boolean"!=typeof t.includeFrozen?e(z.error,null):t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadOpenChannelList(c(c({},t),{},{token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).OpenChannel,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.channels.map((function(e){return s.upsert(e)}))}t.isLoading=!1,e(n,i)}))):e(null,[])}),e)}}]),e}(),Qe=new WeakMap,Ke=function(){function e(t){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",Qe.set(this,t)}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){if("number"==typeof t.limit&&0<t.limit)if(t.isLoading)e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null);else if(t.hasNext){t.isLoading=!0;var n=Qe.get(t);k.get(t._iid).container.apiClient.loadOperatorList(c(c({},t),{},{token:t._token,channelUrl:n.url,isOpenChannel:n.isOpenChannel()}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.operators.map((function(e){return new s(e)}))}t.isLoading=!1,e(n,i)}))}else e(null,[]);else e(z.error,null)}),e)}}]),e}(),Ve=new WeakMap,We=function(){function e(t){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this._token="",t&&Ve.set(this,t.channelUrl)}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){"number"==typeof t.limit&&0<t.limit?t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadParticipantList(c(c({},t),{},{channelUrl:Ve.get(t),token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.participants.map((function(e){return new s(e)}))}t.isLoading=!1,e(n,i)}))):e(null,[]):e(z.error,null)}),e)}}]),e}(),Je=new WeakMap,Xe=function(){function e(t,n){var r=n.limit,i=void 0===r?20:r,s=n.reverse,o=void 0!==s&&s,l=n.exactMatch,u=void 0!==l&&l,c=n.channelUrl,d=void 0===c?"":c,h=n.channelCustomType,f=void 0===h?"":h,p=n.messageTimestampFrom,g=void 0===p?null:p,y=n.messageTimestampTo,m=void 0===y?null:y,_=n.order,v=void 0===_?"score":_;a(this,e),this.isLoading=!1,this.hasNext=!0,Je.set(this,{keyword:t,limit:i,reverse:o,exactMatch:u,channelUrl:d,channelCustomType:f,messageTimestampFrom:g,messageTimestampTo:m,order:v,previousToken:"",nextToken:""})}return l(e,[{key:"next",value:function(e){var t=this,n=L.get(this._iid),r=n.BaseChannel,i=n.GroupChannel,s=n.OpenChannel;return Z(this._iid,(function(e){var n=Je.get(t),a=n.keyword,o=n.limit,l=n.reverse,u=n.exactMatch,c=n.channelUrl,d=n.channelCustomType,h=n.messageTimestampFrom,f=n.messageTimestampTo,p=n.order,g=n.nextToken;!("number"==typeof o&&0<o&&o<=1e3&&"boolean"==typeof l&&"boolean"==typeof u)||"string"!=typeof c&&null!==c||"string"!=typeof d&&null!==d||"number"!=typeof h&&null!==h||"number"!=typeof f&&null!==f||!(0<=["score","ts"].indexOf(p))?e(z.error,null):t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.searchMessages({keyword:a,limit:o,reverse:l,exactMatch:u,channelUrl:c,channelCustomType:d,messageTimestampFrom:h,messageTimestampTo:f,order:p,nextToken:g},(function(n,a){var o=null;if(!n){for(var l in o=[],a.results){var u=a.results[l],c=null;u.channel.hasOwnProperty("members")?(c=new i(u.channel),i.cachedChannels[c.url]=c):(c=new s(u.channel),s.cachedChannels[c.url]=c),o.push(r.buildMessage(u,c))}t.hasNext=a.has_next,Je.get(t).nextToken=a.end_cursor}t.isLoading=!1,e(n,o)}))):e(null,[])}),e)}},{key:"key",get:function(){return Je.get(this).keyword}},{key:"limit",get:function(){return Je.get(this).limit}},{key:"reverse",get:function(){return Je.get(this).reverse}},{key:"exactMatch",get:function(){return Je.get(this).exactMatch}},{key:"channelUrl",get:function(){return Je.get(this).channelUrl}},{key:"channelCustomType",get:function(){return Je.get(this).channelCustomType}},{key:"messageTimestampFrom",get:function(){return Je.get(this).messageTimestampFrom}},{key:"messageTimestampTo",get:function(){return Je.get(this).messageTimestampTo}},{key:"order",get:function(){return Je.get(this).order}}]),e}(),$e=new WeakMap,Ze=new WeakMap,et=function(){function e(t){a(this,e),this.isLoading=!1,this.hasMore=!0,this.limit=20,Ze.set(this,Number.MAX_SAFE_INTEGER),$e.set(this,t),this.reverse=!1,this.messageTypeFilter=null,this.customTypeFilter=null,this.senderUserIdsFilter=[],this.includeMetaArray=!1,this.includeReaction=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return l(e,[{key:"load",value:function(e,t,n,r){var i=this,s=L.get(this._iid).BaseChannel,a=null,o=E(z.parse(arguments,[new z({type:"number",optional:!0,defaultValue:this.limit}),new z({type:"boolean",optional:!0,defaultValue:this.reverse}),new z({type:["string","number"],optional:!0,defaultValue:this.messageTypeFilter,constraint:function(e){return-1<Object.keys(s.MessageTypeFilter).map((function(e){return s.MessageTypeFilter[e]})).indexOf(e)||-1<[0,1,2,3].indexOf(e)}}),new z({type:"callback"})]),5);return a=o[0],e=o[1],t=o[2],n=o[3],r=o[4],Z(this._iid,(function(r){if(Array.isArray(i.senderUserIdsFilter)&&!i.senderUserIdsFilter.some((function(e){return"string"!=typeof e}))||(a=z.error),a)r(a,null);else{if(i.limit=e,i.reverse=t,i.messageTypeFilter=n,"number"==typeof i.messageTypeFilter)switch(i.messageTypeFilter){case 0:i.messageTypeFilter=s.MessageTypeFilter.ALL;break;case 1:i.messageTypeFilter=s.MessageTypeFilter.USER;break;case 2:i.messageTypeFilter=s.MessageTypeFilter.FILE;break;case 3:i.messageTypeFilter=s.MessageTypeFilter.ADMIN}if(i.isLoading)r(new N("Query in progress.",N.QUERY_IN_PROGRESS),null);else if(i.hasMore){i.isLoading=!0;var o=$e.get(i);k.get(i._iid).container.apiClient.getMessageList({channel:o,token:Ze.get(i)||(new Date).getTime()+1e4,tokenType:"timestamp",isInclusive:!1,prevResultSize:e,nextResultSize:0,shouldReverse:t,messageType:n,customType:i.customTypeFilter,senderUserIds:i.senderUserIdsFilter,includeMetaArray:i.includeMetaArray,includeReaction:i.includeReaction,includeReplies:i.includeReplies,includeParentMessageText:i.includeParentMessageText,includeThreadInfo:i.includeThreadInfo},(function(t,n){var a=null;if(!t){(0===(a=n.messages.map((function(e){return s.buildMessage(e,o)}))).length||a.length<e)&&(i.hasMore=!1);var l=Ze.get(i);Ze.set(i,Math.min.apply(Math,C(a.map((function(e){return e.createdAt}))).concat([l])))}i.isLoading=!1,r(t,a)}))}else r(null,[])}}),r)}}]),e}(),tt=function(){function e(){a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.includeEmpty=!1,this.order=je.ORDER_LATEST_LAST_MESSAGE,this._token="",this.channelNameContainsFilter="",this.channelUrlsFilter=[],this.customTypesFilter=[],this.customTypeStartsWithFilter=null,this.superChannelFilter=Se.SuperChannelFilter.ALL,this.membershipFilter=e.MembershipType.JOINED,this.metadataOrderKeyFilter=null,this.includeFrozen=!0}return l(e,[{key:"next",value:function(t){var n=this;return Z(this._iid,(function(t){var r=L.get(n._iid).GroupChannel;!("number"==typeof n.limit&&0<n.limit&&"boolean"==typeof n.includeEmpty&&"string"==typeof n.order&&-1<[e.ORDER_CHRONOLOGICAL,e.CHANNEL_NAME_ALPHABETICAL,e.METADATA_VALUE_ALPHABETICAL,e.ORDER_LATEST_LAST_MESSAGE].indexOf(n.order.toLowerCase())&&Array.isArray(n.customTypesFilter)&&Array.isArray(n.channelUrlsFilter)&&-1<Object.keys(e.MembershipType).map((function(t){return e.MembershipType[t]})).indexOf(n.membershipFilter)&&-1<Object.keys(r.SuperChannelFilter).map((function(e){return r.SuperChannelFilter[e]})).indexOf(n.superChannelFilter))||"string"!=typeof n.customTypeStartsWithFilter&&null!==n.customTypeStartsWithFilter||"string"!=typeof n.channelNameContainsFilter||"string"!=typeof n.metadataOrderKeyFilter&&null!==n.metadataOrderKeyFilter||"boolean"!=typeof n.includeFrozen?t(z.error,null):n.isLoading?t(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):n.hasNext?(n.isLoading=!0,k.get(n._iid).container.apiClient.loadPublicGroupChannelList(c(c({},n),{},{token:n._token}),(function(e,i){var s=null;if(!e){var a=String(i.next);n._token=a,n.hasNext=!!a,s=i.channels.map((function(e){return r.upsert(e)}))}n.isLoading=!1,t(e,s)}))):t(null,[])}),t)}}],[{key:"MembershipType",get:function(){return{ALL:"all",JOINED:"joined"}}},{key:"ORDER_LATEST_LAST_MESSAGE",get:function(){return"latest_last_message"}},{key:"ORDER_CHRONOLOGICAL",get:function(){return"chronological"}},{key:"CHANNEL_NAME_ALPHABETICAL",get:function(){return"channel_name_alphabetical"}},{key:"METADATA_VALUE_ALPHABETICAL",get:function(){return"metadata_value_alphabetical"}}]),e}(),nt=function(){function e(){a(this,e),this.isDistinct=null,this.isSuper=null,this.isBroadcast=null,this.isPublic=null,this.channelUrl=null,this.isEphemeral=null,this.isDiscoverable=null,this.isStrict=null,this.name=null,this.data=null,this.customType=null,this.channelCover=null,this.coverUrl=null,this.coverImage=null,this.accessCode=null,this.messageSurvivalSeconds=null,this._invitedUserIds=[];var t=null;Object.defineProperty(this,"operators",{set:function(e){Array.isArray(e)&&e.filter((function(e){return e.hasOwnProperty("userId")})).length===e.length&&(t=e.map((function(e){return e.userId})))}}),Object.defineProperty(this,"operatorUserIds",{get:function(){return t},set:function(e){Array.isArray(e)&&e.filter((function(e){return"string"==typeof e})).length===e.length&&(t=e)}})}return l(e,[{key:"_validate",value:function(){return Array.isArray(this._invitedUserIds)&&this._invitedUserIds.every((function(e){return"string"==typeof e}))&&("string"==typeof this.channelUrl||null===this.channelUrl)&&("string"==typeof this.coverUrl||null===this.coverUrl)&&(H.isFile(this.coverImage)||null===this.coverImage)&&("string"==typeof this.name||null===this.name)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&("boolean"==typeof this.isDistinct||null===this.isDistinct)&&("boolean"==typeof this.isSuper||null===this.isSuper)&&("boolean"==typeof this.isBroadcast||null===this.isBroadcast)&&("boolean"==typeof this.isPublic||null===this.isPublic)&&("boolean"==typeof this.isEphemeral||null===this.isEphemeral)&&("boolean"==typeof this.isDiscoverable||null===this.isDiscoverable)&&("boolean"==typeof this.isStrict||null===this.isStrict)&&(Array.isArray(this.operatorUserIds)&&this.operatorUserIds.every((function(e){return"string"==typeof e}))||null===this.operatorUserIds)&&("string"==typeof this.accessCode||null===this.accessCode)&&("number"==typeof this.messageSurvivalSeconds||null===this.messageSurvivalSeconds)}},{key:"addUsers",value:function(e){if(Array.isArray(e)){var t,n=e.filter((function(e){return e.hasOwnProperty("userId")&&"string"==typeof e.userId})).map((function(e){return e.userId}));(t=this._invitedUserIds).push.apply(t,C(n))}}},{key:"addUser",value:function(e){e.hasOwnProperty("userId")&&"string"==typeof e.userId&&this._invitedUserIds.push(e.userId)}},{key:"addUserIds",value:function(e){if(Array.isArray(e)){var t,n=e.filter((function(e){return"string"==typeof e}));(t=this._invitedUserIds).push.apply(t,C(n))}}},{key:"addUserId",value:function(e){"string"==typeof e&&this._invitedUserIds.push(e)}}]),e}(),rt=new WeakMap,it=function(){function e(){a(this,e),this._mentionType=e.MentionType.USERS,this._mentionedUserIds=[],this._cachedMentionedUsers=[],this._cachedMentionedUserIds=[],this._metaArrays=[],rt.set(this,null),this._parentMessageId=null}return l(e,[{key:"_validate",value:function(){var e=L.get(this._iid),t=e.BaseMessageParams,n=e.MessageMetaArray,r=rt.get(this);return-1<Object.keys(t.MentionType).map((function(e){return t.MentionType[e]})).indexOf(this.mentionType)&&this._mentionedUserIds.every((function(e){return"string"==typeof e}))&&Array.isArray(this._metaArrays)&&this._metaArrays.every((function(e){return e instanceof n}))&&("number"==typeof r||null===r)&&("number"==typeof this._parentMessageId||null===this._parentMessageId)}},{key:"mentionType",get:function(){return this._mentionType},set:function(e){var t=L.get(this._iid).BaseMessageParams;-1<Object.keys(t.MentionType).map((function(e){return t.MentionType[e]})).indexOf(e)&&(this._mentionType=e)}},{key:"mentionedUserIds",get:function(){return this._cachedMentionedUserIds},set:function(e){if(Array.isArray(e))for(var t=bt.getInstance(this._iid),n=0;n<e.length;n++){var r=e[n];if("string"!=typeof r){this._cachedMentionedUserIds=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r)<0&&t.currentUser&&t.currentUser.userId!==r&&(this._cachedMentionedUserIds.push(r),this._mentionedUserIds.push(r))}}},{key:"mentionedUsers",get:function(){return this._cachedMentionedUsers},set:function(e){if(Array.isArray(e))for(var t=bt.getInstance(this._iid),n=0;n<e.length;n++){var r=e[n];if(!r.hasOwnProperty("userId")){this._cachedMentionedUsers=[],this._mentionedUserIds=[];break}this._mentionedUserIds.indexOf(r.userId)<0&&t.currentUser&&t.currentUser.userId!==r.userId&&(this._cachedMentionedUsers.push(r),this._mentionedUserIds.push(r.userId))}}},{key:"metaArrayKeys",get:function(){return this._metaArrays.map((function(e){return e.key}))},set:function(e){var t=L.get(this._iid).MessageMetaArray,n={};if(Array.isArray(e)){this._metaArrays=[];for(var r=0;r<e.length;r++)"string"!=typeof e[r]||n[e[r]]||(n[e[r]]=!0,this._metaArrays.push(new t(e[r])))}}},{key:"metaArrays",get:function(){return this._metaArrays},set:function(e){var t=L.get(this._iid).MessageMetaArray;if(Array.isArray(e)){this._metaArrays=[];for(var n=0;n<e.length;n++){var r=e[n];if(r instanceof t){var i,s=this._metaArrays.map((function(e){return e.key})).indexOf(r.key);s<0?this._metaArrays.push(r):(i=this._metaArrays[s].value).push.apply(i,C(r.value))}}}}},{key:"rootMessageId",get:function(){return rt.get(this)}},{key:"parentMessageId",get:function(){return this._parentMessageId},set:function(e){rt.set(this,e),this._parentMessageId=e}}],[{key:"MentionType",get:function(){return{USERS:"users",CHANNEL:"channel"}}},{key:"PushNotificationDeliveryOption",get:function(){return{DEFAULT:"default",SUPPRESS:"suppress"}}}]),e}(),st=function(){d(t,it);var e=_(t);function t(){var n;return a(this,t),(n=e.call(this)).message=null,n.data=null,n.customType=null,n.pushNotificationDeliveryOption=null,n._translationTargetLanguages=[],n}return l(t,[{key:"_validate",value:function(){var e=L.get(this._iid).BaseMessageParams;return v(h(t.prototype),"_validate",this).call(this)&&("string"==typeof this.message||null===this.message)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&Array.isArray(this.translationTargetLanguages)&&this.translationTargetLanguages.every((function(e){return"string"==typeof e}))&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(e.PushNotificationDeliveryOption).map((function(t){return e.PushNotificationDeliveryOption[t]})).indexOf(this.pushNotificationDeliveryOption))}},{key:"targetLanguages",get:function(){return this.translationTargetLanguages},set:function(e){this.translationTargetLanguages=e}},{key:"translationTargetLanguages",get:function(){return this._translationTargetLanguages},set:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)if("string"!=typeof e[t])return void(this._translationTargetLanguages=[]);this._translationTargetLanguages=e}}}]),t}(),at=function(){d(t,it);var e=_(t);function t(){var n;return a(this,t),(n=e.call(this)).fileName=null,n.mimeType=null,n.fileSize=null,n.data=null,n.customType=null,n.pushNotificationDeliveryOption=null,n._isUpdate=!1,n._file=null,n._fileUrl=null,n._thumbnailSizes=[],n}return l(t,[{key:"_validate",value:function(){var e=L.get(this._iid).BaseMessageParams;return v(h(t.prototype),"_validate",this).call(this)&&(this._isUpdate||H.isFile(this.file)||"string"==typeof this.fileUrl)&&("string"==typeof this.fileName||null===this.fileName)&&("string"==typeof this.mimeType||null===this.mimeType)&&("number"==typeof this.fileSize||null===this.fileSize)&&("string"==typeof this.data||null===this.data)&&("string"==typeof this.customType||null===this.customType)&&(null===this._thumbnailSizes||this._thumbnailSizes.every((function(e){return"object"===s(e)&&0<e.maxWidth&&0<e.maxHeight})))&&(null===this.pushNotificationDeliveryOption||-1<Object.keys(e.PushNotificationDeliveryOption).map((function(t){return e.PushNotificationDeliveryOption[t]})).indexOf(this.pushNotificationDeliveryOption))}},{key:"file",get:function(){return this._file},set:function(e){H.isFile(e)&&(this._fileUrl=null,this._file=e)}},{key:"fileUrl",get:function(){return this._fileUrl},set:function(e){"string"==typeof e&&(this._fileUrl=e,this._file=null)}},{key:"thumbnailSizes",get:function(){return this._thumbnailSizes},set:function(e){if(Array.isArray(e)){for(var t=0;t<e.length;t++)if("object"!==s(e[t])||"number"!=typeof e[t].maxWidth||"number"!=typeof e[t].maxHeight)return void(this._thumbnailSizes=[]);this._thumbnailSizes=e}}}]),t}(),ot=function(){d(t,st);var e=_(t);function t(n){var r;return a(this,t),(r=e.call(this)).year=null,r.month=null,r.day=null,r.hour=null,r.min=null,r.timezone=null,r._scheduledDateTimeString=null,n&&r._update(n),r}return l(t,[{key:"_update",value:function(e){e.hasOwnProperty("message")&&(this.message=e.message),e.hasOwnProperty("year")&&(this.year=e.year),e.hasOwnProperty("month")&&(this.month=e.month),e.hasOwnProperty("day")&&(this.day=e.day),e.hasOwnProperty("hour")&&(this.hour=e.hour),e.hasOwnProperty("min")&&(this.min=e.min),e.hasOwnProperty("timezone")&&(this.timezone=e.timezone)}},{key:"_getScheduleString",value:function(){return this.scheduledDateTimeString?this.scheduledDateTimeString+" "+this.timezone:"number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2)+" "+this.timezone:null}},{key:"setSchedule",value:function(e,t,n,r,i,s){"number"==typeof e&&4===e.toString().length&&"number"==typeof t&&1<=t&&t<=12&&"number"==typeof n&&1<=n&&n<=31&&"number"==typeof r&&0<=r&&r<=24&&"number"==typeof i&&0<=i&&i<=60&&"string"==typeof s&&0<s.length&&(this.scheduledDateTimeString=e.toString()+"-"+("0"+t.toString()).substr(-2)+"-"+("0"+n.toString()).substr(-2)+" "+("0"+r.toString()).substr(-2)+":"+("0"+i.toString()).substr(-2),this.timezone=s)}},{key:"scheduledDateTimeString",get:function(){return this._scheduledDateTimeString?this._scheduledDateTimeString:"number"==typeof this.year&&4===this.year.toString().length&&"number"==typeof this.month&&1<=this.month&&this.month<=12&&"number"==typeof this.day&&1<=this.day&&this.day<=31&&"number"==typeof this.hour&&0<=this.hour&&this.hour<=24&&"number"==typeof this.min&&0<=this.min&&this.min<=60&&"string"==typeof this.timezone&&0<this.timezone.length?this.year.toString()+"-"+("0"+this.month.toString()).substr(-2)+"-"+("0"+this.day.toString()).substr(-2)+" "+("0"+this.hour.toString()).substr(-2)+":"+("0"+this.min.toString()).substr(-2):null},set:function(e){e&&"string"==typeof e&&(this._scheduledDateTimeString=e)}}]),t}(),lt=function(){function e(){a(this,e),this.channelUrl=null,this.channelType=null,this.messageId=0,this.includeMetaArray=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return l(e,[{key:"_validate",value:function(){var e=L.get(this._iid).BaseChannel;return"string"==typeof this.channelUrl&&"string"==typeof this.channelType&&[e.CHANNEL_TYPE_BASE,e.CHANNEL_TYPE_OPEN,e.CHANNEL_TYPE_GROUP].includes(this.channelType)&&"number"==typeof this.messageId&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),e}(),ut=function(){function e(){a(this,e);var t=L.get(this._iid).BaseChannel;this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageType=t.MessageTypeFilter.ALL,this.customType=null,this.senderUserIds=null,this.includeMetaArray=!1,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return l(e,[{key:"_validate",value:function(){var e=L.get(this._iid).BaseChannel;return"number"==typeof this.prevResultSize&&"number"==typeof this.nextResultSize&&"boolean"==typeof this.isInclusive&&"boolean"==typeof this.reverse&&"string"==typeof this.messageType&&Object.values(e.MessageTypeFilter).includes(this.messageType)&&("string"==typeof this.customType||null===this.customType)&&(Array.isArray(this.senderUserIds)&&this.senderUserIds.every((function(e){return"string"==typeof e}))||null===this.senderUserIds)&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeReplies&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),e}(),ct=function(){function e(){a(this,e);var t=L.get(this._iid).BaseChannel;this.prevResultSize=0,this.nextResultSize=0,this.isInclusive=!1,this.reverse=!1,this.messageType=t.MessageTypeFilter.ALL,this.customType=null,this.senderUserIds=null,this.includeMetaArray=!1,this.includeReactions=!1,this.includeParentMessageText=!1}return l(e,[{key:"_validate",value:function(){var e=L.get(this._iid).BaseChannel;return"number"==typeof this.prevResultSize&&"number"==typeof this.nextResultSize&&"boolean"==typeof this.isInclusive&&"boolean"==typeof this.reverse&&"string"==typeof this.messageType&&Object.values(e.MessageTypeFilter).includes(this.messageType)&&("string"==typeof this.customType||null===this.customType)&&(Array.isArray(this.senderUserIds)&&this.senderUserIds.every((function(e){return"string"==typeof e}))||null===this.senderUserIds)&&"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeParentMessageText}}]),e}(),dt=function(){function e(){a(this,e),this.includeMetaArray=!1,this.includeReactions=!1,this.includeReplies=!1,this.includeParentMessageText=!1,this.includeThreadInfo=!1}return l(e,[{key:"_validate",value:function(){return"boolean"==typeof this.includeMetaArray&&"boolean"==typeof this.includeReactions&&"boolean"==typeof this.includeReplies&&"boolean"==typeof this.includeParentMessageText&&"boolean"==typeof this.includeThreadInfo}}]),e}(),ht=function(){function e(){a(this,e),this.customTypes=[],this.includeEmpty=!1,this.includeFrozen=!0}return l(e,[{key:"_validate",value:function(){return(Array.isArray(this.customTypes)&&this.customTypes.every((function(e){return"string"==typeof e}))||null===this.customTypes)&&("boolean"==typeof this.includeEmpty||null===this.includeEmpty)&&"boolean"==typeof this.includeFrozen}}]),e}(),ft=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];a(this,e),this.key=t,this.value=Array.isArray(n)&&n.every((function(e){return"string"==typeof e}))?n:[]}return l(e,[{key:"encode",value:function(){return{key:this.key,value:this.value||[]}}}]),e}(),pt=new WeakMap,gt=function(){function e(t){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:0;a(this,e),this.key=t,this.userIds=n,this.updatedAt=r;var i={};for(var s in this.userIds)i[this.userIds[s]]=this.updatedAt;pt.set(this,i)}return l(e,[{key:"serialize",value:function(){return{key:this.key,user_ids:this.userIds,updated_at:this.updatedAt}}},{key:"_applyEvent",value:function(e){if(e instanceof X){var t=pt.get(this);if(e.key===this.key&&(!t[e.userId]||t[e.userId]<e.updatedAt)){var n=this.userIds.indexOf(e.userId);switch(e.operation){case"add":n<0&&this.userIds.push(e.userId);break;case"delete":0<=n&&this.userIds.splice(n,1)}t[e.userId]=e.updatedAt}}}},{key:"isEmpty",get:function(){return 0===this.userIds.length}}],[{key:"createFromJson",value:function(e){var t=e.key,n=e.user_ids,r=e.updated_at;return"string"==typeof t&&t&&Array.isArray(n)&&0<n.length&&"number"==typeof r?new this(t,n,r):null}}]),e}(),yt=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];a(this,e),this.isLoading=!1,this.hasNext=!0,this.limit=20,this.userIds=t,this.metaDataKey="",this.metaDataValues=[],this._token=""}return l(e,[{key:"next",value:function(e){var t=this;return Z(this._iid,(function(e){"number"==typeof t.limit&&0<t.limit&&Array.isArray(t.userIds)&&"string"==typeof t.metaDataKey&&Array.isArray(t.metaDataValues)&&!!t.metaDataKey==0<t.metaDataValues.length?t.isLoading?e(new N("Query in progress.",N.QUERY_IN_PROGRESS),null):t.hasNext?(t.isLoading=!0,k.get(t._iid).container.apiClient.loadUserList(c(c({},t),{},{userIdsFilter:t.userIds,metaDataKeyFilter:t.metaDataKey,metaDataValuesFilter:t.metaDataValues,token:t._token}),(function(n,r){var i=null;if(!n){var s=L.get(t._iid).User,a=String(r.next);t._token=a,t.hasNext=!!a,i=r.users.map((function(e){return new s(e)}))}t.isLoading=!1,e(n,i)}))):e(null,[]):e(z.error,null)}),e)}}]),e}(),mt=new WeakMap,_t=function(){function e(t){a(this,e),this.isLoading=!1,mt.set(this,t)}return l(e,[{key:"prev",value:function(e,t,n,r){var i=arguments,s=this;return Z(this._iid,(function(r){var a,o=L.get(s._iid).BaseChannel,l=E(z.parse(i,[new z({type:"number"}),new z({type:"number"}),new z({type:"boolean"}),new z({type:"function"})]),5);if(a=l[0],e=l[1],t=l[2],n=l[3],r=l[4],a)r(a,null);else if(s.isLoading)r(new N("Query in progress.",N.QUERY_IN_PROGRESS),null);else{s.isLoading=!0;var u=mt.get(s);k.get(s._iid).container.apiClient.getMessageList({channelUrl:u.url,channelType:u.channelType,token:e,tokenType:"timestamp",isInclusive:!1,prevResultSize:t,nextResultSize:0,shouldReverse:n,messageType:"",customType:""},(function(e,t){var n=null;e||(n=t.messages.map((function(e){return o.buildMessage(e,u)}))),s.isLoading=!1,r(e,n)}))}}),r)}},{key:"next",value:function(e,t,n,r){var i=arguments,s=this;return Z(this._iid,(function(r){var a,o=L.get(s._iid).BaseChannel,l=E(z.parse(i,[new z({type:"number"}),new z({type:"number"}),new z({type:"boolean"}),new z({type:"function"})]),5);if(a=l[0],e=l[1],t=l[2],n=l[3],r=l[4],a)r(a,null);else if(s.isLoading)r(new N("Query in progress.",N.QUERY_IN_PROGRESS),null);else{s.isLoading=!0;var u=mt.get(s);k.get(s._iid).container.apiClient.getMessageList({channelUrl:u.url,channelType:u.channelType,token:e,tokenType:"timestamp",isInclusive:!1,prevResultSize:0,nextResultSize:t,shouldReverse:n,messageType:"",customType:""},(function(e,t){var n=null;e||(n=t.messages.map((function(e){return o.buildMessage(e,u)}))),s.isLoading=!1,r(e,n)}))}}),r)}},{key:"load",value:function(e,t,n,r,i){var s=arguments,a=this;return Z(this._iid,(function(i){var o,l=L.get(a._iid).BaseChannel,u=E(z.parse(s,[new z({type:"number"}),new z({type:"number"}),new z({type:"number"}),new z({type:"boolean"}),new z({type:"callback"})]),6);if(o=u[0],e=u[1],t=u[2],n=u[3],r=u[4],i=u[5],o)i(o,null);else if(a.isLoading)i(new N("Query in progress.",N.QUERY_IN_PROGRESS),null);else{a.isLoading=!0;var c=mt.get(a);k.get(a._iid).container.apiClient.getMessageList({channelUrl:c.url,channelType:c.channelType,token:e,tokenType:"timestamp",isInclusive:!1,prevResultSize:t,nextResultSize:n,shouldReverse:r,messageType:"",customType:""},(function(e,t){var n=null;e||(n=t.messages.map((function(e){return l.buildMessage(e,c)}))),a.isLoading=!1,i(e,n)}))}}),i)}}]),e}(),vt=null,Et={},Ct=!1,bt=function(){function e(t){a(this,e);var n=!1;if((t.newInstance||!vt||vt&&t.appId!==vt.getApplicationId()&&vt.getConnectionState()===vt.ConnectionState.CLOSED)&&(n=!0,vt=this),n){try{if(!t.hasOwnProperty("appId"))return w.debug("Must be set appId"),null}catch(t){return w.debug("Must be set appId"),null}var r=me.create();Object.defineProperty(this,"_iid",{get:function(){return r}}),(Et[r]=this).customApiHost=null,this.customWsHost=null,this.connecting=!1,this.reconnecting=!1,this.isReconnectingOnError=!1,this.connectionCallbacks=[],this.ConnectionManager=new Y(this),this.GCMPushToken="",this.APNSPushToken="",this.PUSH_TEMPLATE_DEFAULT="default",this.PUSH_TEMPLATE_ALTERNATIVE="alternative",this.currentUser=null,this.isSessionOpened=!1,this.globalTimer,this.loginTimer,this.reconnectTimer,this.loginHandler=null,this.onLoginTimerCancel,this.onReconnectTimerCancel,this.BaseChannel={MessageTypeFilter:se.MessageTypeFilter};var i={User:re,Member:Ae,GroupChannel:Se,OpenChannel:Oe,UserMessage:we,FileMessage:Me,AdminMessage:Le,GroupChannelListQuery:je,GroupChannelParams:nt,BaseMessageParams:it,UserMessageParams:st,FileMessageParams:at,ScheduledUserMessageParams:ot,GroupChannelTotalUnreadMessageCountParams:he,MessageRetrievalParams:lt,MessageListParams:ut,ThreadedMessageListParams:ct,MessageChangeLogsParams:dt,GroupChannelChangeLogsParams:ht,MessageMetaArray:ft,UserEventHandler:pe,ChannelHandler:ge,ConnectionHandler:fe},s={BaseChannel:se,BaseMessage:ne,UserListQuery:yt,ApplicationUserListQuery:Fe,BannedUserListQuery:Ge,BlockedUserListQuery:xe,FriendListQuery:Be,MemberListQuery:qe,MutedUserListQuery:ze,OpenChannelListQuery:Ye,OperatorListQuery:Ke,ParticipantListQuery:We,MessageListQuery:_t,PreviousMessageListQuery:et,MessageSearchQuery:Xe,PublicGroupChannelListQuery:tt,ScheduledUserMessage:Pe,ThreadInfo:De,ThreadInfoUpdateEvent:He,Command:V,Sender:Ie,ReadStatus:ye,Reaction:gt,ReactionEvent:X,Emoji:Ne,EmojiCategory:ke,EmojiContainer:Ue,FileMessageQueue:de},o=new L(this._iid,c(c({},i),s));for(var l in o)i[l]&&(this[l]=o[l]);k.create(r,{appId:t.appId,pinger:new P(this),apiClient:new B(this),wsAdapter:new q(this),commandHandler:new le(this),onlineDetector:new Q(this),ackStateMap:{},subscribedUnreadMessageCount:{all:0,custom_types:{},ts:0},maxUnreadCountOfSuperGroupChannel:A.DEFAULT_MAX_UNREAD_COUNT_OF_SUPER_GROUP_CHANNEL,auth:new R,appInfo:null,pingInterval:15e3,pongTimeout:5e3,connectedAt:0,extensions:{},supportedExtensionKeys:["sb_uikit","sb_syncmanager"],getUserAgentWithExtensions:function(e){var t=e.sb_syncmanager?"s".concat(e.sb_syncmanager):"",n=e.sb_uikit?"u".concat(e.sb_uikit):"";return"JS/c".concat(A.SDK_VERSION,"/").concat(t,"/").concat(n)},stateChangeEnabled:!0,isInBackground:!1,closedByGoingBackground:!1,isErrorFirstInCallback:!1}),this.userEventHandlers={},this.channelHandlers={},this.connectionHandlers={},this.Options={_useMemberAsMessageSender:!0,get UseMemberAsMessageSender(){return this._useMemberAsMessageSender},set UseMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},get useMemberAsMessageSender(){return this._useMemberAsMessageSender},set useMemberAsMessageSender(e){"boolean"==typeof e&&(this._useMemberAsMessageSender=e)},_typingIndicatorThrottle:1e3,get typingIndicatorThrottle(){return this._typingIndicatorThrottle},set typingIndicatorThrottle(e){"number"==typeof e&&1e3<=e&&e<=9e3&&(this._typingIndicatorThrottle=e)}}}return vt}return l(e,[{key:"getApplicationId",value:function(){return k.get(this._iid).get("appId")}},{key:"getCurrentUserId",value:function(){return this.currentUser?this.currentUser.userId:null}},{key:"getDebugMode",value:function(){return Ct}},{key:"setDebugMode",value:function(e){Ct=e,w.mode=e?w.Mode.DEBUG:w.Mode.PRODUCTION}},{key:"getErrorFirstCallback",value:function(){return k.get(this._iid).container.isErrorFirstInCallback}},{key:"setErrorFirstCallback",value:function(e){"boolean"==typeof e&&k.get(this._iid).set("isErrorFirstInCallback",e)}},{key:"getCurrentApiHost",value:function(){return this.customApiHost?this.customApiHost:"https://api.sendbird.com"}},{key:"clearCurrentApiHost",value:function(){this.customApiHost=null}},{key:"getCurrentWsHost",value:function(){return this.customWsHost?this.customWsHost:"wss://ws.sendbird.com"}},{key:"clearCurrentWsHost",value:function(){this.customWsHost=null}},{key:"getConnectionState",value:function(){try{var e=k.get(this._iid).container.wsAdapter;return this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:e.ws?this.connecting||this.reconnecting?this.ConnectionState.CONNECTING:this.isSessionOpened?e.ws.getConnectionState():this.ConnectionState.CLOSED:this.ConnectionState.CLOSED}catch(e){return this.ConnectionState.CLOSED}}},{key:"getPendingGCMToken",value:function(){return this.GCMPushToken}},{key:"getPendingAPNSToken",value:function(){return this.APNSPushToken}},{key:"hasLoggedIn",value:function(){var e=k.get(this._iid);return this.currentUser&&e.get("auth").hasSession()}},{key:"getLastConnectedAt",value:function(){var e=k.get(this._iid);return this.getConnectionState()===this.ConnectionState.OPEN&&this.currentUser?e.get("connectedAt"):0}},{key:"connect",value:function(e,t,n,r,i){var s=this,a=k.get(this._iid).container,o=a.wsAdapter,l=a.onlineDetector;l&&l.start();var u,c=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||3===e.length}}),new z({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new z({type:"string",nullable:!0,ignoreIf:function(e){return 1===e.length||2===e.length}}),new z({type:"callback"})]),6);return u=c[0],e=c[1],t=c[2],n=c[3],r=c[4],i=c[5],Z(this._iid,(function(i){u?i(u,null):(s.customApiHost=n,s.customWsHost=r,s.connecting=!0,s.reconnecting=!1,s.isReconnectingOnError=!1,s.reconnectTimer&&(clearTimeout(s.reconnectTimer),s.reconnectTimer=null,s.onReconnectTimerCancel=null),s.getConnectionState()===s.ConnectionState.OPEN&&s.currentUser&&s.currentUser.userId===e?(s.connecting=!1,i(null,s.currentUser)):(s.connectionCallbacks.push(i),1===s.connectionCallbacks.length&&(o.disconnect({clearSession:!0,err:null},null),o.connect(e,t))))}),i)}},{key:"reconnect",value:function(){var e=k.get(this._iid).container,t=e.wsAdapter;if(e.auth.sessionKey&&this.currentUser){var n=!0;return 0<t.reconnectCount&&(n=!1),t.disconnect({clearSession:!1,err:new N("Connection has been canceled.",N.CONNECTION_CANCELED)},null),t.reconnectCount=0,t.reconnect(this.currentUser.userId,n),!0}return!1}},{key:"disconnect",value:function(e){var t=this;return Z(this._iid,(function(e){var n=k.get(t._iid).container,r=n.wsAdapter,i=n.onlineDetector;i&&i.stop(),r.disconnect({clearSession:!0,err:new N("Connection has been canceled.",N.CONNECTION_CANCELED)},e)}),e)}},{key:"setBackgroundState",value:function(){var e=k.get(this._iid),t=e.container,n=t.wsAdapter,r=t.stateChangeEnabled;!t.isInBackground&&r&&(e.set("isInBackground",!0),this.getConnectionState()!==this.ConnectionState.CLOSED?(e.set("closedByGoingBackground",!0),n.disconnect({clearSession:!1,err:new N("Websocket connection failed.",N.WEBSOCKET_CONNECTION_FAILED)},null)):e.set("closedByGoingBackground",!1))}},{key:"setForegroundState",value:function(){var e=k.get(this._iid),t=e.container,n=t.wsAdapter,r=t.stateChangeEnabled,i=t.isInBackground,s=t.closedByGoingBackground;i&&r&&(e.set("isInBackground",!1),s&&this.currentUser&&n.reconnect(this.currentUser.userId,!0))}},{key:"enableStateChange",value:function(){k.get(this._iid).set("enableStateChange",!0)}},{key:"disableStateChange",value:function(){k.get(this._iid).set("enableStateChange",!1)}},{key:"addExtension",value:function(e,t){var n=k.get(this._iid).container,r=n.extensions;-1<n.supportedExtensionKeys.indexOf(e)&&(r[e]=t)}},{key:"createUserListQuery",value:function(e){return new(L.get(this._iid).UserListQuery)(e)}},{key:"createApplicationUserListQuery",value:function(){return new(L.get(this._iid).ApplicationUserListQuery)}},{key:"createBlockedUserListQuery",value:function(){return new(L.get(this._iid).BlockedUserListQuery)}},{key:"createFriendListQuery",value:function(){return new(L.get(this._iid).FriendListQuery)}},{key:"createMessageSearchQuery",value:function(e,t){return new(L.get(this._iid).MessageSearchQuery)(e,t)}},{key:"sendCommand",value:function(e,t){var n=this;return Z(this._iid,(function(t){n.ConnectionManager.ready((function(r,i){if(r)t(r,null);else{var s=k.get(n._iid).container,a=s.wsAdapter,o=s.ackStateMap;if(null==a||null==a.ws||a.ws.getConnectionState()!==n.ConnectionState.OPEN||n.getConnectionState()!==n.ConnectionState.OPEN)return void t(new N("Connection is not valid. Please reconnect.",N.WEBSOCKET_CONNECTION_CLOSED),null);if(e.isAckRequired){var l=e.requestId,u={handler:t,timer:setTimeout((function(){t(new N("Command received no ack.",N.ACK_TIMEOUT),null),delete o[l]}),A.COMMAND_ACK_TIMEOUT)};o[l]=u,a.ws.send(e,(function(e){e&&(clearTimeout(u.timer),t(e,null))}))}else a.ws.send(e,t)}}),!1)}),t)}},{key:"addUserEventHandler",value:function(e,t){t instanceof L.get(this._iid).UserEventHandler&&(this.userEventHandlers[e]=t)}},{key:"removeUserEventHandler",value:function(e){delete this.userEventHandlers[e]}},{key:"removeAllUserEventHandler",value:function(){this.userEventHandlers={}}},{key:"addChannelHandler",value:function(e,t){t instanceof L.get(this._iid).ChannelHandler&&(this.channelHandlers[e]=t)}},{key:"removeChannelHandler",value:function(e){delete this.channelHandlers[e]}},{key:"removeAllChannelHandlers",value:function(){this.channelHandlers={}}},{key:"addConnectionHandler",value:function(e,t){t instanceof L.get(this._iid).ConnectionHandler&&(this.connectionHandlers[e]=t)}},{key:"removeConnectionHandler",value:function(e){delete this.connectionHandlers[e]}},{key:"removeAllConnectionHandlers",value:function(){this.connectionHandlers={}}},{key:"updateCurrentUserInfo",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"string",nullable:!0}),new z({type:"string",nullable:!0}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.updateCurrentUserInfo({nickname:e,profileUrl:t},(function(r,s){var a=null;r||(i.currentUser&&(e&&(i.currentUser.nickname=e),t&&(i.currentUser.profileUrl=t)),a=i.currentUser),n(r,a)}))}),n)}},{key:"updateCurrentUserInfoWithProfileImage",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"string",nullable:!0}),new z({type:"file",nullable:!0}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.updateCurrentUserInfo({nickname:e,profileImage:t},(function(t,r){var s=null;t||(i.currentUser&&(e&&(i.currentUser.nickname=e),r.profile_url&&(i.currentUser.profileUrl=r.profile_url)),s=i.currentUser),n(t,s)}))}),n)}},{key:"updateCurrentUserInfoWithPreferredLanguages",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.updateCurrentUserInfo({preferredLanguages:e},(function(n,i){var s=null;n||(r.currentUser&&e&&(r.currentUser._preferredLanguages=e),s=r.currentUser),t(n,s)}))}),t)}},{key:"registerGCMPushTokenForCurrentUser",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,r.pushTokenRegistrationState.ERROR):r.currentUser?k.get(r._iid).container.apiClient.registerGCMPushToken({token:e},(function(e,n){var i=r.pushTokenRegistrationState.ERROR;e||(r.GCMPushToken="",i=r.pushTokenRegistrationState.SUCCESS),t(e,i)})):(r.GCMPushToken=e,t(null,r.pushTokenRegistrationState.PENDING))}),t)}},{key:"unregisterGCMPushTokenForCurrentUser",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):r.currentUser?k.get(r._iid).container.apiClient.unregisterGCMPushToken({token:e},(function(e,n){t(e,null)})):(r.GCMPushToken=e,t(null,r.pushTokenRegistrationState.PENDING))}),t)}},{key:"unregisterGCMPushTokenAllForCurrentUser",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.unregisterAllGCMPushTokens({},(function(t,n){e(t,null)}))}),e)}},{key:"registerAPNSPushTokenForCurrentUser",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,r.pushTokenRegistrationState.ERROR):r.currentUser?k.get(r._iid).container.apiClient.registerAPNSPushToken({token:e},(function(e,n){var i=r.pushTokenRegistrationState.ERROR;e||(r.APNSPushToken="",i=r.pushTokenRegistrationState.SUCCESS),t(e,i)})):(r.APNSPushToken=e,t(null,r.pushTokenRegistrationState.PENDING))}),t)}},{key:"unregisterAPNSPushTokenForCurrentUser",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return 0<e.length}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):r.currentUser?k.get(r._iid).container.apiClient.unregisterAPNSPushToken({token:e},(function(e,n){t(e,null)})):(r.APNSPushToken=e,t(null,r.pushTokenRegistrationState.PENDING))}),t)}},{key:"unregisterAPNSPushTokenAllForCurrentUser",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.unregisterAllAPNSPushTokens({},(function(t,n){e(t,null)}))}),e)}},{key:"unregisterPushTokenAllForCurrentUser",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.unregisterAllPushTokens({},(function(t,n){e(t,null)}))}),e)}},{key:"getMyGroupChannelChangeLogsByToken",value:function(e,t,n,r){var i=this,s=null,a=E(z.parse(arguments,[new z({type:"string",nullable:!0}),new z({type:"array",optional:!0,nullable:!0,defaultValue:null}),new z({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new z({type:"callback"})]),5);s=a[0],e=a[1],t=a[2],n=a[3],r=a[4];var o=L.get(this._iid).GroupChannelChangeLogsParams,l=null;if(s){var u=E(z.parse(arguments,[new z({type:"string",nullable:!0}),new z({type:o,constraint:function(e){return e._validate()}}),new z({type:"callback"})]),4);s=u[0],e=u[1],l=u[2],r=u[3]}else(l=new o).customTypes=t,l.includeEmpty=n,l.includeFrozen=!0;return Z(this._iid,(function(t){s?t(s,null):k.get(i._iid).container.apiClient.getMyGroupChannelChangeLogs(c({ts:null,token:e},l),(function(e,n){if(e)t(e,null);else{var r=L.get(i._iid).GroupChannel,s=n.updated.map((function(e){return new r(e)})),a=n.deleted,o=n.has_more,l=n.next;t(null,{updatedChannels:s,deletedChannelUrls:a,hasMore:o,token:l})}}))}),r)}},{key:"getMyGroupChannelChangeLogsByTimestamp",value:function(e,t,n,r){var i=this,s=null,a=E(z.parse(arguments,[new z({type:"number",constraint:function(e){return 0<=e}}),new z({type:"array",optional:!0,nullable:!0,defaultValue:null}),new z({type:"boolean",nullable:!0,optional:!0,defaultValue:null}),new z({type:"callback"})]),5);s=a[0],e=a[1],t=a[2],n=a[3],r=a[4];var o=L.get(this._iid).GroupChannelChangeLogsParams,l=null;if(s){var u=E(z.parse(arguments,[new z({type:"number",constraint:function(e){return 0<=e}}),new z({type:o,constraint:function(e){return e._validate()}}),new z({type:"callback"})]),4);s=u[0],e=u[1],l=u[2],r=u[3]}else(l=new o).customTypes=t,l.includeEmpty=n,l.includeFrozen=!0;return Z(this._iid,(function(t){s?t(s,null):k.get(i._iid).container.apiClient.getMyGroupChannelChangeLogs(c({ts:e,token:null},l),(function(e,n){if(e)t(e,null);else{var r=L.get(i._iid).GroupChannel,s=n.updated.map((function(e){return new r(e)})),a=n.deleted,o=n.has_more,l=n.next;t(null,{updatedChannels:s,deletedChannelUrls:a,hasMore:o,token:l})}}))}),r)}},{key:"getChannelInvitationPreference",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getChannelInvitationPreference({},(function(t,n){var r=null;t||(r={autoAccept:n.auto_accept}),e(t,r)}))}),e)}},{key:"setChannelInvitationPreference",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"boolean"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.setChannelInvitationPreference({isAutoAccept:e},(function(e,n){var r=null;e||(r={autoAccept:n.auto_accept}),t(e,r)}))}),t)}},{key:"getDoNotDisturb",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getDoNotDisturb({},(function(t,n){var r=null;t||(r={doNotDisturbOn:n.do_not_disturb,startHour:n.start_hour,startMin:n.start_min,endHour:n.end_hour,endMin:n.end_min,timezone:n.timezone}),e(t,r)}))}),e)}},{key:"setDoNotDisturb",value:function(e,t,n,r,i,s,a){var o,l=this,u=E(z.parse(arguments,[new z({type:"boolean"}),new z({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new z({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new z({type:"number",constraint:function(e){return 0<=e&&e<=23}}),new z({type:"number",constraint:function(e){return 0<=e&&e<=59}}),new z({type:"string"}),new z({type:"callback"})]),8);return o=u[0],e=u[1],t=u[2],n=u[3],r=u[4],i=u[5],s=u[6],a=u[7],Z(this._iid,(function(a){o?a(o,null):k.get(l._iid).container.apiClient.setDoNotDisturb({doNotDisturbOn:e,startHour:t,startMin:n,endHour:r,endMin:i,timezone:s},(function(e,t){var n=null;e||(n={doNotDisturbOn:t.do_not_disturb,startHour:t.start_hour,startMin:t.start_min,endHour:t.end_hour,endMin:t.end_min,timezone:t.timezone}),a(e,n)}))}),a)}},{key:"getSnoozePeriod",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getSnoozePeriod({},(function(t,n){var r=null;t||(r={isSnoozeOn:n.snooze_enabled,startTs:n.snooze_start_ts,endTs:n.snooze_end_ts}),e(t,r)}))}),e)}},{key:"setSnoozePeriod",value:function(e,t,n,r){var i,s=this,a=E(z.parse(arguments,[new z({type:"boolean"}),new z({type:"number",constraint:function(e){return 0<e}}),new z({type:"number",constraint:function(e){return 0<e}}),new z({type:"callback"})]),5);return i=a[0],e=a[1],t=a[2],n=a[3],r=a[4],Z(this._iid,(function(r){i?r(i,null):k.get(s._iid).container.apiClient.setSnoozePeriod({snoozeOn:e,startTs:t,endTs:n},(function(e,t){var n=null;e||(n={isSnoozeOn:t.snooze_enabled,startTs:t.snooze_start_ts,endTs:t.snooze_end_ts}),r(e,n)}))}),r)}},{key:"blockUser",value:function(e,t){var n,r=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new z({type:"callback"})]),3);return n=r[0],e=r[1],t=r[2],n?Z(this._iid,(function(e){e(n,null)}),t):this.blockUserWithUserId(e.userId,t)}},{key:"blockUserWithUserId",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return e&&(!r.currentUser||e!==r.currentUser.userId)}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.blockUser({blockedUserId:e},(function(e,n){var r=null;e||(r=new re(n)),t(e,r)}))}),t)}},{key:"unblockUser",value:function(e,t){var n,r=E(z.parse(arguments,[new z({type:"object",constraint:function(e){return e&&e.hasOwnProperty("userId")}}),new z({type:"callback"})]),3);return n=r[0],e=r[1],t=r[2],n?Z(this._iid,(function(e){e(n,null)}),t):this.unblockUserWithUserId(e.userId,t)}},{key:"unblockUserWithUserId",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",constraint:function(e){return e&&(!r.currentUser||e!==r.currentUser.userId)}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.unblockUser({unblockedUserId:e},(function(e,n){t(e,null)}))}),t)}},{key:"getPushTriggerOption",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getPushTriggerOption({},(function(t,n){e(t,n?n.push_trigger_option:null)}))}),e)}},{key:"setPushTriggerOption",value:function(e,t){var n=this;return Z(this._iid,(function(t){-1<Object.keys(n.PushTriggerOption).map((function(e){return n.PushTriggerOption[e]})).indexOf(e)?k.get(n._iid).container.apiClient.setPushTriggerOption({pushTriggerOption:e},(function(e,n){t(e,n?n.push_trigger_option:null)})):t(z.error,null)}),t)}},{key:"getGroupChannelCount",value:function(e,t){var n,r=this,i=L.get(this._iid).GroupChannel,s=E(z.parse(arguments,[new z({type:i.MemberStateFilter,optional:!0,defaultValue:i.MemberStateFilter.ALL}),new z({type:"callback"})]),3);return n=s[0],e=s[1],t=s[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.getGroupChannelCount({memberStateFilter:e},(function(e,n){var r=null;e||(r=parseInt(n.group_channel_count)),t(e,r)}))}),t)}},{key:"getTotalUnreadChannelCount",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getTotalUnreadChannelCount({},(function(t,n){var r=null;t||(r=parseInt(n.unread_count)),e(t,r)}))}),e)}},{key:"getTotalUnreadMessageCount",value:function(e,t){var n,r=this,i=L.get(this._iid),s=i.GroupChannel,a=i.GroupChannelTotalUnreadMessageCountParams,o=E(z.parse(arguments,[new z({type:"object",optional:!0,defaultValue:null,constraint:function(e){return Array.isArray(e)&&e.every((function(e){return"string"==typeof e}))||e instanceof a}}),new z({type:"callback"})]),3);return n=o[0],e=o[1],t=o[2],Z(this._iid,(function(t){if(n)t(n,null);else{var i=s.SuperChannelFilter.ALL;if(e instanceof a){var o=e;e=o.channelCustomTypesFilter,i=o.superChannelFilter}k.get(r._iid).container.apiClient.getTotalUnreadMessageCount({customTypesFilter:e,superChannelFilter:i},(function(e,n){var r=null;e||(r=parseInt(n.unread_count)),t(e,r)}))}}),t)}},{key:"getUnreadItemCount",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return 0<e.length&&e.every((function(e){return-1<Object.keys(Se.UnreadItemKey).map((function(e){return Se.UnreadItemKey[e]})).indexOf(e)}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){if(n)t(n,null);else{var i=e.filter((function(t,n){return e.indexOf(t)===n}));k.get(r._iid).container.apiClient.getUnreadItemCount({keys:i},(function(e,n){t(e,n)}))}}),t)}},{key:"getSubscribedTotalUnreadMessageCount",value:function(){var e=k.get(this._iid).container.subscribedUnreadMessageCount;return 0<=e.all?e.all:0}},{key:"getSubscribedCustomTypeTotalUnreadMessageCount",value:function(){var e=k.get(this._iid).container.subscribedUnreadMessageCount;if(0<Object.keys(e.custom_types).length){var t=0;for(var n in e.custom_types)t+=e.custom_types[n];return t}return 0}},{key:"getSubscribedCustomTypeUnreadMessageCount",value:function(e){if(e&&"string"==typeof e){var t=k.get(this._iid).container.subscribedUnreadMessageCount;return t.custom_types.hasOwnProperty(e)?t.custom_types[e]:0}return 0}},{key:"getMyPushTokensByToken",value:function(e,t,n){var r,i=this,s=E(z.parse(arguments,[new z({type:"string"}),new z({type:"string",constraint:function(e){return-1<["gcm","apns","apns_voip"].indexOf(e)}}),new z({type:"callback"})]),4);return r=s[0],e=s[1],t=s[2],n=s[3],Z(this._iid,(function(n){r?n(r,null):k.get(i._iid).container.apiClient.getPushTokens({ts:null,token:e,type:t},(function(e,t){if(e)n(e,null);else{var r=t.type;n(null,{deviceTokens:t.device_tokens,type:r?r.toLowerCase():"unknown",hasMore:t.has_more,token:t.token})}}))}),n)}},{key:"getPushTemplate",value:function(e){var t=this;return Z(this._iid,(function(e){k.get(t._iid).container.apiClient.getPushTemplate({},(function(t,n){var r=null;t||(r=n.name.toString()),e(t,r)}))}),e)}},{key:"setPushTemplate",value:function(e,t){var n=this;return Z(this._iid,(function(t){-1<[n.PUSH_TEMPLATE_DEFAULT,n.PUSH_TEMPLATE_ALTERNATIVE].indexOf(e)?k.get(n._iid).container.apiClient.setPushTemplate({templateName:e},(function(e,n){var r=null;e||(r=n.name.toString()),t(e,r)})):t(z.error,null)}),t)}},{key:"markAsReadAll",value:function(e){var t=this;return Z(this._iid,(function(e){var n=L.get(t._iid).GroupChannel,r=(new Date).getTime();r-n.markAsReadAllLastSentAt<1e3?e(new N("MarkAsRead rate limit exceeded.",N.MARK_AS_READ_RATE_LIMIT_EXCEEDED),null):(n.markAsReadAllLastSentAt=r,k.get(t._iid).container.apiClient.markAsReadAll({channelUrls:null},(function(i,s){if(!i)for(var a in n.cachedChannels)t.currentUser&&n.cachedChannels[a].updateReadReceipt(t.currentUser.userId,r),n.cachedChannels[a]._setGroupChannelUnreadCount(0,0);e(i,null)})))}),e)}},{key:"markAsReadWithChannelUrls",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){if(n)t(n,null);else{var i=(new Date).getTime();k.get(r._iid).container.apiClient.markAsReadAll({channelUrls:e},(function(n,s){if(!n)for(var a in e){var o=e[a];Se.cachedChannels[o]&&(r.currentUser&&Se.cachedChannels[o].updateReadReceipt(r.currentUser.userId,i),Se.cachedChannels[o]._setGroupChannelUnreadCount(0,0))}t(n,null)}))}}),t)}},{key:"markAsDelivered",value:function(e){"string"==typeof e&&L.get(this._iid).GroupChannel.getChannel(e,A.INTERNAL_CALL,(function(e,t){e||t.markAsDelivered()}))}},{key:"getFriendChangeLogsByToken",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string",optional:!0,defaultValue:null}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.getFriendChangeLogsByToken({token:e},(function(e,n){var i=null;if(!e){var s=L.get(r._iid).User;i={updatedUsers:n.updated.map((function(e){return new s(e)})),deletedUserIds:n.deleted,hasMore:n.has_more,token:n.next}}t(e,i)}))}),t)}},{key:"uploadFriendDiscoveries",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return e.every((function(e){return e.hasOwnProperty("friendDiscoveryKey")}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.uploadFriendDiscoveries({discoveries:e},(function(e,n){t(e,n)}))}),t)}},{key:"deleteFriendDiscovery",value:function(e,t){var n,r=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=r[0],e=r[1],t=r[2],n?Z(this._iid,(function(e){e(n,null)}),t):this.deleteFriendDiscoveries([e],t)}},{key:"deleteFriendDiscoveries",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.deleteFriendDiscoveries({discoveryKeys:e},(function(e,n){t(e,n)}))}),t)}},{key:"addFriends",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.addFriends({userIds:e},(function(e,n){var i=null;if(!e){var s=L.get(r._iid).User;i=n.users.map((function(e){return new s(e)}))}t(e,i)}))}),t)}},{key:"deleteFriend",value:function(e,t){var n,r=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=r[0],e=r[1],t=r[2],n?Z(this._iid,(function(e){e(n,null)}),t):this.deleteFriends([e],t)}},{key:"deleteFriends",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"array",constraint:function(e){return e.every((function(e){return"string"==typeof e}))}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.deleteFriends({userIds:e},(function(e,n){t(e,n)}))}),t)}},{key:"getAllEmoji",value:function(e){var t,n=this,r=E(z.parse(arguments,[new z({type:"callback"})]),2);return t=r[0],e=r[1],Z(this._iid,(function(e){t?e(t,null):k.get(n._iid).container.apiClient.getAllEmoji((function(t,r){if(t)e(t,null);else{var i=new(L.get(n._iid).EmojiContainer)(r);e(null,i)}}))}),e)}},{key:"getEmojiCategory",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"number",constraint:function(e){return 0<=e}}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.getEmojiCategory({categoryId:e},(function(e,n){if(e)t(e,null);else{var i=new(L.get(r._iid).EmojiCategory)(n);t(null,i)}}))}),t)}},{key:"getEmoji",value:function(e,t){var n,r=this,i=E(z.parse(arguments,[new z({type:"string"}),new z({type:"callback"})]),3);return n=i[0],e=i[1],t=i[2],Z(this._iid,(function(t){n?t(n,null):k.get(r._iid).container.apiClient.getEmoji({emojiKey:e},(function(e,n){if(e)t(e,null);else{var i=new(L.get(r._iid).Emoji)(n);t(null,i)}}))}),t)}},{key:"ConnectionState",get:function(){return{CONNECTING:"CONNECTING",OPEN:"OPEN",CLOSED:"CLOSED"}}},{key:"MessageRequestState",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",SUCCEEDED:"succeeded"}}},{key:"MessageSendingStatus",get:function(){return{NONE:"none",PENDING:"pending",FAILED:"failed",CANCELED:"canceled",SUCCEEDED:"succeeded"}}},{key:"pushTokenRegistrationState",get:function(){return{SUCCESS:"success",PENDING:"pending",ERROR:"error"}}},{key:"PushTriggerOption",get:function(){return{ALL:"all",MENTION_ONLY:"mention_only",OFF:"off"}}},{key:"appInfo",get:function(){return k.get(this._iid).container.appInfo}}],[{key:"getInstance",value:function(e){return e?Et[e]:vt}},{key:"version",get:function(){return A.SDK_VERSION}}]),e}();return bt}(n(18),n(35),n(36))}).call(this,n(3),n(14).Buffer)},function(e,t){var n,r,i=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function a(){throw new Error("clearTimeout has not been defined")}function o(e){if(n===setTimeout)return setTimeout(e,0);if((n===s||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:s}catch(e){n=s}try{r="function"==typeof clearTimeout?clearTimeout:a}catch(e){r=a}}();var l,u=[],c=!1,d=-1;function h(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length&&f())}function f(){if(!c){var e=o(h);c=!0;for(var t=u.length;t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===a||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||c||o(f)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";e.exports=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}}},function(e,t,n){"use strict";var r=n(1);function i(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,n){if(!t)return e;var s;if(n)s=n(t);else if(r.isURLSearchParams(t))s=t.toString();else{var a=[];r.forEach(t,(function(e,t){null!=e&&(r.isArray(e)?t+="[]":e=[e],r.forEach(e,(function(e){r.isDate(e)?e=e.toISOString():r.isObject(e)&&(e=JSON.stringify(e)),a.push(i(t)+"="+i(e))})))})),s=a.join("&")}if(s){var o=e.indexOf("#");-1!==o&&(e=e.slice(0,o)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},function(e,t,n){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,n){"use strict";(function(t){var r=n(1),i=n(24),s={"Content-Type":"application/x-www-form-urlencoded"};function a(e,t){!r.isUndefined(e)&&r.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var o,l={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(o=n(9)),o),transformRequest:[function(e,t){return i(t,"Accept"),i(t,"Content-Type"),r.isFormData(e)||r.isArrayBuffer(e)||r.isBuffer(e)||r.isStream(e)||r.isFile(e)||r.isBlob(e)?e:r.isArrayBufferView(e)?e.buffer:r.isURLSearchParams(e)?(a(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):r.isObject(e)?(a(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};l.headers={common:{Accept:"application/json, text/plain, */*"}},r.forEach(["delete","get","head"],(function(e){l.headers[e]={}})),r.forEach(["post","put","patch"],(function(e){l.headers[e]=r.merge(s)})),e.exports=l}).call(this,n(3))},function(e,t,n){"use strict";var r=n(1),i=n(25),s=n(6),a=n(27),o=n(30),l=n(31),u=n(10);e.exports=function(e){return new Promise((function(t,c){var d=e.data,h=e.headers;r.isFormData(d)&&delete h["Content-Type"];var f=new XMLHttpRequest;if(e.auth){var p=e.auth.username||"",g=e.auth.password||"";h.Authorization="Basic "+btoa(p+":"+g)}var y=a(e.baseURL,e.url);if(f.open(e.method.toUpperCase(),s(y,e.params,e.paramsSerializer),!0),f.timeout=e.timeout,f.onreadystatechange=function(){if(f&&4===f.readyState&&(0!==f.status||f.responseURL&&0===f.responseURL.indexOf("file:"))){var n="getAllResponseHeaders"in f?o(f.getAllResponseHeaders()):null,r={data:e.responseType&&"text"!==e.responseType?f.response:f.responseText,status:f.status,statusText:f.statusText,headers:n,config:e,request:f};i(t,c,r),f=null}},f.onabort=function(){f&&(c(u("Request aborted",e,"ECONNABORTED",f)),f=null)},f.onerror=function(){c(u("Network Error",e,null,f)),f=null},f.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),c(u(t,e,"ECONNABORTED",f)),f=null},r.isStandardBrowserEnv()){var m=n(32),_=(e.withCredentials||l(y))&&e.xsrfCookieName?m.read(e.xsrfCookieName):void 0;_&&(h[e.xsrfHeaderName]=_)}if("setRequestHeader"in f&&r.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:f.setRequestHeader(t,e)})),r.isUndefined(e.withCredentials)||(f.withCredentials=!!e.withCredentials),e.responseType)try{f.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&f.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&f.upload&&f.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){f&&(f.abort(),c(e),f=null)})),void 0===d&&(d=null),f.send(d)}))}},function(e,t,n){"use strict";var r=n(26);e.exports=function(e,t,n,i,s){var a=new Error(e);return r(a,t,n,i,s)}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e,t){t=t||{};var n={},i=["url","method","params","data"],s=["headers","auth","proxy"],a=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];r.forEach(i,(function(e){void 0!==t[e]&&(n[e]=t[e])})),r.forEach(s,(function(i){r.isObject(t[i])?n[i]=r.deepMerge(e[i],t[i]):void 0!==t[i]?n[i]=t[i]:r.isObject(e[i])?n[i]=r.deepMerge(e[i]):void 0!==e[i]&&(n[i]=e[i])})),r.forEach(a,(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])}));var o=i.concat(s).concat(a),l=Object.keys(t).filter((function(e){return-1===o.indexOf(e)}));return r.forEach(l,(function(r){void 0!==t[r]?n[r]=t[r]:void 0!==e[r]&&(n[r]=e[r])})),n}},function(e,t,n){"use strict";function r(e){this.message=e}r.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},r.prototype.__CANCEL__=!0,e.exports=r},function(e,t,n){n(38),e.exports=n(37)},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(15),i=n(16),s=n(17);function a(){return l.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(a()<t)throw new RangeError("Invalid typed array length");return l.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=l.prototype:(null===e&&(e=new l(t)),e.length=t),e}function l(e,t,n){if(!(l.TYPED_ARRAY_SUPPORT||this instanceof l))return new l(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return d(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);l.TYPED_ARRAY_SUPPORT?(e=t).__proto__=l.prototype:e=h(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!l.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=o(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(l.isBuffer(t)){var n=0|f(t.length);return 0===(e=o(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?o(e,0):h(e,t);if("Buffer"===t.type&&s(t.data))return h(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function c(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function d(e,t){if(c(t),e=o(e,t<0?0:0|f(t)),!l.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function h(e,t){var n=t.length<0?0:0|f(t.length);e=o(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=a())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+a().toString(16)+" bytes");return 0|e}function p(e,t){if(l.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return x(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(e).length;default:if(r)return x(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return R(this,t,n);case"utf8":case"utf-8":return U(this,t,n);case"ascii":return k(this,t,n);case"latin1":case"binary":return N(this,t,n);case"base64":return I(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return T(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function m(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=l.from(t,r)),l.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t)return t&=255,l.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){var s,a=1,o=e.length,l=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;a=2,o/=2,l/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var c=-1;for(s=n;s<o;s++)if(u(e,s)===u(t,-1===c?0:s-c)){if(-1===c&&(c=s),s-c+1===l)return c*a}else-1!==c&&(s-=s-c),c=-1}else for(n+l>o&&(n=o-l),s=n;s>=0;s--){for(var d=!0,h=0;h<l;h++)if(u(e,s+h)!==u(t,h)){d=!1;break}if(d)return s}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");r>s/2&&(r=s/2);for(var a=0;a<r;++a){var o=parseInt(t.substr(2*a,2),16);if(isNaN(o))return a;e[n+a]=o}return a}function E(e,t,n,r){return j(x(t,e.length-n),e,n,r)}function C(e,t,n,r){return j(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function b(e,t,n,r){return C(e,t,n,r)}function S(e,t,n,r){return j(B(t),e,n,r)}function A(e,t,n,r){return j(function(e,t){for(var n,r,i,s=[],a=0;a<e.length&&!((t-=2)<0);++a)n=e.charCodeAt(a),r=n>>8,i=n%256,s.push(i),s.push(r);return s}(t,e.length-n),e,n,r)}function I(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function U(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var s,a,o,l,u=e[i],c=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(c=u);break;case 2:128==(192&(s=e[i+1]))&&(l=(31&u)<<6|63&s)>127&&(c=l);break;case 3:s=e[i+1],a=e[i+2],128==(192&s)&&128==(192&a)&&(l=(15&u)<<12|(63&s)<<6|63&a)>2047&&(l<55296||l>57343)&&(c=l);break;case 4:s=e[i+1],a=e[i+2],o=e[i+3],128==(192&s)&&128==(192&a)&&128==(192&o)&&(l=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&o)>65535&&l<1114112&&(c=l)}null===c?(c=65533,d=1):c>65535&&(c-=65536,r.push(c>>>10&1023|55296),c=56320|1023&c),r.push(c),i+=d}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=l,t.SlowBuffer=function(e){+e!=e&&(e=0);return l.alloc(+e)},t.INSPECT_MAX_BYTES=50,l.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=a(),l.poolSize=8192,l._augment=function(e){return e.__proto__=l.prototype,e},l.from=function(e,t,n){return u(null,e,t,n)},l.TYPED_ARRAY_SUPPORT&&(l.prototype.__proto__=Uint8Array.prototype,l.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&l[Symbol.species]===l&&Object.defineProperty(l,Symbol.species,{value:null,configurable:!0})),l.alloc=function(e,t,n){return function(e,t,n,r){return c(t),t<=0?o(e,t):void 0!==n?"string"==typeof r?o(e,t).fill(n,r):o(e,t).fill(n):o(e,t)}(null,e,t,n)},l.allocUnsafe=function(e){return d(null,e)},l.allocUnsafeSlow=function(e){return d(null,e)},l.isBuffer=function(e){return!(null==e||!e._isBuffer)},l.compare=function(e,t){if(!l.isBuffer(e)||!l.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,s=Math.min(n,r);i<s;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},l.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},l.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return l.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=l.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var a=e[n];if(!l.isBuffer(a))throw new TypeError('"list" argument must be an Array of Buffers');a.copy(r,i),i+=a.length}return r},l.byteLength=p,l.prototype._isBuffer=!0,l.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},l.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},l.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},l.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?U(this,0,e):g.apply(this,arguments)},l.prototype.equals=function(e){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===l.compare(this,e)},l.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},l.prototype.compare=function(e,t,n,r,i){if(!l.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(r>>>=0),a=(n>>>=0)-(t>>>=0),o=Math.min(s,a),u=this.slice(r,i),c=e.slice(t,n),d=0;d<o;++d)if(u[d]!==c[d]){s=u[d],a=c[d];break}return s<a?-1:a<s?1:0},l.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},l.prototype.indexOf=function(e,t,n){return m(this,e,t,n,!0)},l.prototype.lastIndexOf=function(e,t,n){return m(this,e,t,n,!1)},l.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var s=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return E(this,e,t,n);case"ascii":return C(this,e,t,n);case"latin1":case"binary":return b(this,e,t,n);case"base64":return S(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),s=!0}},l.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function k(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function N(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function R(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",s=t;s<n;++s)i+=G(e[s]);return i}function T(e,t,n){for(var r=e.slice(t,n),i="",s=0;s<r.length;s+=2)i+=String.fromCharCode(r[s]+256*r[s+1]);return i}function O(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function w(e,t,n,r,i,s){if(!l.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function M(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function P(e,t,n,r,i,s){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function D(e,t,n,r,s){return s||P(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function H(e,t,n,r,s){return s||P(e,0,n,8),i.write(e,t,n,r,52,8),n+8}l.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),l.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=l.prototype;else{var i=t-e;n=new l(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+e]}return n},l.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r},l.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},l.prototype.readUInt8=function(e,t){return t||O(e,1,this.length),this[e]},l.prototype.readUInt16LE=function(e,t){return t||O(e,2,this.length),this[e]|this[e+1]<<8},l.prototype.readUInt16BE=function(e,t){return t||O(e,2,this.length),this[e]<<8|this[e+1]},l.prototype.readUInt32LE=function(e,t){return t||O(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},l.prototype.readUInt32BE=function(e,t){return t||O(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},l.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=this[e],i=1,s=0;++s<t&&(i*=256);)r+=this[e+s]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},l.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||O(e,t,this.length);for(var r=t,i=1,s=this[e+--r];r>0&&(i*=256);)s+=this[e+--r]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},l.prototype.readInt8=function(e,t){return t||O(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},l.prototype.readInt16LE=function(e,t){t||O(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt16BE=function(e,t){t||O(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},l.prototype.readInt32LE=function(e,t){return t||O(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},l.prototype.readInt32BE=function(e,t){return t||O(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},l.prototype.readFloatLE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!0,23,4)},l.prototype.readFloatBE=function(e,t){return t||O(e,4,this.length),i.read(this,e,!1,23,4)},l.prototype.readDoubleLE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!0,52,8)},l.prototype.readDoubleBE=function(e,t){return t||O(e,8,this.length),i.read(this,e,!1,52,8)},l.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||w(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},l.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||w(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},l.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,1,255,0),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},l.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},l.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,65535,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},l.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},l.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,4294967295,0),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},l.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=0,a=1,o=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},l.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);w(this,e,t,n,i-1,-i)}var s=n-1,a=1,o=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/a>>0)-o&255;return t+n},l.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,1,127,-128),l.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},l.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):M(this,e,t,!0),t+2},l.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,2,32767,-32768),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):M(this,e,t,!1),t+2},l.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,2147483647,-2147483648),l.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},l.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||w(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),l.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},l.prototype.writeFloatLE=function(e,t,n){return D(this,e,t,!0,n)},l.prototype.writeFloatBE=function(e,t,n){return D(this,e,t,!1,n)},l.prototype.writeDoubleLE=function(e,t,n){return H(this,e,t,!0,n)},l.prototype.writeDoubleBE=function(e,t,n){return H(this,e,t,!1,n)},l.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,s=r-n;if(this===e&&n<t&&t<r)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!l.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},l.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!l.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=l.isBuffer(e)?e:x(new l(e,r).toString()),o=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%o]}return this};var F=/[^+\/0-9A-Za-z-_]/g;function G(e){return e<16?"0"+e.toString(16):e.toString(16)}function x(e,t){var n;t=t||1/0;for(var r=e.length,i=null,s=[],a=0;a<r;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===r){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function B(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(F,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function j(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(4))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),a=r[0],o=r[1],l=new s(function(e,t,n){return 3*(t+n)/4-n}(0,a,o)),c=0,d=o>0?a-4:a;for(n=0;n<d;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],l[c++]=t>>16&255,l[c++]=t>>8&255,l[c++]=255&t;2===o&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,l[c++]=255&t);1===o&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,l[c++]=t>>8&255,l[c++]=255&t);return l},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,s=[],a=0,o=n-i;a<o;a+=16383)s.push(c(e,a,a+16383>o?o:a+16383));1===i?(t=e[n-1],s.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],s.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return s.join("")};for(var r=[],i=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,l=a.length;o<l;++o)r[o]=a[o],i[a.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,n){for(var i,s,a=[],o=t;o<n;o+=3)i=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),a.push(r[(s=i)>>18&63]+r[s>>12&63]+r[s>>6&63]+r[63&s]);return a.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var s,a,o=8*i-r-1,l=(1<<o)-1,u=l>>1,c=-7,d=n?i-1:0,h=n?-1:1,f=e[t+d];for(d+=h,s=f&(1<<-c)-1,f>>=-c,c+=o;c>0;s=256*s+e[t+d],d+=h,c-=8);for(a=s&(1<<-c)-1,s>>=-c,c+=r;c>0;a=256*a+e[t+d],d+=h,c-=8);if(0===s)s=1-u;else{if(s===l)return a?NaN:1/0*(f?-1:1);a+=Math.pow(2,r),s-=u}return(f?-1:1)*a*Math.pow(2,s-r)},t.write=function(e,t,n,r,i,s){var a,o,l,u=8*s-i-1,c=(1<<u)-1,d=c>>1,h=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:s-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,a=c):(a=Math.floor(Math.log(t)/Math.LN2),t*(l=Math.pow(2,-a))<1&&(a--,l*=2),(t+=a+d>=1?h/l:h*Math.pow(2,1-d))*l>=2&&(a++,l/=2),a+d>=c?(o=0,a=c):a+d>=1?(o=(t*l-1)*Math.pow(2,i),a+=d):(o=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+f]=255&o,f+=p,o/=256,i-=8);for(a=a<<i|o,u+=i;u>0;e[n+f]=255&a,f+=p,a/=256,u-=8);e[n+f-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){e.exports=n(19)},function(e,t,n){"use strict";var r=n(1),i=n(5),s=n(20),a=n(11);function o(e){var t=new s(e),n=i(s.prototype.request,t);return r.extend(n,s.prototype,t),r.extend(n,t),n}var l=o(n(8));l.Axios=s,l.create=function(e){return o(a(l.defaults,e))},l.Cancel=n(12),l.CancelToken=n(33),l.isCancel=n(7),l.all=function(e){return Promise.all(e)},l.spread=n(34),e.exports=l,e.exports.default=l},function(e,t,n){"use strict";var r=n(1),i=n(6),s=n(21),a=n(22),o=n(11);function l(e){this.defaults=e,this.interceptors={request:new s,response:new s}}l.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=o(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[a,void 0],n=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)n=n.then(t.shift(),t.shift());return n},l.prototype.getUri=function(e){return e=o(this.defaults,e),i(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},r.forEach(["delete","get","head","options"],(function(e){l.prototype[e]=function(t,n){return this.request(r.merge(n||{},{method:e,url:t}))}})),r.forEach(["post","put","patch"],(function(e){l.prototype[e]=function(t,n,i){return this.request(r.merge(i||{},{method:e,url:t,data:n}))}})),e.exports=l},function(e,t,n){"use strict";var r=n(1);function i(){this.handlers=[]}i.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},i.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},i.prototype.forEach=function(e){r.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=i},function(e,t,n){"use strict";var r=n(1),i=n(23),s=n(7),a=n(8);function o(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return o(e),e.headers=e.headers||{},e.data=i(e.data,e.headers,e.transformRequest),e.headers=r.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),r.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||a.adapter)(e).then((function(t){return o(e),t.data=i(t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(o(e),t&&t.response&&(t.response.data=i(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e,t,n){return r.forEach(n,(function(n){e=n(e,t)})),e}},function(e,t,n){"use strict";var r=n(1);e.exports=function(e,t){r.forEach(e,(function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])}))}},function(e,t,n){"use strict";var r=n(10);e.exports=function(e,t,n){var i=n.config.validateStatus;!i||i(n.status)?e(n):t(r("Request failed with status code "+n.status,n.config,null,n.request,n))}},function(e,t,n){"use strict";e.exports=function(e,t,n,r,i){return e.config=t,n&&(e.code=n),e.request=r,e.response=i,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,n){"use strict";var r=n(28),i=n(29);e.exports=function(e,t){return e&&!r(t)?i(e,t):t}},function(e,t,n){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,n){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,n){"use strict";var r=n(1),i=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,n,s,a={};return e?(r.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=r.trim(e.substr(0,s)).toLowerCase(),n=r.trim(e.substr(s+1)),t){if(a[t]&&i.indexOf(t)>=0)return;a[t]="set-cookie"===t?(a[t]?a[t]:[]).concat([n]):a[t]?a[t]+", "+n:n}})),a):a}},function(e,t,n){"use strict";var r=n(1);e.exports=r.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function i(e){var r=e;return t&&(n.setAttribute("href",r),r=n.href),n.setAttribute("href",r),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:"/"===n.pathname.charAt(0)?n.pathname:"/"+n.pathname}}return e=i(window.location.href),function(t){var n=r.isString(t)?i(t):t;return n.protocol===e.protocol&&n.host===e.host}}():function(){return!0}},function(e,t,n){"use strict";var r=n(1);e.exports=r.isStandardBrowserEnv()?{write:function(e,t,n,i,s,a){var o=[];o.push(e+"="+encodeURIComponent(t)),r.isNumber(n)&&o.push("expires="+new Date(n).toGMTString()),r.isString(i)&&o.push("path="+i),r.isString(s)&&o.push("domain="+s),!0===a&&o.push("secure"),document.cookie=o.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,n){"use strict";var r=n(12);function i(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var n=this;e((function(e){n.reason||(n.reason=new r(e),t(n.reason))}))}i.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},i.source=function(){var e;return{token:new i((function(t){e=t})),cancel:e}},e.exports=i},function(e,t,n){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(e,t){e.exports="object"==typeof self?self.FormData:window.FormData},function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,n){},function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return _}));const r=e=>{let t=e=>{e.html=t=>(void 0!==t&&(e.innerHTML=t),e.innerHTML),e.attr=(t,n)=>(void 0!==n&&(n?e.setAttribute(t,n):e.removeAttribute(t)),e.getAttribute(t)),e.val=t=>(void 0!==t&&(e.value=t),e.value),e.simplifiedChildren=()=>{let t=[];for(let n=0;n<e.children.length;n++)t.push(r(e.children[n]));return t},e.removeAll=t=>{if(t){let n=[],r=e.simplifiedChildren();for(let e in r)r[e].hasClass(t)&&n.push(r[e]);for(let t in n)e.removeChild(n[t])}else e.innerHTML=""},e.show=t=>(e.style.display=t||"",e),e.hide=()=>(e.style.display="none",e),e.fadeIn=(t=300,n)=>{e.style.opacity=0,e.style.display="inline-block";let r=0;const i=setInterval(()=>{e.style.opacity=Math.min(r/t,1),r+=10,r>t&&(clearInterval(i),n&&n())},10)},e.fadeOut=(t=300,n)=>{e.style.opacity=1;let r=0;const i=setInterval(()=>{e.style.opacity=1-Math.min(r/t,1),r+=10,r>t&&(clearInterval(i),n&&n())},10)},e.hasClass=t=>e.classList?e.classList.contains(t):new RegExp("(^| )"+t+"( |$)","gi").test(e.className),e.addClass=t=>(Array.isArray(t)||(t=t?[t]:[]),t.forEach(t=>{e.classList?t in e.classList||e.classList.add(t):e.className.indexOf(t)<0&&(e.className+=" "+t)}),e),e.removeClass=t=>(e.classList?e.classList.remove(t):e.className=e.className.replace(new RegExp("(^|\\b)"+t.split(" ").join("|")+"(\\b|$)","gi"),""),e),e.toggleClass=t=>{e.hasClass(t)?e.removeClass(t):e.addClass(t)},e.on=(t,n)=>{e.addEventListener(t,n)},e.off=(t,n)=>{e.removeEventListener(t,n)}};if(e instanceof NodeList&&(e=Array.from(e)),Array.isArray(e))for(let n in e)t(e[n]);else e instanceof HTMLElement&&t(e);return e},i=e=>{var t=document.createElement("div");return t.innerHTML=e.trim(),(t=r(t.firstChild)).parentNode&&t.parentNode.removeChild(t),t},s={};let a=0;class o{constructor(e,t){this._sid=a++,this.event=e,this.callback=t}static send(e,t){if(e instanceof Array)for(let n in e)o.send(e[n],t);else if(s[e])for(let n in s[e])s[e][n].callback(t)}static subscribe(e,t){const n=new o(e,t);return s[e]||(s[e]=[]),s[e].push(n),n}static unsubscribe(e){const t=e.event;if(s[t])for(let n in s[t])if(s[t][n]._sid===e._sid){s[t].splice(n,1);break}}}var l=n(2),u=n.n(l),c=n(0),d=n.n(c);class h{constructor(){this.attachCount=0,this.element=i("<div class='-sbd-spinner'>\n            <div class='-sbd-spinner-wrapper'>\n                <div></div>\n                <div></div>\n                <div></div>\n            </div>\n        </div>")}isAttached(){return!!this.element.parentNode}attachTo(e){this.attachCount++,this.isAttached()||e.appendChild(this.element)}detach(){this.attachCount--,this.isAttached()&&0===this.attachCount&&this.element.parentNode.removeChild(this.element)}}class f{constructor(e,t){this.message=e,this.streak=!!t,this.element=i("<div class='-sbd-message-item'>\n            <div class='profile'>\n                <img src='' alt='Profile' class='image'></img>\n            </div>\n            <div class='content'>\n                <div class='media'>\n                    <img src='' alt='Image' class='image'></img>\n                    <video src='' controls='controls' width='240' height='200' class='video'></video>\n                </div>\n                <div class='preview'>\n                    <img src='' alt='Image' class='image'></img>\n                    <div class='title'></div>\n                    <div class='description'></div>\n                </div>\n                <div class='message'>\n                  <div class='file'></div>\n                  <div class='text'></div>\n                </div>\n                <div class='rating'>\n                  <div class='rating-message'></div>\n                  <div class='rating-score'>\n                    <div class='rating-item'></div>\n                    <div class='rating-item'></div>\n                    <div class='rating-item'></div>\n                    <div class='rating-item'></div>\n                    <div class='rating-item'></div>\n                  </div>\n                  <div class='rating-form'>\n                    <textarea class='rating-comment' placeholder='(Optional)'></textarea>\n                    <button class='rating-submit'>Submit</button>\n                  </div>\n                </div>\n                <div class='rating-result'>\n                  <div class='rating-message'>Thank you!</div>\n                  <div class='rating-description'>Your submission has been received</div>\n                  <div class='line'></div>\n                  <div class='rating-result-score'>\n                    <div class='rating-result-item'></div>\n                    <div class='rating-result-item'></div>\n                    <div class='rating-result-item'></div>\n                    <div class='rating-result-item'></div>\n                    <div class='rating-result-item'></div>\n                    <div class='rating-result-number'></div>\n                  </div>\n                  <div class='rating-result-comment'></div>\n                </div>\n                <div class='created-at'></div>\n            </div>\n            <div class='confirm-end-of-chat'>\n              <div class='message'></div>\n              <div class='confirm'>\n                <div class='yes button'>Yes</div>\n                <div class='no button'>No</div>\n              </div>\n            </div>\n        </div>"),this.isSatisfactionForm=!1,this.satisfaction={score:null,comment:null,sent:!1},this.content=r(this.element.querySelector(".content")),this.media=r(this.content.querySelector(".media")),this.image=r(this.media.querySelector(".image")),this.video=r(this.media.querySelector(".video")),this.preview=r(this.element.querySelector(".preview")),this.previewImage=r(this.preview.querySelector(".image")),this.previewTitle=r(this.preview.querySelector(".title")),this.previewDescription=r(this.preview.querySelector(".description")),this.profile=r(this.element.querySelector(".profile")),this.profileImage=r(this.profile.querySelector(".image")),this.messageBox=r(this.element.querySelector(".content .message")),this.messageFile=r(this.messageBox.querySelector(".file")),this.messageText=r(this.messageBox.querySelector(".text")),this.createdAt=r(this.element.querySelector(".created-at")),this.confirmEndOfChat=r(this.element.querySelector(".confirm-end-of-chat")),this.confirmMessage=r(this.confirmEndOfChat.querySelector(".message")),this.confirm=r(this.confirmEndOfChat.querySelector(".confirm")),this.yes=r(this.confirm.querySelector(".yes")),this.no=r(this.confirm.querySelector(".no")),this.yes.on("click",()=>{d.a.Ticket.confirmEndOfChat(this.message,"yes")}),this.no.on("click",()=>{d.a.Ticket.confirmEndOfChat(this.message,"no")}),this.rating=r(this.element.querySelector(".rating")),this.ratingMessage=r(this.rating.querySelector(".rating-message")),this.ratingItems=r(this.rating.querySelectorAll(".rating-item")),this.ratingForm=r(this.rating.querySelector(".rating-form")),this.ratingComment=r(this.rating.querySelector(".rating-comment")),this.ratingSubmit=r(this.rating.querySelector(".rating-submit")),this.ratingItems.forEach((e,t)=>{e.on("click",()=>{if(!this.satisfaction.sent){for(let e=0;e<this.ratingItems.length;e++)e<=t?this.ratingItems[e].addClass("selected"):this.ratingItems[e].removeClass("selected");this.satisfaction.score=t+1,this.ratingForm.show()}})}),this.ratingSubmit.on("click",()=>{if(!this.satisfaction.sent){const e=this.ratingComment.val();d.a.Ticket.submitFeedback(this.message,this.satisfaction.score,e,(t,n)=>{n||(this.satisfaction.comment=e,this.satisfaction.sent=!0)})}}),this.ratingResult=r(this.element.querySelector(".rating-result")),this.ratingResultItems=r(this.ratingResult.querySelectorAll(".rating-result-item")),this.ratingResultNumber=r(this.ratingResult.querySelector(".rating-result-number")),this.ratingResultComment=r(this.ratingResult.querySelector(".rating-result-comment")),this.render()}render(){const e=u.a.getInstance(),t=this.message.sender||{};e.getCurrentUserId()===t.userId&&(this.messageFile.removeClass("file"),this.messageFile.addClass("my-file"),this.element.addClass("-sbd-my-message")),this.message.isAdminMessage()&&this.element.addClass("-sbd-admin-message");try{const e=JSON.parse(this.message.data);"SENDBIRD_DESK_CUSTOMER_SATISFACTION"===e.type&&(this.isSatisfactionForm=!0,this.satisfaction.ticketId=e.body.ticketId,"WAITING"!==e.body.status&&(this.satisfaction.score=e.body.customerSatisfactionScore,this.satisfaction.comment=e.body.customerSatisfactionComment,this.satisfaction.sent=!0))}catch(e){}if(t.profileUrl?(this.profileImage.attr("src",t.profileUrl),this.profileImage.show()):this.message.isAdminMessage()?this.profileImage.attr("src",""):this.profileImage.hide(),this.isSatisfactionForm)this.preview.hide(),this.media.hide(),this.messageBox.hide(),this.confirmEndOfChat.hide(),this.satisfaction.sent?(this.rating.hide(),this.ratingResult.show(),this.ratingResultItems.forEach((e,t)=>{t+1<=this.satisfaction.score&&e.addClass("selected")}),this.ratingResultNumber.html(this.satisfaction.score),this.satisfaction.comment?this.ratingResultComment.html(this.satisfaction.comment):this.ratingResultComment.hide()):(this.rating.show(),this.ratingResult.hide(),this.ratingMessage.html(this.message.message)),this.ratingForm.hide();else{if(this.preview.hide(),this.message.data)try{const e=JSON.parse(this.message.data);switch(e.type){case d.a.Message.DataType.URL_PREVIEW:this.message.message=this.message.message.replace(d.a.Message.UrlRegExp,e=>`<a href='${e}' target='_blank'>${e}</a>`),e.body.url&&e.body.title&&(this.preview.attr("href",e.body.url),this.previewTitle.html(e.body.title),e.body.image?(this.previewImage.attr("src",e.body.image),this.previewImage.show()):this.previewImage.hide(),e.body.description&&this.previewDescription.html(e.body.description),this.preview.on("click",()=>window.open(e.body.url,"_blank")),this.preview.show());break;case d.a.Message.DataType.TICKET_FEEDBACK:}}catch(e){}this.message.isAdminMessage()?(this.messageFile.hide(),this.media.hide(),this.messageBox.show(),this.messageText.html(this.message.message)):this.message.isFileMessage()?this.message.type.indexOf("image")>=0?(this.messageBox.hide(),this.video.hide(),this.image.attr("src",this.message.url)):this.message.type.indexOf("video")>=0?(this.messageBox.hide(),this.image.hide(),this.video.attr("src",this.message.url)):(this.messageFile.show("inline-block"),this.media.hide(),this.messageBox.show(),this.messageText.html(this.message.name),this.messageText.addClass("file-name"),this.messageText.on("click",()=>{window.open(this.message.url,"_blank")})):(this.messageFile.hide(),this.media.hide(),this.messageBox.show(),this.messageText.html(this.message.message)),this.streak&&this.createdAt.hide(),this.createdAt.html(moment(this.message.createdAt).fromNow());let e=null;try{e=this.message.data?JSON.parse(this.message.data):null}catch(e){throw e}if(e&&e.type===d.a.Message.DataType.TICKET_INQUIRE_CLOSURE){switch(e.body.state){case d.a.Message.ClosureState.WAITING:this.profile.hide(),this.content.hide(),this.confirmMessage.html(this.message.message),this.confirmEndOfChat.show();break;default:this.confirmEndOfChat.hide()}}else this.confirmEndOfChat.hide();this.rating.hide(),this.ratingResult.hide()}}static get Script(){return{TICKET_ASSIGNED:"Ticket assigned.",TICKET_CLOSED:"Ticket closed.",TICKET_START:"Hi, what can I help you?"}}static isVisible(e){let t=null;try{t=e.data?JSON.parse(e.data):null}catch(e){throw e}return e.isSystemMessage="SENDBIRD_DESK_ADMIN_MESSAGE_CUSTOM_TYPE"===e.customType,e.isAssigned=t&&t.type===d.a.Message.DataType.TICKET_ASSIGN,e.isTransferred=t&&t.type===d.a.Message.DataType.TICKET_TRANSFER,e.isClosed=t&&t.type===d.a.Message.DataType.TICKET_CLOSE,!(e.isSystemMessage||e.isAssigned||e.isTransferred||e.isClosed)}}class p{constructor(e){this.ticket=e,this.element=i(`<div class='-sbd-dialog'>\n            <div class='-sbd-dialog-header'>\n                <div class='close'></div>\n                <div class='agent'>\n                    <div class='profile'>\n                        <img src='' alt='Profile' class='image'></img>\n                    </div>\n                    <div class='name'>${this.ticket.agent?this.ticket.agent.name:"Agent"}</div>\n                </div>\n            </div>\n            <div class='-sbd-message-list'>\n            </div>\n            <div class='-sbd-message-form'>\n                <input type='text' class='message' placeholder='Write a message...'></input>\n                <div class='attach'><input type='file' class='file'></input></div>\n            </div>\n        </div>`),this.updateAgent(e.agent),this.isOpened=!1;r(this.element.querySelector(".close")).on("click",()=>{this.close()}),this.messageList=r(this.element.querySelector(".-sbd-message-list")),this.messageElementList=[],this.collisionSet=new Set,this.spinner=new h,this.messageRevision=0,this.isLoading=!1,this.noMoreMessage=!1,this.messageList.on("scroll",e=>{if(!this.isLoading&&!this.noMoreMessage&&this.isTop()){this.isLoading=!0;const t=this.messageRevision;this.loadMessage(!0,(e,n)=>{if(!n&&this.messageRevision===t){const t=e;for(let e in t){const n=t[e];f.isVisible(n)&&this.prependMessage(n)}}this.isLoading=!1}),e.preventDefault(),e.stopPropagation()}}),this.form=r(this.element.querySelector(".-sbd-message-form")),this.input=r(this.form.querySelector(".message")),this.attach=r(this.form.querySelector(".attach")),this.file=r(this.form.querySelector(".file")),this.editable=!0,e.status===d.a.Ticket.Status.CLOSED&&this.disableForm(),this.input.on("keypress",e=>{if(13===e.keyCode&&!e.shiftKey){e.preventDefault();const t=this.input.val();this.input.val(""),t&&this.editable&&(this.ticket.status===d.a.Ticket.Status.INITIALIZED&&(this.ticket.status=d.a.Ticket.Status.UNASSIGNED),this.ticket.channel.sendUserMessage(t,(e,t)=>{if(t)this.ticket.status=d.a.Ticket.Status.INITIALIZED;else{const t=e;d.a.Message.UrlRegExp.test(t.message)&&(t.url=d.a.Message.UrlRegExp.exec(t.message)[0],d.a.Ticket.getUrlPreview(t.url,(e,n)=>{if(n)throw n;this.ticket.channel.updateUserMessage(t.messageId,t.message,JSON.stringify({type:d.a.Message.DataType.URL_PREVIEW,body:{url:t.url,site_name:e.data.siteName,title:e.data.title,description:e.data.description,image:e.data.image}}),t.customType,(e,t)=>{if(t)throw t;this.updateMessage(e)})})),this.appendMessage(e),this.scrollToBottom()}}))}}),this.attach.on("click",()=>{this.editable&&this.file.click()}),this.file.on("change",()=>{if(this.editable){let e=this.file.files[0];this.ticket.channel.sendFileMessage(e,e.name,e.type,e.size,"","",[{maxWidth:220,maxHeight:220}],(e,t)=>{t||f.isVisible(e)&&this.appendMessage(e)})}}),this.file.on("click",e=>e.stopPropagation())}loadMessage(e,t){this.query&&e||(this.query=this.ticket.channel.createPreviousMessageListQuery(),this.clearMessage()),this.query.load(20,!0,(e,n)=>{if(n)throw n;this.noMoreMessage=e.length<20,t(e,n)})}open(e){if(e){this.isOpened=!0,this.widget=e,this.widget.panel.appendChild(this.element),this.element.addClass("opened"),this.ticket.channel.markAsRead(),this.spinner.attachTo(this.messageList),this.messageRevision++;const t=this.messageRevision;this.loadMessage(!1,(e,n)=>{if(!n&&this.messageRevision===t){const t=e;for(let e in t){const n=t[e];f.isVisible(n)&&this.prependMessage(n)}this.scrollToBottom()}this.spinner.detach()})}}close(e){e?(this.element.hide(),this.element.parentNode&&this.widget.panel.removeChild(this.element)):(this.element.removeClass("opened"),setTimeout(()=>{this.element.parentNode&&this.widget.panel.removeChild(this.element)},1e3)),this.isOpened=!1}enableForm(){this.editable=!0,this.form.removeClass("disabled"),this.input.attr("readonly",""),this.input.attr("placeholder","Write a message..."),this.attach.show()}disableForm(){this.editable=!1,this.form.addClass("disabled"),this.input.attr("readonly","readonly"),this.input.attr("placeholder",""),this.attach.hide()}updateAgent(e){this.ticket&&(this.ticket.agent=e);let t=r(this.element.querySelector(".agent .profile .image")),n=r(this.element.querySelector(".agent .name"));e?(e.profileUrl?(t.attr("src",e.profileUrl),t.show()):t.hide(),n.html(e.name||"Agent")):(t.hide(),n.html("Agent"))}isMessageStreak(e,t){return(!e.sender&&!t.sender||e.sender&&t.sender&&e.sender.userId===t.sender.userId)&&Math.round((e.createdAt-t.createdAt)/1e3)<60}prependMessage(e){if(!this.collisionSet.has(e.messageId)){this.collisionSet.add(e.messageId);let t=!1;if(this.messageElementList.length>0){let n=null;for(let e in this.messageElementList){const t=this.messageElementList[e];if(!t.streak){n=t;break}}n&&(t=this.isMessageStreak(n.message,e))}const n=new f(e,t);this.messageElementList.unshift(n),this.messageList.firstChild?this.messageList.insertBefore(n.element,this.messageList.firstChild):this.messageList.appendChild(n.element)}}appendMessage(e){if(!this.collisionSet.has(e.messageId)){if(this.collisionSet.add(e.messageId),this.messageElementList.length>0){const t=this.messageElementList[this.messageElementList.length-1];this.isMessageStreak(e,t.message)&&(t.streak=!0,t.render())}const t=this.isBottom(),n=new f(e);this.messageElementList.push(n),this.messageList.appendChild(n.element),!this.spinner.isAttached()&&t&&this.scrollToBottom()}}updateMessage(e){for(let t in this.messageElementList){const n=this.messageElementList[t];if(n.message.messageId===e.messageId){n.message=e,n.render();break}}}clearMessage(){this.collisionSet=new Set,this.messageList.removeAll("-sbd-message-item"),this.messageElementList=[]}isTop(){return 0===this.messageList.scrollTop}isBottom(){return this.messageList.scrollHeight-this.messageList.scrollTop===this.messageList.clientHeight}scrollToBottom(){this.messageList.scrollTo(0,this.messageList.scrollHeight)}}class g{constructor(e,t){this.ticket=t,this.element=i(`<div class='-sbd-ticket-item'>\n            <div class='profile'>\n                <img src='${t.agent?t.agent.profileUrl:""}' alt='Profile' class='image'></img>\n                <div class='badge'></div>\n            </div>\n            <div class='content'>\n                <div class='name'>${t.agent?t.agent.name:t.title}</div>\n                <div class='last'>${t.channel.lastMessage.message||"No message"}</div>\n            </div>\n            <div class='updated-at'></div>\n        </div>`),this.profileImage=r(this.element.querySelector(".profile .image")),this.badge=r(this.element.querySelector(".profile .badge")),this.name=r(this.element.querySelector(".content .name")),this.last=r(this.element.querySelector(".content .last")),this.updatedAt=r(this.element.querySelector(".updated-at")),this.render(),this.element.on("click",()=>{e.startNewDialog(this.ticket)})}render(){const e=this.ticket.agent;e&&e.profileUrl?(this.profileImage.attr("src",e.profileUrl),this.profileImage.show()):this.profileImage.hide();let t=this.ticket.channel.unreadMessageCount;t>0?(t>=99&&(t+="+"),this.badge.html(t),this.badge.show()):this.badge.hide(),this.name.html(e?e.name:this.ticket.title),this.ticket.channel.lastMessage&&(this.ticket.channel.lastMessage.isFileMessage()?this.last.html(this.ticket.channel.lastMessage.name):this.last.html(this.ticket.channel.lastMessage.message)),this.updatedAt.html(moment(this.ticket.channel.lastMessage?this.ticket.channel.lastMessage.createdAt:null).fromNow())}}class y{constructor(e,t){this.ticket=e,this.message=t,this.element=i("<div class='-sbd-notification'>\n            <div class='profile'>\n              <img src='' alt='Profile' class='image'></img>\n            </div>\n            <div class='content'>\n              <div class='name'>Agent</div>\n              <div class='close'></div>\n              <div class='text'></div>\n            </div>\n        </div>"),this.onClickHandler=null,this.element.on("click",()=>{this.onClickHandler&&this.onClickHandler(this.ticket,this.message)});r(this.element.querySelector(".close")).on("click",e=>{e.stopPropagation(),e.preventDefault(),this.close()}),this.profile=r(this.element.querySelector(".profile")),this.profileImage=r(this.profile.querySelector(".image")),this.messageBox=r(this.element.querySelector(".content")),this.name=r(this.element.querySelector(".name")),this.messageText=r(this.messageBox.querySelector(".text")),this.render()}render(){const e=this.message.sender||{};e.profileUrl?(this.profileImage.attr("src",e.profileUrl),this.profileImage.show()):this.profileImage.hide(),e.name&&this.name.html(e.name),this.message.isAdminMessage()?this.messageText.html(this.message.message):this.message.isFileMessage()?this.messageText.html(this.message.name):this.messageText.html(this.message.message)}open(e,t=5e3){this.widget=e,this.element.addClass("fade-in"),this.widget.element.appendChild(this.element),setTimeout(()=>{this.close()},t)}close(){this.element.removeClass("fade-in"),setTimeout(()=>{this.element.parentNode&&this.widget.element.removeChild(this.element)},2e3)}onClick(e){this.onClickHandler=e}}class m{constructor(e,t){this.element=document.getElementById("sb-desk"),this.element.className="-sbd-widget",t||(t={}),m.panel=this.panel=i(`<div class='-sbd-panel'>\n            <div class='-sbd-header'>\n                <div class='-sbd-title'>Inbox</div>\n                <div class='-sbd-tabs'>\n                    <div class='-sbd-tab-item' data-status='${d.a.Ticket.Status.OPEN}'>OPEN</div>\n                    <div class='-sbd-tab-item' data-status='${d.a.Ticket.Status.CLOSED}'>CLOSED</div>\n                    <div class='-sbd-tab-bar'></div>\n                </div>\n                <div class='-sbd-menu'><div class='icon'></div></div>\n                <div class='-sbd-menu-list'>\n                  <div class='-sbd-menu-item' data-cmd='signout'>Sign out</div>\n                </div>\n            </div>\n            <div class='-sbd-ticket-list'>\n                <div class='-sbd-ticket-new'>\n                    <div class='icon'></div>\n                    <div class='label'>Start a new conversation.</div>\n                </div>\n            </div>\n            <div class='-sbd-error'>Cannot connect to internet.</div>\n        </div>`),this.element.appendChild(this.panel),this.error=r(this.element.querySelector(".-sbd-error"));let n=r(document.querySelectorAll(".-sbd-tabs > .-sbd-tab-item")),s=r(document.querySelector(".-sbd-tabs > .-sbd-tab-bar"));for(let e=0;e<n.length;e++)n[e].on("click",e=>{let t=e.target.getAttribute("data-status");p(t)});let a=r(document.querySelector(".-sbd-menu")),o=r(document.querySelector(".-sbd-menu-list"));a.on("click",()=>o.toggleClass("fade-in"));let l=r(document.querySelectorAll(".-sbd-menu-list > .-sbd-menu-item"));for(let e=0;e<l.length;e++)l[e].on("click",e=>{switch(e.target.getAttribute("data-cmd")){case"signout":this.signout()}o.toggleClass("fade-in")});this.ticketList=r(document.querySelector(".-sbd-panel > .-sbd-ticket-list")),this.ticketElementList=[],this.ticketRevision=0,this.isLoading=!1,this.noMoreTicket=!1,this.ticketList.on("scroll",()=>{if(!this.isLoading&&!this.noMoreTicket&&this.isBottom()){this.isLoading=!0,this.currentPage++;const e=this.ticketRevision;this.loadTicket(this.currentTab,this.currentPage,(t,n)=>{if(!n&&this.ticketRevision===e)for(let e in t)this.appendTicket(t[e]);this.isLoading=!1})}});let c=r(document.querySelector(".-sbd-ticket-list > .-sbd-ticket-new"));c.on("click",()=>{const t="Issue #"+("000"+(new Date).getTime()%1e3).slice(-3);this.spinner.attachTo(this.ticketList),d.a.Ticket.create(t,e.nickname,(e,t)=>{if(t)throw t;this.spinner.detach(),this.startNewDialog(e)})}),this.spinner=new h,this.currentTab="",this.currentPage=0,this.payloadTicket=null;let p=e=>{if(e!=this.currentTab){for(let t=0;t<n.length;t++){n[t].attr("data-status")===e&&(s.style.left=n[t].offsetLeft+"px")}e===d.a.Ticket.Status.OPEN?c.show():c.hide(),this.currentTab=e,this.currentPage=0,this.ticketRevision++,this.clearTicket();const t=this.ticketRevision;this.spinner.attachTo(this.ticketList),this.loadTicket(e,this.currentPage,(e,n)=>{if(this.spinner.detach(),!n&&this.ticketRevision===t){for(let t in e)this.appendTicket(e[t]);this.payloadTicket&&(this.startNewDialog(this.payloadTicket),this.payloadTicket=null)}})}};const _=r(document.querySelector(".guide-balloon"));this.active=!1,this.action=i("<div class='-sbd-action-button'></div>"),this.action.on("click",()=>{this.active=!this.active,this.action.toggleClass("is-active"),this.panel.toggleClass("fade-in"),this.active?p(d.a.Ticket.Status.OPEN):this.dialog&&setTimeout(()=>{this.currentTab="",this.dialog.close(!0)},500),this.active?_.hide():_.show()}),this.action.hide(),this.element.appendChild(this.action),this.sendbird=new u.a({appId:e.appId}),this.sendbird.connect(e.userId,t.apiHost,t.wsHost,(n,r)=>{if(r)throw r;this.sendbird.updateCurrentUserInfo(e.nickname,null,(n,r)=>{if(r)throw r;d.a.init(u.a),t.deskApiHost&&d.a.setApiHost(t.deskApiHost),d.a.authenticate(e.userId,(e,t)=>{if(t)throw t;_.fadeIn(300),this.action.show();const n=new this.sendbird.ConnectionHandler;n.onReconnectStarted=()=>{this.active&&this.spinner.attachTo(this.ticketList)},n.onReconnectSucceeded=()=>{if(this.active){const e=this.currentTab;if(this.currentTab="",this.error.hide(),this.dialog&&this.dialog.isOpened){this.dialog.ticket.channel.markAsRead(),this.dialog.ticket.refresh((e,t)=>{t||(this.dialog.ticket=e,this.dialog.updateAgent(e.agent))});const t=this.dialog.messageRevision;this.dialog.loadMessage(!1,(n,r)=>{if(!r){if(this.dialog.messageRevision===t){const e=n;for(let t in e){const n=e[t];f.isVisible(n)&&this.dialog.prependMessage(n)}this.dialog.scrollToBottom()}this.spinner.detach()}p(e)})}else this.spinner.detach(),p(e)}},n.onReconnectFailed=()=>{this.active&&(this.spinner.detach(),this.error.show())},this.sendbird.addConnectionHandler("widget",n);const r=new this.sendbird.ChannelHandler;r.onChannelChanged=e=>{d.a.Ticket.getByChannelUrl(e.url,(t,n)=>{if(n)throw n;const r=t;r.channel=e;let i=this.ticketElementList.findIndex(e=>e.ticket.id===r.id),s=i>=0?this.ticketElementList[i]:null;s&&(s.ticket=r,s.render());const a=r.status===d.a.Ticket.Status.INITIALIZED,o=r.status===d.a.Ticket.Status.CLOSED,l=0===i;this.currentTab===d.a.Ticket.Status.CLOSED||l||o||(s?(this.ticketElementList.splice(i,1),this.ticketList.removeChild(s.element)):a||(s=new g(this,r)),s&&(this.ticketElementList.length>0?(this.ticketList.insertBefore(s.element,this.ticketElementList[0].element),this.ticketElementList.unshift(s)):(this.ticketElementList.push(s),this.ticketList.appendChild(s.element))))})},r.onMessageReceived=(e,t)=>{if(!this.currentTab||this.currentTab===d.a.Ticket.Status.OPEN){let n=null;try{n=t.data?JSON.parse(t.data):null}catch(e){throw e}d.a.Ticket.getByChannelUrl(e.url,(r,i)=>{if(i)throw i;const s=r;n&&n.ticket&&(s.status=n.ticket.status),t.isAssigned=n&&n.type===d.a.Message.DataType.TICKET_ASSIGN,t.isTransferred=n&&n.type===d.a.Message.DataType.TICKET_TRANSFER,t.isClosed=n&&n.type===d.a.Message.DataType.TICKET_CLOSE,(t.isAssigned||t.isTransferred)&&(s.agent=n.ticket.agent);const a=this.ticketElementList.findIndex(e=>e.ticket.id===s.id),o=a>=0?this.ticketElementList[a]:null;if(o&&(o.ticket=s,o.render(),t.isClosed&&(this.ticketElementList.splice(a,1),this.ticketList.removeChild(o.element))),!this.active&&d.a.isDeskChannel(e)&&f.isVisible(t)){const e=new y(s,t);e.render(),e.onClick(t=>{e.close(),this.payloadTicket=t,this.action.click()}),e.open(this)}}),this.dialog&&this.dialog.isOpened&&this.dialog.ticket.channel.url===e.url&&(f.isVisible(t)&&this.dialog.appendMessage(t),this.dialog.ticket.channel.markAsRead(()=>{}))}},r.onMessageUpdated=(e,t)=>{this.currentTab===d.a.Ticket.Status.OPEN&&d.a.Ticket.getByChannelUrl(e.url,(n,r)=>{if(r)throw r;const i=n;let s=null;try{s=t.data?JSON.parse(t.data):null}catch(e){throw e}s&&s.ticket&&(i.status=s.ticket.status);let a=this.ticketElementList.findIndex(e=>e.ticket.id===i.id),o=a>=0?this.ticketElementList[a]:null;if(t.isClosureInquired=s&&s.type===d.a.Message.DataType.TICKET_INQUIRE_CLOSURE,t.isClosureInquired){switch(s.body.state){case d.a.Message.ClosureState.CONFIRMED:i.status=d.a.Ticket.Status.CLOSED,o&&(this.ticketElementList.splice(a,1),this.ticketList.removeChild(o.element))}}this.dialog&&this.dialog.isOpened&&this.dialog.ticket.channel.url===e.url&&(this.dialog.updateMessage(t),i.status===d.a.Ticket.Status.CLOSED&&this.dialog.disableForm())})},this.sendbird.addChannelHandler("widget",r)})})})}loadTicket(e,t,n){switch(e){case d.a.Ticket.Status.OPEN:d.a.Ticket.getOpenedList(t,(e,t)=>{const r=e;this.noMoreTicket=r.length<d.a.Ticket.defaultLimit,n(e,t)});break;case d.a.Ticket.Status.CLOSED:d.a.Ticket.getClosedList(t,(e,t)=>{const r=e;this.noMoreTicket=r.length<d.a.Ticket.defaultLimit,n(e,t)});break;default:n(null,[])}}appendTicket(e){const t=new g(this,e);this.ticketElementList.push(t),this.ticketList.appendChild(t.element)}clearTicket(){this.ticketElementList=[],this.ticketList.removeAll("-sbd-ticket-item")}signout(){this.sendbird.disconnect(()=>{o.send("signout"),this.panel.hasClass("fade-in")&&(this.panel.toggleClass("fade-in"),setTimeout(()=>{this.element.removeChild(this.panel)},250)),this.element.removeChild(this.action)})}isBottom(){return this.ticketList.scrollHeight-this.ticketList.scrollTop===this.ticketList.clientHeight}startNewDialog(e){this.dialog=new p(e),this.dialog.open(this)}}class _{constructor(){const e=!!window.localStorage,t={appId:"",userId:"",nickname:""},n={active:!1,wsHost:"",apiHost:""};e&&(t.appId=localStorage.getItem("sb-desk-appId")||"",t.userId=localStorage.getItem("sb-desk-userId")||"",t.nickname=localStorage.getItem("sb-desk-nickname")||"",n.active="true"===localStorage.getItem("sb-desk-advanced")||!1,n.wsHost=localStorage.getItem("sb-desk-advanced-wshost")||"",n.apiHost=localStorage.getItem("sb-desk-advanced-apihost")||"",n.deskApiHost=localStorage.getItem("sb-desk-advanced-deskApihost")||""),this.element=i(`<div class='-sbd-login-background'>\n          <div class='-sbd-login'>\n            <div class='logo'></div>\n            <div class='title'><span class='bold'>Desk Widget</span> Login</div>\n            <div class='panel'>\n              <div class='form form-login'>\n                <span class='input-label'>App ID</span>\n                <input class='appId input' placeholder='App ID' value='${t.appId}'></input>\n                <span class='input-label'>User ID</span>\n                <input class='userId input' placeholder='User ID' value='${t.userId}'></input>\n                <span class='input-label'>Name</span>\n                <input class='nickname input' placeholder='Name' value='${t.nickname}'></input>\n                <div class='error'></div>\n              </div>\n              <div class='separator'></div>\n              <div class='control'>\n                <div class='advanced'>\n                  <div class='label'>Advanced</div>\n                </div>\n                <div class='login button'>Login</div>\n              </div>\n              <div class='form form-advanced'>\n                <span class='input-label'>Custom WebSocket host</span>\n                <input class='wsHost input' placeholder='Custom WebSocket host' value='${n.wsHost}'></input>\n                <span class='input-label'>Custom API host</span>\n                <input class='apiHost input' placeholder='Custom API host' value='${n.apiHost}'></input>\n                <span class='input-label'>Custom Desk API host</span>\n                <input class='deskApiHost input' placeholder='Custom Desk API host' value='${n.deskApiHost}'></input>\n              </div>\n            </div>\n          </div>\n        </div>`);const s=r(this.element.querySelector(".form-login .appId")),a=r(this.element.querySelector(".form-login .userId")),l=r(this.element.querySelector(".form-login .nickname"));let u=n.active;const c=r(this.element.querySelector(".advanced .label")),d=r(this.element.querySelector(".form-advanced"));c.on("click",()=>{c.toggleClass("open"),u=!u,u?d.show():d.hide()}),u?d.show():d.hide();const h=r(this.element.querySelector(".form-advanced .wsHost")),f=r(this.element.querySelector(".form-advanced .apiHost")),p=r(this.element.querySelector(".form-advanced .deskApiHost"));const g=r(this.element.querySelector(".form-login .error"));r(this.element.querySelector(".control .login")).on("click",()=>{const t={appId:s.val(),userId:a.val(),nickname:l.val()};if(t.appId&&t.userId&&t.nickname){const n={};e&&(localStorage.setItem("sb-desk-appId",t.appId),localStorage.setItem("sb-desk-userId",t.userId),localStorage.setItem("sb-desk-nickname",t.nickname),u&&(n.wsHost=h.val(),n.apiHost=f.val(),n.deskApiHost=p.val(),localStorage.setItem("sb-desk-advanced-wshost",n.wsHost),localStorage.setItem("sb-desk-advanced-apihost",n.apiHost),localStorage.setItem("sb-desk-advanced-deskApihost",n.deskApiHost)),localStorage.setItem("sb-desk-advanced",u&&n.wsHost&&n.apiHost&&n.deskApiHost?"true":"false")),new m(t,n),this.hide()}else g.html("Insert app ID, user ID and name to login."),g.show()}),o.subscribe("signout",()=>this.show()),this.show()}show(){document.body.appendChild(this.element),this.element.addClass("shown")}hide(){this.element.removeClass("shown"),setTimeout(()=>{document.body.removeChild(this.element)},2e3)}}window.onload=()=>{new _}}]);